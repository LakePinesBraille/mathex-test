(function(e,t,n){if(!e.EquationEditorAPI){var r=e.EquationEditorOptions||{};document.readyState==="complete"&&r.factory!==!0&&(r.factory=!1),e.TN8&&(r.scriptLoader=!1),t().loadScripts(r,function(){var t=e.EquationEditorAPI=n();r.factory!==!1&&(r.process!==!1?t.process(r):t.initialize(r))})}})(this,function(){var e=function(){},t={scriptLoader:!0,scriptSrc:"equationeditor",scriptBase:"../../lib",scriptKeys:["jquery","bootstrap","mathjax"],scripts:{jquery:"jquery-3.3.1.min.js","jquery-ui":"jquery-ui-1.12.1.min.js",bootstrap:"bootstrap-3.3.7.min.js",mathjax:"mathjax-2.7.0/MathJax.js?noContrib"}},n={config:["MML_CHTML.js"],messageStyle:"none",showMathMenu:!1,mml2jax:{preview:"none"},"fast-preview":{disabled:!0},menuSettings:{context:"Browser",inTabOrder:!1},extensions:["AssistiveMML.js"],AssistiveMML:{disabled:!1}},r=function(e){var t=document.getElementsByTagName("script");for(var n=0;n<t.length;n+=1){var r=t[n].getAttribute("src");if(r&&r.indexOf(e)!==-1)return t[n]}return null},i=function(e,t,n){if(n===e.scriptKeys.length){t();return}var s=e.scriptKeys[n];if(!e.scripts.hasOwnProperty(s)||r(s)){i(e,t,n+1);return}var o=document.createElement("script");o.src=e.scriptBase+"/"+e.scripts[s],o.onload=function(){i(e,t,n+1)};var u=r(e.scriptSrc);u&&u.parentNode.insertBefore(o,u)};return e.loadScripts=function(e,r){var s={};for(var o in t)t.hasOwnProperty(o)&&(s[o]=t[o],e.hasOwnProperty(o)&&(s[o]=e[o]));if(!s.scriptLoader){r();return}!window.MathJax&&s.scriptKeys.indexOf("mathjax")!==-1&&(window.MathJax=n),i(s,r,0)},e},function(){var e,t,n;return function(r){function d(e,t){return h.call(e,t)}function v(e,t){var n,r,i,s,o,u,a,f,c,h,p=t&&t.split("/"),d=l.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(f=0;f<e.length;f+=1){h=e[f];if(h===".")e.splice(f,1),f-=1;else if(h===".."){if(f===1&&(e[2]===".."||e[0]===".."))break;f>0&&(e.splice(f-1,2),f-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(f=n.length;f>0;f-=1){r=n.slice(0,f).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=f;break}}}if(s)break;!u&&v&&v[r]&&(u=v[r],a=f)}!s&&u&&(s=u,o=a),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function m(e,t){return function(){return s.apply(r,p.call(arguments,0).concat([e,t]))}}function g(e){return function(t){return v(t,e)}}function y(e){return function(t){a[e]=t}}function b(e){if(d(f,e)){var t=f[e];delete f[e],c[e]=!0,i.apply(r,t)}if(!d(a,e)&&!d(c,e))throw new Error("No "+e);return a[e]}function w(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function E(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice;o=function(e,t){var n,r=w(e),i=r[0];return e=r[1],i&&(i=v(i,t),n=b(i)),i?n&&n.normalize?e=n.normalize(e,g(t)):e=v(e,t):(e=v(e,t),r=w(e),i=r[0],e=r[1],i&&(n=b(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return m(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:E(e)}}},i=function(e,t,n,i){var s,l,h,p,v,g=[],w;i=i||e;if(typeof n=="function"){t=!t.length&&n.length?["require","exports","module"]:t;for(v=0;v<t.length;v+=1){p=o(t[v],i),l=p.f;if(l==="require")g[v]=u.require(e);else if(l==="exports")g[v]=u.exports(e),w=!0;else if(l==="module")s=g[v]=u.module(e);else if(d(a,l)||d(f,l)||d(c,l))g[v]=b(l);else{if(!p.p)throw new Error(e+" missing "+l);p.p.load(p.n,m(i,!0),y(l),{}),g[v]=a[l]}}h=n.apply(a[e],g);if(e)if(s&&s.exports!==r&&s.exports!==a[e])a[e]=s.exports;else if(h!==r||!w)a[e]=h}else e&&(a[e]=n)},e=t=s=function(e,t,n,a,f){return typeof e=="string"?u[e]?u[e](t):b(o(e,t).f):(e.splice||(l=e,t.splice?(e=t,t=n,n=null):e=r),t=t||function(){},typeof n=="function"&&(n=a,a=f),a?i(r,e,t,n):setTimeout(function(){i(r,e,t,n)},4),s)},s.config=function(e){return l=e,l.deps&&s(l.deps,l.callback),s},n=function(e,t,n){t.splice||(n=t,t=[]),!d(a,e)&&!d(f,e)&&(f[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("almond",function(){}),n("editor/util/Object",[],function(){var e=function(){return this},t=/function\s*(\w+)/,n={}.toString;return e.typeOf=function(r){if(e.isUndefined(r))return"undefined";if(e.isNull(r))return"null";if(r.constructor&&r.constructor.name)return r.constructor.name;if(r.constructor&&typeof r.constructor.toString=="function"){var i=r.constructor.toString().match(t);return i&&i.length===2?i[1]:"anonymous"}var s=n.call(r);return s.substring(8,s.length-1)},e.isUndefined=function(e){return e===undefined},e.isNull=function(e){return e===null},e.isFalse=function(e){return e===!1},e.isTrue=function(e){return e===!0},e.isBoolean=function(e){return e===!0||e===!1},e.isZero=function(e){return e===0},e.isOne=function(e){return e===1},e.isInteger=function(t){return e.isNumber(t)&&(t|0)===t},e.isNumber=function(t){return e.typeOf(t)==="Number"},e.isFinite=function(t){return e.isNumber(t)&&t-t===0},e.isInfinite=function(t){return e.isNumber(t)&&t-t!==0&&!isNaN(t)},e.isNaN=function(t){return e.isNumber(t)&&isNaN(t)},e.isString=function(t){return e.typeOf(t)==="String"},e.isArray=function(t){return e.typeOf(t)==="Array"},e.isObject=function(t){return e.typeOf(t)==="Object"},e.toBoolean=function(t){return e.isBoolean(t)?t:t==="true"?!0:t==="false"?!1:undefined},e.toInteger=function(t){if(e.isInteger(t))return t;var n=parseFloat(t);return e.isInteger(n)?n:undefined},e.toNumber=function(t){if(e.isFinite(t))return t;var n=parseFloat(t);return e.isFinite(n)?n:undefined},e.toByte=function(e){return e&255},e.isByte=function(t){return t===e.toByte(t)},e.toInt=function(e){return e|0},e.isInt=function(t){return t===e.toInt(t)},e.toUInt=function(t){return t=e.toInt(t),t>=0?t:t+4294967296},e.isUInt=function(t){return t===e.toUInt(t)},e.extend=function(t){if(!e.isObject(t))return t;var n,r,i;for(n=1;n<arguments.length;n+=1){r=arguments[n];if(e.isObject(r))for(i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}return t},e}),n("editor/util/Array",["lib/jquery","editor/util/Object"],function(e,t){var n=function(){return this};return n.isArray=t.isArray,n.each=function(t,n){e.each(t,function(e,t){return n(t,e)})},n.isEmpty=function(e){return n.isArray(e)&&e.length===0},n.contains=function(t){if(n.isArray(t)){var r;for(r=1;r<arguments.length;r+=1)if(e.inArray(arguments[r],t)===-1)return!1;return!0}return!1},n.copy=function(e){return n.isArray(e)?e.slice():e},n.add=function(e){if(n.isArray(e)){var t;for(t=1;t<arguments.length;t+=1)e.push(arguments[t])}return e},n.addAt=function(e,t){if(n.isArray(e)){var r;for(r=2;r<arguments.length;t+=1,r+=1)e.splice(t,0,arguments[r])}return e},n.remove=function(t){if(n.isArray(t)){var r,i;for(i=1;i<arguments.length;i+=1)r=e.inArray(arguments[i],t),n.removeAt(t,r)}return t},n.removeAt=function(e,t){return n.isArray(e)&&0<=t&&t<e.length&&e.splice(t,1),e},n}),n("editor/util/Char",[],function(){var e=function(){return this};return e.lf=10,e.cr=13,e.space=32,e.bang=33,e.quote=34,e.hash=35,e.dollar=36,e.percent=37,e.amp=38,e.apos=39,e.lparen=40,e.rparen=41,e.star=42,e.plus=43,e.comma=44,e.dash=45,e.dot=46,e.slash=47,e.zero=48,e.nine=57,e.colon=58,e.semi=59,e.lt=60,e.equal=61,e.gt=62,e.qmark=63,e.at=64,e.A=65,e.Z=90,e.lbrack=91,e.bslash=92,e.rbrack=93,e.circ=94,e.under=95,e.grave=96,e.a=97,e.z=122,e.lbrace=123,e.vert=124,e.rbrace=125,e.tilde=126,e.del=127,e.isSpace=function(t){return t<=e.space},e.isLetter=function(t){return e.isUpper(t)||e.isLower(t)},e.isUpper=function(t){return e.A<=t&&t<=e.Z},e.toUpper=function(t){return e.isLower(t)?t-e.a+e.A:t},e.isLower=function(t){return e.a<=t&&t<=e.z},e.toLower=function(t){return e.isUpper(t)?t-e.A+e.a:t},e.isDigit=function(t,n){return 2<=n&&n<=36||(n=10),n!==10?e.toDigit(t,n)!==-1:e.zero<=t&&t<=e.nine},e.toDigit=function(t,n){2<=n&&n<=36||(n=10);var r=-1;return e.isDigit(t)?r=t-e.zero:e.isUpper(t)?r=t-e.A+10:e.isLower(t)&&(r=t-e.a+10),0<=r&&r<n?r:-1},e.compare=function(t,n){return e.isUpper(t)&&(t=e.toLower(t)),e.isUpper(n)&&(n=e.toLower(n)),t===n},e}),n("editor/util/Key",[],function(){var e=function(){return this};return e.BACKSPACE=8,e.TAB=9,e.CENTER=12,e.ENTER=13,e.SHIFT=16,e.CTRL=17,e.ALT=18,e.PAUSE=19,e.CAPS_LOCK=20,e.ESCAPE=27,e.SPACE=32,e.PAGE_UP=33,e.PAGE_DOWN=34,e.END=35,e.HOME=36,e.LEFT=37,e.UP=38,e.RIGHT=39,e.DOWN=40,e.INSERT=45,e.DELETE=46,e.META=91,e.MENU=93,e.NUM=144,e.SCROLL=145,e.SEMI2=59,e.EQUAL2=61,e.MINUS2=173,e.SEMI=186,e.EQUAL=187,e.COMMA=188,e.DASH=189,e.DOT=190,e.SLASH=191,e.GRAVE=192,e.LBRACK=219,e.BSLASH=220,e.RBRACK=221,e.QUOTE=222,e.PLUS=107,e.MINUS=109,e.TIMES=106,e.DIVIDE=111,e.F1=112,e.F2=113,e.F3=114,e.F4=115,e.F5=116,e.F6=117,e.F7=118,e.F8=119,e.F9=120,e.F10=121,e.F11=122,e.F12=123,e.names={},e.names[e.BACKSPACE]="bs",e.names[e.TAB]="tab",e.names[e.CENTER]="center",e.names[e.ENTER]="enter",e.names[e.SHIFT]="shift",e.names[e.PAUSE]="pause",e.names[e.ESCAPE]="esc",e.names[e.SPACE]=" ",e.names[e.PAGE_UP]="pageUp",e.names[e.PAGE_DOWN]="pageDown",e.names[e.END]="end",e.names[e.HOME]="home",e.names[e.LEFT]="left",e.names[e.UP]="up",e.names[e.RIGHT]="right",e.names[e.DOWN]="down",e.names[e.INSERT]="insert",e.names[e.DELETE]="delete",e.names[e.SEMI2]=";",e.names[e.EQUAL2]="=",e.names[e.MINUS2]="-",e.names[e.SEMI]=";",e.names[e.EQUAL]="=",e.names[e.COMMA]=",",e.names[e.DASH]="-",e.names[e.DOT]=".",e.names[e.SLASH]="/",e.names[e.GRAVE]="`",e.names[e.LBRACK]="[",e.names[e.BSLASH]="\\",e.names[e.RBRACK]="]",e.names[e.QUOTE]="'",e.names[e.PLUS]="+",e.names[e.MINUS]="-",e.names[e.TIMES]="*",e.names[e.DIVIDE]="/",e.names[e.F1]="f1",e.names[e.F2]="f2",e.names[e.F3]="f3",e.names[e.F4]="f4",e.names[e.F5]="f5",e.names[e.F6]="f6",e.names[e.F7]="f7",e.names[e.F8]="f8",e.names[e.F9]="f9",e.names[e.F10]="f10",e.names[e.F11]="f11",e.names[e.F12]="f12",e.shift={},e.shift[49]="!",e.shift[50]="@",e.shift[51]="#",e.shift[52]="$",e.shift[53]="%",e.shift[54]="^",e.shift[55]="&",e.shift[56]="*",e.shift[57]="(",e.shift[48]=")",e.shift[e.SEMI2]=":",e.shift[e.EQUAL2]="+",e.shift[e.MINUS2]="_",e.shift[e.SEMI]=":",e.shift[e.EQUAL]="+",e.shift[e.COMMA]="<",e.shift[e.DASH]="_",e.shift[e.DOT]=">",e.shift[e.SLASH]="?",e.shift[e.GRAVE]="~",e.shift[e.LBRACK]="{",e.shift[e.BSLASH]="|",e.shift[e.RBRACK]="}",e.shift[e.QUOTE]='"',e.shift[e.PLUS]="+",e.shift[e.MINUS]="-",e.shift[e.TIMES]="*",e.shift[e.DIVIDE]="/",e.limitEnabled={bs:!0,clear:!0,reset:!0,"delete":!0,undo:!0,up:!0,down:!0,left:!0,right:!0,home:!0,end:!0,select:!0,"ctrl-a":!0,"ctrl-k":!0,"ctrl-z":!0,"shift-up":!0,"shift-down":!0,"shift-left":!0,"shift-right":!0,"ctrl-up":!0,"ctrl-down":!0,"ctrl-left":!0,"ctrl-right":!0},e.values={Unidentified:null,Dead:null,Alt:null,Control:null,Shift:null,NumLock:null,CapsLock:null,ScrollLock:null,ContextMenu:null,AltGraph:null,Fn:null,FnLock:null,Hyper:null,Meta:null,Pause:null,PrintScreen:null,Super:null,Symbol:null,SymbolLock:null,Enter:"enter",Tab:"tab",Backspace:"bs",Delete:"delete",Insert:"insert",Escape:"esc",Home:"home",End:"end",PageUp:"pageUp",PageDown:"pageDown",ArrowLeft:"left",ArrowUp:"up",ArrowDown:"down",ArrowRight:"right",Cut:"cut",Copy:"copy",Paste:"paste",Clear:null,Undo:"undo",Redo:"redo",F1:"f1",F2:"f2",F3:"f3",F4:"f4",F5:"f5",F6:"f6",F7:"f7",F8:"f8",F9:"f9",F10:"f10",F11:"f11",F12:"f12",UIKeyInputEscape:"esc",UIKeyInputLeftArrow:"left",UIKeyInputUpArrow:"up",UIKeyInputRightArrow:"right",UIKeyInputDownArrow:"down","´Y":"Ý","´y":"ý"},e.codes={UIKeyInputEscape:e.ESCAPE,UIKeyInputLeftArrow:e.LEFT,UIKeyInputUpArrow:e.UP,UIKeyInputRightArrow:e.RIGHT,UIKeyInputDownArrow:e.DOWN},e.getKeyCode=function(t){var n=t.keyCode;if(n)return n;var r=t.key;return r&&e.codes.hasOwnProperty(r)?e.codes[r]:0},e}),n("editor/util/Event",[],function(){var e=function(){return this};return e.FOCUS_IN="focusin",e.FOCUS_OUT="focusout",e.KEY_DOWN="keydown",e.KEY_UP="keyup",e.KEY_PRESS="keypress",e.MOUSE_OVER="mouseover",e.MOUSE_OUT="mouseout",e.MOUSE_DOWN="mousedown",e.MOUSE_UP="mouseup",e.MOUSE_ENTER="mouseenter",e.MOUSE_LEAVE="mouseleave",e.MOUSE_MOVE="mousemove",e.TOUCH_START="touchstart",e.TOUCH_MOVE="touchmove",e.TOUCH_END="touchend",e.CLICK="click",e.DOUBLE="dblclick",e.CONTEXT_MENU="contextmenu",e.COLOR_CHANGE="tn.accessibility.contrastColorChange",e}),n("editor/util/Symbol",["editor/util/Object"],function(e){var t=function(){return this},n=function(){return this};t.PACKAGE_NAME_ERROR="The package name for a symbol must be a string.",t.LOCAL_NAME_ERROR="The symbol name for a symbol must be a string.",t.prototype._package=null,t.prototype._localName=null,t.prototype._atts=null,t.prototype._string=null;var r=function(t,n){return e.hasOwnProperty.call(t,n)},i=function(e,n){var r=new t;return r._package=e,r._localName=n,r._atts={},r};t.getInstance=function(t,r){return e.isUndefined(r)&&(r=""),n.getInstance(r).getSymbol(t)},t.prototype.getPackageName=function(){return this._package.getPackageName()},t.prototype.getLocalName=function(){return this._localName},t.prototype.toString=function(){return this._string===null&&(this._string=this._package.toString()+":"+this._localName),this._string},t.prototype.hashCode=function(){var e=this._localName,t={alt:!0,ctrl:!0,shift:!0,left:!0,right:!0,middle:!0},n=0,r=0,i=0,s=e.indexOf("-",i+1);while(s!==-1){if(!t[e.substring(i,s)])break;i=s+1,s=e.indexOf("-",i+1)}var o=e.length;for(i;i<o;i+=1)n=(n<<4)+e.charCodeAt(i),r=n&4026531840,r!==0&&(n^=r>>24),n&=~r;return n&16777215},t.prototype.print=function(){var e=this.getLocalName();if(!e.length||e.search(/["'()\x00-\x20]/)!==-1){var t=e.indexOf('"')===-1?'"':"'";return t+e+t}return e},t.get=t.getInstance,t.prototype.getURI=t.prototype.getPackageName,t.prototype.getName=t.prototype.getLocalName,t.prototype.getAttr=function(e){return r(this._atts,e)?this._atts[e]:null},t.prototype.setAttr=function(e,t){return this._atts[e]=t,this};var s={};n.prototype._string=null,n.prototype._packageName=null,n.prototype._symbols=null;var o=function(e){var t=new n;return t._packageName=e,t._symbols={},t},u=function(e){return s[e]},a=function(e,t){s[e]=t},f=function(e){return r(this._symbols,e)?this._symbols[e]:null},l=function(e,t){this._symbols[e]=t};return n.getInstance=function(n){e.isString(n)||t.error(t.PACKAGE_NAME_ERROR);var r=u(n);return r?r:(r=o(n),a(n,r),r)},n.prototype.getPackageName=function(){return this._packageName},n.prototype.getSymbol=function(n){e.isString(n)||t.error(t.LOCAL_NAME_ERROR);var r=f.call(this,n);return r?r:(r=i(this,n),l.call(this,n,r),r)},n.prototype.toString=function(){return this._string===null&&(this._string="{"+this.getPackageName()+"}"),this._string},t.prototype.jasmineToString=t.prototype.toString,t.error=function(e){throw new Error(e)},t}),n("editor/util/Name",["editor/util/Symbol"],function(e){var t=function(){return this};return t.NS_INFO="http://math.pearson.com/MathEX",t.NS_USER="http://math.pearson.com/User",t.NS_MATH="http://www.w3.org/1998/Math/MathML",t.NS_HTML="http://www.w3.org/1999/xhtml",t.NS_XMLNS="http://www.w3.org/2000/xmlns/",t.get=function(t,n){return e.get(t,n)},t.info=function(e){return t.get(e,t.NS_INFO)},t.user=function(e){return t.get(e,t.NS_USER)},t.math=function(e){return t.get(e,t.NS_MATH)},t.html=function(e){return t.get(e,t.NS_HTML)},t.xmlns=function(e){return t.get(e,t.NS_XMLNS)},t.__xmlns=t.get("xmlns"),t._xmlns=t.xmlns("xmlns"),t._div=t.html("div"),t._p=t.html("p"),t._star=t.get("*"),t._null=t.get("@"),t._box=t.get("box","csymbol:basic"),t._gap=t.get("input","csymbol:basic"),t._html=t.html("html"),t._body=t.html("body"),t._hmath=t.html("math"),t._input=t.html("input"),t._b=t.html("b"),t._i=t.html("i"),t._u=t.html("u"),t._s=t.html("s"),t._tt=t.html("tt"),t._apply=t.math("apply"),t._basic=t.get("basic"),t._bvar=t.math("bvar"),t._cd=t.math("cd"),t._ci=t.math("ci"),t._cn=t.math("cn"),t._csymbol=t.math("csymbol"),t._fn=t.math("fn"),t._minus=t.math("minus"),t._mxf=t.math("mxf"),t._plus=t.math("plus"),t._reln=t.math("reln"),t._sep=t.math("sep"),t._times=t.math("times"),t._divide=t.math("divide"),t._slash=t.math("slash"),t._power=t.math("power"),t._root=t.math("root"),t._log=t.math("log"),t._baseline=t.math("baseline"),t._subscript=t.math("subscript"),t._superscript=t.math("superscript"),t._subsup=t.math("subsup"),t._presubscript=t.math("presubscript"),t._presuperscript=t.math("presuperscript"),t._presubsup=t.math("presubsup"),t._stack=t.math("stack"),t._tilde=t.math("tilde"),t._overbar=t.math("overbar"),t._underbar=t.math("underbar"),t._overscript=t.math("overscript"),t._underscript=t.math("underscript"),t._prime=t.math("prime"),t._dprime=t.math("dprime"),t._tprime=t.math("tprime"),t._sum=t.math("sum"),t._product=t.math("product"),t._limit=t.math("limit"),t._diff=t.math("diff"),t._partialdiff=t.math("partialdiff"),t._int=t.math("int"),t._pvar=t.math("pvar"),t._pvars=t.math("pvars"),t._maction=t.math("maction"),t._maligngroup=t.math("maligngroup"),t._malignmark=t.math("malignmark"),t._math=t.math("math"),t._menclose=t.math("menclose"),t._merror=t.math("merror"),t._mfenced=t.math("mfenced"),t._mfrac=t.math("mfrac"),t._mglyph=t.math("mglyph"),t._mi=t.math("mi"),t._mlabeledtr=t.math("mlabeledtr"),t._mlongdiv=t.math("mlongdiv"),t._mmultiscripts=t.math("mmultiscripts"),t._mn=t.math("mn"),t._mo=t.math("mo"),t._mover=t.math("mover"),t._mpadded=t.math("mpadded"),t._mphantom=t.math("mphantom"),t._mprescripts=t.math("mprescripts"),t._mroot=t.math("mroot"),t._mrow=t.math("mrow"),t._ms=t.math("ms"),t._mscarries=t.math("mscarries"),t._mscarry=t.math("mscarry"),t._msgroup=t.math("msgroup"),t._msline=t.math("msline"),t._mspace=t.math("mspace"),t._msqrt=t.math("msqrt"),t._msrow=t.math("msrow"),t._mstack=t.math("mstack"),t._mstyle=t.math("mstyle"),t._msub=t.math("msub"),t._msubsup=t.math("msubsup"),t._msup=t.math("msup"),t._mtable=t.math("mtable"),t._mtd=t.math("mtd"),t._mtext=t.math("mtext"),t._mtr=t.math("mtr"),t._munder=t.math("munder"),t._munderover=t.math("munderover"),t._none=t.math("none"),t._abracket=t.math("abracket"),t._abs=t.math("abs"),t._bbrace=t.math("bbrace"),t._bbracket=t.math("bbracket"),t._bparen=t.math("bparen"),t._brace=t.math("brace"),t._bracket=t.math("bracket"),t._class=t.math("class"),t._norm=t.math("norm"),t._paren=t.math("paren"),t._unit=t.get("unit"),t._comma=t.get(","),t._it=t.get("&it;"),t._true=t.get("true"),t._symbol=t.info("symbol"),t._number=t.info("number"),t._unknown=t.info("unknown"),t._infix=t.info("infix"),t._ipower=t.info("power"),t._fraction=t.info("fraction"),t._sub=t.info("sub"),t._sup=t.info("sup"),t._prefix=t.info("prefix"),t._suffix=t.info("suffix"),t._iparen=t.info("paren"),t._args=t.info("args"),t._arg=t.info("arg"),t._op=t.info("op"),t._this=t.info("this"),t._close=t.info("close"),t._child=t.info("child"),t._attrib=t.info("attrib"),t._phase=t.math("phase"),t._pre=t.get("pre"),t._post=t.get("post"),t._blur=t.info("blur"),t._focus=t.info("focus"),t._mouse=t.info("mouse"),t._group=t.info("group"),t._ungroup=t.info("ungroup"),t._select=t.info("select"),t._unselect=t.info("unselect"),t._middle=t.info("middle"),t._braille=t.info("braille"),t._cursor=t.info("cursor"),t._assoc=t.info("assoc"),t._nary=t.info("nary"),t._array=t.info("array"),t._text=t.info("text"),t._edit=t.info("edit"),t._side=t.info("side"),t._imath=t.info("math"),t._inone=t.info("none"),t._sense=t.info("sense"),t._mathit=t.info("mathit"),t._detect=t.info("detect"),t._abbrev=t.info("abbrev"),t._accept=t.info("accept"),t._echo=t.info("echo"),t._speech=t.math("speech"),t._context=t.info("context"),t._actions=t.info("actions"),t._keys=t.info("keys"),t._doc=t.info("doc"),t._in=t.info("in"),t._out=t.info("out"),t._up=t.info("up"),t._down=t.info("down"),t._left=t.info("left"),t._right=t.info("right"),t._home=t.info("home"),t._end=t.info("end"),t._done=t.info("done"),t._iroot=t.info("root"),t._leaf=t.info("leaf"),t._last=t.info("last"),t._place=t.info("place"),t._stop=t.info("stop"),t._extend=t.info("extend"),t._sibling=t.info("sibling"),t._implicit=t.info("implicit"),t._row=t.info("row"),t._col=t.info("col"),t._elt=t.info("elt"),t._wrap=t.info("wrap"),t._insert=t.info("insert"),t._delete=t.info("delete"),t._merge=t.info("merge"),t._split=t.info("split"),t._flat=t.info("flat"),t._head=t.info("head"),t._tail=t.info("tail"),t._function=t.info("function"),t._keyboard=t.info("keyboard"),t._mode=t.info("mode"),t._quote=t.info("quote"),t._cut=t.info("cut"),t._copy=t.info("copy"),t._paste=t.info("paste"),t._undo=t.info("undo"),t._redo=t.info("redo"),t._reset=t.info("reset"),t._clear=t.info("clear"),t._content=t.info("content"),t._present=t.info("present"),t._popup=t.info("popup"),t._constants={pi:"pi",imaginaryi:"ii",exponentiale:"ee",infinity:"inf"},t._units={pi:"pi",ii:"imaginaryi",ee:"exponentiale",inf:"infinity","in":t.get("in"),ft:t.get("ft"),yd:t.get("yd"),mi:t.get("mi"),pt:t.get("pt"),qt:t.get("qt"),gal:t.get("gal"),tsp:t.get("tsp"),tbsp:t.get("tbsp"),oz:t.get("oz"),lb:t.get("lb"),min:t.get("min"),wk:t.get("wk"),mo:t.get("mo"),yr:t.get("yr"),kWh:t.get("kWh"),mm:t.get("mm"),cm:t.get("cm"),km:t.get("km"),mg:t.get("mg"),kg:t.get("kg"),mL:t.get("mL"),kL:t.get("kL")},t._functions={sin:t.math("sin"),cos:t.math("cos"),tan:t.math("tan"),sec:t.math("sec"),csc:t.math("csc"),cot:t.math("cot"),asin:t.math("arcsin"),acos:t.math("arccos"),atan:t.math("arctan"),asec:t.math("arcsec"),acsc:t.math("arccsc"),acot:t.math("arccot"),arcsin:t.math("arcsin"),arccos:t.math("arccos"),arctan:t.math("arctan"),arcsec:t.math("arcsec"),arccsc:t.math("arccsc"),arccot:t.math("arccot"),sine:t.math("sin"),cosine:t.math("cos"),tangent:t.math("tan"),secant:t.math("sec"),cosecant:t.math("csc"),cotangent:t.math("cot"),arcsine:t.math("arcsin"),arccosine:t.math("arccos"),arctangent:t.math("arctan"),arcsecant:t.math("arcsec"),arccosecant:t.math("arccsc"),arccotangent:t.math("arccot"),exp:t.math("exp"),log:t.math("log"),ln:t.math("ln")},t._nsprefix={},t._nsprefix[t.NS_INFO]="i:",t._nsprefix[t.NS_USER]="u:",t._nsprefix[t.NS_HTML]="h:",t}),n("editor/util/Buffer",["editor/util/Object","editor/util/Char","editor/util/Array"],function(e,t,n){var r=function(){return this};return r.create=function(e){var t=new r;return t.setData(e),t},r.prototype.setData=function(t){e.isString(t)||(t=""),this.data=t,this.length=t.length,this.offset=0},r.prototype.getChar=function(e){return 0<=e&&e<this.length?this.data.charCodeAt(e):0},r.prototype.getString=function(t,n){return e.isInteger(n)||(n=this.offset),0<=t&&t<this.length?this.data.substring(t,n):""},r.prototype.matchToken=function(e){var n,r,i;for(i=0;i<e.length;i+=1){n=this.getChar(this.offset+i),r=e.charCodeAt(i);if(!t.compare(n,r))return!1}return this.offset+=e.length,!0},r.prototype.scanSpace=function(){var e=this.offset,n=this.length,r=e;for(e;e<n;e+=1)if(!t.isSpace(this.getChar(e)))break;return this.offset=e,e>r},r.prototype.scanNSpace=function(){this.scanSpace();var e=this.offset,n=this.length,r=e;for(e;e<n;e+=1)if(t.isSpace(this.getChar(e)))break;return this.offset=e,e>r},r.prototype.scanDone=function(){this.scanSpace();var e=this.offset,t=this.length;return e===t},r.prototype.scanToken=function(){this.scanSpace();var e=this.offset,n=this.length,r=e,i;for(e;e<n;e+=1){i=this.getChar(e);if(i===t.lparen||i===t.rparen||t.isSpace(i))break}return this.offset=e,e>r},r.prototype.scanString=function(){this.scanSpace();var e=this.offset,n=this.length,r=e,i=this.getChar(e);if(i===t.quote||i===t.apos)for(e+=1;e<n;e+=1)if(this.getChar(e)===i){e+=1;break}return this.offset=e,e>r},r.prototype.scanChar=function(e){this.scanSpace();var t=this.offset,n=this.length,r=t;return t<n&&this.getChar(t)===e&&(t+=1),this.offset=t,t>r},r.prototype.scanFn=function(e){this.scanSpace();var n=this.offset;return this.matchToken(e)&&this.scanChar(t.lparen)?!0:(this.offset=n,!1)},r.prototype.scanNatural=function(){this.scanSpace();var e=this.offset,n=this.length,r=e;for(e;e<n;e+=1)if(!t.isDigit(this.getChar(e)))break;return this.offset=e,e>r},r.prototype.scanInteger=function(){this.scanSpace();var e=this.offset;this.scanChar(t.plus)||this.scanChar(t.dash),this.scanSpace();var n=this.offset,r=this.length,i=n;for(n;n<r;n+=1)if(!t.isDigit(this.getChar(n)))break;return this.offset=n>i?n:e,n>i},r.prototype.scanNumber=function(){this.scanSpace();var e=!1,n=!1,r=this.offset;this.scanChar(t.dash),this.scanSpace();var i=this.offset,s=this.length,o;for(i;i<s;i+=1){o=this.getChar(i);if(t.isDigit(o))e=!0;else{if(o!==t.dot||!!n)break;n=!0}}return this.offset=e?i:r,e},r.prototype.scanEnum=function(e){this.scanSpace();if(!n.isArray(e))return!1;var t;for(t=e.length-1;t>=0;t-=1)if(this.matchToken(e[t]))return!0;return!1},r.prototype.scanBool=function(){var e=["true","false"];return this.scanEnum(e)},r.prototype.scanColor=function(){var e=["black","silver","gray","white","maroon","red","purple","fuchsia","green","lime","olive","yellow","navy","blue","teal","aqua"];return this.scanEnum(e)},r.prototype.scanRGB=function(){if(!this.scanChar(t.hash))return!1;var e=this.offset,n=this.length,r=e;for(e;e<n;e+=1)if(t.toDigit(this.getChar(e),16)===-1)break;var i=e-r===3||e-r===6;return this.offset=i?e:r-1,i},r.prototype.scanUnit=function(){var e=["%","em","ex","px","in","cm","mm","pt","pc","mu"];return this.scanEnum(e)},r.prototype.scanSize=function(e){n.isArray(e)||(e=["%","em","ex","px","in","cm","mm","pt","pc","mu"]),this.scanSpace();var t=this.offset,r=this.scanNumber(),i=this.scanEnum(e);return r&&i?!0:(this.offset=t,this.scanEnum(["0"]))},r.prototype.scanPseudoUnit=function(){var e=["height","depth","width","lspace","voffset"];return this.scanEnum(e)},r.prototype.scanNamedSpace=function(){var e=["veryverythinmathspace","verythinmathspace","thinmathspace","mediummathspace","thickmathspace","verythickmathspace","veryverythickmathspace"];return this.scanEnum(e)},r}),n("editor/util/ByteBuffer",[],function(){var e=function(){return this};return e.create=function(t){var n=new e;return n.setData(t),n},e.prototype.setData=function(e){e instanceof Uint8Array||(e=new Uint8Array),this.data=e,this.length=e.length,this.offset=0},e.prototype.getValue=function(e){return this.data[e]||0},e.prototype.setValue=function(e,t){0<=e&&e<this.length&&(this.data[e]=t)},e.prototype.getPosition=function(){return this.offset},e.prototype.setPosition=function(e){this.offset=e},e.prototype.more=function(){return this.offset<this.length},e.prototype.done=function(){this.offset=this.length},e.prototype.loadByte=function(){var e=this.offset;return this.offset+=1,this.getValue(e)},e.prototype.saveByte=function(e){var t=this.offset;this.offset+=1,this.setValue(t,e)},e.prototype.loadInt=function(){var t=0,n=0;this.more()&&(t=this.loadByte());if((t&e.bit(7))!==0){var r=0;while((t&e.bit(7))!==0)t<<=1,r+=1;t=(t&e.bits(8))>>r;var i;for(i=1;i<r&&this.more();i+=1)n=this.loadByte(),(n&192)===128?t=e.put6(t,n):this.done()}return t},e.prototype.saveInt=function(t){t<e.bit(7)?this.saveByte(t):t<e.bit(11)?(this.saveByte(192+e.get6(t,1)),this.saveByte(128+e.get6(t,0))):t<e.bit(16)?(this.saveByte(224+e.get6(t,2)),this.saveByte(128+e.get6(t,1)),this.saveByte(128+e.get6(t,0))):t<e.bit(21)?(this.saveByte(240+e.get6(t,3)),this.saveByte(128+e.get6(t,2)),this.saveByte(128+e.get6(t,1)),this.saveByte(128+e.get6(t,0))):t<e.bit(26)?(this.saveByte(248+e.get6(t,4)),this.saveByte(128+e.get6(t,3)),this.saveByte(128+e.get6(t,2)),this.saveByte(128+e.get6(t,1)),this.saveByte(128+e.get6(t,0))):t<e.bit(31)&&(this.saveByte(252+e.get6(t,5)),this.saveByte(128+e.get6(t,4)),this.saveByte(128+e.get6(t,3)),this.saveByte(128+e.get6(t,2)),this.saveByte(128+e.get6(t,1)),this.saveByte(128+e.get6(t,0)))},e.bit=function(e){return 1<<e},e.bits=function(t){return e.bit(t)-1},e.getBits=function(t,n,r){return t>>r*n&e.bits(r)},e.putBits=function(t,n,r){return t<<r|n&e.bits(r)},e.get6=function(t,n){return e.getBits(t,n,6)},e.put6=function(t,n){return e.putBits(t,n,6)},e.get8=function(t,n){return e.getBits(t,n,8)},e.put8=function(t,n){return e.putBits(t,n,8)},e}),n("editor/util/Color",["editor/util/Object","editor/util/Char","editor/util/Buffer"],function(e,t,n){var r=function(){return this},i={},s={},o=n.create();o.parseColor=function(e){return this.setData(e),this.scanColor()?this.parseColorName():this.scanChar(t.hash)?this.parseColorHash():this.scanFn("rgb")?this.parseColorRGB():this.scanFn("rgba")?this.parseColorRGBA():r.transparent},o.parseColorName=function(){this.offset=0,this.scanSpace();var e=this.offset;this.scanColor();var t=this.getString(e).toLowerCase();return i.hasOwnProperty(t)?i[t]:r.transparent},o.parseColorHash=function(){var n=this.offset,i=this.length;for(n;n<i;n+=1)if(!t.isDigit(this.getChar(n),16))break;var s=0,o=0,u=0,a=255,f=this.offset;if(n-f===6)s=this.getHexDigit(0)*16+this.getHexDigit(1),o=this.getHexDigit(2)*16+this.getHexDigit(3),u=this.getHexDigit(4)*16+this.getHexDigit(5);else if(n-f===3)s=this.getHexDigit(0)*17,o=this.getHexDigit(1)*17,u=this.getHexDigit(2)*17;else if(n-f===8)a=this.getHexDigit(0)*16+this.getHexDigit(1),s=this.getHexDigit(2)*16+this.getHexDigit(3),o=this.getHexDigit(4)*16+this.getHexDigit(5),u=this.getHexDigit(6)*16+this.getHexDigit(7);else{if(n-f!==4)return r.transparent;a=this.getHexDigit(0)*17,s=this.getHexDigit(2)*17,o=this.getHexDigit(2)*17,u=this.getHexDigit(3)*17}return e.toUInt((a<<24)+(s<<16)+(o<<8)+u)},o.getHexDigit=function(e){return t.toDigit(this.getChar(this.offset+e),16)},o.parseColorRGB=function(){var t=this.parseColorValue(),n=this.parseColorValue(),r=this.parseColorValue(),i=255;return e.toUInt((i<<24)+(t<<16)+(n<<8)+r)},o.parseColorRGBA=function(){var t=this.parseColorValue(),n=this.parseColorValue(),r=this.parseColorValue(),i=this.parseColorValue();return e.toUInt((i<<24)+(t<<16)+(n<<8)+r)},o.parseColorValue=function(){var n=0,r=1,i=!1;this.scanSpace();var s=this.offset,o=this.length,u;for(s;s<o;s+=1){u=this.getChar(s);if(t.isDigit(u))n=10*n+t.toDigit(u),i&&(r*=10);else{if(u!==t.dot||!!i)break;i=!0}}return this.offset=s,this.scanChar(t.percent)&&(r*=100),this.scanChar(t.comma),r===1?Math.min(n,255):r<=n?255:e.toUInt((512*n+r)/(2*r))},r.valueOf=function(t){if(!t||!e.isString(t))return r.transparent;if(i.hasOwnProperty(t))return i[t];var n=o.parseColor(t);return i[t]=n,n},r.toString=function(t){if(s[t])return s[t];var n=e.toByte(t>>24),r=e.toByte(t>>16),i=e.toByte(t>>8),o=e.toByte(t),u;return n===255?u="rgb( "+r+", "+i+", "+o+" )":u="rgba( "+r+", "+i+", "+o+", "+n+" )",u};var u=function(t,n,r,o,u){e.isByte(n)||(n=0),e.isByte(r)||(r=0),e.isByte(o)||(o=0),e.isByte(u)||(u=255);var a=e.toUInt((u<<24)+(n<<16)+(r<<8)+o);return i[t]=a,s[a]=t,a};return r.transparent=u("transparent",0,0,0,0),r.black=u("black",0,0,0),r.blue=u("blue",0,0,255),r.lime=u("lime",0,255,0),r.aqua=u("aqua",0,255,255),r.red=u("red",255,0,0),r.fuchsia=u("fuchsia",255,0,255),r.yellow=u("yellow",255,255,0),r.white=u("white",255,255,255),r.navy=u("navy",0,0,128),r.green=u("green",0,128,0),r.teal=u("teal",0,128,128),r.maroon=u("maroon",128,0,0),r.purple=u("purple",128,0,128),r.olive=u("olive",128,128,0),r.gray=u("gray",128,128,128),r.silver=u("silver",192,192,192),r}),n("editor/util/Entity",["editor/util/Object"],function(t){var n=function(){return this},r,i;return n.isEntity=function(e){return!e||!t.isString(e)?!1:e.charAt(0)==="&"&&e.charAt(e.length-1)===";"},n.expand=function(e){if(!t.isString(e))return null;var i=e.indexOf("&");if(i===-1)return e;var s=e.indexOf(";",i);return s===-1?e:e.substring(0,i)+r(e,i+1,s)+n.expand(e.substring(s+1))},r=function(e,n,r){var s=e.charCodeAt(n);if(s===35||s===95){s=e.charCodeAt(n+1),s===88||s===120?s=parseInt(e.substring(n+2,r),16):s=parseInt(e.substring(n+1,r),10);if(t.isInteger(s))return String.fromCharCode(s)}return i[e.substring(n,r)]||null},i={Alpha:"Α",Beta:"Β",Chi:"Χ",Copf:"ℂ",Delta:"Δ",Epsilon:"Ε",Eta:"Η",Gamma:"Γ",Ifr:"ℑ",Iota:"Ι",Kappa:"Κ",Lambda:"Λ",Mu:"Μ",Nopf:"ℕ",Nu:"Ν",Omega:"Ω",Omicron:"Ο",OverBar:"‾",OverParenthesis:"⏜",Phi:"Φ",Pi:"Π",Popf:"ℙ",Psi:"Ψ",Qopf:"ℚ",Rfr:"ℜ",Rho:"Ρ",Rightarrow:"→",Ropf:"ℝ",Sigma:"Σ",Tau:"Τ",Theta:"Θ",Upsilon:"Υ",Xi:"Ξ",Zeta:"Ζ",Zopf:"ℤ",af:"⁡",aleph:"ℵ",alpha:"α",amp:"&",and:"∧",angle:"∠",angmsd:"∡",angrt:"∟",angsph:"∢",apos:"'",approx:"≈",ast:"*",because:"∵",beta:"β",bull:"•",cap:"∩",chi:"χ",circ:"ˆ",compfn:"∘",cong:"≅",cup:"∪",dd:"ⅆ",deg:"°",delta:"δ",divide:"÷",doteq:"≐",ee:"ⅇ",emptyset:"∅",epsilon:"ε",ensp:" ",equiv:"≡",eta:"η",exist:"∃",fltns:"▱",forall:"∀",frasl:"⁄",gamma:"γ",geq:"≥",gg:"≫",gt:">",ic:"⁣",ii:"ⅈ","in":"∈",infin:"∞","int":"∫",iota:"ι",ip:"⁤",it:"⁢",kappa:"κ",lambda:"λ",lceil:"⌈",leftrightarrow:"↔",leq:"≤",lfloor:"⌊",ll:"≪",lowast:"∗",lt:"<",mdash:"—",mid:"∣",mp:"∓",mu:"μ",nabla:"∇",napprox:"≉",nbsp:" ",ncong:"≇",ndash:"–",ne:"≠",nequiv:"≢",not:"¬",notin:"∉",nparallel:"∦",nperp:"⊥̸",nsim:"≁",nsimeq:"≄",nsub:"⊄",nsubseteq:"⊈",nsup:"⊅",nsupseteq:"⊉",nu:"ν",odot:"⊙",omega:"ω",omicron:"ο",oplus:"⊕",or:"∨",otimes:"⊗",parallel:"∥",part:"∂",perp:"⊥",phi:"φ",pi:"π",pm:"±",prec:"≺",preceq:"⪯",prod:"∏",propto:"∝",psi:"ψ",quot:'"',rceil:"⌉",rfloor:"⌋",rho:"ρ",rightarrow:"→",sdot:"⋅",setminus:"∖",sigma:"σ",sim:"∼",simeq:"≃",subset:"⊂",subseteq:"⊆",succ:"≻",succeq:"⪰",sum:"∑",supset:"⊃",supseteq:"⊇",tau:"τ",therefore:"∴",theta:"θ",times:"×",triangle:"▵",upsilon:"υ",xi:"ξ",zeta:"ζ"},n}),n("editor/util/XML",["lib/jquery","lib/require","editor/util/Object","editor/util/Array","editor/util/Entity"],function(e,t,n,r,i){var s=null,o=function(){return this};o.ELEMENT_NODE=1,o.ATTRIBUTE_NODE=2,o.TEXT_NODE=3,o.CDATA_SECTION_NODE=4,o.ENTITY_REFERENCE_NODE=5,o.ENTITY_NODE=6,o.PROCESSING_INSTRUCTION_NODE=7,o.COMMENT_NODE=8,o.DOCUMENT_NODE=9,o.DOCUMENT_TYPE_NODE=10,o.DOCUMENT_FRAGMENT_NODE=11,o.NOTATION_NODE=12;var u="http://www.w3.org/1999/xhtml",a="http://www.w3.org/1998/Math/MathML";o.use_namespace=!n.isUndefined(document.documentElement.hasAttributeNS),o.valueOf=function(t,r){try{if(!t||!n.isString(t))return null;r===null&&(r=""),n.isString(r)||(r=a),/&nbsp;/.exec(t)&&(t=t.replace(/&nbsp;/g,"&#x00A0;"));var i="<root xmlns='"+r+"'>"+t+"</root>",s=e.parseXML(i).documentElement;return o.trim(s),s.removeChild(o.contents(s)[0])||null}catch(u){return null}},o.trim=function(t){var n=function(){return this.nodeType===o.PROCESSING_INSTRUCTION_NODE||this.nodeType===o.COMMENT_NODE||this.nodeType===o.TEXT_NODE&&this.data.match(/^\s+$/)&&(this.parentNode.nodeName!=="p"||this.previousSibling===null&&this.nextSibling!==null||this.previousSibling!==null&&this.nextSibling===null)},r=function(){return this.nodeType===o.TEXT_NODE&&this.data.match(/\s/)&&this.parentNode.namespaceURI!==u},i=function(){this.data=e.trim(this.data)},s=function(){e(this).children().each(s),e(this).contents().filter(n).remove(),e(this).contents().filter(r).each(i)};return s.call(t),t},o.toString=function(e){if(!o.isNode(e))return"";if(XMLSerializer===undefined){var t=e.xml||e.outerHTML||"";return t=t.replace(/<\?[^>]*>/,""),t=t.replace(/<m:/g,"<"),t=t.replace(/<\/m:/g,"</"),t=t.replace(/ xmlns:m=\"http:\/\/www.w3.org\/1998\/Math\/MathML\"/g,""),t}var n=(new XMLSerializer).serializeToString(e);return e.tagUrn&&e.namespaceURI&&e.tagUrn!==e.namespaceURI&&(n=n.replace(' xmlns="'+e.namespaceURI+'"',"")),n.indexOf("<input>")!==-1&&n.indexOf("</input>")===-1&&(n=n.replace(/<input>/g,"<input></input>")),/&nbsp;/.exec(n)&&(n=n.replace(/&nbsp;/g,"&#x00A0;")),/[\u0100-\uFFFF]/.exec(n)&&(n=n.replace(/[\u0100-\uFFFF]/g,function(e){return"&#x"+e.charCodeAt().toString(16)+";"})),n},o.print=function(e){var t=o.toString(e);t=t.replace(/<(\w[^\/>]*)><\/\1>/g,"<$1/>"),t=t.replace(/(>)(<)(\/*)/g,"$1\r\n$2$3"),t=t.replace(/(<p>)\r\n(<math)/g,"$1$2"),t=t.replace(/(<\/math>)\r\n(<\/p>)/g,"$1$2");var n=0,i="",s=!1;return r.each(t.split("\r\n"),function(e){var t=0;e.match(/.+<\/\w[^>]*>$/)?t=0:e.match(/^<\/\w/)?n!==0&&(n-=1):e.match(/^<\w[^>]*[^\/]>.*$/)?t=1:t=0;var r="",o;for(o=0;o<n;o+=1)r+="  ";s||(i+=r);var u=e.lastIndexOf("<p>"),a=e.lastIndexOf("</p>");u!==-1&&u>a&&(s=!0),a!==-1&&a>u&&(s=!1),i+=e,s||(i+="\r\n",n+=t)}),i},o.copyNode=function(e){return o.isNode(e)?e.cloneNode(!0):null},o.isNode=function(e){return e?e.nodeType>=o.ELEMENT_NODE:!1},o.isElement=function(e){return e?e.nodeType===o.ELEMENT_NODE:!1},o.isAttribute=function(e){return e?e.nodeType===o.ATTRIBUTE_NODE:!1},o.isText=function(e){return e?e.nodeType===o.TEXT_NODE:!1},o.isCDATA=function(e){return e?e.nodeType===o.CDATA_SECTION_NODE:!1},o.isComment=function(e){return e?e.nodeType===o.COMMENT_NODE:!1},o.isTheElement=function(e,t){return o.isElement(e)&&o.localName(e)===t},o.isTheSelector=function(t,n){return o.isElement(t)?e(t).is(n):!1},o.localName=function(e){return o.isAttribute(e)?e.localName||e.nodeName.replace(/.*:/,""):o.isElement(e)?e.localName||e.nodeName.replace(/.*:/,""):null},o.namespaceURI=function(e,t){var n=null;if(o.isAttribute(e)){n=e.namespaceURI;if(n)return n;o.isElement(t)&&(e=t);if(e&&e.prefix)return a}if(o.isElement(e)){n=e.tagUrn;if(n)return n;n=e.namespaceURI;if(n)return n;if(e.scopeName)return e.getAttribute("xmlns:"+e.scopeName)}return null},o.hasAttr=function(e,t){return o.isElement(e)?e.hasAttribute(t):!1},o.getAttr=function(e,t){return o.isElement(e)?e.getAttribute(t):null},o.setAttr=function(e,t,n){n===null?o.removeAttr(e,t):o.isElement(e)&&e.setAttribute(t,n)},o.removeAttr=function(e,t){o.isElement(e)&&e.removeAttribute(t)},o.hasAttrNS=function(e,t,n){return o.use_namespace===!1?o.hasAttr(e,n):o.isElement(e)?e.hasAttributeNS(t,n):!1},o.getAttrNS=function(e,t,n){return o.use_namespace===!1?o.getAttr(e,n):o.isElement(e)&&o.hasAttrNS(e,t,n)?e.getAttributeNS(t,n):null},o.setAttrNS=function(e,t,n,r){o.use_namespace===!1?o.setAttr(e,n,r):r===null?o.removeAttrNS(e,t,n):o.isElement(e)&&e.setAttributeNS(t,n,r)},o.removeAttrNS=function(e,t,n){o.use_namespace===!1?o.removeAttrNS(e,n):o.isElement(e)&&e.removeAttributeNS(t,n)},o.getText=function(e){return o.isAttribute(e)?e.value:o.isText(e)||o.isCDATA(e)||o.isComment(e)?e.data:null},o.contents=function(t){return o.isElement(t)?e(t).contents():null},o.children=function(t){return o.isElement(t)?e(t).children():null},o.createElement=function(t,r){if(!t||!n.isString(t))return null;r!==null&&!n.isString(r)&&(r=a);if(!document.createElementNS){var i="<"+t+"/>";return r&&(i="<m:"+t+' xmlns:m="'+r+'"/>'),e.parseHTML(i)[0]}return document.createElementNS(r,t)},o.createAttribute=function(e,t){return!e||!n.isString(e)?null:(t!==null&&!n.isString(t)&&(t=a),document.createAttributeNS?document.createAttributeNS(t,e):document.createAttribute(e))},o.createText=function(e){return document.createTextNode(i.expand(e))},o.encloseElement=function(e,t,n){var r=o.namespaceURI(e);!r&&n&&(r=n);var i=o.createElement(t,r);return i&&(e.parentNode&&e.parentNode.replaceChild(i,e),i.appendChild(e)),i},o.encloseChildren=function(t,n){var r=e(t).children();if(r.length===1&&o.localName(r[0])===n)return r[0];var i=o.createElement(n,o.namespaceURI(t));return i&&(r.each(function(){t.removeChild(this),i.appendChild(this)}),t.appendChild(i)),i},o.importNode=function(e){if(o.isElement(e)){var t=o.createElement(e.nodeName,e.namespaceURI),n,r=e.attributes,i=r?r.length:0;for(n=0;n<i;n+=1)t.setAttributeNode(o.importNode(r[n]));var s=e.childNodes,u=s?s.length:0;for(n=0;n<u;n+=1)t.appendChild(o.importNode(s[n]));return t}if(o.isAttribute(e)){var a=o.createAttribute(e.nodeName,e.namespaceURI);return a.value=e.value,a}return o.isText(e)||o.isCDATA(e)||o.isComment(e)?o.createText(e.data):null},o.isEqualNode=function(e,t){if(!e||!t)return!1;if(e.isEqualNode)return e.isEqualNode(t);if(e.nodeType!==t.nodeType)return!1;if(e.nodeName!==t.nodeName)return!1;if(o.isAttribute(e))return e.value===t.value;if(o.isText(e)||o.isCDATA(e)||o.isComment(e))return e.data===t.data;if(!o.isElement(e))return!1;var n=e.attributes,r=t.attributes,i=n?n.length:0,s=r?r.length:0,u,a;for(a=0;a<i;a+=1){u=n[a].nodeName;if(u.indexOf("xmlns")===0)continue;if(!o.isEqualNode(n[a],t.getAttributeNode(u)))return!1}for(a=0;a<s;a+=1){u=r[a].nodeName;if(u.indexOf("xmlns")===0)continue;if(!o.isEqualNode(r[a],e.getAttributeNode(u)))return!1}var f=e.childNodes,l=t.childNodes,c=f?f.length:0,h=l?l.length:0;if(c!==h)return!1;for(a=0;a<c;a+=1)if(!o.isEqualNode(f[a],l[a]))return!1;return!0},o.addToDocument=function(e){return document.body.appendChild(o.importNode(e))},o.removeFromDocument=function(e){document.body.removeChild(e)},o.createTextSpan=function(e,t){var n=o.getText(e)===" ";return e=o.encloseElement(e,"span",u),t&&e.setAttribute("class",t),n&&e.appendChild(o.createText("&#x200B;")),e},o.isSelectionSpan=function(e){return o.isTheElement(e,"span")&&e.getAttribute("class")==="selection"},o.createSpan=function(e){return o.isElement(e)||(o.isSelectionSpan(e.parentNode)?e=e.parentNode:e=o.createTextSpan(e,"selection")),e},o.removeSpan=function(t){o.isSelectionSpan(t)&&e(t).replaceWith(t.firstChild)},o.getOffsets=function(n,r){var i=0,u=0,a=0,f=0,l=n.parentNode,c,h=r;if(n instanceof HTMLElement&&n.offsetParent){a=n.offsetWidth,f=n.offsetHeight,a<n.scrollWidth&&(a=n.scrollWidth);while(n.offsetParent){i+=n.offsetLeft,u+=n.offsetTop,n=n.offsetParent;if(h&&n===h){h=null;break}}}else{c=e(n).offset(),c&&(i=c.left,u=c.top),a=n.scrollWidth,f=n.scrollHeight;while(h&&o.localName(h)!=="html"){if(h.scrollLeft>0||h.scrollTop>0){i+=h.scrollLeft,u+=h.scrollTop;break}h=h.parentNode}h=r}h&&(c=o.getOffsets(h),i-=c.left,u-=c.top);if(f===0&&l){var p=o.getOffsets(l,r);u=p.top,f=p.height}s=s||t("editor/util/Utils"),s.isIOS&&(u+=.5,f-=1);var d={};return d.left=i,d.top=u,d.width=a,d.height=f,d};var f={fontColor:"color",fontFamily:"font-family",fontStyle:"font-style",fontWeight:"font-weight",fontSize:"font-size",valign:"vertical-align"};return o.processStyles=function(t,n){var i={},s=function(e){e.each(function(){r.each(this.attributes,function(e){var t=f[e.name],n=e.value;t&&n&&(i[t]=n,t==="vertical-align"&&(i["line-height"]="100%"))})})};s(t),s(n);var o=[];return e.each(i,function(e,t){o.push(e),o.push(":"),o.push(t),o.push(";")}),o.join("")},o}),n("editor/util/Markup",["editor/util/Name","editor/util/XML"],function(e,t){var n=function(){return this},r,i,s,o,u;return n.math=function(t){return u(t,e._math)?t:n.createElement(e._math,t)},n.root=function(t){while(u(t,e._math)||u(t,e._html))t=s(t);return t},n.createElement=function(e,n){var r=t.createElement(e.getName(),e.getURI());return n&&r.appendChild(n),r},n.createText=function(e){var n=e.getName();return n.indexOf("<")!==-1&&(n=n.replace("<","&lt;")),n.indexOf("&nbsp;")!==-1&&(n=n.replace("&nbsp;","&amp;nbsp;")),t.createText(n)},n.getName=function(n){if(!t.isElement(n)&&!t.isAttribute(n))return null;var r=t.localName(n),i=t.namespaceURI(n)||"";return e.get(r,i)},n.getAttName=function(n,r){if(!t.isElement(n)||!t.isAttribute(r))return null;var i=t.localName(r),s=t.namespaceURI(r);return r.nodeName&&r.nodeName.indexOf("xmlns")===0&&(s=s||e.NS_XMLNS),n.prefix&&(s=s||e.NS_MATH),s=s||t.namespaceURI(n)||"",e.get(i,s)},n.getText=function(n){return e.get(t.getText(n))},r=function(e){return t.isElement(e)?t.contents(e).length:0},i=function(e,n){return t.contents(e)[n]},s=function(e){return i(e,0)},o=function(e){return r(e)===0},u=function(e,t){return n.getName(e)===t&&!o(e)},n.isElement=function(e){return!(n.isSymbol(e)||n.isUnknown(e)||n.isOperator(e))},n.isOperator=function(t){return u(t,e._apply)||u(t,e._reln)?(t=s(t),u(t,e._fn)&&(t=s(t)),o(t)):!1},n.isUnknown=function(n){return u(n,e._apply)||u(n,e._reln)?(n=s(n),u(n,e._fn)&&(n=s(n)),u(n,e._ci)&&(n=s(n)),u(n,e._mo)&&(n=s(n)),t.isText(n)):!1},n.isSymbol=function(n){return u(n,e._apply)||u(n,e._reln)?(n=s(n),u(n,e._csymbol)&&t.getAttr(n,"cd")&&(n=s(n)),t.isText(n)):!1},n.getKey=function(r){var i;if(n.isSymbol(r)){r=s(r);var o="";u(r,e._csymbol)&&(o="csymbol:"+t.getAttr(r,"cd"),r=s(r)),i=e.get(t.getText(r),o)}else n.isUnknown(r)?(r=s(r),u(r,e._fn)&&(r=s(r)),u(r,e._ci)&&(r=s(r)),u(r,e._mo)&&(r=s(r)),i=e.user(t.getText(r))):n.isOperator(r)?(r=s(r),u(r,e._fn)&&(r=s(r)),i=n.getName(r)):i=n.getName(r);return i},n.getElt=function(t){if(n.isSymbol(t)||n.isUnknown(t)||n.isOperator(t))t=s(t),u(t,e._fn)&&(t=s(t));return t},n}),n("editor/util/Utils",["lib/jquery","lib/require","editor/util/Object","editor/util/Array","editor/util/Char","editor/util/Key","editor/util/Event","editor/util/Symbol","editor/util/Name","editor/util/Buffer","editor/util/ByteBuffer","editor/util/Color","editor/util/Entity","editor/util/XML","editor/util/Markup"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){var v=function(){return this};v.$=e,v.require=t,v.Object=n,v.Array=r,v.Char=i,v.Key=s,v.Event=o,v.Symbol=u,v.Name=a,v.Buffer=f,v.ByteBuffer=l,v.Color=c,v.Entity=h,v.XML=p,v.Markup=d,v.timeStamp="21-Sep-2022 20:09:41Z",v.userAgent=navigator.userAgent.toLowerCase(),v.isFF=/firefox/.test(v.userAgent),v.isMacOS=/mac os/.test(v.userAgent),v.isIOS=/iphone|ipad|ipod/.test(v.userAgent),v.isIOS10=/cpu os 10/.test(v.userAgent),v.isCrOS=/cros|chromebook/.test(v.userAgent),v.isWin10=/windows nt 10.0/.test(v.userAgent),v.isAndroid=/android/.test(v.userAgent),v.isMobile=/android|webos|iphone|ipad|ipod|blackberry/.test(v.userAgent),v.useMoreMenu=v.isMobile&&(!v.isCrOS||!v.isAndroid),v.isIE=/trident/.test(v.userAgent)||/msie/.test(v.userAgent),v.isTouch=window.hasOwnProperty("ontouchstart")||navigator.maxTouchPoints>0,v.isZoom=function(){var e=window.visualViewport,t=e?e.width:window.innerWidth,n=t-document.documentElement.clientWidth;return Math.abs(n)>18},v.hasFocus=function(t){try{return e(t)[0]===document.activeElement}catch(n){return e(t).is(":focus")}},v.log=function(e){var t=null;window.TN8&&window.TN8.Application&&(t=TN8.Application.error),window.SWT&&window.SWT.alert&&alert(e),t?t.logError(e,t.logLevel.IMPORTANT):console&&console.log&&console.log(e)},v.error=function(e){var t=null;window.TN8&&window.TN8.Application&&(t=TN8.Application.error),window.SWT&&window.SWT.alert&&alert(e);if(!t)throw new Error(e);t.showError(e,t.type.EE_UNKNOWN_ERROR)},u.error=v.error,Function.prototype.bind||(Function.prototype.bind=function(e){var t=this,n=[].slice.call(arguments,1);return function(){var r=[].slice.call(arguments);return t.apply(e,n.concat(r))}});var m=0,g={},y=function(e,t,n){if(!window.requestAnimationFrame)return;var r=(new Date).getTime()+e,i=!1;m+=1;var s=m;return g[s]=window.requestAnimationFrame(function o(){var u=(new Date).getTime();!i&&u>=r&&(i=!0,n(),r=(new Date).getTime()+e,t=t||v.stopThread(s),i=!1),g[s]&&(g[s]=window.requestAnimationFrame(o))}),s};return v.runOnce=function(e,t){return y(e,!1,t)},v.runEvery=function(e,t){return y(e,!0,t)},v.stopThread=function(e){window.cancelAnimationFrame&&(window.cancelAnimationFrame(g[e]),delete g[e])},v}),n("editor/config/AttInfo",["editor/util/Utils"],function(e){var t=e.Array,n=e.Name,r=e.Symbol,i=function(){return this},s,o,u,a,f,l,c,h,p,d;i.isTextElt=function(e){e instanceof r||(e=null);if(e===null)return!1;var t=e.getURI();return t===n.NS_HTML?!0:!1},i.isPresentElt=function(e){e instanceof r||(e=null);if(e===null)return!1;var t=e.getURI(),i=e.getName();return t===n.NS_HTML?a[i]||!1:t===n.NS_MATH?f[i]||!1:!1},i.isContentElt=function(e){e instanceof r||(e=null);if(e===null)return!1;var t=e.getURI(),i=e.getName();return t===n.NS_MATH?l[i]||!1:!1},i.isContentOp=function(e){e instanceof r||(e=null);if(e===null)return!1;var t=e.getURI(),i=e.getName();return t===n.NS_MATH?c[i]||!1:!1},i.isCustomOp=function(e){e instanceof r||(e=null);if(e===null)return!1;var t=e.getURI(),i=e.getName();return t===n.NS_MATH?h[i]||!1:!1},i.isCustomConstant=function(e){e instanceof r||(e=null);if(e===null)return!1;var t=e.getURI(),i=e.getName();return t===n.NS_MATH?p[i]||!1:!1},i.isContentAtt=function(e){return e===null?!1:e.getURI()!==n.NS_MATH?!1:u[e.getName()]||!1},i.checkAttrib=function(e,r){if(e===null)return!1;if(r.getURI()!==n.NS_MATH||r.getName()==="id")return!0;if(e.getURI()!==n.NS_MATH)return!1;if(!i.isPresentElt(e))return!0;var u=d[r.getName()]||null;return u===null?!1:u.length===0?!0:t.contains(u,e.getName())?!0:e===n._mstyle&&s[r.getName()]?!1:e===n._mstyle&&!o[r.getName()]?!0:e===n._math&&!o[r.getName()]?!0:!1},s={close:!0,columnalign:!0,columnspan:!0,groupalign:!0,open:!0,rowalign:!0,rowspan:!0,separators:!0},o={actiontype:!0,alt:!0,altimg:!0,alttext:!0,base:!0,baseline:!0,closure:!0,definitionURL:!0,denomalign:!0,display:!0,encoding:!0,index:!0,linebreak:!0,macros:!0,mode:!0,name:!0,nargs:!0,notation:!0,numalign:!0,occurrence:!0,order:!0,overflow:!0,scope:!0,type:!0},u={base:!0,cd:!0,closure:!0,definitionURL:!0,encoding:!0,name:!0,nargs:!0,occurrence:!0,order:!0,scope:!0,type:!0},a={div:!0,span:!0,p:!0,br:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,b:!0,i:!0,u:!0,s:!0,tt:!0,em:!0,sub:!0,sup:!0,big:!0,small:!0,strike:!0},f={maction:!0,maligngroup:!0,malignmark:!0,math:!0,menclose:!0,merror:!0,mfenced:!0,mfrac:!0,mglyph:!0,mi:!0,mlabeledtr:!0,mlongdiv:!0,mmultiscripts:!0,mn:!0,mo:!0,mover:!0,mpadded:!0,mphantom:!0,mprescripts:!0,mroot:!0,mrow:!0,ms:!0,mscarries:!0,mscarry:!0,msgroup:!0,msline:!0,mspace:!0,msqrt:!0,msrow:!0,mstack:!0,mstyle:!0,msub:!0,msubsup:!0,msup:!0,mtable:!0,mtd:!0,mtext:!0,mtr:!0,munder:!0,munderover:!0,none:!0},l={annotation:!0,"annotation-xml":!0,apply:!0,bvar:!0,ci:!0,cn:!0,complexes:!0,condition:!0,csymbol:!0,declare:!0,degree:!0,domainofapplication:!0,emptyset:!0,eulergamma:!0,exponentiale:!0,"false":!0,fn:!0,imaginaryi:!0,infinity:!0,integers:!0,interval:!0,list:!0,logbase:!0,lowlimit:!0,matrix:!0,matrixrow:!0,momentabout:!0,naturalnumbers:!0,notanumber:!0,otherwise:!0,pi:!0,piece:!0,piecewise:!0,primes:!0,rationals:!0,reals:!0,reln:!0,semantics:!0,sep:!0,set:!0,"true":!0,uplimit:!0,vector:!0,amp:!0,angstrom:!0,asterisk:!0,at:!0,caret:!0,cent:!0,check:!0,dagger:!0,ddagger:!0,degrees:!0,dollar:!0,dslash:!0,hash:!0,hslash:!0,lambdabar:!0,paragraph:!0,partial:!0,percent:!0,pound:!0,rslash:!0,section:!0,omission:!0,slash:!0,bslash:!0,therefore:!0,because:!0,ldquo:!0,lsquo:!0,rdquo:!0,rsquo:!0,space:!0,apos:!0,quote:!0,Alpha:!0,Beta:!0,Gamma:!0,Delta:!0,Epsilon:!0,Zeta:!0,Eta:!0,Theta:!0,Iota:!0,Kappa:!0,Lambda:!0,Mu:!0,Nu:!0,Xi:!0,Omicron:!0,Pi:!0,Rho:!0,Sigma:!0,Tau:!0,Upsilon:!0,Phi:!0,Chi:!0,Psi:!0,Omega:!0,alpha:!0,beta:!0,gamma:!0,delta:!0,epsilon:!0,zeta:!0,eta:!0,theta:!0,iota:!0,kappa:!0,lambda:!0,mu:!0,nu:!0,xi:!0,omicron:!0,letterpi:!0,rho:!0,sigma:!0,tau:!0,upsilon:!0,phi:!0,chi:!0,psi:!0,omega:!0,varbeta:!0,varepsilon:!0,vartheta:!0,varkappa:!0,varpi:!0,varrho:!0,varsigma:!0,varphi:!0,qoph:!0,stigma:!0,digamma:!0,sampi:!0,scriptA:!0,scriptB:!0,scriptC:!0,scriptD:!0,scriptE:!0,scriptF:!0,scriptG:!0,scriptH:!0,scriptI:!0,scriptJ:!0,scriptK:!0,scriptL:!0,scriptM:!0,scriptN:!0,scriptO:!0,scriptP:!0,scriptQ:!0,scriptR:!0,scriptS:!0,scriptT:!0,scriptU:!0,scriptV:!0,scriptW:!0,scriptX:!0,scriptY:!0,scriptZ:!0,scripta:!0,scriptb:!0,scriptc:!0,scriptd:!0,scripte:!0,scriptf:!0,scriptg:!0,scripth:!0,scripti:!0,scriptj:!0,scriptk:!0,scriptl:!0,scriptm:!0,scriptn:!0,scripto:!0,scriptp:!0,scriptq:!0,scriptr:!0,scripts:!0,scriptt:!0,scriptu:!0,scriptv:!0,scriptw:!0,scriptx:!0,scripty:!0,scriptz:!0,calA:!0,calB:!0,calC:!0,calD:!0,calE:!0,calF:!0,calG:!0,calH:!0,calI:!0,calJ:!0,calK:!0,calL:!0,calM:!0,calN:!0,calO:!0,calP:!0,calQ:!0,calR:!0,calS:!0,calT:!0,calU:!0,calV:!0,calW:!0,calX:!0,calY:!0,calZ:!0,frakturA:!0,frakturB:!0,frakturC:!0,frakturD:!0,frakturE:!0,frakturF:!0,frakturG:!0,frakturH:!0,frakturI:!0,frakturJ:!0,frakturK:!0,frakturL:!0,frakturM:!0,frakturN:!0,frakturO:!0,frakturP:!0,frakturQ:!0,frakturR:!0,frakturS:!0,frakturT:!0,frakturU:!0,frakturV:!0,frakturW:!0,frakturX:!0,frakturY:!0,frakturZ:!0,fraktura:!0,frakturb:!0,frakturc:!0,frakturd:!0,frakture:!0,frakturf:!0,frakturg:!0,frakturh:!0,frakturi:!0,frakturj:!0,frakturk:!0,frakturl:!0,frakturm:!0,frakturn:!0,frakturo:!0,frakturp:!0,frakturq:!0,frakturr:!0,frakturs:!0,frakturt:!0,frakturu:!0,frakturv:!0,frakturw:!0,frakturx:!0,fraktury:!0,frakturz:!0,vecA:!0,vecB:!0,vecC:!0,vecD:!0,vecE:!0,vecF:!0,vecG:!0,vecH:!0,vecI:!0,vecJ:!0,vecK:!0,vecL:!0,vecM:!0,vecN:!0,vecO:!0,vecP:!0,vecQ:!0,vecR:!0,vecS:!0,vecT:!0,vecU:!0,vecV:!0,vecW:!0,vecX:!0,vecY:!0,vecZ:!0,veca:!0,vecb:!0,vecc:!0,vecd:!0,vece:!0,vecf:!0,vecg:!0,vech:!0,veci:!0,vecj:!0,veck:!0,vecl:!0,vecm:!0,vecn:!0,veco:!0,vecp:!0,vecq:!0,vecr:!0,vecs:!0,vect:!0,vecu:!0,vecv:!0,vecw:!0,vecx:!0,vecy:!0,vecz:!0,hatA:!0,hatB:!0,hatC:!0,hatD:!0,hatE:!0,hatF:!0,hatG:!0,hatH:!0,hatI:!0,hatJ:!0,hatK:!0,hatL:!0,hatM:!0,hatN:!0,hatO:!0,hatP:!0,hatQ:!0,hatR:!0,hatS:!0,hatT:!0,hatU:!0,hatV:!0,hatW:!0,hatX:!0,hatY:!0,hatZ:!0,hata:!0,hatb:!0,hatc:!0,hatd:!0,hate:!0,hatf:!0,hatg:!0,hath:!0,hati:!0,hatj:!0,hatk:!0,hatl:!0,hatm:!0,hatn:!0,hato:!0,hatp:!0,hatq:!0,hatr:!0,hats:!0,hatt:!0,hatu:!0,hatv:!0,hatw:!0,hatx:!0,haty:!0,hatz:!0},c={abs:!0,and:!0,approx:!0,arccos:!0,arccosh:!0,arccot:!0,arccoth:!0,arccsc:!0,arccsch:!0,arcsec:!0,arcsech:!0,arcsin:!0,arcsinh:!0,arctan:!0,arctanh:!0,arg:!0,card:!0,cartesianproduct:!0,ceiling:!0,codomain:!0,compose:!0,conjugate:!0,cos:!0,cosh:!0,cot:!0,coth:!0,csc:!0,csch:!0,curl:!0,determinant:!0,diff:!0,divergence:!0,divide:!0,domain:!0,eq:!0,equivalent:!0,exists:!0,exp:!0,factorial:!0,factorof:!0,floor:!0,forall:!0,gcd:!0,geq:!0,grad:!0,gt:!0,ident:!0,image:!0,imaginary:!0,implies:!0,"in":!0,"int":!0,dint:!0,tint:!0,intersect:!0,inverse:!0,laplacian:!0,lcm:!0,leq:!0,limit:!0,ln:!0,log:!0,lt:!0,max:!0,mean:!0,median:!0,min:!0,minus:!0,mode:!0,moment:!0,neq:!0,not:!0,notin:!0,notprsubset:!0,notsubset:!0,or:!0,outerproduct:!0,partialdiff:!0,plus:!0,power:!0,product:!0,prsubset:!0,quotient:!0,real:!0,rem:!0,root:!0,scalarproduct:!0,sdev:!0,sec:!0,sech:!0,selector:!0,setdiff:!0,sin:!0,sinh:!0,subset:!0,sum:!0,tan:!0,tanh:!0,tendsto:!0,times:!0,transpose:!0,union:!0,variance:!0,vectorproduct:!0,xor:!0},h={abracket:!0,af:!0,andbar:!0,andeq:!0,angle:!0,anglemeasure:!0,approxeq:!0,approxequal:!0,arc:!0,arcdown:!0,baseline:!0,bbrace:!0,bbracket:!0,binomial:!0,bparen:!0,brace:!0,bracket:!0,cancel:!0,capbar:!0,capeq:!0,cupbar:!0,cupeq:!0,circle:!0,circleddot:!0,circleddown:!0,circleddownup:!0,circledequals:!0,circledleft:!0,circledleftright:!0,circledminus:!0,circledplus:!0,circledright:!0,circledrightleft:!0,circledring:!0,circledslash:!0,circledstar:!0,circledtimes:!0,circledup:!0,circledupdown:!0,comma:!0,cong:!0,dashbond:!0,dbond:!0,diamond:!0,dipole:!0,divides:!0,divideinto:!0,ddot:!0,dot:!0,dotbond:!0,doteq:!0,doteqdot:!0,dotminus:!0,downarrow:!0,downdarrow:!0,dprime:!0,ellipse:!0,eqarrows:!0,eqharpoons:!0,equivalence:!0,gg:!0,GG:!0,gteq:!0,hat:!0,heptagon:!0,hexagon:!0,iheptagon:!0,ihexagon:!0,intersecting:!0,ioctagon:!0,ipentagon:!0,labracket:!0,labs:!0,lbbrace:!0,lbbracket:!0,lbparen:!0,lbrace:!0,lbracket:!0,lceiling:!0,leftarrow:!0,leftdarrow:!0,lfloor:!0,line:!0,ll:!0,LL:!0,lparen:!0,lrarrow:!0,lrdarrow:!0,lrharpoons:!0,lteq:!0,lvar:!0,lvars:!0,measuredangle:!0,minusplus:!0,mp:!0,mxf:!0,napprox:!0,napproxeq:!0,napproxequal:!0,ncong:!0,ndivides:!0,nearrow:!0,nedarrow:!0,negative:!0,nequivalent:!0,neswarrow:!0,ni:!0,norm:!0,notprsupset:!0,notsubseteq:!0,notsupset:!0,notsupseteq:!0,nparallel:!0,nperp:!0,nsim:!0,nsimeq:!0,nwarrow:!0,nwdarrow:!0,nwsearrow:!0,octagon:!0,odivide:!0,odot:!0,omit:!0,ominus:!0,oplus:!0,orbar:!0,oreq:!0,oslash:!0,otimes:!0,overbar:!0,overscript:!0,pair:!0,parallel:!0,parallelogram:!0,paren:!0,pentagon:!0,perp:!0,plusminus:!0,pm:!0,positive:!0,prec:!0,preceq:!0,presubscript:!0,presubsup:!0,presuperscript:!0,prime:!0,proportion:!0,variation:!0,prsupset:!0,pvar:!0,pvars:!0,quadrilateral:!0,qvar:!0,qvars:!0,ratio:!0,ray:!0,rabracket:!0,rabs:!0,rbbrace:!0,rbbracket:!0,rbparen:!0,rbrace:!0,rbracket:!0,rceiling:!0,reaction:!0,rectangle:!0,resonance:!0,rfloor:!0,rhombus:!0,rightangle:!0,rightarrow:!0,rightdarrow:!0,rparen:!0,sbond:!0,sdot:!0,searrow:!0,sedarrow:!0,segment:!0,select:!0,sim:!0,simeq:!0,sphericalangle:!0,square:!0,squaredbslash:!0,squareddot:!0,squareddown:!0,squaredequals:!0,squaredleft:!0,squaredminus:!0,squaredplus:!0,squaredright:!0,squaredslash:!0,squaredtimes:!0,squaredup:!0,squaredvbar:!0,stack:!0,star:!0,subscript:!0,subseteq:!0,subsup:!0,succ:!0,succeq:!0,sum1:!0,superscript:!0,supset:!0,supseteq:!0,swarrow:!0,swdarrow:!0,tbond:!0,tdot:!0,tilde:!0,tprime:!0,trapezoid:!0,triangle:!0,triangledown:!0,udarrow:!0,uddarrow:!0,underbar:!0,underscript:!0,uparrow:!0,updarrow:!0,"var":!0,vec:!0,wavearrow:!0,wedgebond:!0},p={indeterminant:!0};var v=["mo","munder","mover","munderover","mtable","mstack"],m=["mtable","mtr","mlabeledtr","mtd","maligngroup"],g=["msub","msubsup","mmultiscripts","munder","munderover"],y=["mi","mn","mo","ms","mspace","mtext","mglyph"];return d={accent:["mo","mover","munderover"],accentunder:["munder","munderover"],actiontype:["maction"],align:v,alignmentscope:["mtable"],alt:["mglyph"],altimg:["math"],"altimg-height":["math"],"altimg-valign":["math"],"altimg-width":["math"],alttext:["math"],background:[],bevelled:["mfrac"],cdgroup:["math"],charalign:["mstack"],charspacing:["mstack"],"class":[],close:["mfenced"],color:[],columnalign:["mtable","mtr","mlabeledtr","mtd"],columnlines:["mtable"],columnspacing:["mtable"],columnspan:["mtd"],columnwidth:["mtable"],crossout:["mscarries","mscarry"],decimalpoint:["mstyle"],denomalign:["mfrac"],depth:["mpadded","mspace"],dir:["mi","mn","mo","ms","mspace","mtext","mrow"],display:["math"],displaystyle:["mtable"],edge:["malignmark"],equalcolumns:["mtable"],equalrows:["mtable"],fence:["mo"],fontfamily:y,fontsize:["mi","mn","mo","ms","mspace","mtext"],fontstyle:["mi","mn","mo","ms","mspace","mtext"],fontweight:["mi","mn","mo","ms","mspace","mtext"],form:["mo"],frame:["mtable"],framespacing:["mtable","menclose"],groupalign:m,height:["mglyph","mpadded","mspace"],href:[],id:[],indentalign:["mo"],indentalignfirst:["mo"],indentalignlast:["mo"],indentshift:["mo"],indentshiftfirst:["mo"],indentshiftlast:["mo"],indenttarget:["mo"],index:["mglyph"],infixlinebreakstyle:["mstyle"],largeop:["mo"],leftoverhang:["msline"],length:["msline"],linebreak:["mo","mspace"],linebreakmultchar:["mo"],linebreakstyle:["mo"],lineleading:["mo"],linethickness:["mfrac"],location:["mscarries","mscarry"],longdivstyle:["mlongdiv"],lquote:["ms"],lspace:["mo","mpadded"],macros:["math"],mathbackground:[],mathcolor:[],mathsize:y,mathvariant:y,maxsize:["mo"],maxwidth:["math"],minlabelspacing:["mtable"],minsize:["mo"],mode:["math"],movablelimits:["mo"],mslinethickness:["msline"],notation:["menclose"],numalign:["mfrac"],open:["mfenced"],other:[],overflow:["math"],position:["mscarries","msgroup","msline","msrow"],rightoverhang:["msline"],rowalign:["mtable","mtr","mlabeledtr","mtd"],rowlines:["mtable"],rowspacing:["mtable"],rowspan:["mtd"],rquote:["ms"],rspace:["mo"],scriptlevel:["mstyle"],scriptminsize:["mstyle"],scriptsizemultiplier:["mscarries"],selection:["maction"],separator:["mo"],separators:["mfenced"],shift:["msgroup"],side:["mtable"],src:["mglyph","maction"],stackalign:["mstack"],stretchy:["mo"],style:[],subscriptshift:g,superscriptshift:g,symmetric:["mo"],valign:["mglyph"],voffset:["mpadded"],width:["mglyph","mpadded","mspace","mtable"],xref:[]},i}),n("editor/config/FormInfo",["editor/util/Utils"],function(e){var t=e.Name,n=e.Object,r=e.Symbol,i=null,s=function(){return this},o,u,a;return s.hasForms=function(e){e instanceof r||(e=null);if(e===null)return!1;var n=e.getURI();if(n!==t.NS_MATH)return!1;var i=e.getName(),s=a[i]||null;return s!==null},s.getForms=function(e){e instanceof r||(e=null);if(e===null)return null;var i=e.getURI();if(i!==t.NS_MATH)return null;var s=e.getName(),u=a[s]||null;return n.isString(u)&&(a[s]=u=o(u)),u},o=function(n){i=i||e.require("editor/expr/Expr"),n="((list xmlns "+t.NS_MATH+")"+n+")";var r=i.parse(n),s=[],o=r.getApplyArgc(),a;for(a=1;a<=o;a+=1)s.push(u(r.getApplyArg(a)));return s},u=function(e){if(e.isEmpty())return e.copy(e);if(e.isSymbol()){var n=r.get(e.getString(),t.NS_INFO);return e.createApplyOp(n)}var i=e.create(e.getConfig());i.addChild(e.copy(e.getChild(0)));var s=e.getCount(),o;for(o=1;o<s;o+=1)i.addChild(u(e.getChild(o)));return i},a={bvar:"(eq (bvar x n) (bvar (degree n) x))(eq (bvar x n) (bvar x (degree n)))",diff:"(eq (diff y x) (diff (bvar x) y))(eq (diff y x n) (diff (bvar x n) y))",exists:"(eq (exists y) (exists (qvars) y))(eq (exists y x) (exists x y))",fn:"(eq x (fn x))",forall:"(eq (forall y) (forall (qvars) y))(eq (forall y x) (forall x y))","int":"(eq (int y x)    (int (bvar x) y))(eq (int y x (interval a b))    (int (bvar x) (interval a b) y))(eq (int y x (condition a))    (int (bvar x) (condition a) y))(eq (int y x (domainofapplication a))    (int (bvar x) (domainofapplication a) y))(eq (int (none) x a b)    (int (bvar x) (lowlimit a) (uplimit b)))(eq (int y x a)    (int (bvar x) (lowlimit a) y))(eq (int y x a b)    (int (bvar x) (lowlimit a) (uplimit b) y))",lambda:"(eq (lambda y) (lambda (lvars) y))(eq (lambda y x) (lambda x y))",limit:"(eq ((limit type @) y x a)    (limit (bvar x) (lowlimit a) y))(eq ((limit type above) y x a)    (limit (bvar x) (condition ((tendsto type above) x a)) y))(eq ((limit type below) y x a)    (limit (bvar x) (condition ((tendsto type below) x a)) y))(eq ((limit type two-sided) y x a)    (limit (bvar x) (condition ((tendsto type two-sided) x a)) y))",log:"(eq (log x n) (log (logbase n) x))",moment:"(eq (moment x n) (moment (degree n) x))(eq (moment x n p) (moment (degree n) (momentabout p) x))",partialdiff:"(eq (partialdiff y) (partialdiff (pvars) y))(eq (partialdiff y x) (partialdiff x y))(eq (partialdiff y x n) (partialdiff x (degree n) y))",product:"(eq (product y x)    (product (bvar x) y))(eq (product y x (interval a b))    (product (bvar x) (interval a b) y))(eq (product y x (condition a))    (product (bvar x) (condition a) y))(eq (product y x (domainofapplication a))    (product (bvar x) (domainofapplication a) y))(eq (product (none) x a b)    (product (bvar x) (lowlimit a) (uplimit b)))(eq (product y x a)    (product (bvar x) (lowlimit a) y))(eq (product y x a b)    (product (bvar x) (lowlimit a) (uplimit b) y))",root:"(eq (root x n) (root (degree n) x))",sum:"(eq (sum y x)    (sum (bvar x) y)) (eq (sum y x (interval a b))    (sum (bvar x) (interval a b) y))(eq (sum y x (condition a))    (sum (bvar x) (condition a) y)) (eq (sum y x (domainofapplication a))    (sum (bvar x) (domainofapplication a) y))(eq (sum (none) x a b)    (sum (bvar x) (lowlimit a) (uplimit b)))(eq (sum y x a)    (sum (bvar x) (lowlimit a) y))(eq (sum y x a b)    (sum (bvar x) (lowlimit a) (uplimit b) y))"},s}),n("editor/config/TagInfo",["editor/util/Utils","editor/config/AttInfo"],function(e,t){var n=e.Array,r=e.Name,i=e.Symbol,s=function(){return this},o,u,a,f,l,c={},h=0,p=function(e){e instanceof i||(e=null);if(e===null)return c;var t=e.getURI(),n=e.getName();return t===r.NS_MATH?o[n]||c:t===r.NS_HTML?u[n]||c:t==="csymbol:basic"?a[n]||c:c},d=function(e,t,n){e instanceof i||(e=null),t instanceof i||(t=null);if(e===null)return h;if(e.getURI()!==r.NS_MATH)return h;var s=e.getName(),o=l[s];if(!o)return h;var u=f[s];return u&&t&&(o=u[t.getName()]||o),o.length===1&&o.push(o[0]),o.length===2&&o.push(h,h),o[n]};return s.getAdditiveOp=function(e){var t=p(e);return t.addop?r.math(t.addop):null},s.isAdditiveOp=function(e){var t=p(e);return t.addop?t.addop===e.getName():!1},s.isAdditiveInverse=function(e){var t=p(e);return t.addop?t.addop!==e.getName():!1},s.isNary=function(e){var t=p(e);return t.arity||t.argc?!0:!1},s.isBinary=function(e){return p(e).arity==="binary"},s.isNullary=function(e){return p(e).arity==="nullary"},s.getNaryMax=function(e){return p(e).argc||0},s.isArray=function(e){return p(e).array?!0:!1},s.isAssoc=function(e){return p(e).assoc?!0:!1},s.isCondition=function(e){return p(e).condition?!0:!1},s.isElement=function(e){var n=p(e);return n.element?!0:t.isPresentElt(e)||t.isContentElt(e)},s.isOperator=function(e){return t.isContentOp(e)||t.isCustomOp(e)},s.isOrder=function(e){var t=p(e);return t.order?!0:!1},s.getOrders=function(e,t){var r=p(e);if(!r.order||t<2)return null;var i=null;return n.each(r.order,function(e){i===null&&e.length===t&&(i=e)}),i},s.isPlace=function(e){return p(e).place?!0:!1},s.getLeftBinding=function(e,t){return d(e,t,0)},s.getRightBinding=function(e,t){return d(e,t,1)},s.getOuterLeftBinding=function(e,t){return d(e,t,2)},s.getOuterRightBinding=function(e,t){return d(e,t,3)},s.isRelation=function(e){return p(e).relation?!0:!1},s.isTable=function(e){return p(e).table?!0:!1},s.isToken=function(e){return p(e).token?!0:!1},s.isNumberToken=function(e){return p(e).token==="number"},s.isSymbolToken=function(e){return p(e).token==="symbol"},s.isBinding=function(e){var t=p(e);return t.bindVar&&t.bindList?!0:!1},s.getBindingVar=function(e){var t=p(e);return t.bindVar?r.math(t.bindVar):null},s.getBindingList=function(e){var t=p(e);return t.bindList?r.math(t.bindList):null},o={math:{relation:!0},mi:{token:"symbol"},mn:{token:"number"},mo:{token:"symbol"},mrow:{arity:"nary"},ms:{token:"text"},mtable:{table:!0},mtext:{token:"text"},mtr:{arity:"nary"},and:{arity:"binary",assoc:!0},andbar:{arity:"binary"},andeq:{arity:"binary"},annotation:{token:"text"},apply:{arity:"binary"},approx:{arity:"binary",relation:!0},approxeq:{arity:"binary",relation:!0},approxequal:{arity:"binary",relation:!0},cartesianproduct:{arity:"binary"},outerproduct:{arity:"binary"},scalarproduct:{arity:"binary"},vectorproduct:{arity:"binary"},ci:{token:"symbol"},cn:{token:"number"},compose:{arity:"binary",assoc:!0},diff:{argc:3,order:[[0,3,2,-1],[0,5,3,4,-1,-1]]},divide:{arity:"binary"},eq:{arity:"binary",assoc:!0,relation:!0},equivalence:{arity:"binary"},equivalent:{arity:"binary",relation:!0},exists:{argc:2,bindVar:"qvar",bindList:"qvars",condition:!0},factorof:{arity:"binary"},forall:{argc:2,bindVar:"qvar",bindList:"qvars",condition:!0},gcd:{arity:"nary"},geq:{arity:"binary",assoc:!0,relation:!0},gt:{arity:"binary",assoc:!0,relation:!0},gteq:{arity:"binary",assoc:!0,relation:!0},implies:{arity:"binary"},"int":{argc:4,condition:!0},intersect:{arity:"binary"},capbar:{arity:"binary"},capeq:{arity:"binary"},interval:{condition:!0},lambda:{argc:2,bindVar:"lvar",bindList:"lvars"},lcm:{arity:"nary"},leq:{arity:"binary",assoc:!0,relation:!0},limit:{condition:!0},tendsto:{arity:"binary"},list:{arity:"nary",condition:!0},log:{argc:2,order:[[0,1,2]]},lt:{arity:"binary",assoc:!0,relation:!0},lteq:{arity:"binary",assoc:!0,relation:!0},matrix:{array:!0},matrixrow:{arity:"nary"},max:{arity:"nary",condition:!0},mean:{arity:"nary"},median:{arity:"nary"},min:{arity:"nary",condition:!0},minus:{arity:"binary",addop:"plus"},mode:{arity:"nary"},moment:{argc:3,order:[[0,2,1]]},neq:{arity:"binary",assoc:!0,relation:!0},or:{arity:"binary",assoc:!0},orbar:{arity:"binary"},oreq:{arity:"binary"},partialdiff:{argc:3,bindVar:"pvar",bindList:"pvars",order:[[0,2,1],[0,3,2,1]]},piecewise:{arity:"nary"},plus:{arity:"binary",addop:"plus",assoc:!0},product:{argc:4,condition:!0},root:{argc:2,order:[[1,0]]},sdev:{arity:"nary"},selector:{arity:"binary"},semantics:{arity:"nary"},set:{arity:"nary",condition:!0},sum:{argc:4,condition:!0},times:{arity:"binary",assoc:!0},union:{arity:"binary"},cupbar:{arity:"binary"},cupeq:{arity:"binary"},variance:{arity:"nary"},vector:{arity:"nary"},xor:{arity:"binary",assoc:!0},lvars:{arity:"nary"},pvar:{argc:2},pvars:{arity:"nary"},qvars:{arity:"nary"},select:{arity:"binary"},"var":{arity:"nary"},nequivalent:{arity:"binary",relation:!0},napprox:{arity:"binary",relation:!0},napproxeq:{arity:"binary",relation:!0},napproxequal:{arity:"binary",relation:!0},sim:{arity:"binary",relation:!0},nsim:{arity:"binary",relation:!0},simeq:{arity:"binary",relation:!0},nsimeq:{arity:"binary",relation:!0},cong:{arity:"binary",relation:!0},ncong:{arity:"binary",relation:!0},"in":{arity:"binary"},ni:{arity:"binary"},notin:{arity:"binary"},setdiff:{arity:"binary"},subset:{arity:"binary"},subseteq:{arity:"binary"},prsubset:{arity:"binary"},notsubset:{arity:"binary"},notsubseteq:{arity:"binary"},notprsubset:{arity:"binary"},supset:{arity:"binary"},supseteq:{arity:"binary"},prsupset:{arity:"binary"},notsupset:{arity:"binary"},notsupseteq:{arity:"binary"},notprsupset:{arity:"binary"},circle:{argc:3},ellipse:{argc:3},triangle:{argc:3},triangledown:{argc:3},pentagon:{argc:5},ipentagon:{argc:5},hexagon:{argc:6},ihexagon:{argc:6},heptagon:{argc:7},iheptagon:{argc:7},octagon:{argc:8},ioctagon:{argc:8},square:{argc:4},rectangle:{argc:4},rhombus:{argc:4},parallelogram:{argc:4},diamond:{argc:4},star:{argc:5},trapezoid:{argc:4},quadrilateral:{argc:4},segment:{argc:2},line:{argc:2},ray:{argc:2},arc:{argc:3},arcdown:{argc:3},parallel:{arity:"binary"},nparallel:{arity:"binary"},perp:{arity:"binary"},nperp:{arity:"binary"},intersecting:{arity:"binary"},angle:{argc:3},rightangle:{argc:3},measuredangle:{argc:3},sphericalangle:{argc:3},leftarrow:{arity:"binary"},rightarrow:{arity:"binary"},downarrow:{arity:"binary"},uparrow:{arity:"binary"},nearrow:{arity:"binary"},nwarrow:{arity:"binary"},swarrow:{arity:"binary"},searrow:{arity:"binary"},lrarrow:{arity:"binary"},udarrow:{arity:"binary"},neswarrow:{arity:"binary"},nwsearrow:{arity:"binary"},lrharpoons:{arity:"binary"},leftdarrow:{arity:"binary"},rightdarrow:{arity:"binary"},downdarrow:{arity:"binary"},updarrow:{arity:"binary"},nedarrow:{arity:"binary"},nwdarrow:{arity:"binary"},swdarrow:{arity:"binary"},sedarrow:{arity:"binary"},lrdarrow:{arity:"binary"},uddarrow:{arity:"binary"},reaction:{arity:"binary"},eqarrows:{arity:"binary"},eqharpoons:{arity:"binary"},resonance:{arity:"binary"},dipole:{arity:"binary"},wavearrow:{arity:"binary"},sbond:{arity:"binary"},dbond:{arity:"binary"},tbond:{arity:"binary"},dotbond:{arity:"binary"},dashbond:{arity:"binary"},wedgebond:{arity:"binary"},circledplus:{arity:"binary"},circledminus:{arity:"binary"},circledtimes:{arity:"binary"},circledslash:{arity:"binary"},circleddot:{arity:"binary"},circledring:{arity:"binary"},circledstar:{arity:"binary"},circledequals:{arity:"binary"},circledleft:{arity:"binary"},circledright:{arity:"binary"},circleddown:{arity:"binary"},circledup:{arity:"binary"},circledleftright:{arity:"binary"},circledrightleft:{arity:"binary"},circleddownup:{arity:"binary"},circledupdown:{arity:"binary"},squaredplus:{arity:"binary"},squaredminus:{arity:"binary"},squaredtimes:{arity:"binary"},squareddot:{arity:"binary"},squaredbslash:{arity:"binary"},squaredslash:{arity:"binary"},squaredvbar:{arity:"binary"},squaredequals:{arity:"binary"},squaredleft:{arity:"binary"},squaredright:{arity:"binary"},squareddown:{arity:"binary"},squaredup:{arity:"binary"},doteq:{arity:"binary"},doteqdot:{arity:"binary"},ratio:{arity:"binary"},variation:{arity:"binary"},prec:{arity:"binary",relation:!0},succ:{arity:"binary",relation:!0},preceq:{arity:"binary",relation:!0},succeq:{arity:"binary",relation:!0},ll:{arity:"binary",relation:!0},gg:{arity:"binary",relation:!0},LL:{arity:"binary",relation:!0},GG:{arity:"binary",relation:!0},omit:{arity:"binary"},plusminus:{arity:"binary",addop:"plus"},minusplus:{arity:"binary",addop:"plus"},pm:{arity:"binary",addop:"plus"},mp:{arity:"binary",addop:"plus"},subscript:{arity:"binary",argc:100},superscript:{arity:"binary",argc:100},subsup:{arity:"binary",argc:100},presubscript:{arity:"binary",argc:100},presuperscript:{arity:"binary",argc:100},presubsup:{arity:"binary",argc:100}},u={html:{element:!0},head:{element:!0,arity:"nullary"},body:{element:!0,arity:"nullary"},title:{element:!0,token:"text",arity:"nullary"},style:{element:!0,token:"text"},div:{arity:"nary"},span:{token:"text",arity:"nary"},p:{token:"text",arity:"nary"},h1:{token:"text"},h2:{token:"text"},h3:{token:"text"},h4:{token:"text"},h5:{token:"text"},h6:{token:"text"},b:{token:"text",arity:"nary"},i:{token:"text",arity:"nary"},u:{token:"text",arity:"nary"},s:{token:"text",arity:"nary"},tt:{token:"text",arity:"nary"},big:{token:"text",arity:"nary"},small:{token:"text",arity:"nary"},strike:{token:"text",arity:"nary"},input:{element:!0,place:!0},caps:{element:!0,token:"text",arity:"nary"},emph:{element:!0,token:"text",arity:"nary"},hsub:{element:!0,token:"text",arity:"nary"},hsup:{element:!0,token:"text",arity:"nary"}},a={box:{place:!0},input:{place:!0,relation:!1},eqnarray:{array:!0}},f={times:{sign:[50],sdot:[50],ast:[50]},divide:{sign:[50,51],slash:[54,51]}},l={and:[15],andbar:[15],andeq:[15],apply:[70,0],approx:[20],approxeq:[20],approxequal:[20],arccos:[0,40,0,40],arccosh:[0,40,0,40],arccot:[0,40,0,40],arccoth:[0,40,0,40],arccsc:[0,40,0,40],arccsch:[0,40,0,40],arcsec:[0,40,0,40],arcsech:[0,40,0,40],arcsin:[0,40,0,40],arcsinh:[0,40,0,40],arctan:[0,40,0,40],arctanh:[0,40,0,40],arg:[60],capbar:[25],capeq:[25],card:[50],cartesianproduct:[50],codomain:[65],compose:[67],cos:[0,40,0,40],cosh:[0,40,0,40],cot:[0,40,0,40],coth:[0,40,0,40],csc:[0,40,0,40],csch:[0,40,0,40],cupbar:[23],cupeq:[23],curl:[60],diff:[0,40],divergence:[60],divide:[54],domain:[65],eq:[20],equivalence:[20],equivalent:[20],exists:[100],exp:[71,70],factorial:[80,0],factorof:[20],forall:[100],geq:[20],grad:[60],gt:[20],gteq:[20],image:[65],imaginary:[60],"in":[20],"int":[0,40],dint:[0,40],tint:[0,40],intersect:[25],inverse:[70,0],lambda:[100],laplacian:[60],leq:[20],limit:[0,40],ln:[0,40,0,41],log:[0,40,0,41],lt:[20],lteq:[20],minus:[30,31],neq:[20],ni:[20],not:[0,17],notin:[20],notprsubset:[20],notsubset:[20],notsubseteq:[20],or:[13],orbar:[13],oreq:[13],otherwise:[10],outerproduct:[50],partialdiff:[0,40],piece:[10],piecewise:[0,100],plus:[30],power:[71,0],product:[0,40],prsubset:[20],real:[60],scalarproduct:[50],sec:[0,40,0,40],sech:[0,40,0,40],setdiff:[27],sin:[0,40,0,40],sinh:[0,40,0,40],subset:[20],subseteq:[20],sum:[0,40],tan:[0,40,0,40],tanh:[0,40,0,40],times:[53],union:[23],vectorproduct:[50],xor:[13],nequivalent:[20],napprox:[20],napproxeq:[20],napproxequal:[20],sim:[20],nsim:[20],simeq:[20],nsimeq:[20],cong:[20],ncong:[20],supset:[20],supseteq:[20],prsupset:[20],notsupset:[20],notsupseteq:[20],notprsupset:[20],circle:[90,40],ellipse:[90,40],triangle:[90,40],triangledown:[90,40],pentagon:[90,40],ipentagon:[90,40],hexagon:[90,40],ihexagon:[90,40],heptagon:[90,40],iheptagon:[90,40],octagon:[90,40],ioctagon:[90,40],square:[90,40],rectangle:[90,40],rhombus:[90,40],parallelogram:[90,40],diamond:[90,40],star:[90,40],trapezoid:[90,40],quadrilateral:[90,40],segment:[90,40],line:[90,40],ray:[90,40],arc:[90,40],arcdown:[90,40],parallel:[20],nparallel:[20],perp:[20],nperp:[20],intersecting:[20],angle:[90,40],rightangle:[90,40],measuredangle:[90,40],sphericalangle:[90,40],anglemeasure:[90,40],leftarrow:[20],rightarrow:[20],downarrow:[20],uparrow:[20],nearrow:[20],nwarrow:[20],swarrow:[20],searrow:[20],lrarrow:[20],udarrow:[20],neswarrow:[20],nwsearrow:[20],lrharpoons:[20],leftdarrow:[20],rightdarrow:[20],downdarrow:[20],updarrow:[20],nedarrow:[20],nwdarrow:[20],swdarrow:[20],sedarrow:[20],lrdarrow:[20],uddarrow:[20],reaction:[20],eqarrows:[20],eqharpoons:[20],resonance:[20],dipole:[20],sbond:[20],dbond:[20],tbond:[20],dotbond:[20],dashbond:[20],wedgebond:[20],wavearrow:[20],circledplus:[20],circledminus:[20],circledtimes:[20],circledslash:[20],circleddot:[20],circledring:[20],circledstar:[20],circledequals:[20],circledleft:[20],circledright:[20],circleddown:[20],circledup:[20],circledleftright:[20],circledrightleft:[20],circleddownup:[20],circledupdown:[20],squaredplus:[20],squaredminus:[20],squaredtimes:[20],squareddot:[20],squaredbslash:[20],squaredslash:[20],squaredvbar:[20],squaredequals:[20],squaredleft:[20],squaredright:[20],squareddown:[20],squaredup:[20],doteq:[20],doteqdot:[20],ratio:[45],variation:[20],prec:[20],succ:[20],preceq:[20],succeq:[20],ll:[20],gg:[20],LL:[20],GG:[20],omit:[20],cancel:[90],plusminus:[30,31],minusplus:[30,31],pm:[30,31],mp:[30,31],positive:[0,70],negative:[0,70],subscript:[71,0],superscript:[71,0],subsup:[71,0],presubscript:[71,0],presuperscript:[71,0],presubsup:[71,0],mxf:[90,54]},s}),n("editor/config/Styles",["editor/util/Utils"],function(e){var t=e.$,n=e.XML,r=e.Array,i=e.Object,s=function(){return this},o={};s.getStyleNames=function(e,t){return r.isArray(t)||(t=[]),r.each(e.split(" "),function(e){var n=o[e]||null;n?s.getStyleNames(n,t):r.contains(t,e)||r.add(t,e)}),t};var u={};s.getStyleData=function(e){return u[e]||null},s.setStyleData=function(e,t){u[e]=t};var a=function(n,r,o){if(!i.isString(o))return;var u=n.getBasePath(r,o),a=s.getStyleData(u);a instanceof XMLHttpRequest&&(n._count+=1,a.factoryList.push(n));if(a)return;n._count+=1;var f,l,c,h;if(u.indexOf(".mxc")!==-1){var p=new XMLHttpRequest;p.open("GET",u+"?_="+e.timeStamp,!0),p.responseType="arraybuffer",p.factoryList=[n],s.setStyleData(u,p),p.onload=function(){if(p.status&&p.status!==200){p.onerror();return}var e=new Uint8Array(p.response);s.setStyleData(u,e),p.always()},p.onerror=function(){var n=this.status,r=new Uint8Array(p.response),i=String.fromCharCode.apply(null,r);e.log("EquationEditor missing style file:  "+u),e.log("EquationEditor "+n+" "+i),t(p.factoryList).each(function(){this._error+=1}),s.setStyleData(u,null),p.always()},p.always=function(){t(p.factoryList).each(function(){this._count-=1,this._count===0&&this._ready&&(this._ready(),this._ready=null)})},p.send(null)}else u.indexOf(".mxa")!==-1?(f=function(e){var t=atob(e),n=t.length,r=new Uint8Array(new ArrayBuffer(t.length)),i;for(i=0;i<n;i+=1)r[i]=t.charCodeAt(i);s.setStyleData(u,r)},l=function(){n._error+=1},c=function(){n._count-=1,n._count===0&&n._ready&&(n._ready(),n._ready=null)},h={cache:!1,dataType:"text"},t.ajax(u,h).done(f).fail(l).always(c)):u.indexOf(".xml")!==-1&&(f=function(e){s.setStyleData(u,e)},l=function(){n._error+=1},c=function(){n._count-=1,n._count===0&&n._ready&&(n._ready(),n._ready=null)},h={cache:!1,dataType:"xml"},t.ajax(u,h).done(f).fail(l).always(c))},f=function(e,t){r.each(s.getStyleNames(t),function(t){a(e,t,u[t])})},l=function(e){var t=e.getBasePath("_catalog","catalog.xml"),r=u[t]||null;u={},o={},r&&(u[t]=r,n.children(r).each(function(){var e=n.getAttr(this,"name"),t=n.getAttr(this,"href"),r=n.getAttr(this,"refs");e&&t&&(u[e]=t),e&&r&&(o[e]=r)}))},c=function(n,r){var o=n.getBasePath("_catalog","catalog.xml");if(s.getStyleData(o)){f(n,r);return}n._count+=1;var u=function(e){s.setStyleData(o,e.documentElement)},a=function(t,r,s){e.log("EquationEditor missing catalog file:  "+o),e.log("EquationEditor "+r+" "+s),e.log("EquationEditor "+i.typeOf(t)),n._error+=1},c=function(){n._count-=1,n._error===0&&(l(n),f(n,r)),n._count===0&&n._ready&&(n._ready(),n._ready=null)},h={cache:!1,dataType:"xml"};t.ajax(o,h).done(u).fail(a).always(c)},h=function(e){var n="ee-basic";i.isString(e.stylePreload)&&(n+=" "+e.stylePreload),i.isArray(e.models)&&r.each(e.models,function(e){i.isString(e.styles)&&(n+=" "+e.styles),e.lang&&e.lang!=="en"&&(n+=" lang-"+e.lang)});if(t.i18n&&t.i18n.lng){var s=t.i18n.lng();s&&s!=="en"&&(n+=" lang-"+s)}return n};return s.loadStyles=function(e,t){c(e,h(t))},s}),n("editor/config/KeyInfo",["editor/util/Utils"],function(e){var t=e.Object,n=e.Array,r=e.XML,i=e.Symbol,s=function(){return this.name=null,this.table=null,this.next=null,this},o=i.get("");return s.create=function(e,n,r,i){var o=null;r._parent&&(o=r._parent.getKeyInfo(e,n));var u=new s;return u.name=n,u.table=o?t.extend({},o.table):{},u.next=o?t.extend({},o.next):{},u.process(r,e,i),u},s.prototype.process=function(e,i,s){var o=this;n.each(s,function(n){t.isInteger(n)&&(e._data.setPosition(n),n=e._data.loadExpr());var s=r.getAttr(n,"key"),u=r.getAttr(n,"name"),a=r.getAttr(n,"next");o.processKey(e,i,s,u,a)})},s.prototype.processKey=function(e,t,n,r,o){var u=n.length,a,f;u===1||n.indexOf(" ")===-1?(f=i.get(n),this.table[f]=i.get(r),o&&(this.next[f]=i.get(o))):u>2&&(f=i.get(n.charAt(0)),f=this.table[f]||this.createKey(f),a=e.getLocalInfo(t,f),a||(a=s.create(t,f,e,[]),e._types[t][f]=a),a.processKey(e,t,n.substr(2),r,o))},s.prototype.createKey=function(e){var t=this.name.getName()+" "+e.getName(),n=i.get(t);return this.table[e]=n,n},s.prototype.isRoot=function(){return this.name===o},s.prototype.getKey=function(e){return this.table[e]||null},s.prototype.getNext=function(e){return this.next[e]},s}),n("editor/config/KeyModel",["editor/util/Symbol","editor/config/KeyInfo"],function(e,t){var n=function(){return this._parent=null,this._types=null,this._data=null,this},r=e.get("");return n.create=function(e){var t=new n;return t._parent=e._parent,t._types=e._types||{},t._data=e._data,t},n.prototype.getKeyInfo=function(e,t){var n=this.getLocalInfo(e,t);return!n&&this._parent&&(n=this._parent.getKeyInfo(e,t)),!n&&t!==r&&(n=this.getKeyInfo(e,r)),n},n.prototype.getLocalInfo=function(n,r){r instanceof e||(r=null);if(r===null)return null;var i=this._types[n]||null;i===null&&(i=this._types[n]={});var s=i[r]||null;if(s===null)return null;if(s instanceof t)return s;var o=t.create(n,r,this,s);return i[r]=o,o},n}),n("editor/config/KeyFactory",["editor/util/Utils","editor/config/KeyModel"],function(e,t){var n=e.$,r=e.XML,i=e.Symbol,s=function(){return this._parent=null,this._types=null,this._data=null,this};return s.create=function(){return new s},s.prototype.build=function(){return t.create(this)},s.prototype.push=function(e){this._types&&(this._parent=this.build()),this._types={},this._data=e},s.prototype.add=function(e){this.push(null);var t=n(e).attr("type")||"",i=this._types[t]||null;i===null&&(this._types[t]={});var o=this;n(e).children("key").each(function(){var e=s.prefixName(this),n=o._types[t],i=n[e]||null;i===null&&(n[e]=i=[]),i.push(r.copyNode(this))})},s.prototype.addData=function(e,t){this.push(e),e.setPosition(e._offset[t]);var n=e.loadInt(),r,i,s,o,u,a;for(a=0;a<n;a+=1)r=e.getPosition(),i=this.prefixDataName(),s=this._data.getAttr("type")||"",o=this._types[s]||null,o===null&&(this._types[s]=o={}),u=o[i]||null,u===null&&(o[i]=u=[]),e.scanExpr(),u.push(r)},s.prefixName=function(e){var t=r.getAttr(e,"prefix")||"";return i.get(t)},s.prototype.prefixDataName=function(){var e=this._data.getAttr("prefix")||"";return i.get(e)},s}),n("editor/config/LayoutInfo",["editor/util/Utils"],function(e){var t=e.Object,n=e.Symbol,r=e.Array,i=e.XML,s=null,o="The empty name may not be used to create layout transformations.",u=function(){return this.name=null,this.layouts=null,this};return u.create=function(e,t,n,r){var i=new u;return i.name=e,i.layouts=t?t.layouts.concat():[],i.process(n,r),i},u.prototype.process=function(n,o){s=s||e.require("editor/expr/Layout");var a=this.layouts,f=this.name;r.each(o,function(e){if(t.isInteger(e)){n._data.setPosition(e),e=n._data.loadExpr();var o=u.layoutName(e);if(o!==f)return}i.children(e).length===2&&r.add(a,s.expand(i.trim(e)))})},u.prototype.getLayouts=function(){return this.layouts},u.layoutName=function(t){var r=i.getAttr(t,"name");r||e.error(o);var s=i.getAttr(t,"uri")||i.namespaceURI(t)||"";return n.get(r,s)},u}),n("editor/config/LayoutModel",["editor/util/Symbol","editor/config/LayoutInfo"],function(e,t){var n=function(){return this._parent=null,this._types=null,this._hash=null,this._data=null,this._brailleOutput=null,this},r,i=e.get("_unknown");return n.create=function(e){var t=new n;return t._parent=e._parent,t._types=e._types||{},t._hash=e._hash||{},t._data=e._data,t._brailleOutput=e._brailleOutput,t._parent&&!t._brailleOutput&&(t._brailleOutput=t._parent.getBrailleOutput()),t},n.prototype.copy=function(e){if(this.hasOwnProperty(e))return this[e];var t=new n;e=e||"";var r=this._parent;r=r?r.copy(e):null,t._parent=r,t._types={},t._hash={},t._data=this._data,t._types[""]=this._types[""]||{},t._hash[""]=this._hash[""]||[],t._brailleOutput=this._brailleOutput;var i=this._types[e],s=this._hash[e];return e&&(i||s)&&(r=t,t=new n,t._parent=r,t._types={},t._hash={},t._data=this._data,t._types[""]=i||{},t._hash[""]=s||[],t._brailleOutput=this._brailleOutput),this[e]=t,t},n.prototype.getBrailleOutput=function(){return this._brailleOutput},n.prototype.getLayoutInfo=function(e){var t=r(this,e);return!t&&this._parent&&(t=this._parent.getLayoutInfo(e)),!t&&e!==i&&(t=this.getLayoutInfo(i)),t},r=function(n,r){r instanceof e||(r=null);if(r===null)return null;var i=n._hash[""].length,s=r.hashCode()%i,o=n._types[""][r]||n._hash[""][s]||null;if(o===null)return null;if(o instanceof t)return o;var u=null;return n._parent&&(u=n._parent.getLayoutInfo(r)),u=t.create(r,u,n,o),n._types[""][r]=u,u},n}),n("editor/config/LayoutFactory",["editor/util/Utils","editor/config/LayoutInfo","editor/config/LayoutModel"],function(e,t,n){var r=e.$,i=e.XML,s=function(){return this._parent=null,this._types=null,this._hash=null,this._type=null,this._data=null,this._brailleOutput=null,this};return s.create=function(){return new s},s.prototype.build=function(){return this._types||this.push(null),n.create(this)},s.prototype.push=function(e){this._types&&(this._parent=this.build()),this._types={},this._hash={},this._type="",this._data=e,this._brailleOutput="",this._types[this._type]={},this._hash[this._type]=[],this.addLayout()},s.prototype.add=function(e){this.push(null);var t=r(e).attr("brailleOutput");this._brailleOutput=t||this._brailleOutput;var n=r(e).attr("type")||"";this._type=n;var i=this._types[n]||null;i===null&&(this._types[n]={},this.addLayout());var s=this;r(e).children("layout").each(function(){s.addLayout(this)})},s.prototype.addData=function(e,t){this.push(e),e.setPosition(e._offset[t]);var n=e.loadInt(),r,i,s,o,u,a,f,l,c;for(c=0;c<n;c+=1)s=e.getPosition(),o=e.getHash(),u=this._data.getAttr("type")||"",this._type=u,a=this._data.getAttr("brailleOutput")||"",this._brailleOutput=a,f=this._hash[u]||null,f===null&&(this._types[u]={},this._hash[u]=f=[],this.addLayout()),r=f.length,r===0&&(i=Math.ceil(Math.log(n)/Math.log(2)),r=1<<Math.max(3,i-2),f[r-1]=[]),l=f[o%r]||null,l===null&&(f[o%r]=l=[]),e.scanExpr(),l.push(s)},s.prototype.addLayout=function(e){e||(e=i.valueOf('<layout name="_unknown"/>',null));var t=s.layoutName(e),n=this._types[this._type],r=n[t]||null;r===null&&(n[t]=r=[]),r.push(i.copyNode(e))},s.layoutName=t.layoutName,s}),n("editor/config/TemplateInfo",["editor/util/Utils"],function(e){var t=e.Object,n=e.Symbol,r=e.Array,i=e.Name,s=e.XML,o=null,u,a,f,l="The empty name may not be used to create template transformations.",c=function(){return this.name=null,this.templates=null,this};return c.create=function(e,t,n,r){var i=new c;return i.name=e,i.templates=t?t.templates.concat():[],i.process(n,r),i},c.prototype.process=function(n,i){o=o||e.require("editor/expr/Template");var f=this.templates,l=this.name,h;r.each(i,function(e){if(t.isInteger(e)){n._data.setPosition(e),e=n._data.loadExpr();var i=c.templateName(e);if(l&&i!==l)return}h=s.children(e).length;if(h===2||h===3){var p=o.expand(s.trim(e));p.setName(l);var d=p.getAttribute("lang");if(d&&u(p)){var v=a(f,p);if(!v||!u(v))return}r.add(f,p)}})},u=function(e){e=e.getApplyArg(2);if(e&&e.isApplyOp(i._edit)){e=e.getApplyArg(1);if(e&&e.isApplyOp(i._popup))return!0}return!1},a=function(e,t){var n=t.getName(),i=t.getAttribute("phase"),s=t.getAttribute("selector"),o=null;return r.each(e,function(e){var t=e.getName(),r=e.getAttribute("phase"),u=e.getAttribute("selector");n===t&&i===r&&s===u&&(o=e)}),o},c.prototype.getTemplates=function(){return this.templates},c.templateName=function(t){var r=s.getAttr(t,"name");r||e.error(l);var o=s.getAttr(t,"uri")||i.NS_USER,u=f(t,"alt"),a=f(t,"ctrl"),c=f(t,"shift"),h=f(t,"left"),p=f(t,"right"),d=f(t,"middle");return r=(h?"left-":"")+(p?"right-":"")+(d?"middle-":"")+r,r=(a?"ctrl-":"")+(u?"alt-":"")+(c?"shift-":"")+r,n.get(r,o)},f=function(e,n){return t.toBoolean(s.getAttr(e,n))||!1},c}),n("editor/config/TemplateModel",["editor/util/Utils","editor/config/TemplateInfo"],function(e,t){var n=e.Name,r=e.Symbol,i=function(){return this._parent=null,this._table=null,this._hash=null,this._target=null,this._thash=null,this._data=null,this},s,o,u=n.user("_unknown");return i.create=function(e){var t=new i;return t._parent=e._parent,t._table=e._table||{},t._hash=e._hash||[],t._target=e._target||{},t._thash=e._thash||[],t._data=e._data,t},i.prototype.getTemplateInfo=function(e){var t=s(this,e);return!t&&this._parent&&(t=this._parent.getTemplateInfo(e)),!t&&e!==u&&(t=this.getTemplateInfo(u)),t},i.prototype.getTargetInfo=function(e){var t=o(this,e);return!t&&this._parent&&(t=this._parent.getTargetInfo(e)),t},s=function(e,n){n instanceof r||(n=null);if(n===null)return null;var i=e._hash.length,s=n.hashCode()%i,o=e._table[n]||e._hash[s]||null;if(o===null)return null;if(o instanceof t)return o;var u=null;return e._parent&&(u=e._parent.getTemplateInfo(n)),u=t.create(n,u,e,o),e._table[n]=u,u},o=function(e,n){n instanceof r||(n=null);if(n===null)return null;var i=e._thash.length,s=n.hashCode()%i,o=e._target[n]||e._thash[s]||null;if(o===null)return null;if(o instanceof t)return o;var u=null;return e._parent&&(u=e._parent.getTargetInfo(n)),u=t.create(null,u,e,o),e._target[n]=u,u},i}),n("editor/config/TemplateFactory",["editor/util/Utils","editor/config/TemplateInfo","editor/config/TemplateModel"],function(e,t,n){var r=e.$,i=e.XML,s=function(){return this._parent=null,this._table=null,this._hash=null,this._thash=null,this._data=null,this};return s.create=function(){return new s},s.prototype.build=function(){return this._table||this.push(null),n.create(this)},s.prototype.push=function(e){this._table&&(this._parent=this.build()),this._table={},this._hash=[],this._thash=[],this._data=e,this.addTemplate()},s.prototype.add=function(e){this.push(null);var t=this;r(e).children("template").each(function(){t.addTemplate(this)})},s.prototype.addData=function(e,t){this.push(e),e.setPosition(e._offset[t]);var n=e.loadInt(),r=Math.ceil(Math.log(n)/Math.log(2)),i=this._hash.length;i===0&&(i=1<<Math.max(3,r-2),this._hash[i-1]=[]);var s=this._thash.length;s===0&&(s=1<<Math.max(3,r-4),this._thash[s-1]=[]);var o,u,a,f;for(f=0;f<n;f+=1)o=e.getPosition(),u=e.getHash()%i,a=this._hash[u]||null,a===null&&(this._hash[u]=a=[]),a.push(o),u=e.getHash("thash")%s,u&&(a=this._thash[u]||null,a===null&&(this._thash[u]=a=[]),a.push(o)),e.scanExpr()},s.prototype.addTemplate=function(e){e||(e=i.valueOf('<template name="_unknown"/>',null));var t=s.templateName(e),n=this._table[t]||null;n===null&&(this._table[t]=n=[]),n.push(i.copyNode(e))},s.templateName=t.templateName,s}),n("editor/config/ButtonModel",["editor/util/Utils"],function(e){var t=e.$,n=e.XML,r=e.Object,i=function(){return this._parent=null,this._table=null,this._data=null,this};return i.create=function(e){var t=new i;return t._parent=e._parent,t._table=e._table||{},t._data=e._data,t},i.prototype.getButtonInfo=function(e){var i=this._table[e]||null,s=!0;r.isInteger(i)&&(this._data.setPosition(i),this._table[e]=i=this._data.loadExpr(),s=!1),n.isElement(i)&&(s=n.getAttr(i,"merged"));if(i&&s)return i;if(this._parent){var o=this._parent.getButtonInfo(e);if(o){if(i===null)return this._table[e]=o,o;t(o).children().each(function(){var e=n.localName(this);t(i).children(e).length===0&&t(i).append(n.copyNode(this))})}}return n.setAttr(i,"merged","true"),i},i}),n("editor/config/ButtonFactory",["editor/util/Utils","editor/config/ButtonModel"],function(e,t){var n=e.$,r=e.XML,i=function(){return this._parent=null,this._table=null,this._data=null,this},s="The empty name may not be used to create a palette button.";return i.create=function(){return new i},i.prototype.build=function(){return t.create(this)},i.prototype.push=function(e){this._table&&(this._parent=this.build()),this._table={},this._data=e},i.prototype.add=function(e){this.push(null);var t=this;n(e).children("button").each(function(){var e=i.buttonName(this);t._table[e]=r.copyNode(this)})},i.prototype.addData=function(e,t){this.push(e),e.setPosition(e._offset[t]);var n=e.loadInt(),r,i,s;for(s=0;s<n;s+=1)r=e.getPosition(),i=this.buttonDataName(),e.scanExpr(),this._table[i]=r},i.buttonName=function(t){var n=r.getAttr(t,"id");return n||e.error(s),n},i.prototype.buttonDataName=function(){var t=this._data.getAttr("id");return t||e.error(s),t},i}),n("editor/config/ButtonBarModel",["editor/util/Object"],function(e){var t=function(){return this._parent=null,this._table=null,this._data=null,this};return t.create=function(e){var n=new t;return n._parent=e._parent,n._table=e._table||{},n._data=e._data,n},t.prototype.getButtonBarInfo=function(t){var n=this._table[t]||null;return e.isInteger(n)&&(this._data.setPosition(n),this._table[t]=n=this._data.loadExpr()),!n&&this._parent&&(n=this._parent.getButtonBarInfo(t)),n},t}),n("editor/config/ButtonBarFactory",["editor/util/Utils","editor/config/ButtonBarModel"],function(e,t){var n=e.$,r=e.XML,i=function(){return this._parent=null,this._table=null,this._data=null,this},s="The empty name may not be used to create a button bar.";return i.create=function(){return new i},i.prototype.build=function(){return t.create(this)},i.prototype.push=function(e){this._table&&(this._parent=this.build()),this._table={},this._data=e},i.prototype.add=function(e){this.push(null);var t=this;n(e).children("buttonBar").each(function(){var e=i.buttonBarName(this);t._table[e]=r.copyNode(this)})},i.prototype.addData=function(e,t){this.push(e),e.setPosition(e._offset[t]);var n=e.loadInt(),r,i,s;for(s=0;s<n;s+=1)r=e.getPosition(),i=this.buttonBarDataName(),e.scanExpr(),this._table[i]=r},i.buttonBarName=function(t){var n=r.getAttr(t,"id");return n||e.error(s),n},i.prototype.buttonBarDataName=function(){var t=this._data.getAttr("id");return t||e.error(s),t},i}),n("editor/config/PaletteModel",["editor/util/Utils"],function(e){var t=e.$,n=e.XML,r=e.Object,i=function(){return this._parent=null,this._table=null,this._data=null,this},s="_carousel",o="_quickBar",u="_sideBar",a="_moreMenu";return i.create=function(e){var t=new i;return t._parent=e._parent,t._table=e._table||{},t._data=e._data,t},i.prototype.getPaletteInfo=function(e){var i=this._table[e]||null,s=!0;r.isInteger(i)&&(this._data.setPosition(i),this._table[e]=i=this._data.loadExpr(),s=!1),n.isElement(i)&&(s=n.getAttr(i,"merged"));if(i&&s)return i;if(this._parent){var o=this._parent.getPaletteInfo(e);if(o){if(i===null)return this._table[e]=o,o;var u={};t(o).children().each(function(){var e=n.localName(this);if(e==="br")return;t(i).children(e).length===0&&(u[e]=!0),u[e]&&t(i).append(n.copyNode(this))});var a=n.getAttr(o,"open"),f=n.getAttr(i,"open");a!==null&&f===null&&n.setAttr(i,"open",a)}}return n.setAttr(i,"merged","true"),i},i.prototype.getCarousel=function(){return this.getPaletteInfo(s)},i.prototype.getQuickBar=function(){return this.getPaletteInfo(o)},i.prototype.getSideBar=function(){return this.getPaletteInfo(u)},i.prototype.getMoreMenu=function(){return this.getPaletteInfo(a)},i}),n("editor/config/PaletteFactory",["editor/util/Utils","editor/config/PaletteModel"],function(e,t){var n=e.$,r=e.XML,i=function(){return this._parent=null,this._table=null,this._data=null,this},s="The empty name may not be used to create a palette.",o="_carousel",u="_quickBar",a="_sideBar",f="_moreMenu";return i.create=function(){return new i},i.prototype.build=function(){return t.create(this)},i.prototype.push=function(e){this._table&&(this._parent=this.build()),this._table={},this._data=e},i.prototype.add=function(e){this.push(null);var t=this;n(e).children().each(function(){var e=i.paletteName(this);t._table[e]=r.copyNode(this)})},i.prototype.addData=function(e,t){this.push(e),e.setPosition(e._offset[t]);var n=e.loadInt(),r,i,s;for(s=0;s<n;s+=1)r=e.getPosition(),i=this.paletteDataName(),this._table[i]=r,e.scanExpr()},i.paletteName=function(t){var n=r.localName(t),i="";return n==="palette"&&(i=r.getAttr(t,"id")),n==="carousel"&&(i=o),n==="quickBar"&&(i=u),n==="sideBar"&&(i=a),n==="moreMenu"&&(i=f),i||e.error(s),i},i.prototype.paletteDataName=function(){var t=this._data.getName(),n="";return t==="palette"&&(n=this._data.getAttr("id")),t==="carousel"&&(n=o),t==="quickBar"&&(n=u),t==="sideBar"&&(n=a),t==="moreMenu"&&(n=f),n||e.error(s),n},i}),n("editor/config/ZConfig",["editor/util/Utils"],function(e){var t=e.Char,n=e.Name,r=e.Object,i=e.Symbol,s=e.ByteBuffer,o=function(){return this._offsetCount=0,this._offset=[],this._symbolCount=0,this._symbol=[],this._buffer=null,this};o.create=function(e){var t=new o;return t._buffer=s.create(e),t.loadHeader(),t.loadSymbols(),t},o.prototype.getPosition=function(){return this._buffer.getPosition()},o.prototype.setPosition=function(e){this._buffer.setPosition(e)},o.prototype.getLength=function(){return this._buffer.length},o.prototype.getByte=function(e){return this._buffer.data[e]||0},o.prototype.getChar=function(e){return String.fromCharCode(this.getByte(e))};var u=function(e,t){if(65536<=t&&t<1114112){var n=(t-65536>>10)+55296,r=(t-65536&1023)+56320;e.push(n,r)}else e.push(t)};return o.prototype.getString=function(e,t){var n=[];this.setPosition(e);while(this.getPosition()<t)u(n,this.loadInt());return String.fromCharCode.apply(null,n)},o.prototype.getInt=function(e){var t=0;return t=s.put8(t,this.getByte(e+3)),t=s.put8(t,this.getByte(e+2)),t=s.put8(t,this.getByte(e+1)),t=s.put8(t,this.getByte(e)),t},o.prototype.loadInt=function(){return this._buffer.loadInt()},o.prototype.loadSymbol=function(){var e=this.loadInt(),t=this._symbol[e];return r.isInteger(t)&&(this._symbol[e]=t=this.createSymbol(t)),t},o.prototype.loadSymbolName=function(){var e=this.loadInt(),t=this._symbol[e];return r.isInteger(t)?this.createSymbol(t,!0):t.getName()},o.prototype.getName=function(){var e=this.getPosition(),t=this.loadSymbolName();return this.setPosition(e),t},o.prototype.getURI=function(){var e=this.getPosition(),t=this.loadSymbol();return this.setPosition(e),t.getURI()},o.prototype.getHash=function(e){e=e||"hash";var t=this.getPosition();this.loadInt();var n=this.loadInt(),r,i=0,s;for(s=0;s<n;s+=1){r=this.loadSymbolName(),i=this.loadInt();if(r===e)break;i=0}return this.setPosition(t),i},o.prototype.getAttr=function(e){var t=this.getPosition();this.loadInt();var n=this.loadInt(),r,i,s;for(s=0;s<n;s+=1){r=this.loadSymbolName();if(r===e)return i=this.loadSymbolName(),this.setPosition(t),i;this.loadInt()}return this.setPosition(t),""},o.prototype.isGlobal=function(e){var t=this._symbol[e];return r.isInteger(t)?this.getByte(t)===123&&this.getByte(t+1)===125:!t.getURI()},o.prototype.scanExpr=function(){var e=this.loadInt();if(this.isGlobal(e))return;var t=this.loadInt(),n;for(n=0;n<t;n+=1)this.loadInt(),this.loadInt();var r=this.loadInt(),i;for(i=0;i<r;i+=1)this.scanExpr()},o.prototype.loadExpr=function(){var e=this.loadSymbol();if(!e)return document.createTextNode("");var t=e.getName(),r=e.getURI();if(!r)return document.createTextNode(t);var i=n._nsprefix[r];i&&(t=i+t);var s=document.createElementNS(r,t),o=this.loadInt(),u,a,f;for(f=0;f<o;f+=1)u=this.loadSymbolName(),u==="hash"||u==="thash"?this.loadInt():(a=this.loadSymbolName(),s.setAttribute(u,a));var l=this.loadInt(),c;for(c=0;c<l;c+=1)s.appendChild(this.loadExpr());return s},o.prototype.loadHeader=function(){this._offsetCount=this.getByte(3),this._offset=[4*this._offsetCount];var e;for(e=1;e<this._offsetCount;e+=1)this._offset[e]=this.getInt(4*e);this.checkHeader()||(this._offsetCount=0,this._offset=[])},o.prototype.checkHeader=function(){if(this._offsetCount<1)return!1;var e=s.put8(this.getByte(0),this.getByte(1));if(e!==12609||this._offsetCount!==9)return!1;var t=this.getByte(2);if(t!==16)return!1;var n=0,r;for(r=0;r<this._offsetCount;r+=1){if(!(n<this._offset[r]))return!1;n=this._offset[r]}return this.getLength()!==n?!1:!0},o.prototype.loadSymbols=function(){var e=this._offset[0],t=this._offset[1],n;this._symbolCount=1,this._symbol=[null];var r=e;for(n=e;n<t;n+=1)this.getByte(n)===0&&(this._symbol[this._symbolCount]=r,this._symbolCount+=1,r=n+1)},o.prototype.createSymbol=function(e,r){var s=this._offset[1],o,u=e,a=e,f,l,c,h;for(o=e;o<s;o+=1){f=this.getChar(o);if(f==="{"&&u===a&&u===o)u=o+1;else if(f==="}"&&u>a)a=o+1;else if(this.getByte(o)===0){l=this.getPosition(),c=this.getString(a,o),h=n.NS_MATH;if(a>u)h=this.getString(u,a-1);else if(c===""||c.charAt(0)!=="_"&&!t.isLetter(c.charCodeAt()))h="";return this.setPosition(l),r?c:i.get(c,h)}}return null},o}),n("editor/config/ConfigFactory",["editor/util/Utils","editor/config/Styles","editor/config/KeyFactory","editor/config/LayoutFactory","editor/config/TemplateFactory","editor/config/ButtonFactory","editor/config/ButtonBarFactory","editor/config/PaletteFactory","editor/config/ZConfig"],function(e,t,n,r,i,s,o,u,a){var f=e.Array,l=e.Object,c=e.XML,h=null,p,d,v="A configuration resource must contain configuration data.",m=function(){return this._parent=null,this._base=null,this._count=0,this._error=0,this._ready=null,this._styles=null,this._loaded=null,this._keyFactory=n.create(),this._layoutFactory=r.create(),this._templateFactory=i.create(),this._buttonFactory=s.create(),this._buttonBarFactory=o.create(),this._paletteFactory=u.create(),this},g=function(){var e="",t=window.location.pathname;return window.TN8&&(window.TN8.baseUrl?e=window.TN8.baseUrl:t.indexOf("client")===1?e="":t.indexOf("tn8itemstyleguide")===1?e="/tn8itemstyleguide/":e="/"),e};return m.createBase=function(e){var n=new m;return n.setBaseURL(e),n._styles={},n._loaded=[],t.loadStyles(n,e),n},m.extendBase=function(e,n){var r=new m;return r.setBaseURL(n),r._parent=e,r._styles=e._styles,r._loaded=f.copy(e._loaded),t.loadStyles(r,n),r},m.createChild=function(e){var t=new m;return t._parent=e,t._loaded=f.copy(e._loaded),t._layoutFactory._parent=e._layoutModel,t._templateFactory._parent=e._templateModel,t._buttonFactory._parent=e._buttonModel,t._buttonBarFactory._parent=e._buttonBarModel,t._paletteFactory._parent=e._paletteModel,t},m.prototype.build=function(){return h=h||e.require("editor/config/Config"),h.build(this)},m.prototype.extend=function(){return h=h||e.require("editor/config/Config"),h.extend(this)},m.prototype.addStyles=function(n){if(!n||!l.isString(n))return this;var r=this._styles||this._parent.getStyles(),i=this._parent.getLoaded(),s=this;return f.each(t.getStyleNames(n),function(t){var n=r[t];if(!n){e.log("EquationEditor missing style file:  "+t);return}if(f.contains(i,t))return;var o=m.getStyleData(n);o&&(s.add(o),f.add(s._loaded,t))}),this},m.prototype.add=function(t){if(!t)return this;l.isString(t)&&(t=c.valueOf(t)),t.documentElement&&(t=t.documentElement);if(t instanceof a)return d(this,t),this;if(c.isElement(t)){var n=this;return p(n,t),c.children(t).each(function(){p(n,this)}),this}e.error(v)},p=function(e,t){var n=c.localName(t);switch(n){case"keys":e._keyFactory.add(t);break;case"layouts":e._layoutFactory.add(t);break;case"templates":e._templateFactory.add(t);break;case"buttons":e._buttonFactory.add(t);break;case"buttonBars":e._buttonBarFactory.add(t);break;case"palettes":e._paletteFactory.add(t)}},d=function(e,t){e._keyFactory.addData(t,2),e._layoutFactory.addData(t,3),e._templateFactory.addData(t,4),e._buttonFactory.addData(t,5),e._buttonBarFactory.addData(t,6),e._paletteFactory.addData(t,7)},m.prototype._parent=null,m.prototype._base=null,m.prototype._count=0,m.prototype._ready=null,m.prototype._styles=null,m.prototype._loaded=null,m.prototype._keyFactory=null,m.prototype._layoutFactory=null,m.prototype._templateFactory=null,m.prototype._buttonFactory=null,m.prototype._buttonBarFactory=null,m.prototype._paletteFactory=null,m.prototype.getParent=function(){return this._parent},m.prototype.getBaseURL=function(){return this._base},m.prototype.setBaseURL=function(e){var t="",n=e.styleBase;l.isString(n)&&(t=n);var r=g();r&&t&&(t=r+t),this._base=t},m.prototype.getBasePath=function(e,t){var n=this._base?this._base+"/"+t:t;return this._styles[e]=n,n},m.prototype.getStyles=function(){return this._styles},m.getStyleNames=function(e){return t.getStyleNames(e)},m.getStyleData=function(e){var n=t.getStyleData(e);return n instanceof Uint8Array&&(n=a.create(n),t.setStyleData(e,n)),n},m.prototype.getLoaded=function(){return this._loaded},m.prototype.getKeyModel=function(){return this._keyFactory.build()},m.prototype.getLayoutModel=function(){return this._layoutFactory.build()},m.prototype.getTemplateModel=function(){return this._templateFactory.build()},m.prototype.getButtonModel=function(){return this._buttonFactory.build()},m.prototype.getButtonBarModel=function(){return this._buttonBarFactory.build()},m.prototype.getPaletteModel=function(){return this._paletteFactory.build()},m}),n("editor/config/Config",["editor/util/Utils","editor/config/AttInfo","editor/config/FormInfo","editor/config/TagInfo","editor/config/ConfigFactory","editor/config/ZConfig"],function(e,t,n,r,i,s){var o=e.Name,u=function(){return this},a=function(e){return e instanceof u||(e=null),i.createChild(e)};u.build=function(e){var t=new u;return t._parent=e.getParent(),t._styles=e.getStyles(),t._loaded=e.getLoaded(),t._factoryCount=0,t._errorCount=0,t._isReady=!0,t._ready=[],t._keyModel=e.getKeyModel(),t._layoutModel=e.getLayoutModel(),t._templateModel=e.getTemplateModel(),t._buttonModel=e.getButtonModel(),t._buttonBarModel=e.getButtonBarModel(),t._paletteModel=e.getPaletteModel(),e._count!==0&&(t._isReady=!1,t._factoryCount+=1,e._ready=function(){t._factoryCount-=1;if(t._factoryCount===0){t._errorCount+=e._error;var n=t._ready;t._ready=[],t._isReady=!0;while(n.length>0)n.shift()()}}),t},u.extend=function(e){var t=e.getParent();return e._count!==0&&(t._isReady=!1,t._factoryCount+=1,e._ready=function(){t._factoryCount-=1;if(t._factoryCount===0){t._errorCount+=e._error;var n=t._ready;t._ready=[],t._isReady=!0;while(n.length>0)n.shift()()}}),t};var f=null,l=null;u.base=function(e){return e||(e={}),f&&f._errorCount===0?f=i.extendBase(f,e).extend():f=i.createBase(e).build(),l===null&&f.ready(function(){var t=e.stylePreload||"ee-basic";l=f.pushStyles(t)}),f},u.empty=function(){return f},u.root=function(){return f},u.basic=function(){return l},u.create=function(){return a(u.root()).build()},u.prototype.copy=function(e){if(this.hasOwnProperty(e))return this[e];var t=new u,n=this._parent;return n=n?n.copy(e):null,t._parent=n,t._styles=this.getStyles(),t._loaded=this.getLoaded(),t._type=e,t._factoryCount=0,t._errorCount=0,t._isReady=!0,t._ready=[],t._keyModel=this._keyModel,t._layoutModel=this._layoutModel.copy(e),t._templateModel=this._templateModel,t._buttonModel=this._buttonModel,t._buttonBarModel=this._buttonBarModel,t._paletteModel=this._paletteModel,this[e]=t,t},u.prototype.pushStyles=function(e){return a(this).addStyles(e).build()},u.prototype.push=function(e){return a(this).add(e).build()},u.prototype.pop=function(){return this._parent},u.prototype.reset=function(){var e=this;return this._parent!==null&&(e=this._parent.reset()),e},u.prototype.ready=function(e){this._isReady?e():this._ready.push(e)},u.prototype.getStyles=function(){return this._parent?this._parent.getStyles():this._styles},u.prototype.getStyleNames=function(e){return i.getStyleNames(e)},u.prototype.getStyleData=function(t){var n=this.getStyles()[t];if(!n){e.log("EquationEditor missing style file:  "+t);return}var r=i.getStyleData(n);return r?(r.documentElement&&(r=r.documentElement),r instanceof s&&(r.setPosition(r._offset[1]),r.loadInt(),r=r.loadExpr()),r):r},u.prototype.getLoaded=function(){return this._loaded},u.prototype._parent=null,u.prototype._styles=null,u.prototype._loaded=null,u.prototype._isReady=!1,u.prototype._ready=null,u.prototype._layoutModel=null,u.prototype._templateModel=null,u.prototype._buttonModel=null,u.prototype._buttonBarModel=null,u.prototype._paletteModel=null,u.prototype.showAssoc=!0,u.prototype.showIdentity=!0,u.prototype.showInverse=!1,u.NO_PAREN=0,u.prototype.compareBindings=function(e,t){return e===u.NO_PAREN||t===u.NO_PAREN?!1:e>t?!0:e===20&&t===20?!1:e===t&&this.showAssoc?!0:!1},u.isUnknown=function(e){return e!==null&&e.getURI()===o.NS_USER},u.isSymbol=function(e){return e!==null&&e.getURI().match(/^csymbol:/)!==null},u.isPresentElt=t.isPresentElt,u.isContentAtt=t.isContentAtt,u.checkAttrib=t.checkAttrib;var c=function(e,t,n){return e._keyModel.getKeyInfo(t,n)},h=function(e,t){return e._layoutModel.getLayoutInfo(t)},p=function(e,t){return e._templateModel.getTemplateInfo(t)},d=function(e,t){return e._templateModel.getTargetInfo(t)},v=function(e,t){return e._buttonModel.getButtonInfo(t)},m=function(e,t){return e._buttonBarModel.getButtonBarInfo(t)},g=function(e,t){return e._paletteModel.getPaletteInfo(t)};return u.prototype.hasForms=function(e){return n.hasForms(e)},u.prototype.getForms=function(e){return n.getForms(e)},u.prototype.getPrefixInfo=function(e,t,n){var r=c(this,e,t);return r&&r.getKey(n)?r:(r=c(this,e,""),r&&r.getKey(n)?r:null)},u.prototype.getLayouts=function(e){return h(this,e).getLayouts()},u.prototype.getBrailleOutput=function(){return this._layoutModel.getBrailleOutput()},u.prototype.getTemplates=function(e){return p(this,e).getTemplates()},u.prototype.getTargets=function(e){var t=d(this,e);return t?t.getTemplates():null},u.prototype.getButtonInfo=function(e){return v(this,e)},u.prototype.getButtonBarInfo=function(e){return m(this,e)},u.prototype.getPaletteInfo=function(e){return g(this,e)},u.prototype.getCarousel=function(){return this._paletteModel.getCarousel()},u.prototype.getQuickBar=function(){return this._paletteModel.getQuickBar()},u.prototype.getSideBar=function(){return this._paletteModel.getSideBar()},u.prototype.getMoreMenu=function(){return this._paletteModel.getMoreMenu()},u.prototype.getAdditiveOp=function(e){return r.getAdditiveOp(e)},u.prototype.isAdditiveOp=function(e){return r.isAdditiveOp(e)},u.prototype.isAdditiveInverse=function(e){return r.isAdditiveInverse(e)},u.prototype.isNary=function(e){return r.isNary(e)},u.prototype.isBinary=function(e){return r.isBinary(e)},u.prototype.isNullary=function(e){return r.isNullary(e)},u.prototype.getNaryMax=function(e){return r.getNaryMax(e)},u.prototype.isArray=function(e){return r.isArray(e)},u.prototype.isAssoc=function(e){return r.isAssoc(e)},u.prototype.isCondition=function(e){return r.isCondition(e)},u.prototype.isElement=function(e){return r.isElement(e)},u.prototype.isOperator=function(e){return r.isOperator(e)},u.prototype.isOrder=function(e){return r.isOrder(e)},u.prototype.getOrders=function(e,t){return r.getOrders(e,t)},u.prototype.isPlace=function(e){return r.isPlace(e)},u.prototype.getLeftBinding=function(e){return r.getLeftBinding(e)},u.prototype.getRightBinding=function(e){return r.getRightBinding(e)},u.prototype.getOuterLeftBinding=function(e){return r.getOuterLeftBinding(e)},u.prototype.getOuterRightBinding=function(e){return r.getOuterRightBinding(e)},u.prototype.isTable=function(e){return r.isTable(e)},u.prototype.isToken=function(e){return r.isToken(e)},u.prototype.isNumber=function(e){return r.isNumberToken(e)},u.prototype.isSymbol=function(e){return r.isSymbolToken(e)},u.prototype.isBinding=function(e){return r.isBinding(e)},u.prototype.getBindingVar=function(e){return r.getBindingVar(e)},u.prototype.getBindingList=function(e){return r.getBindingList(e)},u}),n("editor/expr/Expr",["editor/util/Utils","editor/config/TagInfo","editor/config/Config"],function(e,t,n){var r=e.Array,i=e.Buffer,s=e.Char,o=e.Markup,u=e.Name,a=e.Object,f=e.Symbol,l=e.XML,c=function(){return this};c.prototype.init=function(e){return this.setConfig(e),this.setParent(null),this.setSymbol(null),this._children=[],this._attributes={},this},c.create=function(e){return(new c).init(e)},c.prototype.create=function(e){return e instanceof n||(e=this.getConfig()),c.create(e)},c.copy=function(e){return e instanceof c?c.create().copy(e):null},c.prototype.copy=function(e){if(e instanceof c){var t=e.getConfig();this.getConfig()!==n.root()&&(t=this.getConfig());var r=this.create(t);r._source=e;var i;for(i in e._attributes)e._attributes.hasOwnProperty(i)&&(r._attributes[i]=e._attributes[i]);r.setSymbol(e.getSymbol());var s=e.getCount(),o;for(o=0;o<s;o+=1)r.addChild(this.copy(e.getChild(o)));return r}return null},c.valueOf=function(e){return c.expand(l.valueOf(e))},c.prototype.toString=function(){return this.print()},c.prototype.toXMLString=function(){return l.toString(this.markup())},c.prototype.getConfig=function(){return this._config},c.prototype.setConfig=function(e){e instanceof n||(e=n.root()),this._config=e},c.prototype.getSymbol=function(){return this._symbol},c.prototype.setSymbol=function(e){e instanceof f||(e=null),this._symbol=e},c.prototype.getString=function(){return this.isSymbol()?this.getSymbol().getName():null},c.prototype.getStrings=function(){var e=this.getString()||"",t=this.getApplyArgc(),n;for(n=1;n<=t;n+=1)e+=this.getApplyArg(n).getStrings();return e},c.prototype.getParent=function(){return this._parent},c.prototype.setParent=function(e){e instanceof c||(e=null),this._parent=e},c.prototype.invalidate=function(){return},c.prototype.refer=function(e){return e instanceof c||(e=null),e},c.prototype.adopt=function(e){return e instanceof c&&e.setParent(this),e},c.prototype.disown=function(e){return e instanceof c&&e.getParent()===this&&e.setParent(null),e},c.prototype.getCount=function(){return this._children.length},c.prototype.getChild=function(e){return this._children[e]||null},c.prototype.setChild=function(e,t){var n=this.disown(this.getChild(e));return this._children[e]=this.refer(this.adopt(t)),this.invalidate(),n},c.prototype.referChild=function(e){return this._children.push(this.refer(e)),this.invalidate(),e},c.prototype.getHead=function(){return this._children[0]||null},c.prototype.setHead=function(e){this.setChild(0,e)},c.prototype.getTail=function(){return this.getChild(this.getCount()-1)},c.prototype.addChild=function(e){return this.referChild(this.adopt(e))},c.prototype.insertChildAt=function(e,t){return r.addAt(this._children,e,this.refer(this.adopt(t))),this.invalidate(),t},c.prototype.insertChildBefore=function(e,t){return this.insertChildAt(this.getApplyIndex(e),t)},c.prototype.insertChildAfter=function(e,t){return this.insertChildAt(this.getApplyIndex(e)+1,t)},c.prototype.removeChildAt=function(e){var t=this.disown(this.getChild(e));return r.removeAt(this._children,e),this.invalidate(),t},c.prototype.removeChild=function(e){return this.removeChildAt(this.getApplyIndex(e))},c.prototype.createEmpty=function(){return this.create()},c.prototype.createSymbol=function(e){e instanceof f||(e=null);var t=this.create();return t.setSymbol(e),t},c.prototype.createString=function(e){return a.isString(e)||(e=""),this.createSymbol(f.get(e))},c.prototype.createName=function(e){return this.createSymbol(o.getName(e))},c.prototype.createApply=function(){var e=this.create(),t;for(t=0;t<arguments.length;t+=1)e.addChild(arguments[t]);return e},c.prototype.createApplyOp=function(e){var t=this.createApply(this.createSymbol(e)),n;for(n=1;n<arguments.length;n+=1)t.addChild(arguments[n]);return t},c.prototype.isEmpty=function(){return this.getCount()===0&&this.getSymbol()===null},c.prototype.isSymbol=function(){return this.getCount()===0&&this.getSymbol()!==null},c.prototype.isTheSymbol=function(e){return this.isSymbol()&&this.getSymbol()===e},c.prototype.isApply=function(){return this.getCount()!==0},c.prototype.isApplySymbol=function(){return this.isApplyOp(u._apply)&&this.getApplyArgc()>0},c.prototype.isApplyArgc=function(e){return this.isApply()&&this.getApplyArgc()===e},c.prototype.isApplyOp=function(e){return this.isApply()&&this.getOp()===e},c.prototype.isApplyOpArgc=function(e,t){return this.isApplyOp(e)&&this.isApplyArgc(t)},c.prototype.getApplyArgc=function(){return this.getCount()-1},c.prototype.getApplyArg=function(e){return this.getChild(e)},c.prototype.getApplyOp=function(){return this.getApplyArg(0)},c.prototype.getApplyIndex=function(e){var t=this.getApplyArgc(),n;for(n=0;n<=t;n+=1)if(e===this.getApplyArg(n))return n;return-1},c.prototype.getNumberValue=function(){if(!this.isApplyOpArgc(u._cn,1))return 0;var e=this.getApplyArg(1);return e.isSymbol()?a.toInteger(e.getString()):0},c.prototype.isNumber=function(){return this.isApplyOpArgc(u._cn,1)},c.prototype.isFunction=function(){return this.isApplyOpArgc(u._fn,1)&&!this.getApplyArg(1).isPattern()},c.prototype.isPattern=function(){return this.isApplyArgc(0)&&this.getOp().getURI()===u.NS_INFO},c.prototype.getPatternName=function(){return this.isPattern()?this.getOp().getName():null},c.prototype.getNthPattern=function(e){var t=e?this.getApplyArg(e):this;return t?t.getOp():null},c.prototype.getOper=function(){var e=null,t=this.getHead();while(t)e=t,t=e.getHead();return e},c.prototype.getOp=function(){var e=this.getOper();return e?e.getSymbol():null},c.prototype.setOp=function(e){var t=this.getOper();t&&t.setSymbol(e)},c.prototype.getParentOp=function(){var e=this.getParent();return e?e.getOp():null},c.prototype.getOpURI=function(){var e=this.getParentOp()||this.getOp()||u._math;return e.getURI()},c.prototype.getAttrib=function(e){var t=this.getHead();if(t===null)return null;var n=t.getCount(),r;for(r=1;r+1<n;r+=2)if(t.getChild(r).getSymbol()===e)return t.getChild(r+1).getSymbol();return null},c.prototype.setAttrib=function(e,t){var n=this.getHead();if(n===null)return;e===u._xmlns&&(t?this._attributes.xmlns=t:delete this._attributes.xmlns),n.isApply()||(n=this.createApply(n),this.setHead(n)),n.getHead().invalidate();var r=n.getCount(),i;for(i=1;i+1<r;i+=2)if(n.getChild(i).getSymbol()===e){t?n.getChild(i+1).setSymbol(t):(n.removeChildAt(i),n.removeChildAt(i)),n.getCount()===1&&n.getChild(0).getCount()===1&&(n=n.getChild(0),this.setHead(n));return}t&&(n.addChild(this.createSymbol(e)),n.addChild(this.createSymbol(t)))},c.prototype.getOpAttrib=function(e){var t=this.getHead();return t===null?null:t.getAttrib(e)},c.prototype.setOpAttrib=function(e,t){var n=this.getHead();if(n===null)return;n.isApply()||(n=this.createApply(n),this.setHead(n)),n.setAttrib(e,t)},c.prototype.getAttribute=function(e){var t=this.getHead();if(t===null)return null;var n=t.getCount(),r;for(r=1;r+1<n;r+=2)if(t.getChild(r).getString()===e)return t.getChild(r+1).getString();return t.getAttribute(e)},c.prototype.setAttribute=function(e,t){a.isString(e)||(t=null),a.isString(t)||(t=null);var n=this.getOp()?this.getOp().getURI():"",r=u.get(e,n),i=t===null?null:u.get(t);this.setAttrib(r,i)},c.prototype.setOpAttribute=function(e,t){a.isString(e)||(t=null),a.isString(t)||(t=null);var n=this.getOp()?this.getOp().getURI():"",r=u.get(e,n),i=t===null?null:u.get(t);this.setOpAttrib(r,i)},c.prototype.getClass=function(){return this.getOpAttrib(u._class)},c.prototype.getNamespace=function(){return this.getAttribute(u._xmlns.getName())},c.prototype.getStyleAttribute=function(e){var t=this.getAttribute("style");if(!t)return"";var n="";return r.each(t.split(/\s*;\s*/),function(t){var r=t.split(/\s*:\s*/);r[0]===e&&(n=r[1]||"")}),n},c.prototype.addAttributesAll=function(e,t,r){var i=e instanceof c?e.getHead():null;if(i===null)return this;t instanceof c||(t=null),r instanceof f||(r=null);var s,o,a=i.getCount(),l;for(l=1;l+1<a;l+=2){s=i.getChild(l).getSymbol(),o=i.getChild(l+1).getSymbol(),o===u._null&&(o=null),n.checkAttrib(this.getOp(),s)&&this.setAttrib(s,o);if(this.getAttrib(s)===o)continue;if(!n.checkAttrib(r,s))continue;t||(t=this.createApplyOp(r,this)),t.setAttrib(s,o)}return t||this};var h={ci:1,cn:1,brace:20,bracket:20,paren:20,divide:35,power:35,mxf:70,root:70};return c.prototype.getExpressionCount=function(){var e=0;this.isEmpty()&&(e+=1),this.isSymbol()&&(e+=this.getString().length);if(this.isApply()){var t=this.getOp();if(t===null)return NaN;e+=h[t.getName()]||5}var n=this.getApplyArgc(),r,i;for(i=1;i<=n;i+=1){r=this.getApplyArg(i);if(r===null)return NaN;e+=r.getExpressionCount()}return e},c.prototype.equalAttrib=function(e){var t=e instanceof c?e.getHead():null;if(t===null)return!0;var n,r,i,s=t.getCount(),o;for(o=1;o+1<s;o+=2){n=t.getChild(o).getSymbol();if(n===u._xmlns)continue;r=t.getChild(o+1).getSymbol(),i=this.getAttrib(n);if(i!==r)return!1}return(this.getHead()||this).equalAttrib(t)},c.prototype.matchAttrib=function(e){var t=e instanceof c?e.getHead():null;if(t===null)return!0;var n=!0,r,i,s,o=t.getCount(),a;for(a=1;n&&a+1<o;a+=2){r=t.getChild(a).getSymbol();if(r===u._xmlns)continue;i=t.getChild(a+1).getSymbol(),s=this.getAttrib(r);if(s===i)continue;if(s!==null&&i===u._star)continue;if(s===null&&i===u._null)continue;n=!1}return n&&(this.getHead()||this).matchAttrib(t)},c.prototype.substAttrib=function(e){var t=e instanceof c?e.getHead():null;if(t===null)return this.copy(e);var n=this.createApply(this.substAttrib(t)),r,i,s=t.getCount(),o;for(o=1;o+1<s;o+=2){r=t.getChild(o).getSymbol();if(r===u._xmlns)continue;i=t.getChild(o+1).getSymbol(),i===u._null&&(i=null),n.setAttrib(r,i)}return n},c.prototype.contains=function(e){var t=this;if(t===e)return!1;while(e){if(t===e)return!0;e=e.getParent()}return!1},c.equal=function(e,t){return e instanceof c||(e=null),t instanceof c||(t=null),e!==null&&t!==null&&e.equal(t)},c.prototype.equal=function(e){var t=this;if(e===null)return!1;if(t.getSymbol()!==e.getSymbol())return!1;if(t.getCount()!==e.getCount())return!1;if(t.getOp()!==e.getOp())return!1;if(!t.equalAttrib(e)||!e.equalAttrib(t))return!1;var n=t.getCount(),r;for(r=1;r<n;r+=1)if(!t.getChild(r).equal(e.getChild(r)))return!1;return!0},c.prototype.match=function(e,t){var n=this;if(t instanceof c){if(t.isPattern()){var r=t.getPatternName(),i=e[r];return i?n.equal(i):(e[r]=n,!0)}if(n.getSymbol()!==t.getSymbol())return!1;if(n.getCount()!==t.getCount())return!1;if(n.getOp()!==t.getOp())return!1;if(!n.matchAttrib(t))return!1;var s=n.getCount(),o;for(o=1;o<s;o+=1)if(!n.getChild(o).match(e,t.getChild(o)))return!1;return!0}return!1},c.prototype.subst=function(e,t){if(t===null)return null;if(t.isPattern()){var n=t.getPatternName(),r=this.copy(e[n]||t);return e[n]=r,r}if(t.isEmpty())return this.copy(t);if(t.isSymbol())return this.copy(t);var i=t.getCount(),s=this.substAttrib(t),o;for(o=1;o<i;o+=1)s.addChild(this.subst(e,t.getChild(o)));return s},c.parse=function(e){return c.create().parse(e)},c.prototype.parse=function(e){return this.parseBuffer(i.create(e))},c.prototype.parseBuffer=function(e){if(e.scanDone()||e.scanChar(s.rparen))return null;var t=e.offset;if(e.scanString())return this.createString(e.getString(t+1,e.offset-1));if(e.scanToken())return this.createString(e.getString(t));if(!e.scanChar(s.lparen))return null;var n=this.create(),r=this._attributes.xmlns,i=null;for(;;){i=this.parseBuffer(e);if(i===null)break;n.addChild(i),n.getCount()===1&&this.parseHead(n)}return this._attributes.xmlns=r,n},c.prototype.parseHead=function(e){var t=this._attributes.xmlns||u.get(""),n=e.getAttrib(u.__xmlns);n&&n!==t&&(this._attributes.xmlns=t=n);var r,i,s,o,a=e.getHead(),l=a.getCount(),c;for(c=1;c+1<l;c+=2)r=a.getChild(c),i=a.getChild(c+1),s=r.getSymbol(),o=s.getName(),o.match(/xmlns/)&&(e._attributes[o]=i.getSymbol()),s===u.__xmlns?r.setSymbol(u._xmlns):r.setSymbol(f.get(o,t.getName()));n=e.getOpAttrib(u._xmlns),n&&n!==t&&(t=n);var h=e.getOp();h&&h.getURI()!==t.getName()&&e.setOp(f.get(h.getName(),t.getName()))},c.print=function(e,t){return e instanceof c?e.print(t):"null"},c.prototype.print=function(e){a.isInteger(e)||(e=0);if(this.isEmpty())return"()";if(this.isSymbol())return this.getSymbol().print();var t="(",n=this.getCount(),r,i;for(r=0;r<n;r+=1)i=this.getChild(r),r>0&&(i.isSymbol()||i.isPattern()?t+=" ":(t+="\n",t+="                    ".substr(0,e+2))),t+=i.print(e+2);return t+=")",t},c.expand=function(e){return l.isNode(e)?c.create().expand(e):null},c.prototype.expand=function(e){if(!l.isNode(e))return null;if(l.isText(e)||l.isCDATA(e))return this.createString(l.getText(e));var t=this.expandElement(e);return t.expandAttributes(e),t.expandNamespaces(e),t},c.prototype.expandArguments=function(e,t){a.isInteger(t)||(t=0);var n=l.contents(e),r=n?n.length:0,i;for(i=t;i<r;i+=1)this.addChild(this.expand(n[i]))},c.prototype.expandAttributes=function(e){var t=this;r.each(e.attributes,function(n){var r=o.getAttName(e,n),i=o.getText(n);t.setAttrib(r,i)})},c.prototype.expandOpAttributes=function(e){if(this.isFunction()){this.getApplyArg(1).expandOpAttributes(e);return}this.expandAttributes(e);var t=o.getElt(e);if(t===e)return;var i=this;r.each(t.attributes,function(e){var r=o.getAttName(t,e),s=o.getText(e);n.isContentAtt(r)?i.setAttrib(r,s):i.setOpAttrib(r,s)})},c.prototype.expandNamespaces=function(e){var t=this;r.each(e.attributes,function(n){if(l.namespaceURI(n,e)===u.NS_XMLNS){var r=o.getAttName(e,n),i=o.getText(n);t._attributes[r.getName()]=i}})},c.prototype.expandElement=function(e){var t=this.createApply(this.createName(e));return t.expandArguments(e),t},c.prototype.expandOperator=function(e){var t=this.createApplyOp(o.getKey(e));return t.expandArguments(e,1),t},c.prototype.expandUnknown=function(e){var t=this.createApplyOp(o.getKey(e));return t.expandArguments(e,1),t},c.prototype.expandSymbol=function(e){var t=this.createApplyOp(o.getKey(e));return t.expandArguments(e,1),t},c.prototype.expandFunction=function(e){var t=this.createApplyOp(u._fn);return t.addChild(this.createApplyOp(o.getKey(e))),t},c.prototype.expandToken=function(e){e=this.copy(e);var t=e.getCount(),n,r,i,o,u,a;for(n=1;n<t;n+=1){a=e.removeChildAt(1);if(a.isSymbol()){o=a.getString(),u=o.length;for(r=0;r<u;r){i=r;if(o.charCodeAt(r)===s.amp){while(r<u&&o.charCodeAt(r)!==s.semi)r+=1;r===u&&(r=i)}r+=1,e.addChild(this.createString(o.substring(i,r)))}}else e.addChild(a)}return e},c.markup=function(e){return e?e.markup():null},c.prototype.markup=function(){if(this.isEmpty())return null;if(this.isSymbol())return o.createText(this.getSymbol());var e=o.createElement(this.getOp());return this.markupNamespaces(e),this.markupAttributes(e),this.markupArguments(e),e},c.prototype.markupArguments=function(e){var t=0,n=null,r=this.getCount(),i,s;for(i=1;i<r;i+=1)s=this.getChild(i).markup(),l.getText(s)===" "?(i===1?s=l.createText("&#xA0;"):t===2&&i!==3?e.insertBefore(n,n.previousSibling):t>0&&e.replaceChild(l.createText("&#xA0;"),n),t+=1,n=s):(t=0,n=null),s&&e.appendChild(s)},c.prototype.markupAttributes=function(e){var t=this.getHead(),n=l.namespaceURI(e),r=t.getCount(),i,s,o,a,f,c;for(i=1;i+1<r;i+=2){s=t.getChild(i).getSymbol(),o=t.getChild(i+1).getSymbol();if(s===u._xmlns)continue;a=s.getURI(),f=s.getName(),c=o.getName();if(a===u.NS_XMLNS)continue;a===n&&(a=null),l.setAttrNS(e,a,f,c)}},c.prototype.markupOpAttributes=function(e){var t=o.getElt(e),r=this.getHead(),i=l.namespaceURI(e),s=l.namespaceURI(e),a=r.getCount(),f,c,h,p,d,v;for(f=1;f+1<a;f+=2){h=r.getChild(f).getSymbol(),p=r.getChild(f+1).getSymbol();if(h===u._xmlns)continue;s=h.getURI(),d=h.getName(),v=p.getName();if(s===u.NS_XMLNS)continue;s===i&&(s=null),c=e,n.isContentAtt(h)&&(c=t),l.setAttrNS(c,s,d,v)}t!==e&&r.getHead()&&r.markupAttributes(t)},c.prototype.markupNamespaces=function(e){var t,n;for(t in this._attributes)this._attributes.hasOwnProperty(t)&&(n=this._attributes[t].getName(),t==="xmlns"&&n!==u.NS_USER&&l.setAttrNS(e,u.NS_XMLNS,t,n));var r=this.getParentOp(),i=l.namespaceURI(e);r&&r.getURI()!==i&&l.setAttrNS(e,u.NS_XMLNS,"xmlns",i)},c.prototype.markupElement=function(e){var t=o.createElement(e.getOp());return e.markupArguments(t),t},c.prototype.markupOperator=function(e){var t=o.createElement(u._apply),n=o.createElement(e.getOp());return t.appendChild(n),e.markupArguments(t),t},c.prototype.markupUnknown=function(e){var t=o.createElement(u._apply),n=o.createElement(u._ci);return n.appendChild(o.createText(e.getOp())),t.appendChild(n),e.markupArguments(t),t},c.prototype.markupSymbol=function(e){var t=o.createElement(u._apply),n=o.createElement(u._csymbol);return l.setAttr(n,"cd",e.getOp().getURI().substring(8)),n.appendChild(o.createText(e.getOp())),t.appendChild(n),e.markupArguments(t),t},c.prototype.markupFunction=function(e){var t=o.createElement(e.getChild(1).getOp());return t},c.prototype.markupToken=function(e){e=this.copy(e);var t="",n=e.getCount(),r,i;for(r=1;r<n;r+=1)i=e.removeChildAt(1),i.isSymbol()?t+=i.getString():(t&&e.addChild(this.createString(t)),t="",e.addChild(i));return t&&e.addChild(this.createString(t)),e},c.prototype.jasmineToString=c.prototype.toString,c.prototype.jasmineMatches=c.prototype.equal,c.prototype.getAdditiveOp=function(){return t.getAdditiveOp(this.getOp())},c.prototype.isAdditiveOp=function(){return t.isAdditiveOp(this.getOp())},c.prototype.isAdditiveInverse=function(){return t.isAdditiveInverse(this.getOp())},c.prototype.isNary=function(){return t.isNary(this.getOp())},c.prototype.isBinary=function(){return t.isBinary(this.getOp())},c.prototype.isNullary=function(){return t.isNullary(this.getOp())},c.prototype.getNaryMax=function(){return t.getNaryMax(this.getOp())},c.prototype.isArray=function(){return t.isArray(this.getOp())},c.prototype.isAssoc=function(){return t.isAssoc(this.getOp())},c.prototype.isCondition=function(){return t.isCondition(this.getOp())},c.prototype.isElement=function(){return t.isElement(this.getOp())},c.prototype.isOperator=function(){return t.isOperator(this.getOp())},c.prototype.isOrder=function(){return t.isOrder(this.getOp())},c.prototype.getOrders=function(e){return t.getOrders(this.getOp(),e)},c.prototype.isPlace=function(){var e=this.getOp();return e===u._gap?!this.getConfig().getStyles()["ee-fill-in-create"]:t.isPlace(e)},c.prototype.getLeftBinding=function(){return t.getLeftBinding(this.getOp(),this.getClass())},c.prototype.getRightBinding=function(){return t.getRightBinding(this.getOp(),this.getClass())},c.prototype.getOuterLeftBinding=function(){return t.getOuterLeftBinding(this.getOp(),this.getClass())},c.prototype.getOuterRightBinding=function(){return t.getOuterRightBinding(this.getOp(),this.getClass())},c.prototype.isRelation=function(){return t.isRelation(this.getOp())},c.prototype.isTable=function(){return t.isTable(this.getOp())},c.prototype.isToken=function(){return t.isToken(this.getOp())},c.prototype.isNumberToken=function(){return t.isNumberToken(this.getOp())},c.prototype.isSymbolToken=function(){return t.isSymbolToken(this.getOp())},c.prototype.isBinding=function(){return t.isBinding(this.getOp())},c.prototype.getBindingVar=function(){return t.getBindingVar(this.getOp())},c.prototype.getBindingList=function(){return t.getBindingList(this.getOp())},c.prototype.isBrailleOutput=function(){return this.getConfig()._type==="braille"},c}),n("editor/expr/Content",["editor/util/Utils","editor/config/Config","editor/expr/Expr"],function(e,t,n){var r=e.Array,i=e.Markup,s=e.Name,o=e.XML,u=null,a=null,f=function(t){return this.init(t),this._suspend=!1,this._listeners=[],this._present={},this.setPresent(null),this};return f.prototype=new n,f.prototype.constructor=f,f.create=function(e){return new f(e)},f.transform=function(e,t){e=o.valueOf(e),e=this.expand(e,t);var n=e.getOp();n!==s._math&&n!==s._html&&e.setAttrib(s._xmlns,s.get(s.NS_MATH));var r=a.layout(e);return r.toXMLString()},f.prototype.create=function(e){return e instanceof t||(e=this.getConfig()),f.create(e)},f.copy=function(e){return e instanceof n?f.create().copy(e):null},f.valueOf=function(e){return f.expand(o.valueOf(e))},f.prototype.suspend=function(){this._suspend=!0},f.prototype.resume=function(){this._suspend=!1},f.prototype.invalidate=function(){if(this._suspend)return;this.setPresent(null);var e=this.getParent();e&&e.invalidate()},f.prototype.layout=function(){a=a||e.require("editor/expr/Layout"),this.setPresent(null),this.setPresent(a.layout(this)),this.dispatchChangeEvent()},f.prototype.addChangeListener=function(e){e instanceof Function&&r.add(this._listeners,e)},f.prototype.removeChangeListener=function(e){e instanceof Function&&r.remove(this._listeners,e)},f.prototype.dispatchChangeEvent=function(){r.each(this._listeners,function(e){e()})},f.prototype.getPresentRef=function(){return this._present},f.prototype.getPresent=function(){return this._present.value},f.prototype.setPresent=function(t){u=u||e.require("editor/expr/Present"),t instanceof u||(t=null);var n=this.getPresent();n&&(this._present.parent=n.getParent(),n.setContent(null)),this._present.value=t,t&&(t.setContent(this),t.setParent(this._present.parent))},f.prototype.isTheElement=function(e){var t=this.getOp();return t!==null&&t.getName()===e},f.prototype.isDone=function(){return this.getParent()===null},f.prototype.isText=function(){return this.isSymbol()},f.prototype.isTokenMode=function(){if(this.isOp())return!1;if(this.isText())return!0;var e=this.getParent();return e!==null&&e.isToken()},f.prototype.isOp=function(){var e=this.getParent();return e!==null&&e.getApplyOp()===this},f.prototype.isOpParent=function(){var e=this.getParent();return e!==null&&e.getOper()===this.getOper()},f.prototype.getOpParent=function(){var e=this.getParent();while(e&&e.isOpParent())e=e.getParent();return e},f.prototype.isTextMode=function(){var e=this.getParentOp();return e!==null&&e.getURI()===s.NS_HTML},f.prototype.isMathMode=function(){var e=this.getParentOp();return e!==null&&e.getURI()!==s.NS_HTML},f.prototype.isStop=function(e){return this.getAttribute("class")===e},f.prototype.isGroup=function(){var e=this.getOp();return e===s._paren||e===s._bracket||e===s._brace||e===s._bparen||e===s._bbracket||e===s._bbrace||e===s._abracket||e===s._abs||e===s._norm},f.prototype.isStruct=function(e){var t=this.getOp();return t===s._divide&&!this.getClass()?!0:t===s._math?e!==!1:t===s._mxf||t===s._power||t===s._root||t===s._ln||t===s._log||this.isGroup()},f.prototype.addAttributes=function(e){if(e instanceof n){var t=this.getHead();return t===null?this:(t.isApply()||(t=t.createApply(t),this.setHead(t)),t.addAttributesAll(e.getHead(),null,null),this.addAttributesAll(e,null,null))}return this},f.prototype.findAttrib=function(e,t){var n=this.getHead();if(n&&n.getAttribute(e)===t)return n.getOper();if(this.getAttribute(e)===t)return this;var r=null,i=this.getApplyArgc(),s;for(s=1;s<=i&&r===null;s+=1)r=this.getApplyArg(s).findAttrib(e,t);return r},f.prototype.findId=function(e){return this.findAttrib("id",e)},f.prototype.findPlace=function(){if(this.isPlace())return this;var e=null,t=this.getApplyArgc(),n;for(n=1;n<=t&&e===null;n+=1)e=this.getApplyArg(n).findPlace();return e},n.prototype.findOp=function(e){if(this.isApplyOp(e))return this;var t=null,n=this.getApplyArgc(),r;for(r=1;r<=n&&t===null;r+=1)t=this.getApplyArg(r).findOp(e);return t},f.prototype.createPlace=function(){var e=this.getOpURI(),t;return e===s.NS_HTML?t=this.createApplyOp(s._input):(t=this.createApplyOp(s._box),t.setAttrib(s._cd,s._basic)),t},f.prototype.createRow=function(e){return this.createApplyOp(e.getOp())},f.prototype.createElt=function(e){var t=this.createPlace();return this.isTable()&&(t=this.createApplyOp(e.getOp(),t)),t},f.prototype.getRowCount=function(){return this.getApplyArgc()},f.prototype.getRow=function(e){return this.getApplyArg(e)},f.prototype.getColCount=function(e){var t=this.getRow(e);return t?t.getApplyArgc():0},f.prototype.getRowElt=function(e,t){return e.getApplyArg(t)},f.prototype.getElt=function(e,t){var n=this.getRowCount();if(n===0)return null;1<=e||(e=1),e<=n||(e=n);var r=this.getColCount(e);if(r===0)return null;1<=t||(t=1),t<=r||(t=r);var i=this.getRow(e).getApplyArg(t);return this.isTable()&&(i=i.getApplyArg(1)),i},f.prototype.getRowIndex=function(e){var t=this.getRowCount(),n,r,i;for(r=1;r<=t;r+=1){n=this.getColCount(r);for(i=1;i<=n;i+=1)if(this.getElt(r,i)===e)return r}return 0},f.prototype.getColIndex=function(e){var t=this.getRowCount(),n,r,i;for(r=1;r<=t;r+=1){n=this.getColCount(r);for(i=1;i<=n;i+=1)if(this.getElt(r,i)===e)return i}return 0},f.prototype.insertRowBefore=function(e){var t=this.getRow(e),n=this.createRow(t),r=this.getColCount(e),i;for(i=1;i<=r;i+=1)n.addChild(this.createElt(t.getApplyArg(1)));this.insertChildBefore(t,n)},f.prototype.insertRowAfter=function(e){var t=this.getRow(e),n=this.createRow(t),r=this.getColCount(e),i;for(i=1;i<=r;i+=1)n.addChild(this.createElt(t.getApplyArg(1)));this.insertChildAfter(t,n)},f.prototype.insertColBefore=function(e){var t=this.getRowCount(),n;for(n=1;n<=t;n+=1)e<=this.getColCount(n)&&this.insertEltBefore(n,e)},f.prototype.insertColAfter=function(e){var t=this.getRowCount(),n;for(n=1;n<=t;n+=1)e<=this.getColCount(n)&&this.insertEltAfter(n,e)},f.prototype.insertRowWrap=function(e){return this.insertRowAfter(e),1},f.prototype.insertColWrap=function(e){var t=0,n=this.getRowCount(),r;for(r=n;r>=1;r-=1)e===this.getColCount(r)&&(t=r,this.insertEltAfter(t,e));return t},f.prototype.insertEltBefore=function(e,t){var n=this.getRow(e),r=this.getRowElt(n,t);n.insertChildBefore(r,this.createElt(r))},f.prototype.insertEltAfter=function(e,t){var n=this.getRow(e),r=this.getRowElt(n,t);n.insertChildAfter(r,this.createElt(r))},f.prototype.removeRow=function(e){var t=this.getRow(e);this.removeChildAt(this.getApplyIndex(t))},f.prototype.removeCol=function(e){var t=this.getRowCount(),n;for(n=1;n<=t;n+=1)e<=this.getColCount(n)&&this.removeElt(n,e)},f.prototype.removeElt=function(e,t){var n=this.getRow(e),r=this.getRowElt(n,t);n.removeChildAt(n.getApplyIndex(r))},f.prototype.replaceResult=function(e){var t=this;if(t===e)return t.createApplyOp(s._box);if(t.isEmpty())return this.copy(t);if(t.isSymbol())return this.copy(t);var n=t.getCount(),r=t.substAttrib(t),i;for(i=1;i<n;i+=1)r.addChild(t.getChild(i).replaceResult(e));return r},f.prototype.closeOuter=function(e){var t=this,n=t.getParent();while(n&&!n.contains(e))t=n,n=t.getParent();return t},f.prototype.closeSoft=function(e){var t=this;if(!e.contains(t))return;e.suspend();var n,r=0;while(t){n=t.getOpAttrib(s._class),n&&n.getName()==="soft"&&(t.setOpAttrib(s._class,null),r+=1);if(t===e)break;t=t.getParent()}return e.resume(),r&&e.layout(),r},f.equal=n.equal,f.parse=function(e){return f.create().parse(e)},f.print=n.print,f.expand=function(e,t){return o.isNode(e)?f.create(t).expand(e):null},f.prototype.expand=function(e){if(!o.isNode(e))return null;if(o.isText(e)||o.isCDATA(e))return this.createString(o.getText(e));var t=i.getKey(e),n=null;return i.isUnknown(e)?n=this.expandUnknown(e):i.isSymbol(e)?n=this.expandSymbol(e):i.isOperator(e)?n=this.expandOperator(e):this.getConfig().isOperator(t)?n=this.expandFunction(e):n=this.expandElement(e),this.getConfig().isToken(t)&&(n=this.expandToken(n,t)),this.getConfig().isBinding(t)&&(n=this.expandBinding(n,t)),this.getConfig().hasForms(t)&&(n=this.expandPattern(n,t)),n.expandOpAttributes(e),n.expandNamespaces(e),n},f.prototype.expandBinding=function(e,t){var n=this.getConfig().getBindingVar(t),r=this.getConfig().getBindingList(t),i=this.createApplyOp(r);e=this.copy(e),e.insertChildAt(1,i);var o,u,a;while(e.getCount()>3){u=e.getChild(2),o=u.getCount();if(!(u.isApplyOp(s._bvar)&&o>=2))break;a=this.createApplyOp(n),o>=2&&a.addChild(u.getChild(1)),o>=3&&a.addChild(u.getChild(2)),i.addChild(a),e.removeChildAt(2)}return i.getCount()===1&&e.removeChild(i),e},f.prototype.expandPattern=function(e,t){var n=this.getConfig().getForms(t),i=e;return r.each(n,function(n){var r=n.getChild(2),s=n.getChild(1),o={};if(r.isApplyOp(t)&&e.match(o,r))return i=e.subst(o,s),!1}),i},f.markup=n.markup,f.prototype.markup=function(){if(this.isEmpty())return null;if(this.isSymbol())return i.createText(this.getSymbol());var e=this.getOp(),n=this;this.getConfig().hasForms(e)&&(n=this.markupPattern(n,e)),this.isBinding()&&this.getApplyArgc()>0&&(n=this.markupBinding(n,e)),this.isToken()&&(n=this.markupToken(n,e));var r=null;return e===s._fn?r=this.markupFunction(n):t.isUnknown(e)?r=this.markupUnknown(n):t.isSymbol(e)?r=this.markupSymbol(n):this.isElement()?r=this.markupElement(n):r=this.markupOperator(n),n.markupOpAttributes(r),n.markupNamespaces(r),r},f.prototype.markupBinding=function(e){e=this.copy(e);var t=e.removeChildAt(1),n,r,i=t.getCount(),o,u;for(o=1;o<i;o+=1){n=t.getChild(o),r=this.createApplyOp(s._bvar);for(u=1;u<n.getCount()&&u<3;u+=1)r.addChild(n.getChild(u));e.insertChildAt(o,r)}return e},f.prototype.markupPattern=function(e,t){var n=this.getConfig().getForms(t),i=e;return r.each(n,function(n){var r=n.getChild(1),s=n.getChild(2),o={};if(r.isApplyOp(t)&&e.match(o,r))return i=e.subst(o,s),!1}),i},f}),n("editor/panel/Panel",["editor/util/Utils"],function(e){var t=function(){return this};return t.PARENT="ee-parent-panel",t.QUICK="ee-quick-bar",t.SIDE="ee-side-bar",t.MORE="ee-more-menu",t.CHILD="ee-child-panel",t.INPUT="ee-input-panel",t.PROXY="ee-input-proxy",t.SCRATCH="ee-scratch-panel",t.SPEECH="ee-speech-panel",t.BRAILLE="ee-braille-panel",t.BAR="ee-button-bar-panel",t.CAROUSEL="ee-carousel",t.open=function(e){e.attr("aria-expanded")!=="true"&&e.click(),e.focus()},t.tooltipOptions=function(){var t={trigger:e.isIOS?"focus":"hover focus",template:'<div class="tooltip" aria-hidden="true" aria-label="&nbsp;"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'};return t},t.isVisible=function(e){return e.is(".collapse.in button")},t}),n("editor/expr/Display",["editor/util/Utils"],function(e){var t=e.$,n=e.Array,r=e.Entity,i=e.XML,s=null,o,u=function(t){return this.setRefer(null),this.setParent(null),this._listeners=[],this._children=[],this.setXML(t),this};return u.create=function(e){return new u(e)},u.prototype.getRefer=function(){return this._refer},u.prototype.setRefer=function(t){s=s||e.require("editor/expr/Refer"),t instanceof s||(t=null),this._refer=t},u.prototype.getParent=function(){return this._parent},u.prototype.setParent=function(e){e instanceof u||(e=null),this._parent=e},u.prototype.getXML=function(){return this._xml},u.prototype.setXML=function(e){i.isNode(e)||(e=null),i.isElement(this._xml)&&o(this._xml,null),this._xml&&this._xml.parentNode&&e&&this._xml.parentNode.replaceChild(e,this._xml),this._xml=e,i.isElement(this._xml)&&o(this._xml,this),this.process(e)},o=function(e,t){try{e.display=t}catch(n){return}},u.prototype.process=function(e){var s=i.contents(e),o=s?s.length:0;i.localName(e)==="script"&&(o=0);var a,f,l,c=function(t){var n=i.createText(t);e.insertBefore(n,a)};for(f=0;f<o;f+=1){a=s[f];if(!i.isText(a))continue;l=t(a).text();if(l.length<2)continue;if(r.isEntity(l)){c(l),t(a).remove();continue}n.each(l.split(""),c),t(a).remove()}s=i.contents(e),o=s?s.length:0,this._children=[];for(f=0;f<o;f+=1)this.addDisplayChild(u.create(s[f]))},u.prototype.update=function(){var e=this;while(e.getParent())e=e.getParent();if(n.isEmpty(e._listeners)){var t=this.getRefer().getPresent();this.setXML(t.markup()),t.collectDisplay(this)}else e.dispatchChangeEvent()},u.prototype.getDisplayCount=function(){return this._children.length},u.prototype.getDisplayChild=function(e){return this._children[e]||null},u.prototype.addDisplayChild=function(e){e instanceof u&&(e.setParent(this),this._children.push(e))},u.prototype.addChangeListener=function(e){e instanceof Function&&n.add(this._listeners,e)},u.prototype.removeChangeListener=function(e){e instanceof Function&&n.remove(this._listeners,e)},u.prototype.dispatchChangeEvent=function(){n.each(this._listeners,function(e){e()})},u.prototype.getSpanName=function(){var e=this.getXML(),t=i.localName(e)||"#text";if(t==="span"||t==="SPAN"){var r=e.className||i.getAttr(e,"class")||"";n.each(r.split(" "),function(e){e.substring(0,4)==="mjx-"&&(t=e.substring(4))})}return t},u.prototype.getFirstChild=function(){var e=this.getDisplayCount(),t,n;for(t=0;t<e;t+=1){n=this.getDisplayChild(t);if(n.getDisplayCount()>0&&n.getSpanName()!=="surd")return n}return null},u.prototype.getImpliedRow=function(){var e=this;while(e&&e.getSpanName()!=="mrow")e=e.getFirstChild();return e},u.prototype.getBox=function(){var e=this._box;if(e)return e;var t=this.getXML();if(i.isElement(t)){var n=t;while(n&&!i.isTheElement(n,"p"))n=n.parentNode;return e=i.getOffsets(t,n),this._box=e,e}var r=t.parentNode;if(r===null)return e=i.getOffsets(t),this._box=e,e;var s=r;while(s&&!i.isTheElement(s,"p")&&s.className.indexOf("mjx")===-1)s=s.parentNode;if(s===null)return e=i.getOffsets(t),this._box=e,e;var o=i.createTextSpan(t.cloneNode());return r.insertBefore(o,t),r.removeChild(t),e=i.getOffsets(o,s),r.insertBefore(t,o),r.removeChild(o),this._box=e,e},u}),n("editor/expr/Refer",["editor/util/Utils","editor/expr/Display"],function(e,t){var n=null,r=function(t){return this.setUpdate(this.update),this.setDisplay(null),this.setContent(t),this};return r.create=function(e){return new r(e)},r.prototype.destroy=function(){this.setDisplay(null),this.setContent(null)},r.prototype.update=function(){var e=this.getDisplay(),t=this.getPresent(),n=this.getContent();if(e&&t){e.update();return}while(n&&n.getParent()){n=n.getParent();if(n._listeners.length>0){n.dispatchChangeEvent();return}}},r.prototype.getUpdate=function(){return this._update},r.prototype.setUpdate=function(e){var t=this;this._update=function(){e.call(t)}},r.prototype.getDisplay=function(){return this._display},r.prototype.setDisplay=function(e){e instanceof t||(e=null),this._display&&this._display.setRefer(null),this._display=e,this._display&&this._display.setRefer(this)},r.prototype.getContent=function(){return this._content},r.prototype.setContent=function(t){n=n||e.require("editor/expr/Content"),t instanceof n||(t=null);var r=this.getContent();r&&r.removeChangeListener(this.getUpdate()),this._content=t,t&&t.addChangeListener(this.getUpdate())},r.prototype.getPresent=function(){var e=this.getContent();return e?e.getPresent():null},r.prototype.getReferenceCount=function(){var e=this.getPresent();return e?e.getReferenceCount():0},r.prototype.getReference=function(e){var t=this.getPresent();return t?t.getReference(e):null},r.prototype.isChildReference=function(e){var t=this.getReferenceCount(),n;for(n=0;n<t;n+=1)if(this.getReference(n)===e)return!0;return!1},r.prototype.isTextMode=function(){var e=this.getContent();return e&&e.isTextMode()},r}),n("editor/expr/Present",["editor/util/Utils","editor/config/Config","editor/expr/Refer","editor/expr/Expr"],function(e,t,n,r){var i=e.$,s=e.Array,o=e.Markup,u=e.Name,a=e.XML,f=null,l=function(t){return this.init(t),this._oreferences=null,this._references=[],this._content={},this.setContent(null),this};l.prototype=new r,l.prototype.constructor=l,l.create=function(e){return new l(e)},l.prototype.create=function(e){return e instanceof t||(e=this.getConfig()),l.create(e)},l.copy=function(e){return e instanceof r?l.create().copy(e):null},l.valueOf=function(e){return l.expand(a.valueOf(e))},l.prototype.refer=function(e){e instanceof r||(e=null);var t={};return t.value=e,t};var c={value:null};return l.prototype.getChildRef=function(e){return this._children[e]||c},l.prototype.setChildRef=function(e,t){this._children[e]=t},l.prototype.addChildRef=function(e){this.adopt(e.value),this._children.push(e)},l.prototype.addChildRefs=function(e){var t=this;s.each(e,function(e){t.addChildRef(e)})},l.prototype.getChild=function(e){return this.getChildRef(e).value},l.prototype.getHead=function(){return(this._children[0]||c).value},l.prototype.getOper=function(){var e=null,t=this._children[0];while(t)e=t.value,t=e._children[0];return e},l.prototype.getContent=function(){return this._content.value},l.prototype.setContent=function(t){f=f||e.require("editor/expr/Content"),t instanceof f||(t=null),this._content.value=t,this.removeReferences(),t&&this.collectReferences()},l.prototype._references=null,l.prototype.getReferenceCount=function(){return this._references.length},l.prototype.getReference=function(e){return this._references[e]||null},l.prototype.addReference=function(e){e instanceof n&&s.add(this._references,e)},l.prototype.removeReference=function(){return this._references.shift()},l.prototype.removeReferences=function(){s.each(this._references,function(e){e.destroy()}),this._oreferences=null,this._references=[]},l.prototype.collectReferences=function(e){e instanceof l||(e=this);var t=e.getContent();if(t&&this.visitThisReference(e))this.addReference(n.create(t));else{var r=e.getCount(),i;for(i=0;i<r;i+=1)this.collectReferences(e.getApplyArg(i))}this._oreferences=this._references,e===this&&t.isOrder()&&!t.isBrailleOutput()&&this.permuteReferences()},l.prototype.visitThisReference=function(e){if(e===this)return!1;var t=e.getOp(),n=t?t.getName():null;return n==="maligngroup"||n==="mtd"||n==="mtr"?!1:(t=this.getOp(),n=t?t.getName():null,n==="maction"||n==="mphantom"||n==="mspace"?!1:!0)},l.prototype.permuteReferences=function(){var e=this.getReferenceCount(),t=this.getContent(),n=t.getOrders(e);if(n===null)return;var r=[],i,s;for(i=0;i<e;i+=1)s=n[i],s!==-1&&r.push(this._references[n[i]]);this._references=r},l.prototype.collectDisplay=function(e,t){t instanceof l||(t=this);var n=t.getOp();while(n&&e&&n.getName()!==e.getSpanName()){if(n.getName()==="mrow"&&e.getSpanName()==="stack")break;e=e.getFirstChild()}if(e===null)return;var r=e.getRefer();r&&t!==this&&e.setRefer(null);var s=t.getContent(),o,u,a,f,c,h,p,d;if(s&&this.visitThisReference(t)){var v=this._oreferences.shift();v.setDisplay(e),this._oreferences.push(v),t.collectDisplay(e)}else{var m=e.getSpanName();if(m==="menclose"){o=e.getDisplayCount();for(u=1;u<o;u+=1)f=e.getDisplayChild(u),i(f.getXML()).css("pointer-events","none")}if(m==="math"||m==="msqrt"||m==="mstyle"||m==="merror"||m==="mpadded"||m==="mtd"||m==="mphantom"||m==="menclose")e=e.getImpliedRow()||e;if(m==="mfrac"||m==="munder"||m==="mover"||m==="mtable"||m==="mi"||m==="mn")e=e.getFirstChild()||e;if(m==="mroot"||m==="mover"){f=e.getDisplayChild(1),f=f.getFirstChild()||f,c=t.getApplyArg(1),this.collectDisplay(f,c),f=e.getDisplayChild(0),f=f.getFirstChild()||f,c=t.getApplyArg(2),this.collectDisplay(f,c);return}if(m==="msubsup"){f=e.getDisplayChild(0),f=f.getFirstChild()||f,c=t.getApplyArg(1),this.collectDisplay(f,c),e=e.getDisplayChild(1),f=e.getDisplayChild(1),f=f.getFirstChild()||f,c=t.getApplyArg(2),this.collectDisplay(f,c),f=e.getDisplayChild(0),f=f.getFirstChild()||f,c=t.getApplyArg(3),this.collectDisplay(f,c);return}if(m==="munderover"){e=e.getFirstChild()||e,f=e.getDisplayChild(0),f=f.getFirstChild()||f,f=f.getFirstChild()||f,f=f.getDisplayChild(1),c=t.getApplyArg(1),this.collectDisplay(f,c),f=e.getDisplayChild(1),f=f.getFirstChild()||f,c=t.getApplyArg(2),this.collectDisplay(f,c),f=e.getDisplayChild(0),f=f.getFirstChild()||f,f=f.getFirstChild()||f,f=f.getDisplayChild(0),c=t.getApplyArg(3),this.collectDisplay(f,c);return}u=1;if(m==="stack"){o=e.getDisplayCount();for(a=0;a<o;a+=1){f=e.getDisplayChild(a);while(f&&f.getSpanName()!=="mrow")f=f.getFirstChild();if(f===null)continue;p=f.getDisplayCount();for(h=0;h<p;h+=1)d=f.getDisplayChild(h),c=t.getApplyArg(u),this.collectDisplay(d,c),u+=1}return}o=e.getDisplayCount();for(a=0;a<o;a+=1){f=e.getDisplayChild(a);while(f&&f.getSpanName()===null)f=f.getFirstChild();if(f===null)continue;if(m==="mfenced"&&f.getSpanName()==="mo")continue;c=t.getApplyArg(u),this.collectDisplay(f,c),u+=1}}if(t===this){o=this._oreferences.length;for(u=0;u<o;u+=1){if(this._oreferences[0].getDisplay())break;this._oreferences.push(this._oreferences.shift())}}},l.prototype.addAttributes=function(e){return this.addAttributesAll(e,null,null)},l.prototype.addAttributesParent=function(e){var t=e instanceof l?e.getOp():null;return this.addAttributesAll(this.getContent(),e,t)},l.prototype.addAttributesCreate=function(e,t){return this.addAttributesAll(e,null,t)},l.prototype.hasParenOuter=function(){var e=this.getParent();return e===null?!1:e.getOp()===u._mfenced&&e.getHead().isSymbol()},l.prototype.getParenOuter=function(){return this.getParent()},l.prototype.replaceBox=function(){var e=this;if(e.getAttribute("class")==="ee-box")return e.createApplyOp(u._mtext,e.createString("box"));if(e.isEmpty())return this.copy(e);if(e.isSymbol())return this.copy(e);var t=e.getCount(),n=this.substAttrib(e),r;for(r=1;r<t;r+=1)n.addChild(e.getChild(r).replaceBox());return n},l.equal=r.equal,l.parse=function(e){return l.create().parse(e)},l.print=r.print,l.expand=function(e,t){return a.isNode(e)?l.create(t).expand(e):null},l.prototype.expand=function(e){if(!a.isNode(e))return null;if(a.isText(e)||a.isCDATA(e))return this.createString(a.getText(e));var t=o.getKey(e),n=this.expandElement(e);return this.getConfig().isToken(t)&&(n=this.expandToken(n,t)),n.expandAttributes(e),n.expandNamespaces(e),n},l.markup=r.markup,l}),n("editor/expr/Layout",["editor/util/Utils","editor/config/Config","editor/expr/Expr","editor/expr/Content","editor/expr/Present"],function(e,t,n,r,i){var s=e.Array,o=e.Char,u=e.Markup,a=e.Name,f=e.Object,l=e.Symbol,c=e.XML,h=function(t){return this.init(t),this};h.prototype=new n,h.prototype.constructor=h;var p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I;h.create=function(e){return new h(e)},h.prototype.create=function(e){return e instanceof t||(e=this.getConfig()),h.create(e)},h.copy=function(e){return e instanceof n?h.create().copy(e):null},h.valueOf=function(e){return h.expand(c.valueOf(e))},h.equal=n.equal,h.parse=function(e){return h.create().parse(e)},h.print=n.print,h.expand=function(e){return c.isNode(e)?h.create().expand(e):null},h.prototype.expand=function(e){if(!c.isNode(e))return null;if(c.isText(e)||c.isCDATA(e))return this.createString(c.getText(e));var t=u.getKey(e),n=null;u.isUnknown(e)?n=this.expandUnknown(e):u.isSymbol(e)?n=this.expandSymbol(e):u.isOperator(e)?n=this.expandOperator(e):this.getConfig().isOperator(t)?n=this.expandFunction(e):n=this.expandElement(e),this.getConfig().isToken(t)&&(n=this.expandToken(n,t)),n.expandOpAttributes(e),n.expandNamespaces(e);if(n.isFunction()){var r=n.getApplyArg(1);r.getHead().isSymbol()&&(n=r.getHead())}return n},h.markup=n.markup,h.prototype.markup=function(){if(this.isEmpty())return null;if(this.isSymbol())return u.createText(this.getSymbol());var e=this.getOp(),n=this;this.isToken()&&(n=this.markupToken(n,e));var r=null;return e===a._fn?r=this.markupFunction(n):t.isUnknown(e)?r=this.markupUnknown(n):t.isSymbol(e)?r=this.markupSymbol(n):this.isElement()?r=this.markupElement(n):r=this.markupOperator(n),n.markupOpAttributes(r),n.markupNamespaces(r),r},h.match=function(e){if(e instanceof r){var t=null,n=e.getOp()||e.getSymbol();return s.each(e.getConfig().getLayouts(n),function(n){n.getApplyArg(1).match({},e)&&(t=n.getApplyArg(2))}),t?t:(n=a._unknown,s.each(e.getConfig().getLayouts(n),function(n){n.getApplyArg(1).match({},e)&&(t=n.getApplyArg(2))}),t)}return null},h.prototype.match=function(e,t){var n=this;if(t instanceof r){if(n.isPattern()){var i=n.getPatternName(),s=e[i];return s?t.equal(s):(e[i]=t,!0)}if(n.isFunction()){var o=n.getApplyArg(1);if(o.getOp()!==t.getSymbol())return!1;var u=t,f=u.getParent();return f&&f.getOper()===t&&(u=f),f=u.getParent(),f&&f.getOper()===t&&(u=f),u.matchAttrib(o)}if(t.getSymbol()!==n.getSymbol())return!1;if(t.getOp()!==n.getOp()&&n.getOp()!==a._unknown)return!1;if(!t.matchAttrib(n))return!1;if(n.isApplyArgc(1)&&n.getApplyArg(1).isApplyOp(a._args))return!0;var l=t.getCount();if(l!==n.getCount())return!1;var c;for(c=1;c<l;c+=1)if(!n.getChild(c).match(e,t.getChild(c)))return!1;return!0}return!1};var q=null;h.setContent=function(e){e instanceof r||(e=null),q=e};var R=function(){return q.isBrailleOutput()},U=function(){if(q.isMathMode())return m;var e=q.getConfig().getBrailleOutput();return e==="br-text-echo"?g:e==="br-text-cbc"?y:e==="br-text-gr1"?b:m},z=function(e){return e.refer(e)},W=function(){var e=q?q.getConfig():null;return i.create(e)},X=function(e){var t=W();return t.setSymbol(e),t},V=function(e){return X(l.get(e))},$=function(e){var t=W();return t.addChild(X(e)),t},J=function(){return $(a._mrow)},K=function(e){if(!(e&&e.value instanceof i))return null;var t=$(a._mfenced);return e.value.addAttributesParent(t),t.addChildRef(e),t.refer(t)},Q=function(e){if(!(e&&e.value instanceof i))return null;if(R()&&!H(q))return e;var t=q.createSymbol(a.math("sdot")),n=z(h.layoutContent(t));return n.value.setContent(e.value.getContent()),n};h.isSeparator=function(e){if(e instanceof n){if(!e.isApplyOp(a._mo))return!1;var t=e.getApplyArg(1).getString();return t===","||t==="⠠"||t==="⠪"||t==="⣤"}return!1},h.isInvisibleTimes=function(e){return e instanceof n&&e.isApplyOpArgc(a._mo,1)&&e.getApplyArg(1).isTheSymbol(a._it)},h.isIdentityOp=function(e){return e?e.getConfig().showIdentity?!1:e.isApplyArgc(1)&&e.isAdditiveOp():!1},h.isAdditiveOp=function(e,t){if(!e||!t)return!1;if(e.getApplyArgc()>1&&t.getApplyArgc()>1){var n=e.getAdditiveOp(),r=t.getAdditiveOp();return!n||!r||n!==r?!1:n===e.getOp()||e.getApplyArg(1)===t}return!1},h.isInverseOp=function(e,t){if(!e||!t)return!1;if(e.getApplyArgc()>1&&t.getApplyArgc()===1){if(e.getConfig().showInverse)return!1;var n=e.getAdditiveOp(),r=t.getAdditiveOp();return!n||!r||n!==r?!1:n===e.getOp()&&n!==t.getOp()||e.getApplyArg(1)===t}return!1};var G=function(e,t){if(!e)return!1;if(e.isApplyOp(t))return!0;var n=e.getApplyArgc(),r;for(r=1;r<=n;r+=1)if(G(e.getChild(r),t))return!0;return!1};h.checkParensCommon=function(e,t,n){if(!e||!t)return!1;if(t.isRelation()&&!e.isRelation())return!0;if(h.isIdentityOp(e))return!1;while(h.isIdentityOp(t))t=t.getApplyArg(1);if(h.isInverseOp(e,t))return!1;if(n||!q||!q.getConfig().showAssoc)if(h.isAdditiveOp(e,t))return!1;return q&&q.getConfig().showAssoc&&h.isAdditiveOp(e,t)?!0:t},h.checkParensPrefix=function(e,t){if(!e||!t)return!1;var n=e.getConfig(),r=e.getRightBinding(),i=t.getLeftBinding();return n.compareBindings(r,i)},h.checkParensSuffix=function(e,t){if(!e||!t)return!1;var n=e.getConfig(),r=e.getLeftBinding(),i=t.getRightBinding();return n.compareBindings(r,i)},h.checkParensPrefixOuter=function(e,n,r){if(!e||!n)return!1;if(!r||!r.getOp())return!1;var i=n.getOuterRightBinding(),s=r.getOuterRightBinding();return i!==t.NO_PAREN&&i===s},h.checkParensSuffixOuter=function(e,n,r){if(!e||!n)return!1;if(!r||!r.getOp())return!1;var i=n.getOuterLeftBinding(),s=r.getOuterLeftBinding();return i!==t.NO_PAREN&&i===s},h.useParensTemplate=function(e,t,n){n=h.checkParensCommon(t,n,!0);if(f.isBoolean(n))return n;var r=h.match(t);if(r===null||G(r,a._iparen))return!1;var i=r.getOp();if(i===a._ipower||i===a._sub||i===a._sup||i===a._infix){var s=t.getApplyArgc();if(e>1||s===1)if(h.checkParensPrefix(t,n))return!0;if(e<s&&h.checkParensSuffix(t,n))return!0}if(i===a._prefix){r=r.getChild(2);if(r.getOp()===a._arg&&r.getChild(1).getNumberValue()===e)return h.checkParensPrefix(t,n)}if(i===a._suffix){r=r.getChild(2);if(r.getOp()===a._arg&&r.getChild(1).getNumberValue()===e)return h.checkParensSuffix(t,n)}return!1},h.useParensInfix=function(e,t,n){var r=q,i=n.getContent(),s;i=h.checkParensCommon(r,i);if(f.isBoolean(i))return i;if(e>1||t===1){s=r.getApplyArg(e-1);if(h.checkParensPrefix(r,i)&&!h.checkParensSuffixOuter(r,i,s))return!0}if(e<t){s=r.getApplyArg(e+1);if(h.checkParensSuffix(r,i)&&!h.checkParensPrefixOuter(r,i,s))return!0}return!1},h.useParensPrefix=function(e){var t=q,n=e.getContent();n=h.checkParensCommon(t,n);if(f.isBoolean(n))return n;if(h.checkParensPrefix(t,n))return!0;var r=n.getApplyArgc(),i,s;for(i=1;i<=r;i+=1){s=n.getApplyArg(i);if(h.checkParensPrefixOuter(t,t,s))return!0}return!1},h.useParensSuffix=function(e){var t=q,n=e.getContent();n=h.checkParensCommon(t,n);if(f.isBoolean(n))return n;if(h.checkParensSuffix(t,n))return!0;var r=n.getApplyArgc(),i,s;for(i=1;i<=r;i+=1){s=n.getApplyArg(i);if(h.checkParensSuffixOuter(t,t,s))return!0}return!1},h.layout=function(e){return h.layoutContent(e)},h.layoutContent=function(e){if(e instanceof r){var n=null,i=q;return q=e,q.getPresent()?n=q.getPresent():q.isEmpty()?n=W():q.isSymbol()&&q.getSymbol().getURI()?n=h.layoutApply():q.isSymbol()?n=X(h.layoutSymbol(q)):q.isApplyOp(a._math)?n=h.layoutApply():q.isApplyOp(a._mtable)&&R()?n=h.layoutApply():t.isPresentElt(q.getOp())?n=h.layoutPresent():n=h.layoutApply(),q.setPresent(n),q=i,n}return null},h.layoutContentRef=function(e){return h.layoutContent(e),e?e.getPresentRef():null},h.layoutPresent=function(){var e=$(q.getOp());e.addAttributes(q);var t=q.getApplyArgc(),n,r;for(n=1;n<=t;n+=1)r=q.getApplyArg(n),e.addChildRef(h.layoutContentRef(r));return e},h.layoutApply=function(){var e=h.match(q);if(e===null)return J();var t=e.layout_markup();return t=t.addAttributesCreate(q,a._mstyle),t},h.layoutSymbol=function(e){var t=e.getSymbol();return R()&&(t=v(t,U())),t},v=function(e,t){var n=e.getName(),r="",i=q.getParent();i&&i.isNumberToken()&&(o.isLetter(n.charCodeAt(0))&&(r="⣠"),n=n.toLowerCase());var s=!1,u=n.length,f,l;for(l=0;l<u;l+=1)f=n.charAt(l),f==="&"&&l+1<u&&(s=!0),s||(f=t[f]||f),f===";"&&(s=!1),r+=f;return a.get(r)},h.prototype.layout_content=function(e){var t=q;q=e;var n=this.layout_markup();return q.setPresent(n),q=t,n},h.prototype.layout_markup=function(){var e=null;return this.isEmpty()?e=W():this.isSymbol()?e=X(h.layoutSymbol(this)):t.isPresentElt(this.getOp())?e=this.layout_present():e=this.layout_apply(),e},h.prototype.layout_present=function(){var e=$(this.getOp());return e.addAttributes(this),e.addChildRefs(this.collectParts()),e},h.prototype.layout_apply=function(){var e=this.getOp()?this.getOp().getName():null,t=d[e];if(t)return t.call(this);var n=p[e];if(n){var r=[];this.collectPart(r);var i=J();return i.addChildRefs(r),i}return J()},h.prototype.contentPart=function(){var e=q,t=this.getCount(),n;for(n=1;n<t&&e&&e.isApply();n+=1)e=e.getApplyArg(this.getChild(n).getNumberValue());return e},h.prototype.collectSymbol=function(e,t){var n=t.getName(),r=n.length,i,s;for(i=0;i<r;i){s=i;if(n.charCodeAt(i)===o.amp){while(i<r&&n.charCodeAt(i)!==o.semi)i+=1;i===r&&(i=s)}i+=1,e.push(z(V(n.substring(s,i))))}},h.prototype.collectPart=function(e){var t=this.getOp()?this.getOp().getName():null,n=p[t];n?n.call(this,e):e.push(z(this.layout_markup()))},h.prototype.collectParts=function(){var e=[],t=this.getCount(),n,r;for(n=1;n<t;n+=1)r=this.getChild(n),r.collectPart(e);return e},h.prototype.collectArray=function(){var e=[],t=this.getChild(1),n=null;t&&t.isApplyOp(a._args)&&(n=t.contentPart()),n===null&&(n=r.copy(this));var i=n.getRowCount(),s,o,u,f,l;for(o=1;o<=i;o+=1){f=[],s=n.getColCount(o);for(u=1;u<=s;u+=1)l=n.getElt(o,u),f.push(h.layoutContentRef(l));e.push(f)}return e};var Y=function(e){var t=this.contentPart();t===null?e.push(z(J())):t===q?e.push(z(h.layoutContent(t))):e.push(h.layoutContentRef(t))},Z=function(e){var t=this.contentPart();if(t===null)return;var n=t.getApplyArgc(),r,i;for(r=1;r<=n;r+=1)i=t.getApplyArg(r),e.push(h.layoutContentRef(i))},et=function(e){var t=this.contentPart(),n=this.getHead();if(t===null||n.getCount()<2)return;var r=n.getChild(1).getSymbol(),i=t.getAttrib(r);i&&this.collectSymbol(e,i)},tt=function(){var e=$(a._mfenced);return e.setAttribute("open","{"),e.setAttribute("close","}"),e.addChildRefs(this.collectParts()),e},nt=function(){var e=$(a._mfenced);return e.setAttribute("open","["),e.setAttribute("close","]"),e.addChildRefs(this.collectParts()),e},rt=function(){var e=$(a._mtable),t=this.collectParts();return s.each(t,function(t){var n=$(a._mtr),r=$(a._mtd),i=t.value;i.addAttributesParent(r),r.addChildRef(t),n.addChild(r),e.addChild(n)}),e},it=function(){var e=this.collectParts();if(e.length<2)return J();var t=$(a._mfrac);return t.addChildRef(e[0]),t.addChildRef(e[1]),t},st=function(){var e=this.collectParts(),t=e.length-1,n=e[0],r,i=J(),s=n.value,o,u;if(t===0)h.isSeparator(s)||(i.addChildRef(n),i.addChild($(a._mfenced)));else if(t===1)h.isSeparator(s)||h.isIdentityOp(q)||i.addChildRef(n),r=e[1],u=r.value,h.isSeparator(s)||h.useParensInfix(1,t,u)&&(r=K(r)),i.addChildRef(r);else{var f=h.isInvisibleTimes(s),l=!1,c=!1,p=!1,d=!1,v=!1,m=!1,g=!1,y=!1,b;for(b=1;b<=t;b+=1){r=e[b];if(r===null)continue;u=r.value,o=u.getContent();while(o&&o.isApplyOp(a._power))o=o.getApplyArg(1);c=o&&o.isApplyOp(a._cn),d=I(o)||F(u),y=o&&(o.isApplyOp(a._divide)||o.isApplyOp(a._mxf))&&!o.getClass(),v=o&&o.isPlace(),b>1&&(h.isInverseOp(q,o)?u.getChild(1).setAttribute("form","infix"):f&&(c||v)&&(p||l||g||m)?i.addChildRef(Q(n)):f&&y&&(l||g)&&!R()?i.addChildRef(Q(n)):i.addChildRef(n)),h.isSeparator(s)||h.useParensInfix(b,t,u)&&(r=K(r)),i.addChildRef(r),l=c,p=d,m=v,g=y}}return i},ot=function(e){var t=this.contentPart();if(t===null)return;t.isFunction()&&(t=t.getApplyArg(1)),t.isApply()&&(t=t.getHead()),t.isSymbol()&&this.collectSymbol(e,h.layoutSymbol(t))},ut=function(){var e=$(a._mtable),t=this.collectArray();return s.each(t,function(t){var n=$(a._mtr);s.each(t,function(e){var t=$(a._mtd),r=e.value;r.addAttributesParent(t),t.addChildRef(e),n.addChild(t)}),e.addChild(n)}),e},at=function(e){var t=this.getChild(1).getNumberValue(),n=q.getApplyArgc(),r,i;for(r=1;r<=n;r+=1)i=q.getApplyArg(r),i.isApplyOp(a._sep)?t-=1:t===1&&e.push(h.layoutContentRef(i))},ft=function(e){var t=this.getApplyArgc()===1&&this.getApplyArg(1).isSymbol(),n=t?q:this.contentPart();if(n===null)return;var r=n.getOper();if(t){var i=this.getApplyArg(1).getString();i&&(r=n.createSymbol(a.math(i)))}if(r===null)return;var s=z(h.layoutContent(r)),o=s.value;n.getParent()&&n.getParent().isFunction()?o.addAttributes(n):o.addAttributes(n.getHead()),t&&o.setContent(null),e.push(s)},lt=function(){var e=this.getCount();if(e<2)return J();var t=this.getChild(2).getSymbol();if(t===a._divide)return x.call(this);if(t===a._root)return T.call(this);if(t===a._baseline)return N.call(this);if(t===a._subscript){if(q.isApplyOpArgc(a._subscript,2)||q.isApplyOp(a._subsup)||q.isApplyOpArgc(a._log,2))if(j(q))return J();return C.call(this)}return t===a._superscript?C.call(this):t===a._stack?k.call(this):t===a._overscript?L.call(this):t===a._underscript?A.call(this):J()};x=function(){var e=J(),t=this.getChild(1).layout_markup(),n=[a._divide,a._mxf,a._slash],r=D(q,n),i;for(i=1;i<r;i+=1)e.addChild(t);return e},T=function(){var e=J(),t=this.getChild(1).layout_markup(),n=M(q,[a._root]),r;for(r=0;r<n;r+=1)e.addChild(t);return e},N=function(){var e=J(),t=this.parse("⣾").layout_markup(),n=this.parse("⣿").layout_markup(),r=this.parse("⣽").layout_markup();return q.isApplyOpArgc(a._subscript,2)&&j(q)&&(n=t),s.contains(S,q.getOp())&&e.addChild(r),e.addChild(t),O(q,e,w),e.addChild(n),e},C=function(){var e=J(),t=this.parse("⠐").layout_markup(),n=this.getChild(1).layout_markup();return e.addChild(t),O(q,e,w),e.addChild(n),e},k=function(){var e=J(),t=this.getChild(1).layout_markup(),n=_(q);return n===0&&e.addChild(t),e},L=function(){var e=J(),t=this.getChild(1).layout_markup(),n=[a._overbar,a._overscript],r=P(q,n),i=P(q.getApplyArg(1),n),s;if(r>i)for(s=0;s<r;s+=1)e.addChild(t);return e},A=function(){var e=J(),t=this.getChild(1).layout_markup(),n=[a._underbar,a._underscript],r=P(q,n),i=P(q.getApplyArg(1),n),s;if(r>i)for(s=0;s<r;s+=1)e.addChild(t);return e},w=[a._subscript,a._superscript,a._presubscript,a._presuperscript,a._power],S=[a._tilde,a._overbar,a._underbar,a._overscript,a._underscript],E=[a._prime,a._dprime,a._tprime,a._superscript,a._presubscript,a._presupscript,a._power],M=function(e,t){var n=0;for(;;){e=e.getParent();if(e===null)break;s.contains(t,e.getOp())&&(n+=1)}return n},_=function(e){var t=0,n,r,i;for(;;){n=e.getParent();if(n===null)break;r=n.getOp(),i=n.getApplyArg(1);if(!s.contains(S,r)||e!==i)break;t+=1,e=n}return t},O=function(e,t,n){var r=e.getParent();if(r===null)return;O(r,t,n);var i=r.getOp(),o=r.getApplyIndex(e);if(i===a._subsup||i===a._presubsup)o===2&&(i=a._subscript),o===3&&(i=a._superscript);o>1&&s.contains(n,i)&&(e=r.createApplyOp(i).getOper(),t.addChild(h.layoutContent(e)))},D=function(e,t){var n=0,r=e.getOp(),i=e.getApplyArgc();s.contains(w,r)&&(i=1);if(r===a._subsup||r===a._presubsup)i=1;var o,u;for(o=1;o<=i;o+=1)u=D(e.getApplyArg(o),t),u>n&&(n=u);return s.contains(t,r)&&(n+=1),n},P=function(e,t,n){var r=0,i=e.getOp();if(s.contains(S,i)){var o=!1;if(i===a._overbar||i===a._underbar)o=i===n;r=P(e.getApplyArg(1),t,i),s.contains(t,i)&&!o&&(r+=1)}return r},H=function(e){var t,n,r;for(;;){t=e.getParent();if(t===null)break;n=t.getOp(),r=t.getApplyArg(1);if(s.contains(w,n)&&e!==r)return!1;if(n===a._subsup||n===a._presubsup)if(e!==r)return!1;e=t}return!0},B=function(e){var t;do e=e.getApplyArg(1),t=e.getOp();while(s.contains(E,t));return e},j=function(){if(!H(q))return!1;if(!q.getApplyArg(2).isApplyOp(a._cn))return!1;if(q.isApplyOp(a._log))return!0;var e=B(q);if(e.isApplyOpArgc(a._ci,1))return!0;var t=e.getPresent();return F(t)?!0:!1},F=function(e){if(!e.isApplyOp(a._mi))return!1;var t="",n=e.getApplyArgc(),r;for(r=1;r<n;r+=1)t+=e.getApplyArg(r).getString();return t.match(/^(\u2828|(\u2808(\u2830|\u2838)))(\u2820)?$/)},I=function(e){return e?e.isApplyOp(a._ci)?e.getApplyArgc()===0?!1:(e=e.getApplyArg(1),e.isSymbol()?o.isLetter(e.getString().charCodeAt()):!1):!1:!1};var ct=function(){var e=$(a._mfenced);return e.addChildRefs(this.collectParts()),e},ht=function(e){var t=this.contentPart();t===null?e.push(z(J())):t===q?e.push(z(h.layoutContent(t))):e.push(h.layoutContentRef(t))},pt=function(e){var t=this.contentPart();if(t===null)return;var n=t.getApplyArgc(),r,i;for(r=0;r<=n;r+=1)i=t.getApplyArg(r),e.push(h.layoutContentRef(i))},dt=function(){var e=this.collectParts();if(e.length<2)return J();var t=$(a._msup),n=e[0],r=e[1];return h.useParensSuffix(n.value)&&(n=K(n)),t.addChildRef(n),t.addChildRef(r),t},vt=function(){var e=this.collectParts();if(e.length<2)return J();var t=J(),n=e[0],r=e[1];return h.useParensPrefix(r.value)&&(r=K(r)),t.addChildRef(n),t.addChildRef(r),t},mt=function(){var e=this.collectParts();if(e.length<2)return J();var t=$(a._mmultiscripts),n=e[0],r=e[1];return h.useParensPrefix(n.value)&&(n=K(n)),t.addChildRef(n),t.addChild($(a._mprescripts)),t.addChildRef(r),t.addChild($(a._none)),t},gt=function(){var e=this.collectParts();if(e.length<2)return J();var t=$(a._mmultiscripts),n=e[0],r=e[1];return h.useParensPrefix(n.value)&&(n=K(n)),t.addChildRef(n),t.addChild($(a._mprescripts)),t.addChild($(a._none)),t.addChildRef(r),t},yt=function(){var e=this.getCount();if(e<2)return J();var t=J(),n=this.getChild(1).layout_markup(),r=this.getChild(2).getNumberValue(),i;for(i=1;i<=r;i+=1)t.addChild(n);return t},bt=function(e){var t=this.getChild(1).getNumberValue(),n=q.getApplyArgc(),r,i;for(r=t;r<=n;r+=1)i=q.getApplyArg(r),e.push(h.layoutContentRef(i))},wt=function(){var e=this.collectParts();if(e.length<2)return J();var t=$(a._mroot);return t.addChildRef(e[0]),t.addChildRef(e[1]),t},Et=function(){var e=this.collectParts(),t=e.length,n=$(a._mrow),r,i;for(r=0;r<t;r+=1)i=e[r],h.useParensInfix(r,t,i.value)&&(i=K(i)),n.addChildRef(i);return n},St=function(){var e=$(a._mtable),t=$(a._mtr),n=this.collectParts();return s.each(n,function(e){var n=$(a._mtd),r=e.value;r.addAttributesParent(n),n.addChildRef(e),t.addChild(n)}),e.addChild(t),e},xt=function(){var e=this.collectParts();if(e.length<2)return J();var t=$(a._msub),n=e[0],r=e[1];return h.useParensSuffix(n.value)&&(n=K(n)),t.addChildRef(n),t.addChildRef(r),t},Tt=function(){var e=this.collectParts();if(e.length<2)return J();var t=J(),n=e[1],r=e[0];return h.useParensSuffix(n.value)&&(n=K(n)),t.addChildRef(n),t.addChildRef(r),t},Nt=function(){var e=this.collectParts();if(e.length<2)return J();var t=$(a._msup),n=e[0],r=e[1];return h.useParensSuffix(n.value)&&(n=K(n)),t.addChildRef(n),t.addChildRef(r),t},Ct=function(){var e=$(q.getOp());e.addAttributes(q);var t=this.collectArray(),n=t.length,r,i,s,o,u,a,f,l,c;for(i=0;i<n;i+=1){o=q.getRow(i+1),u=$(o.getOp()),u.addAttributes(o),r=t[i].length;for(s=0;s<r;s+=1)a=o.getApplyArg(s+1),f=$(a.getOp()),f.addAttributes(a),l=t[i][s],c=l.value,c.addAttributesParent(f),f.addChildRef(l),u.addChild(f);e.addChild(u)}return e};p={arg:Y,args:Z,attrib:et,label:ot,number:at,op:ft,part:ht,parts:pt,rest:bt},d={brace:tt,bracket:nt,colvector:rt,fraction:it,infix:st,matrix:ut,order:lt,paren:ct,power:dt,prefix:vt,presub:mt,presup:gt,repeat:yt,root:wt,row:Et,rowvector:St,sub:xt,suffix:Tt,sup:Nt,table:Ct};var kt={a:"⠁",b:"⠃",c:"⠉",d:"⠙",e:"⠑",f:"⠋",g:"⠛",h:"⠓",i:"⠊",j:"⠚",k:"⠅",l:"⠇",m:"⠍",n:"⠝",o:"⠕",p:"⠏",q:"⠟",r:"⠗",s:"⠎",t:"⠞",u:"⠥",v:"⠧",w:"⠺",x:"⠭",y:"⠽",z:"⠵"},Lt={A:"⠠⠁",B:"⠠⠃",C:"⠠⠉",D:"⠠⠙",E:"⠠⠑",F:"⠠⠋",G:"⠠⠛",H:"⠠⠓",I:"⠠⠊",J:"⠠⠚",K:"⠠⠅",L:"⠠⠇",M:"⠠⠍",N:"⠠⠝",O:"⠠⠕",P:"⠠⠏",Q:"⠠⠟",R:"⠠⠗",S:"⠠⠎",T:"⠠⠞",U:"⠠⠥",V:"⠠⠧",W:"⠠⠺",X:"⠠⠭",Y:"⠠⠽",Z:"⠠⠵"},At={A:"⡁",B:"⡃",C:"⡉",D:"⡙",E:"⡑",F:"⡋",G:"⡛",H:"⡓",I:"⡊",J:"⡚",K:"⡅",L:"⡇",M:"⡍",N:"⡝",O:"⡕",P:"⡏",Q:"⡟",R:"⡗",S:"⡎",T:"⡞",U:"⡥",V:"⡧",W:"⡺",X:"⡭",Y:"⡽",Z:"⡵"},Ot={1:"⣠⠁",2:"⣠⠃",3:"⣠⠉",4:"⣠⠙",5:"⣠⠑",6:"⣠⠋",7:"⣠⠛",8:"⣠⠓",9:"⣠⠊",0:"⣠⠚"},Mt={1:"⠂",2:"⠆",3:"⠒",4:"⠲",5:"⠢",6:"⠖",7:"⠶",8:"⠦",9:"⠔",0:"⠴"},_t={" ":"⠀","!":"⠮",'"':"⠐","#":"⠼",$:"⠫","%":"⠩","&":"⠯","'":"⠄","(":"⠷",")":"⠾","*":"⠡","+":"⠬",",":"⠠","-":"⠤",".":"⠨","/":"⠌",":":"⠱",";":"⠰","<":"⠣","=":"⠿",">":"⠜","?":"⠹","`":"⠈","{":"⠪","|":"⠳","}":"⠻","~":"⠘",_:"⠸"},Dt={"@":"⡈","[":"⡪","\\":"⡳","]":"⡻","^":"⡘","":"⡸"},Pt={_:"⠸⠸","@":"⡈","[":"⡪","\\":"⡳","]":"⡻","^":"⡘"},Ht={" ":"⠀",",":"⠂",";":"⠆",":":"⠒",".":"⠲","!":"⠖","?":"⠦","*":"⠔","(":"⠶",")":"⠶","[":"⠠⠶","]":"⠶⠄","‘":"⠠⠦","’":"⠴⠄","“":"⠦","”":"⠴",'"':"⠦","'":"⠄","…":"⠄⠄⠄","-":"⠤","–":"⠤⠤","—":"⠤⠤⠤⠤"};return m={1:"⣠⠂",2:"⣠⠆",3:"⣠⠒",4:"⣠⠲",5:"⣠⠢",6:"⣠⠖",7:"⣠⠶",8:"⣠⠦",9:"⣠⠔",0:"⣠⠴",",":"⠠",".":"⠨⣰"," ":"⣴"},m=f.extend({},m,kt,Lt),g=f.extend({},kt,At,Mt,_t,Dt),y=f.extend({},kt,At,Mt,_t,Pt),b=f.extend({},kt,Lt,Ot,Ht),function(){var e,t,n,r;for(r=32;r<127;r+=1)r===64&&(r=96),t=String.fromCharCode(r),n=g[t],n&&(e=r-32,t=String.fromCharCode(e),e=n.charCodeAt()+64,n=String.fromCharCode(e),g[t]||(g[t]=n));for(r=0;r<128;r+=1)t=String.fromCharCode(r),n=g[t],n&&(e=r+128,t=String.fromCharCode(e),e=n.charCodeAt()+128,n=String.fromCharCode(e),g[t]=n)}(),h}),n("editor/expr/Template",["editor/util/Utils","editor/config/Config","editor/panel/Panel","editor/expr/Expr","editor/expr/Layout"],function(e,t,n,r,i){var s=e.$,o=e.Array,u=e.Char,a=e.Markup,f=e.Name,l=e.Object,c=e.Event,h=e.Symbol,p=e.XML,d=null,v=null,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D=null,P,H,B,j,F,I,q=!1,R=!1,U=null,z=null,W,X=!1,V=null,$="this",J="next",K="side",Q="box",G="key",Y="word",Z=null,et=function(t){return this.init(t),this._name=null,this._repeat=null,this._assoc=null,this._model=null,this};et.prototype=new r,et.prototype.constructor=et,et.create=function(e){return new et(e)},et.prototype.create=function(e){return e instanceof t||(e=this.getConfig()),et.create(e)},et.copy=function(e){return e instanceof r?et.create().copy(e):null},et.valueOf=function(e){return et.expand(p.valueOf(e))},et.equal=r.equal,et.parse=function(e){return et.create().parse(e)},et.print=r.print,et.expand=function(e){return p.isNode(e)?et.create().expand(e):null},et.prototype.expand=function(e){if(!p.isNode(e))return null;if(p.isText(e)||p.isCDATA(e))return this.createString(p.getText(e));var t=a.getKey(e),n=null;return a.isUnknown(e)?n=this.expandUnknown(e):a.isSymbol(e)?n=this.expandSymbol(e):a.isOperator(e)?n=this.expandOperator(e):this.getConfig().isOperator(t)?n=this.expandFunction(e):n=this.expandElement(e),this.getConfig().isToken(t)&&(n=this.expandToken(n,t)),n.expandOpAttributes(e),n.expandNamespaces(e),n},et.markup=r.markup,et.prototype.markup=function(){if(this.isEmpty())return null;if(this.isSymbol())return a.createText(this.getSymbol());var e=this.getOp(),n=this;this.getConfig().isToken(e)&&(n=this.markupToken(n,e));var r=null;return e===f._fn?r=this.markupFunction(n):t.isUnknown(e)?r=this.markupUnknown(n):t.isSymbol(e)?r=this.markupSymbol(n):this.isElement()?r=this.markupElement(n):r=this.markupOperator(n),n.markupOpAttributes(r),n.markupNamespaces(r),r},et.prototype._name=null,et.prototype.getName=function(){return this._name},et.prototype.setName=function(e){this._name=e},et.prototype._repeat=null,et.prototype.getRepeat=function(){return this._repeat},et.prototype.setRepeat=function(e){this._repeat=e},et.prototype._assoc=null,et.prototype.getAssoc=function(){return this._assoc},et.prototype.setAssoc=function(e){this._assoc=e},et.prototype._model=null,et.prototype.getModel=function(){return this._model},et.prototype.setModel=function(t){d=d||e.require("editor/model/Model"),t instanceof d||(t=null),this._model=t},et.prototype.getHistory=function(){return this.getModel().getHistory()},et.prototype.getSelection=function(){return this.getModel().getSelection()},et.prototype.getCurrent=function(){return this.getSelection().getCurrentContent()},et.prototype.setCurrent=function(e){this.getSelection().setCurrentContent(e)},et.prototype.getBaseName=function(){var e=this.getName();if(e===null)return null;var t=e.getName();t==="space"&&(t=" ");var n=t.indexOf("-");return n>0&&(t=t.substring(n+1)),f.get(t)},et.prototype.getPhase=function(){return this.getAttrib(f._phase)},et.prototype.getSelector=function(){return this.getAttribute("selector")},et.prototype.getSource=function(){return this.getChild(1)},et.prototype.getTarget=function(){return this.getChild(2)},et.prototype.isMouse=function(){var e=this.getTarget(),t=e?e.getNthPattern(0):null;return t===f._mouse},et.prototype.isMouseSymbol=function(e){var t=this.getTarget(),n=t?t.getNthPattern(1):null;return this.isMouse()&&n===e},et.prototype.isMatch=function(){var e=this.getSource(),t=e?e.getNthPattern(0):null;return e!==null&&t!==f._this},et.prototype.isCommand=function(){var e=this.getTarget(),t=e?e.getNthPattern(0):null;return t===f._cursor||t===f._assoc||t===f._nary||t===f._array||t===f._text||t===f._edit||t===f._echo||t===f._select||t===f._imath},et.prototype.isGroup=function(){var e=this.getTarget(),t=e?e.getNthPattern(0):null;return t===f._paren||t===f._bracket||t===f._brace||t===f._abs},et.prototype.isGroupOpen=function(){var e=this.getTarget(),t=e?e.getNthPattern(1):null;return this.isGroup()&&t!==f._close},et.prototype.isGroupClose=function(){var e=this.getTarget(),t=e?e.getNthPattern(1):null;return this.isGroup()&&t===f._close},et.prototype.isApplyClose=function(){var e=this.getTarget(),t=e?e.getNthPattern(1):null;return t===f._close},et.prototype.isApplyChild=function(){var e=this.getTarget(),t=e?e.getNthPattern(1):null;return t===f._child},et.prototype.isApplyAttrib=function(){var e=this.getTarget(),t=e?e.getNthPattern(1):null;return t===f._attrib},et.prototype.isExist=function(){var e=this.getSelector();return e!==null&&e.indexOf("%exist")!==-1},et.prototype.isToken=function(){var e=this.getSelector();return e!==null&&e.indexOf("%token")!==-1},et.prototype.isOutfix=function(){var e=this.getSelector();return e!==null&&e.indexOf("%outfix")!==-1},et.prototype.isOutfixBinary=function(){var e=this.getTarget();return this.isOutfix()&&e!==null&&e.isApplyArgc(2)},et.prototype.isOutfixExist=function(){return this.isOutfixBinary()&&this.isExist()},et.prototype.isOutfixGroup=function(){var e=this.getTarget(),t=e?e.getNthPattern(2):null;return t===f._paren||t===f._bracket||t===f._brace||t===f._abs};var tt=!1,nt=!0,rt=!1;et.process=function(e,t){et.processMath(e,t),et.processPre(e,t),et.processMain(e,t),et.processPost(e,t)},et.processMath=function(e,t){tt=!1,nt=!0,X=t.getSelection().getSelectionSide(),V=t.getSelection().getHeadReference();var n=et.selectMath(e,t);n&&(n.update(),n.setAssoc(null),n.setModel(null))},et.processPre=function(e,t){var n=et.select(e,t,f._pre);n&&(n.update(),t.getEchoAction()&&n.echoAction(t),n.setAssoc(null),n.setModel(null))},et.processMain=function(e,t,n){var r=et.select(e,t);r&&(r.setRepeat(n),r.update(),t.getEchoAction()&&r.echoAction(t),r.setAssoc(null),r.setModel(null),q=R,R=!1)},et.processPost=function(e,t){var n=tt,r=et.select(e,t,f._post);r&&(r.update(),r.setAssoc(null),r.setModel(null)),D&&(D.setAssoc({}),D.setModel(t),D.echoAction(t),D.setAssoc(null),D.setModel(null)),D=null,n&&t.getHistory().save(),U=z,z=null,nt=!0},et.processPlaceLeft=function(e){e.getSelection().onPlaceLeft(),e.getHistory().save();var t="back tab";e.getEchoAction()&&_(e,t)},et.processPlaceRight=function(e){e.getSelection().onPlaceRight(),e.getHistory().save();var t="tab";e.getEchoAction()&&_(e,t)},et.mouse=function(e,t){var n=null,r=t.getConfig();return o.each(r.getTemplates(e),function(e){n=e}),n},et.selectSpeech=function(e,t){var n=e.getOp(),r=e.getClass(),i=n.getName()+(r?"-"+r.getName():""),s=f.user(i);return this.selectSpeechByTarget(s,e,t)||this.selectSpeechByName(s,t)},et.selectSpeechByName=function(e,t){var n=t.getConfig().getTemplates(e),r=null;return o.each(n,function(e){var t=e.getApplyArg(3);t&&t.isApplyOp(f._speech)&&(r=t)}),r},et.selectSpeechByTarget=function(e,t,n){var r=n.getConfig().getTargets(e)||[],i=null;return o.each(r,function(e){var n=e.getApplyArg(2);t.match({},n)&&(n=e.getApplyArg(3),n&&n.isApplyOp(f._speech)&&(i=n))}),i},et.selectMath=function(t,n){d=d||e.require("editor/model/Model");if(t instanceof h){if(n instanceof d){var r=n.getSelection().getCurrentContent();if(!r.isTextMode())return null;var i=t.getName();i==="ctrl-`"&&(i="root");if(i.lastIndexOf("-")>=i.length-2)return null;var s=et.select(f._imath,n);if(s===null)return null;var u=n.getConfig(),a=/^%math/,l=null;return o.each(u.getTemplates(t),function(e){if(e.getPhase()||e.isMatch())return;if(!a.test(e.getSelector()))return;if(e.isCommand()){l=!1;return}l===null&&(l=!0)}),l?s:null}return null}return null},et.select=function(t,n,r){d=d||e.require("editor/model/Model");if(t instanceof h){if(n instanceof d){r instanceof h||(r=null);var i=n.getConfig(),s=null,u=null,a=0,f;o.each(i.getTemplates(t),function(e){f=m(e,n,r,s,a),f!==-1&&(s=e.getSelector(),a=f,u=e)});if(u)return u;var l=g(t,r);return l?(o.each(i.getTemplates(l),function(e){f=m(e,n,r,s,a),f!==-1&&(s=e.getSelector(),a=f,u=e)}),u&&u.setName(t),u):null}return null}return null},m=function(t,n,r,i,s){v=v||e.require("editor/model/Selector");var o=n.getSelection(),u=nt?n.getEditableSelector():null,a=t.getPhase();if(a!==r)return-1;var l=t.getSelector();if(!v.compare(l,i))return-1;var c=o.getCurrentContent(),h=o.getSelectionWidth(),p=o.isRight()?f._right:f._left,d=l&&l.indexOf("%outer")!==-1;o.isComplex()&&(h=null),c&&c.isOp()&&!d&&(p=f._unknown);var m=v.match(l,c,p,h);if(m===-1)return-1;u==="inputs >"&&(v.match("input mtable >",c,p)!==-1?u="input mtd >":u="input >");if(!o.isDone()&&v.match(u,c,p,h)===-1&&!y(t))return-1;var g={},b=t.getSource();if(c&&c.isOp()){var w=t.isCommand()||t.isApplyAttrib()||t.isApplyClose()||t.isApplyChild();if(!w){c=c.getOpParent(),b=t.getTarget();var E=c.getApplyArgc(),S=b.getApplyArgc(),x=t.getName(),T=x===f.user("delete")||x===f.user("bs"),N=c.getParent(),C=c.getAdditiveOp(),k=b.getAdditiveOp(),L=N.getAdditiveOp();if(m===0){m=1;var A;for(A=c;A;m+=1)A=A.getParent()}if((E!==1||S!==1)&&c.getOp()===b.getOp()&&c.getClass()===b.getClass()&&!T)return-1;if(E===1&&S===1)m+=3;else if(E===S)m+=1;else if(E===1&&S===2&&N.isAssoc()&&C===k&&C!==null)m+=2;else if(E===1&&S===2&&N.isAssoc()&&C===L&&C!==null&&N.getApplyIndex(c)>1)m+=2;else if(E===1&&S===2)m+=2;else if(S===1&&c.isAssoc()&&C===k&&C!==null)m+=2;else{if(S!==2||!c.isAssoc())return-1;m+=1}}}else if(c&&!c.match(g,b))return-1;return m<s?-1:(t.setAssoc(g),t.setModel(n),m)},y=function(e){var t=e.getTarget().getNthPattern(0),n=e.getTarget().getNthPattern(1);return t===f._edit&&n===f._clear?!0:t===f._edit&&n===f._undo?!0:!1},g=function(e,t){var n=e.getName();if(n.length!==1)return t?f._unknown:null;var r=n.charCodeAt();return u.isLetter(r)?f._symbol:u.isDigit(r)?f._number:f._unknown};var it=!1;et.prototype.float=function(){var e=this.getSelection();if(it)return it=!1,!1;if(e.isDone())return!1;if(this.isCommand())return!1;if(this.isMatch())return!1;var t=!0;while(t){if(e.isDone())break;if(this.isApplyAttrib()){if(this.floatIsClose())break;e.out();continue}if(e.isRoot())break;if(!this.floatIsSelectable()&&!this.floatIsMerge())break;if(this.floatIsApply()){if(this.floatIsClose())break;e.out();continue}if(this.floatIsOp())break;if(this.floatIsOutfix())break;if(this.floatIsUnary())break;if(this.floatIsBound()){e.out();continue}if(this.floatIsAdditive()){e.out();continue}if(this.floatIsMerge())return this.floatDoNary(),tt=!0,this.floatCloseNary();if(this.floatIsNary()){if(this.floatIsInfix())break;e.out();continue}if(this.floatIsParen()){if(this.floatIsInfix())break;e.out();continue}t=!1}return this.floatIsApply()?this.floatIsClose()?this.isApplyAttrib()?!1:(e.update(),tt=!0,!0):(this.getHistory().restore(),!0):!1},et.prototype.floatIsSelectable=function(){var e=this.getCurrent().getParent();return this.getModel().isSelectable(e,!0)},et.prototype.floatIsApply=function(){return this.isApplyClose()||this.isApplyChild()||this.isApplyAttrib()},et.prototype.floatIsClose=function(){var e=this.getCurrent();this.isApplyChild()&&!e.isDone()&&(e=e.getParent());var t=this.getTarget();return e.isApplyOp(t.getOp())},et.prototype.floatIsOp=function(){return this.getCurrent().isOp()},et.prototype.floatIsOutfix=function(){return this.isOutfixExist()&&this.getCurrent().isPlace()},et.prototype.floatIsUnary=function(){var e=this.getTarget();if(e.getApplyArgc()===1)if(e.isAdditiveOp()||e.isAdditiveInverse()){var t=this.getSelection().getParentContent(),n=this.getCurrent(),r=t.getApplyIndex(n);return t.isApplyOp(f._times)&&r===1?!1:!0}return!1},et.prototype.floatIsBound=function(){var e=this.getSelection().getParentContent(),t=this.getCurrent(),n=e.getOp(),r=e.getApplyIndex(t),i=e.getApplyArgc();if(r===1)return n===f._pvar||n===f._pvars;if(r===2){if(n===f._diff||n===f._partialdiff)return!0;if(n===f._sum||n===f._product||n===f._limit||n===f._int)return i>2}return!1},et.prototype.floatIsAdditive=function(){var e=this.getSelection().getParentContent(),t=this.getTarget();if(e.getApplyArgc()===1){var n=e.getAdditiveOp();if(n===null)return!1;if(n===t.getAdditiveOp())return!0}return!1},et.prototype.floatIsMerge=function(){var e=this.getSelection().getParentContent(),t=this.getTarget();if(this.isToken())return!1;var n=e.getOp();if(n===null||n===f._divide)return!1;if(!t.isApplyOpArgc(n,2))return!1;var r=f._class;return e.getOpAttrib(r)!==t.getOpAttrib(r)?!1:e.isNary()&&e.getNaryMax()===0?!0:!1},et.prototype.floatIsNary=function(){var e=this.getSelection().getParentContent(),t=this.getTarget();if(e.getOp()===null)return!1;var n=f._class;if(e.getOpAttrib(n)===t.getOpAttrib(n))return!1;if(t.isApplyOp(e.getOp())&&e.isNary()&&e.getNaryMax()===0)if(this.floatIsParen()||e.getRightBinding()===t.getLeftBinding())return!0;return!1},et.prototype.floatDoNary=function(){this.getSelection().isLeft()?this.naryInsertLeft():this.naryInsertRight()},et.prototype.floatCloseNary=function(){return!this.isOutfixExist()&&!this.isOutfixGroup()},et.prototype.floatIsParen=function(){var e=this.getSelection().getParentContent(),t=this.getTarget(),n=e.getApplyIndex(this.getCurrent());return i.useParensTemplate(n,e,t)},et.prototype.floatIsInfix=function(){var e=this.getSelection(),t=e.getParentContent(),n=this.getCurrent(),r=this.getTarget(),i=t.getApplyIndex(n);if(n.isApplyOpArgc(f._minus,1)&&e.isLeft())return e.inn(0),rt=!0,rt;if(t.isApplyOpArgc(f._minus,1))return rt=e.isLeft(),rt;if(t.isNary()&&t.getNaryMax()===0){var s=e.isLeft()?1:t.getApplyArgc();return rt=i!==s,rt}var o=f._divide;return t.isApplyOp(o)&&r.isApplyOp(o)?!0:t.isApplyOp(f._power)?i===1&&e.isRight():!1},et.prototype.update=function(){var e=this.getCurrent(),t=null,n=null,r=null;nt=!1,rt=!1;if(this.float())return;var i=this.getCurrent();e.closeSoft(i);var s=this.getSelection(),o=this.getAssoc();tt=!0,o[$]=i;if(this.isCommand())this.updateCommand();else if(this.isApplyAttrib()){var u=s.getSelectionSide();s.onDone(),i.suspend(),i.addAttributes(this.getTarget()),i.resume(),i.layout(),s.onSelect(e),s.setSelectionSide(u)}else i.isOp()?(o[$]=i.getParent(),this.updateInfix()):(this.updateSymbols(),t=i.subst(o,this.updateResult()),n=this.updateNext(i,t),r=o[$],this.setCurrent(t),rt&&this.editUngroup(),e=this.getCurrent(),n&&n.getParent()?s.onSelect(n):t.contains(e)&&e.findPlace()?s.onPlace():t.findPlace()&&(!r||!r.findPlace())?(s.onSelect(t),s.onPlace()):r&&r.getParent()&&s.onSelect(r))},et.prototype.updateTarget=function(){var e=this.getAssoc();if(!e[J]){var t=this.getCurrent(),n=this.getSelection().getSelectionSide();n=n?"after":"before",this.getSelection().isDone()&&(n="math"),t.isOp()&&(t=t.getParent()),e[J]=t,e[K]=t.createString(" : "+n)}},et.prototype.updateSymbols=function(){var e=this.getAssoc(),t=this.getCurrent(),n=this.getTarget(),r=t.copy(n.findOp(f._math))||t.copy(n.findOp(f._html))||t;e[$]=t,e[J]=r.createPlace(),e[Q]=r.createPlace(),e[G]=t.createSymbol(this.getBaseName())},et.prototype.updateResult=function(){var e=this.getTarget(),t=e,n=this.getCurrent().isPlace(),r=this.getSelection().isRight();return this.isOutfixGroup()&&n?t=e.getApplyArg(2):this.isOutfixExist()&&n?t=e.getApplyArg(2):this.isOutfixBinary()&&(!this.isToken()||!n)&&(n===r?(t=et.create(),t.referChild(e.getApplyArg(0)),t.referChild(e.getApplyArg(2)),t.referChild(e.getApplyArg(1))):(t=et.create(),t.referChild(e.getApplyArg(0)),t.referChild(e.getApplyArg(1)),t.referChild(e.getApplyArg(2)))),t},et.prototype.updateNext=function(e,t){var n=this.getSelection(),r=this.getAssoc();if(this.isGroupOpen())return t.getTail();var i=r[G];if(i&&i.getParent())return i;i=r[J];if(i&&i.getParent())return i;if(e.isTokenMode()&&t.isToken()){var s=t.getTail();return s.findPlace()||s}if(!this.isOutfix())return null;if(this.isOutfixExist()&&e.isPlace())return null;if(t.getApplyArgc()!==2)return null;var o=n.isRight()?2:1;return i=t.getApplyArg(o),i.isApplyOp(f._maligngroup)&&(i=t.getApplyArg(3-o)),i},et.prototype.updateInfix=function(){var e=this.getSelection(),t=e.getParentContent(),n=this.getTarget(),r=t.getParent(),s=t.getApplyArgc(),o=n.getApplyArgc(),u,a,l;a=this.getName();var c=a===f.user("delete")||a===f.user("bs");if(s===1&&o===2&&(r.getApplyArgc()>1||c)){u=t.getApplyArg(1),e.out(),e.setCurrentContent(u),t.layout(),e.onSelect(u);if(!(r.isAssoc()&&r.getApplyIndex(u)>1)){e.setLeft(),e.onLeaf();return}e.onSiblingLeft(),t=r,r=t.getParent(),s=t.getApplyArgc();if(t.getOp()===n.getOp())return}if(s!==1&&o===1&&t.isAssoc()){var h=n.getOp(),p=n.getAdditiveOp();if(p){a=f.user(p.getName());var d=this.getHistory().getCount();et.process(a,this.getModel());if(h===p){tt=!1;return}while(this.getHistory().getCount()>d)this.getHistory().pop()}e.onSiblingRight(),this.update(),e.onSiblingLeft();return}if(s===2&&o===2){var v=r.getApplyIndex(t),m,g,y,b,w,E,S,x,T;while(this.getModel().isSelectable(r)&&i.useParensTemplate(v,r,n)){m=r.getApplyArgc(),l=e.getSelectionSide(),g=r.getApplyArg(1),y=r.getApplyArg(m),b=t.getApplyArg(1),w=t.getApplyArg(2),E=e.getHeadReference(-3),S=e.isExtendRowRefer(E);if(m===1)x=r.createApply(r.getHead(),b),T=t.createApply(t.getHead(),x,w),e.out(),e.out(),e.setCurrentContent(T),e.onSelect(x),e.onSiblingRight();else if(S&&v>1)e.extendToContent(g,b),this.editGroup();else{if(!(S&&v<m))break;e.extendToContent(w,y),this.editGroup()}e.setSelectionSide(l),t=e.getParentContent(),r=t.getParent(),v=r.getApplyIndex(t)}e.out()}else if(s>2&&o===2){var N=e.getHeadIndex(),C=null,k=null,L=e.getCurrentContent().isOp()?1:0;C=e.getSiblingReference(N-L).getContent(),k=e.getSiblingReference(N+1).getContent(),l=e.getSelectionSide(),e.extendToContent(C,k);var A=t.getApplyIndex(C),O=t.getApplyIndex(k);if(A<=0||O<=0)return;var M=i.useParensTemplate(A,t,n),_=i.useParensTemplate(O,t,n);u=t,M&&A>1&&(this.assocLeftNth(t,A),s=s-A+1,A=1,O=2),_&&O<s&&(this.assocRightNth(t,O),s=O),s>2&&(this.assocInsert(t,A,O),u=t.getApplyArg(A)),t.layout(),r=t,t=u,e.onSelect(u),e.setSelectionSide(l)}else e.out();u=n.applyInfix(t),this.setCurrent(u),e.onSelect(u.getOper());var D=null;u.isApplyArgc(2)&&u===e.getCurrentContent()&&(D=u.getApplyArg(2).getOper(),e.onSelect(D));if(r.isAssoc()&&r.getOp()===n.getOp()&&r.getClass()===n.getClass()&&!c){var P=r.getApplyIndex(u);this.assocRemove(r,P),r.layout(),D?e.onSelect(D):s>1?(e.onSelect(r.getApplyArg(P)),e.onSiblingRight()):(e.onSelect(r.getApplyArg(P)),e.onSiblingLeft())}},et.prototype.applyInfix=function(e){var t=e.createApplyOp(this.getOp());t.suspend(),t.addAttributes(this);var n=this.getApplyArgc(),r,i,s,o;for(i=1;i<=n;i+=1)s=this.getApplyArg(i),r=e.getApplyArg(i)||e.createPlace(),o={},o[$]=r,o[J]=r,o[Q]=r,t.addChild(t.subst(o,s));return t.resume(),t},et.prototype.updateCommand=function(){var e=this.getTarget().getNthPattern(0);e===f._cursor&&this.updateCursor(),e===f._select&&this.updateSelect(),e===f._array&&this.updateArray(),e===f._assoc&&this.updateAssoc(),e===f._nary&&this.updateNary(),e===f._imath&&this.updateMath(),e===f._text&&this.updateText(),e===f._edit&&this.updateEdit(),e===f._echo&&this.updateEcho()},et.prototype.updateCursor=function(){var e=this.getSelection(),t=this.getTarget().getNthPattern(1);if(t===null)return;t===f._inone&&this.getPhase()===f._pre&&(tt=!1),t===f._out&&e.onOut(),t===f._in&&e.onIn(),t===f._iroot&&e.onRoot(),t===f._last&&this.updateCursorLast(),t===f._done&&e.onDone(),t===f._clear&&this.updateCursorClear();var n=this.getTarget().getNthPattern(2),r=this.getTarget().getNthPattern(3);if(n===null&&t!==f._leaf)return;t===f._doc&&(n===f._left&&(e.onDocLeft(),r===f._leaf&&this.updateCursorLast()),n===f._right&&(e.onDocRight(),r===f._leaf&&this.updateCursorLast()),n===f._home&&e.onDocHome(),n===f._end&&e.onDocEnd()),t===f._sibling&&(n===f._left&&e.onSiblingLeft(),n===f._right&&e.onSiblingRight(),n===f._home&&e.onSiblingHome(),n===f._end&&e.onSiblingEnd()),t===f._place&&(n===f._left&&e.onPlaceLeft(),n===f._right&&e.onPlaceRight());if(t===f._stop){var i=this.getTarget().getChild(1).getAttribute("class");if(i===null)return;n===f._left&&e.onStopLeft(i),n===f._right&&e.onStopRight(i)}t===f._extend&&(n===f._left&&e.onExtendLeft(),n===f._right&&e.onExtendRight(),n===f._inone&&e.onExtendNone()),t===f._present&&(n===f._left&&e.onPresentLeft(),n===f._right&&e.onPresentRight()),t===f._implicit&&(n===f._left&&e.onImplicitLeft(),n===f._right&&e.onImplicitRight()),t===f._leaf&&(n===f._side&&(e.isLeft()?e.onImplicitLeft():e.onImplicitRight()),n===f._left&&e.onDocLeft(),n===f._right&&e.onDocRight(),this.updateCursorLeaf())},et.prototype.updateCursorLeaf=function(){var e=this.getSelection();e.onLeaf();var t=g(this.getName(),null);if(t===null)return;var n=e.getParentContent().getOp();t===f._symbol&&(n===f._cn||n===f._ci)&&e.onOut(),t===f._number&&n===f._ci&&e.onOut()},et.prototype.updateCursorLast=function(){var e=this.getSelection();e.onLast(!1);var t=g(this.getName(),null);if(t===null)return;var n=e.getParentContent().getOp();(n===f._cn||n===f._ci)&&e.onOut()},et.prototype.updateCursorClear=function(){this.getModel().clearKeyHistory()},et.prototype.updateSelect=function(){var e=this.getSelection(),t=this.getModel(),n=e.getHeadReference(),r=e.getOtherReference(),i=this.getTarget().getNthPattern(1),s=this.getTarget().getNthPattern(2),o=e.getSelectionSide(),u=e.getChildCount(),a=s===f._right,l=s===f._left,c=i===f._out,h=e.getCurrentContent(),p=h.getOper(),d;for(d=u-1;d>=0;d-=1)e.getChildReference(d).getContent()===p&&(u-=1);if(i===f._present&&(l||a)){if(e.isImplicit()){o===a&&e.makeExplicit(),e.setSelectionSide(a),e.update();return}if(e.isExplicit()&&a!==o){var v=u===0||h.isApplyOp(f._mxf);u===1&&(v=h.isToken()),n===r&&!e.isExtendRowRefer(n)&&(v=!0);if(v){e.makeImplicit(),e.update();return}if(o){for(d=0;d<n.getReferenceCount();d+=1){r=n.getReference(d);if(r.getContent()!==p)break}r=e.getReferenceFirst(r),n=e.getReferenceLast(n)}else{for(d=n.getReferenceCount()-1;d>=0;d-=1){r=n.getReference(d);if(r.getContent()!==p)break}r=e.getReferenceLast(r),n=e.getReferenceFirst(n)}if(u===1){e.extendToReference(n,r),e.update();return}}}var m=r,g=n,y=!0;if(s===f._home||s===f._left)y=!1;if(s===f._end||s===f._right)y=!0;e.moveToReference(g),g.getContent().isToken()&&e.onIn(),e.setSelectionSide(y),this.updateCursor(),g=e.getHeadReference(),m.isTextMode()&&!g.isTextMode()&&(g=e.getMathReference(g),c=!0),!m.isTextMode()&&g.isTextMode()&&(m=e.getMathReference(m),c=!0),e.containsReference(n)?(y!==o||y===!1&&g.getContent().isApplyOp(f._p))&&this.updateCursor():c||e.onLeaf(),!c&&!e.isInReference(n)&&(g=e.getHeadReference()),e.setSelectionSide(o),e.onExtendReference(g,m),e.isExtended()&&!e.isExtendRow()&&(e.out(),e.makeExplicit(),e.update());var b=e.isDone(),w=g.getContent();b=b||!t.isSelectable(w),e.isComplex()&&(w=e.getComplexContent(),b=b||!t.isSelectable(w,!0)),b&&this.getHistory().restorePosition()},et.prototype.updateArray=function(){var e=this.getTarget().getNthPattern(1),t=this.getTarget().getNthPattern(2);e===f._cursor&&(t===f._elt?this.arrayCursorElt():t&&this.arrayCursor()),e===f._insert&&this.arrayInsert(),e===f._delete&&this.arrayDelete(),e===f._merge&&this.arrayMerge()},et.prototype.updateAssoc=function(){var e=this.getTarget().getNthPattern(1);if(e===null)return;var t=this.getSelection(),n=t.getParentContent(),r=t.getCurrentContent(),i=null,s=r,o=null,u=null,a=r.isAssoc(),l=n.isAssoc(),c=n.getApplyIndex(r),h;if(a&&e===f._flat)this.assocFlat(r);else if(a&&e===f._left)this.assocLeft(r);else if(a&&e===f._right)this.assocRight(r);else if(l&&e===f._head)this.assocLeftNth(n,c),s=n.getApplyArg(1);else if(l&&e===f._tail)this.assocRightNth(n,c),s=n.getTail();else if(l&&e===f._insert){c=t.getHeadIndex(),h=t.getOtherIndex();if(c>h){var p=c;c=h,h=p}var d=0,v;while(c<=h&&d<=0)v=t.getSiblingReference(c).getContent(),d=n.getApplyIndex(v),d<=0&&(c+=1);var m=0,g;while(c<=h&&m<=0)g=t.getSiblingReference(h).getContent(),m=n.getApplyIndex(g),m<=0&&(h-=1);if(d<=0||m<=0)return;d!==m&&this.assocInsert(n,d,m),o=u=s=n.getApplyArg(d)}else{if(!l||e!==f._delete)return;i=n,s=null;if(n.getOp()!==r.getOp())return;t.isRight()?(o=r.getTail(),u=r.getApplyArg(1)):(o=r.getApplyArg(1),u=r.getTail()),this.assocRemove(n,c)}i===null&&(i=r),n.suspend(),i.invalidate(),n.resume(),n.layout(),s&&t.onSelect(s),o&&u&&t.onExtend(o,u)},et.prototype.updateNary=function(){var e=this.getTarget().getNthPattern(1);e===f._insert&&this.naryInsert(),e===f._delete&&this.naryDelete()},et.prototype.updateMath=function(){var e=this.getTarget().getNthPattern(1);e===f._sense&&this.mathSense()},et.prototype.updateText=function(){var e=this.getTarget().getNthPattern(1);e===f._braille&&this.textBraille(),e===f._cursor&&this.textCursor(),e===f._extend&&this.textExtend(),e===f._insert&&this.textInsert(),e===f._delete&&this.textDelete(),e===f._split&&this.textSplit(),e===f._merge&&this.textMerge()},et.prototype.updateEdit=function(){var e=this.getTarget().getNthPattern(1);e===f._delete&&this.editDelete(),e===f._function&&this.editFunction(),e===f._undo&&this.editUndo(),e===f._redo&&this.editRedo(),e===f._reset&&this.editReset(),e===f._clear&&this.editClear(),e===f._cut&&this.editCut(),e===f._copy&&this.editCopy(),e===f._paste&&this.editPaste(),e===f._iroot&&this.editRoot(),e===f._select&&this.editSelect(),e===f._unselect&&this.editUnselect(),e===f._group&&this.editGroup(),e===f._ungroup&&this.editUngroup(),e===f._merge&&this.editMerge(),e===f._split&&this.editSplit(),e===f._quote&&this.editQuote(),e===f._keyboard&&this.editKeyboard(),e===f._content&&this.editContent(),e===f._present&&this.editPresent(),e===f._popup&&this.editPopup(),e===f._mode&&this.showKeyMode()},et.prototype.updateEcho=function(){var e=this.getTarget().getNthPattern(1);e===f._content&&this.updateEchoContent(),e===f._context&&this.updateEchoContext(),e===f._actions&&this.updateEchoActions(),e===f._keys&&this.updateEchoKeys()},et.prototype.updateEchoContent=function(){var e=this.getModel(),t=this.getSelection(),n=t.getHeadReference(1);M(e,n)},et.prototype.updateEchoContext=function(){var e=this.getModel(),t=this.getSelection(),n=t.getHeadReference();M(e,n)},M=function(t,r){var i=t._editor.getPanel(n.INPUT),o=t._editor.getPanel(n.SPEECH),u=t._editor.getProxy(),a=r.getPresent().replaceBox();a.isSymbol()&&(a=a.createApplyOp(f._mtext,a)),a=a.createApplyOp(f._math,a);var l=p.toString(a.markup()),c=s(".MathJax_CHTML",i).clone();c.children(".mjx-math").remove(),c.attr("data-mathml",l);var h=s(".MJX_Assistive_MathML",c);h.empty(),h.append(l),o.children(".MathJax_CHTML").remove(),o.children("span").empty(),o.append(c),c[0].focus(),e.runOnce(1e3,function(){u[0].focus()})},et.prototype.updateEchoActions=function(){var e=this.getModel(),t=!e.getEchoAction();e.setEchoAction(t);var n="Echo input actions "+(t?"on":"off");_(e,n)},et.prototype.echoAction=function(e,t){var n=this.getApplyArg(3);if(n&&n.findOp(f._side)&&this!==D&&!t){D=this;return}if(n&&n.isApplyOp(f._speech)){this.updateTarget();var r=this.getAssoc();n=n.subst(r,n)}this.echoMessageList(e,n)},_=function(e,t){var r=e._editor.getPanel(n.SPEECH),i=r.children("span");P(i,t)};var st=null;et.prototype.echoMessageList=function(e,t){var n=this.getPhase();if(st&&!n){st=null;return}if(!t||!t.isApplyOp(f._speech))return;st=n;var i=t.getApplyArgc(),s,o,u,a,l,c,h="";for(o=1;o<=i;o+=1){a=t.getApplyArg(o);if(r.prototype.isToken.apply(a)){s=a.getApplyArgc();for(u=s;u>=1;u-=1)t.insertChildAfter(a,a.getApplyArg(u));i=t.getApplyArgc();continue}if(a.isPlace())l="box";else{if(a.isApply()){c=et.selectSpeech(a,e);if(c){s=c.getApplyArgc();for(u=s;u>=1;u-=1)t.insertChildAfter(a,c.getApplyArg(u))}i=t.getApplyArgc();continue}a.isSymbol()?l=a.getString():l=a.toString()}l==="."&&(l="point"),h+=l+" "}_(e,h)};var ot=[],ut=0;P=function(e,t){t&&(ot.push(t),H(e))},H=function(t){ut===0&&(ut=e.runEvery(300,j.bind(this,t)))},B=function(){e.stopThread(ut),ut=0},j=function(e){var t=ot.shift();t?(e.empty(),e.append(t)):(e.empty(),B())},et.clearQueue=function(e){var t=e._editor.getPanel(n.SPEECH),r=t.children("span");ot=[],r.empty(),B()},et.prototype.echoMessageDeleted=function(e,t,n){var r=this.getModel();if(!r.getEchoAction())return;if(this.getPhase()===f._post)return;var i=this.getApplyArg(3);if(i&&i.isApplyOp(f._speech)&&i.getApplyArgc()>0)return;var s=e.createSymbol(f.get(t?"delete":"backspace"));e=e.createApplyOp(f._speech,s,e.replaceResult(n)),this.echoMessageList(r,e)},et.prototype.updateEchoKeys=function(){console.log("update echo keys")},et.prototype.arrayCursorElt=function(){var e=this.getCurrent();while(e!==null&&!v.isArray(e))e=e.getParent();var t=this.getSelection();t.onSelect(e)},et.prototype.arrayCursor=function(){var e=this.getSelection(),t=e.getParentContent(),n=e.getCurrentContent(),r=t.getRowIndex(n),i=t.getColIndex(n),s=t.getRowCount(),o=t.getColCount(r),u=this.getTarget().getNthPattern(2);u===f._up&&r>1&&(r-=1),u===f._down&&r<s&&(r+=1),u===f._left&&i>1&&(i-=1),u===f._right&&i<o&&(i+=1),e.onSelect(t.getElt(r,i))},et.prototype.arrayInsert=function(){var e=this.getTarget().getNthPattern(2),t=this.getTarget().getNthPattern(3);if(e===null||t===null)return;var n=this.getSelection(),r=n.getParentContent(),i=n.getCurrentContent(),s=r.getRowIndex(i),o=r.getColIndex(i),u=r.getColCount(s);r.suspend(),t===f._left&&(e===f._row&&r.insertRowBefore(s),e===f._col&&r.insertColBefore(o),e===f._elt&&r.insertEltBefore(s,o)),t===f._right&&(e===f._row&&(r.insertRowAfter(s),s+=1),e===f._col&&(r.insertColAfter(o),o+=1),e===f._elt&&(r.insertEltAfter(s,o),o+=1)),t===f._wrap&&(e===f._row&&(o=r.insertRowWrap(s),s+=1),e===f._col&&(o===u&&(s=r.insertColWrap(o)),o+=1)),r.resume(),r.layout(),n.onSelect(r.getElt(s,o))},et.prototype.arrayDelete=function(){var e=this.getTarget().getNthPattern(2),t=this.getTarget().getNthPattern(3);if(e===null||t===null)return;var n=this.getSelection(),r=n.getParentContent(),i=n.getCurrentContent(),s=r.getRowIndex(i),o=r.getColIndex(i),u=r.getRowCount(),a=r.getColCount(s);r.suspend(),t===f._right&&(e===f._row&&u>1&&(r.removeRow(s),s===u&&(s-=1)),e===f._col&&a>1&&(r.removeCol(o),o===a&&(o-=1)),e===f._elt&&a>1&&(r.removeElt(s,o),o===a&&(o-=1)),e===f._wrap&&(a>1?r.removeElt(s,o):u>1&&r.removeRow(s),o===a&&(s<u?(a>1&&(s+=1),o=1):o>1?o-=1:s>1&&(s-=1,o=r.getColCount(s))))),t===f._left&&(e===f._row&&u>1&&(r.removeRow(s),s>1&&(s-=1)),e===f._col&&a>1&&(r.removeCol(o),o>1&&(o-=1)),e===f._elt&&a>1&&(r.removeElt(s,o),o>1&&(o-=1)),e===f._wrap&&(a>1?r.removeElt(s,o):u>1&&r.removeRow(s),o>1?o-=1:s>1&&(s-=1,o=r.getColCount(s))));var l=r.getElt(s,o);r.resume(),r.layout(),n.onSelect(l),l!==i&&n.onLeaf()},et.prototype.arrayMerge=function(){var e=this.getSelection(),t=this.getCurrent(),n=e.getSelectionSide(),r=t,i=null,s=null,o=null;while(r&&!r.isTable())o=s,s=i,i=r,r=r.getParent();var u=r.getApplyIndex(i),a=0,l=null,c=null,h=null,p=0,d=null,v=null,m=null;n?(a=u,l=i,c=s,h=o,p=u+1,d=r.getApplyArg(p),v=d.getApplyArg(1),m=v.getApplyArg(1),t=e.getLeafLast(t)):(p=u,d=i,v=s,m=o,a=u-1,l=r.getApplyArg(a),c=l.getApplyArg(1),h=c.getApplyArg(1),t=e.getLeafFirst(t)),r.suspend(),o=this.merge(h,m),s=o.createApplyOp(f._mtd,o),i=s.createApplyOp(f._mtr,s),r.insertChildAfter(l,i),r.removeChild(l),r.removeChild(d),r.resume(),r.layout(),e.moveToContent(t),e.setSelectionSide(n)},et.prototype.assocFlat=function(e){var t=e.getApplyArgc(),n,r;for(n=t;n>=1;n-=1)r=e.getApplyArg(n),e.getOp()===r.getOp()&&e.getClass()===r.getClass()&&(this.assocFlat(r),this.assocRemove(e,n))},et.prototype.assocLeft=function(e){this.assocFlat(e);var t=e.getApplyArgc(),n;for(n=2;n<=t-1;n+=1)this.assocLeftNth(e,2)},et.prototype.assocRight=function(e){this.assocFlat(e);var t=e.getApplyArgc(),n;for(n=t-1;n>=2;n-=1)this.assocRightNth(e,n)},et.prototype.assocLeftNth=function(e,t,n){var r=e.createApplyOp(n||e.getOp());e.suspend(),r.suspend(),r.addAttributes(e);var i;for(i=1;i<=t;i+=1)r.addChild(e.removeChildAt(1));e.insertChildAt(1,r),r.resume(),e.resume()},et.prototype.assocRightNth=function(e,t,n){var r=e.createApplyOp(n||e.getOp());e.suspend(),r.suspend(),r.addAttributes(e);var i=e.getApplyArgc(),s;for(s=t;s<=i;s+=1)r.addChild(e.removeChildAt(t));e.addChild(r),r.resume(),e.resume()},et.prototype.assocRemove=function(e,t,n){var r=e.getApplyArg(t),i=r.getApplyArgc();if((n||e.getOp())!==r.getOp())return;e.suspend(),r.suspend();var s;for(s=1;s<=i;s+=1)e.insertChildBefore(r,r.removeChildAt(1));e.removeChild(r),r.resume(),e.resume()},et.prototype.assocInsert=function(e,t,n,r){this.assocLeftNth(e,n,r),this.assocRightNth(e.getApplyArg(1),t,r),this.assocRemove(e,1,r)},et.prototype.naryInsert=function(){var e=this.getTarget().getNthPattern(2);e===f._left&&this.naryInsertLeft(),e===f._right&&this.naryInsertRight()},et.prototype.naryInsertLeft=function(){var e=this.getSelection(),t=e.getParentContent(),n=e.getCurrentContent(),r=null,i=null,s=t.getNaryMax();t.suspend(),s===0&&(i=r=n.createPlace(),t.insertChildBefore(n,r)),t.addAttributes(this.getTarget()),t.resume(),i&&(t.layout(),e.onSelect(i))},et.prototype.naryInsertRight=function(){var e=this.getSelection(),t=e.getParentContent(),n=e.getCurrentContent(),r=null,i=null,s=t.getApplyIndex(n),o=t.getApplyArgc(),u=t.getNaryMax(),a,f;t.suspend();if(u===0||s===o&&o<u){var l=t.getParent();t.isBinding()&&o===1?(a=t.getBindingVar(),f=t.getBindingList(),i=n.createPlace(),r=n.createApplyOp(a,i),r=n.createApplyOp(f,r)):l&&l.isBinding()&&(a=l.getBindingVar(),f=l.getBindingList(),t.getOp()===f&&(i=n.createPlace(),r=n.createApplyOp(a,i))),r===null&&(i=r=n.createPlace()),t.insertChildAfter(n,r)}u>0&&s===o&&o===u&&(i=t),t.addAttributes(this.getTarget()),t.resume(),i&&(t.layout(),e.onSelect(i))},et.prototype.naryDelete=function(){var e=this.getTarget().getNthPattern(2);e===f._left&&this.naryDeleteLeft(),e===f._right&&this.naryDeleteRight()},et.prototype.naryDeleteLeft=function(){var e=this.getSelection(),t=e.getParentContent(),n=e.getCurrentContent(),r=null,i=null,s=t.getApplyIndex(n),o=t.getApplyArgc(),u,a=1,f=t.getNaryMax();f===100&&(a=2,f=0);if(f===0||s===o&&o>=a)if(o===a&&t.isNullary())i=r=n.createPlace();else if(o===a&&a===1&&n.isPlace())i=r=t.createPlace(),n=t,e.out();else if(o===a)i=r=t.getApplyArg(1),n=t,e.out();else{if(e.isApplyFirst()&&!e.isNaryFirst()){e.out(),this.naryDeleteLeft(),e.getCurrentContent()!==n&&e.inn(0),e.update();return}if(e.isApplyFirst()&&!n.isPlace())i=r=n.createPlace();else if(o===1)e.out(),i=r=n.createPlace();else if(o===2&&t.isBinary()){u=s===1||e.isLeft()?2:1,i=r=t.getApplyArg(u),n=t,e.out(),u===1?i=e.getLeafLast(i):i=e.getLeafFirst(i),r.suspend();var l=r.getApplyOp();l&&l.invalidate(),r.resume(),r.layout()}else u=s,s>1&&(s-=1,u=e.getNextIndex(s)),t.suspend(),t.removeChildAt(u),i=t.getApplyArg(s),t.resume(),t.layout(),s===u?i=e.getLeafFirst(i):i=e.getLeafLast(i)}r&&(this.echoMessageDeleted(n,!1,r),e.setCurrentContent(r)),e.onSelect(i),r||this.echoMessageDeleted(t,!1)},et.prototype.naryDeleteRight=function(){var e=this.getSelection(),t=e.getParentContent(),n=e.getCurrentContent(),r=null,i=null,s=t.getApplyIndex(n),o=t.getApplyArgc(),u,a=1,f=t.getNaryMax();f===100&&(a=2,f=0);if(f===0||s===1&&o>=a)if(o===a&&t.isNullary())i=r=n.createPlace();else if(o===a&&a===1&&n.isPlace())i=r=t.createPlace(),n=t,e.out();else if(o===a)i=r=t.getApplyArg(1),n=t,e.out();else{if(e.isApplyLast()&&!e.isNaryLast()){e.out(),this.naryDeleteRight(),e.getCurrentContent()!==n&&e.inn(-1),e.update();return}if(e.isApplyLast()&&!n.isPlace())i=r=n.createPlace();else if(o===1)e.out(),i=r=n.createPlace();else if(o===2&&t.isBinary()){u=s===2||e.isRight()?1:2,i=r=t.getApplyArg(u),n=t,e.out(),u===1?i=e.getLeafLast(i):i=e.getLeafFirst(i),r.suspend();var l=r.getApplyOp();l&&l.invalidate(),r.resume(),r.layout()}else u=s,s===o?s-=1:u=e.getNextIndex(s),t.suspend(),t.removeChildAt(u),i=t.getApplyArg(s),t.resume(),t.layout(),s===u?i=e.getLeafFirst(i):i=e.getLeafLast(i)}r&&(this.echoMessageDeleted(n,!0,r),e.setCurrentContent(r)),e.onSelect(i),r||this.echoMessageDeleted(t,!0)},et.prototype.mathSense=function(){var e=this.getTarget().getNthPattern(2);e===f._mathit&&this.mathSenseMathIt(),e===f._detect&&this.mathSenseDetect(),e===f._abbrev&&this.mathSenseAbbrev(),e===f._accept&&this.mathSenseAccept()},et.prototype.mathSenseMathIt=function(){var e=this.getModel();if(!e.getMathIt())return;this.textSelectWord(),this.textInsertMath()},et.prototype.mathSenseDetect=function(){var e=this.getModel();e.getMathSense()?this.mathSenseSuggest():e.getMathIt()||this.textInsertMath()},et.prototype.mathSenseAbbrev=function(){var e=this.getModel();if(!e.getMathSense())return;var t=this.getSelection(),n=t.getParentContent(),r=t.getCurrentContent(),i=n.getApplyIndex(r);R=q;var s="",o=[],a,l,c,h;for(a=i;a>=1;a-=1){l=n.getApplyArg(a);if(!l.isText())break;c=l.getString();if(c.length!==1)break;h=c.charCodeAt();if(!u.isLetter(h))break;if(h===u.space)break;s=c+s,(f._functions[s]||f._units[s])&&o.unshift(s)}o.length>0&&(this.getAssoc()[Y]=o,this.mathSenseSuggest())},et.prototype.mathSenseSuggest=function(){if(q)return;var t=this.getModel(),n=this.mathSenseCollect();R=!0,e.runOnce(500,function(){F(t,n,"ee-markup",!0)}),tt=!1},et.prototype.mathSenseCollect=function(){var e=this.getAssoc()[$].getString(),t=this.getBaseName().getName(),n=W[t]||this.getAssoc()[Y];z=n;var r=[];return r.push("<p>Did you mean?</p>"),r.push("<ol>"),o.each(n,function(t){o.isArray(t)&&(t=t[0]),r.push("<li>"),r.push(t.replace("_x",e)),r.push("</li>")}),r.push("</ol>"),r.join("")},W={"+":[["_x + []","_x plus"],["+ []","uplus"],["positive _x","positive _x"],["positive []","positive"]],"-":[["_x - []","_x minus"],["- []","uminus"],["negative _x","negative _x"],["negative []","negative"]],"*":[["_x &it; []","_x times"],["_x &times; []","_x times-sign"],["_x &sdot; []","_x times-sdot"],["_x &lowast; []","_x times-ast"]],"/":[["_x &divide; []","_x divide-sign"],["_x &frasl; []","_x divide-slash"],["_x \\over []","_x divide"],["_x [] \\over []","divide"]],"\\":[["_x &divide; []","_x divide-sign"],["_x &frasl; []","_x divide-slash"],["_x \\over []","_x divide"],["_x [] \\over []","divide"]],"^":[["_x<sup>[]</sup>","_x power"]],"`":[["_x &#x221A; [] ","_x sqrt"],["&#x221A; _x","sqrt _x"]],"=":[["_x = []","_x eq"],["_x &ne; []","_x neq"]],"<":[["_x &lt; []","_x lt"],["_x &le; []","_x leq"]],">":[["_x &gt; []","_x gt"],["_x &ge; []","_x geq"]],"(":[["_x ( [] )","_x paren"],["( _x )","paren _x"]],"[":[["_x [ [] ]","_x bracket"],["[ _x ]","bracket _x"]],"{":[["_x { [] }","_x brace"],["{ _x }","brace _x"]],"|":[["_x | [] |","_x abs"],["| _x |","abs _x"]],"!":[["_x !","_x factorial"]],_:[["_x<sub>[]</sub>","_x subscript"]]},et.prototype.mathSenseAccept=function(){var e=this.getModel();if(!e.getMathSense()||!U)return;var t=this.getSelection(),n=this.getHistory(),r=t.getParentContent(),i=t.getCurrentContent(),s=r.getApplyIndex(i),u=r.getApplyArg(s-1).getString(),a=this.getBaseName().getName(),l=U[a-1],c=l.length,h;o.isArray(l)?(l=l[1],l.indexOf("_x")===-1?c=1:l=l.replace("_x",u),l=l.split(" ")):l=l.split("");var p=n.getCount(),d=n.getIndex();r.suspend();for(h=0;h<c;h+=1)r.removeChildAt(s),s-=1;var v=r.getChild(s);l.unshift("ctrl-m"),r.resume(),r.layout(),t.moveToContent(v);while(l.length>0)et.process(f.user(l.shift()),e);n.removeNewer(p),n.setIndex(d)},et.prototype.textBraille=function(){var e=this.getTarget().getNthPattern(2);e===f._up&&this.textBrailleUp(),e===f._down&&this.textBrailleDown()},et.prototype.textBrailleUp=function(){var e=this.getModel(),t=e.getHandler(),n=e.getSelection(),r=n._brailleBar,i=r._brailleString.s,s=t.getProxyIndex(),o=n.getSelectionSide(),u=n.isPlace();o&&!u&&(s-=1);var a=i.lastIndexOf("\n",s-1);a!==-1&&(s-=a+1),a=i.lastIndexOf("\n",a-1),a!==-1&&(s+=a+1),a=i.indexOf("\n",a+1),a<=s&&(s=a-1),o&&!u&&(s+=1),r.route(s)},et.prototype.textBrailleDown=function(){var e=this.getModel(),t=e.getHandler(),n=e.getSelection(),r=n._brailleBar,i=r._brailleString.s,s=t.getProxyIndex(),o=n.getSelectionSide(),u=n.isPlace();o&&!u&&(s-=1);var a=i.lastIndexOf("\n",s-1);a!==-1&&(s-=a+1),a=i.indexOf("\n",a+1);if(a===-1)return;s+=a+1,a=i.indexOf("\n",a+1),a===-1&&(a=i.length),a<=s&&(s=a-1),o&&!u&&(s+=1),r.route(s)},et.prototype.textCursor=function(){var e=this.getTarget().getNthPattern(2);e===f._up&&this.textCursorUp(),e===f._down&&this.textCursorDown(),e===f._left&&this.textCursorLeft(),e===f._right&&this.textCursorRight()};var at=function(e,t){var n=e.getReference(t);if(n===null)return null;var r=n.getDisplay();return r===null?null:r.getBox()},ft=function(e,t,n){t===-1&&(t=0),n===e.getReferenceCount()&&(n-=1);var r=at(e,t),i=at(e,n);if(r===null||i===null)return!1;var s=r.top,o=s+r.height-.5,u=i.top,a=u+i.height-.5;return s<=a&&u<=o},lt=function(e,t,n,r){var i=t===-1&&n===e.getReferenceCount(),s,o,u,a;while(n-t>1){s=Math.round((t+n)/2),o=at(e,s);if(o===null)break;u=o.left,a=u+o.width;if(r<u)n=s;else{if(!(a<r))return e.getReference(s).getContent();t=s}}return n-t===1&&i?(t===-1&&(t=0),e.getReference(t).getContent()):null},ct=function(e,t,n,r,i,s){if(ft(e,t,n))return lt(e,t,n,r);var o=t,u=n,a,f,l,c,h,p;while(u-o>1){a=Math.round((o+u)/2),f=at(e,a);if(f===null)break;l=f.left,c=f.top,h=l+f.width,p=c+f.height-.5;if(l<=r&&r<=h&&c<=i&&i<=p)return e.getReference(a).getContent();if(i<c||i<=p&&r<l)u=a;else{if(!(i>p||i>=c&&r>h))break;o=a}}for(a=o+1;a<u;a+=1){f=at(e,a);if(f===null)continue;l=f.left,c=f.top,h=l+f.width,p=c+f.height-.5;if(l<=r&&r<=h&&c<=i&&i<=p)return e.getReference(a).getContent()}if(u-o===1){if(o===-1)return null;f=at(e,o);if(f===null)return null;c=f.top,p=c+f.height-.5;if(s===!0&&c<=i||s===!1&&i<=p)return e.getReference(o).getContent()}return null},ht=function(e,t,n,r,i,s){var o=t,u=n,a,f,l,c;while(u-o>1){a=Math.round((o+u)/2),f=at(e,a);if(f===null)break;l=f.top,c=l+f.height-.5;if(l>=i||c>=r&&s===!0)u=a;else{if(!(c<=r||l<=i&&s===!1))break;o=a}}return f=at(e,s?o:u),f===null?s?r-4:r+4:(l=f.top,c=l+f.height,s?c-4:l+4)},pt=function(e,t){var n=e.getPresent(),r,i,s=n.getReferenceCount(),o,u,a=0,f;for(u=0;u<s;u+=1){o=n.getReference(u),r=o.getDisplay();if(r===null)continue;i=r.getBox();if(i===null)continue;f=i.left+i.width;if(a<=t&&t<f)return e=r.getRefer().getPresent().getContent(),pt(e,t);a=f}return e};et.prototype.textCursorUp=function(){var e=this.getSelection(),t=e.getParentContent(),n=this.getCurrent(),r=t.getApplyIndex(n),i=t.getPresent(),o=i.getReference(r-1).getDisplay();if(o===null)return;var u=-1,a=r-1,l=o.getBox(),c=l.top,h=c+l.height-.5;if(n.isApplyOp(f._math)){var d=e.getParentReference().getDisplay().getXML(),v=V.getDisplay().getXML();v=p.createSpan(v),l=p.getOffsets(v,d),p.removeSpan(v)}var m=l.left+l.width/2,g=ht(i,u,a,c,h,!0),y=ct(i,u,a,m,g,!0);if(y){y.isApplyOp(f._math)&&(y=pt(y,m)),y.getString()===" "&&(r=t.getApplyIndex(y),r>1&&(y=t.getApplyArg(r-1))),e.onSelect(y);return}var b=t.getParent();if(b.getOp()===t.getOp())return;var w=b.getApplyIndex(t);if(w===1)return;t=b.getApplyArg(w-1),i=t.getPresent(),o=b.getPresent().getReference(w-2).getDisplay(),g=s(o.getXML()).height()-4,u=-1,a=t.getApplyArgc(),y=ct(i,u,a,m,g,!0),y&&(y.isApplyOp(f._math)&&(y=pt(y,m)),e.onSelect(y))},et.prototype.textCursorDown=function(){var e=this.getSelection(),t=e.getParentContent(),n=this.getCurrent(),r=t.getApplyIndex(n),i=t.getApplyArgc(),s=t.getPresent(),o=s.getReference(r-1).getDisplay();if(o===null)return;var u=r-1,a=i,l=o.getBox(),c=l.top,h=c+l.height-.5;if(n.isApplyOp(f._math)){var d=e.getParentReference().getDisplay().getXML(),v=V.getDisplay().getXML();v=p.createSpan(v),l=p.getOffsets(v,d),p.removeSpan(v)}var m=l.left+l.width/2,g=ht(s,u,a,c,h,!1),y=ct(s,u,a,m,g,!1);if(y){y.isApplyOp(f._math)&&(y=pt(y,m)),y.getString()===" "&&(r=t.getApplyIndex(y),r>1&&(y=t.getApplyArg(r-1))),e.onSelect(y);return}var b=t.getParent();if(b.getOp()===t.getOp())return;var w=b.getApplyIndex(t);if(w===b.getApplyArgc())return;t=b.getApplyArg(w+1),s=t.getPresent(),g=4,u=-1,a=t.getApplyArgc(),y=ct(s,u,a,m,g,!1),y&&(y.isApplyOp(f._math)&&(y=pt(y,m)),e.onSelect(y))};var dt=function(e){var t=e.getString();return t===null||t.charCodeAt()===u.space},vt=function(e){var t=e.getString();if(t===null)return!0;var n=t.charCodeAt();return u.isLetter(n)||u.isDigit(n)?!0:!1};return et.prototype.textCursorLeft=function(){var e=this.getSelection(),t=e.getParentContent(),n=this.getCurrent(),r=t.getApplyIndex(n),i=null,s,o=t.getParent(),u=o.getApplyIndex(t),a=null,f,l;for(f=u;f>=1;f-=1){a=o.getApplyArg(f),s=f===u?r-1:a.getApplyArgc();for(s;s>=1;s-=1){i=a.getApplyArg(s);if(vt(i))l=i;else if(l){e.setLeft(),e.onSelect(l);return}}if(l){e.setLeft(),e.onSelect(l);return}}i&&(e.setLeft(),e.onSelect(i))},et.prototype.textCursorRight=function(){var e=this.getSelection(),t=e.getParentContent(),n=this.getCurrent(),r=t.getApplyIndex(n),i=null,s,o,u=t.getParent(),a=u.getApplyArgc(),f=u.getApplyIndex(t),l=null,c,h;for(c=f;c<=a;c+=1){l=u.getApplyArg(c),o=l.getApplyArgc(),s=c===f?r+1:1;for(s;s<=o;s+=1){i=l.getApplyArg(s);if(vt(i))h=i;else if(h){e.setRight(),e.onSelect(h);return}}if(h){e.setRight(),e.onSelect(h);return}}i&&(e.setRight(),e.onSelect(i))},et.prototype.textSplit=function(){var e=this.getSelection(),t=this.getCurrent(),n=e.getParentContent(),r=n.getParent(),i=n.getApplyIndex(t),s=e.getSelectionSide(),o=!0;r.suspend();var u=n.createApplyOp(n.getOp()),a=s?i+1:i,l=n.getApplyArgc(),c;for(c=a;c<=l;c+=1)u.addChild(n.removeChildAt(a)),o=!1;n.getApplyArgc()===0&&n.addChild(n.createPlace()),u.getApplyArgc()===0&&u.addChild(u.createPlace()),r.insertChildAfter(n,u),r.resume(),r.layout(),e.moveToContent(u.getChild(1)),e.setSelectionSide(o),u.getOp()!==f._p&&(e.onOut(),this.textSplit())},et.prototype.textMerge=function(e){var t=this.getSelection(),n=this.getCurrent(),r=t.getParentContent(),i=r.getParent(),s=t.getSelectionSide();while(i&&n.isMathMode())t.onOut(),n=this.getCurrent(),r=t.getParentContent(),i=r.getParent();if(i&&r.getOp()!==f._p){t.onOut();if(!this.textMerge(!0))return t.moveToContent(n),!1;var o=t.getParentContent(),u=t.getCurrentContent(),a=o.getApplyIndex(u);if(a>1&&o.getApplyArg(a-1).isApplyOp(f._input))return!0;t.onIn(),i=r.getParent()}var l=r.getApplyIndex(n),c=r.getApplyArgc(),h=i.getApplyIndex(r),p=i.getApplyArgc(),d=h+(s?0:-1),v=h+(s?1:0),m=s?c:1;if(1<=d&&v<=p&&l===m){var g=i.getApplyArg(d),y=i.getApplyArg(v);if(g.getOp()!==y.getOp())return g.isPlace()||(i.suspend(),i.insertChildBefore(y,i.createPlace()),i.resume(),i.layout()),t.moveToContent(y),!1;i.suspend(),c=g.getApplyArgc(),!e&&(c!==1||!g.getChild(1).isPlace())&&g.addChild(r.createPlace()),c=y.getApplyArgc();if(c===0||y.getChild(1).isPlace())s=!0,n=g.getChild(g.getApplyArgc());var b,w;for(b=1;b<=c;b+=1)w=y.removeChildAt(1),w.isPlace()||g.addChild(w);return i.removeChild(y),i.resume(),i.layout(),t.moveToContent(n),t.setSelectionSide(s),!0}return!1},et.prototype.textExtend=function(){var e=this.getTarget().getNthPattern(2);e===f._up&&this.textExtendUp(),e===f._down&&this.textExtendDown()},et.prototype.textExtendUp=function(){var e=this.getSelection(),t=e.getParentContent(),n=e.getLeftContent(),r=e.getRightContent();e.isComplex()&&(n=e.getComplexLeft().getContent(),r=e.getComplexRight().getContent());if(e.isRight()&&n!==r){var i=n;n=r,r=i}var o=t.getApplyIndex(n),u=t.getPresent(),a=u.getReference(o-1).getDisplay();if(a===null)return;var f=a.getBox(),l=f.left+f.width/2,c=f.top-4,h=-1,p=o-1,d=ct(u,h,p,l,c,!0);if(d){e.onExtend(d,r),e.getCurrentContent()===r&&e.setLeft();return}var v=t.getParent(),m=v.getApplyIndex(t);if(m===1)return;t=v.getApplyArg(m-1),u=t.getPresent(),a=v.getPresent().getReference(m-2).getDisplay(),c=s(a.getXML()).height()-4,h=-1,p=t.getApplyArgc(),d=ct(u,h,p,l,c,!0),d&&(e.onExtend(d,r),e.getCurrentContent()===r&&e.setLeft())},et.prototype.textExtendDown=function(){var e=this.getSelection(),t=e.getParentContent(),n=e.getRightContent(),r=e.getLeftContent();e.isComplex()&&(n=e.getComplexRight().getContent(),r=e.getComplexLeft().getContent());if(e.isLeft()&&n!==r){var i=n;n=r,r=i}var s=t.getApplyIndex(n),o=t.getApplyArgc(),u=t.getPresent(),a=u.getReference(s-1).getDisplay();if(a===null)return;var f=a.getBox(),l=f.left+f.width/2,c=f.top+f.height+4,h=s-1,p=o,d=ct(u,h,p,l,c,!1);if(d){e.onExtend(d,r),e.getCurrentContent()===r&&e.setRight();return}var v=t.getParent(),m=v.getApplyIndex(t);if(m===v.getApplyArgc())return;t=v.getApplyArg(m+1),u=t.getPresent(),c=4,h=-1,p=t.getApplyArgc(),d=ct(u,h,p,l,c,!1),d&&(e.onExtend(d,r),e.getCurrentContent()===r&&e.setRight())},et.prototype.textInsert=function(){var e=this.getTarget().getNthPattern(2);e===f._imath&&this.textInsertMath(),e&&e.getURI()===f.NS_HTML&&this.textInsertSpan(e)},et.prototype.textSelectWord=function(){var e=this.getSelection(),t=e.getParentContent(),n=e.getCurrentContent(),r=t.getApplyIndex(n),i=t.getApplyArgc(),s=r;for(s;s>=2;s-=1)if(dt(t.getApplyArg(s-1)))break;var o=r;for(o;o<i;o+=1)if(dt(t.getApplyArg(o+1)))break;e.moveToContent(t.getApplyArg(s)),e.extendToContent(t.getApplyArg(o)),e.update()},et.prototype.textInsertMath=function(){var e=this.getSelection(),t=this.getModel(),n=e.getParentContent(),r=e.getCurrentContent(),i=this.getBaseName(),s=i.getName().charAt(0),o=!1,a=null;if(!n||!r)return;if(r.isTheSymbol(f.get(" "))){if("([{".indexOf(s)!==-1)return;var l=n.getApplyIndex(r),c=n.getApplyArg(l-1);l>1&&c.isApplyOp(f._math)&&(n.suspend(),n.removeChildAt(l),n.resume(),n.layout(),e.moveToContent(c),r=c)}if(r.isApplyOp(f._math)){e.isExplicit()?(e.onIn(),e.makeExplicit()):(e.onLast(),e.isLeaf()&&e.onOut());return}e.isExplicit()||e.isExtended()?(a=e.getLeftContent(),r=e.getRightContent(),e.moveToContent(r),e.setRight()):s!=="m"?(et.processMain(i,t),t.getHistory().save(),r=e.getCurrentContent(),e.setRight(),o=!0):(et.processMain(f.info("_"),t),r=e.getCurrentContent(),e.setRight(),o=!0);var h=n.getApplyIndex(r),p=this.getHistory().getCount(),d=this.getHistory().getIndex();et.process(f.user("ctrl-m"),t);var v=e.getCurrentContent();n.suspend(),o&&(n.removeChildAt(h),h-=1);var m=!1,g=!1,y=!0,b=!1,w=!1,E=!1,S="",x=h+1,T=-1,N,C,k,L,A;for(C=h;C>=1;C-=1){b=!0,k=n.getApplyArg(C);if(!k.isText())break;L=k.getString();if(L.length!==1)break;A=L.charCodeAt(),a&&(x=C),y&&A===u.space&&(x=C),g=u.isLetter(A);if(g){if(E||w)if(x===C+1){C+=1,x=C+1;break}if(m||E||w)break;!S&&C===1&&(x=C),S=L+S,f._functions[S]&&(T=x,x=C),f._units[S]&&(T=x,x=C),T!==-1&&x-C>2&&(x=T,T=-1)}else N=S.length,0<N&&N<3&&!a&&(N===1||C+N===h)&&(x=C+1),S="";E=A===u.dot,(E&&m||A===u.dollar||A===u.percent||A===u.qmark||A===u.bang||A===u.lparen||A===u.lbrack||A===u.lbrace)&&x===C+1&&(x=C),w=A===u.comma,w&&m&&x===C+1&&(x=C),m=u.isDigit(A),m&&x===C+1&&(x=C),A===u.space?x===C+1&&(b=!1):y=!1;if(x!==C&&!g)break;x===C+1&&(b=!1);if(k===a){b=!1;break}}if(C===0){N=S.length;if(N<2||N===2&&N===h)x=1}var O=[],M,_;for(M=h;M>=x;M-=1)_=n.getApplyArg(M).getString(),n.removeChildAt(M),_!==" "&&O.push(_);b&&M>0&&n.insertChildAt(M+1,n.createString(" ")),n.resume(),n.layout(),e.moveToContent(v);var D="+-*/\\=<>([{";if(h>0&&O.length===0&&D.indexOf(s)!==-1)if(s!=="-"||M===h){this.editUndo(),this.editUndo(),p=this.getHistory().getIndex(),this.getHistory().removeNewer(p);return}while(O.length>0)_=O.pop(),et.process(f.user(_),t),_==="!"&&e.makeExplicit();v=e.getCurrentContent(),e.isToken()&&v.isTokenMode()&&e.onOut(),this.getHistory().removeNewer(p),this.getHistory().setIndex(d)},et.prototype.textInsertSpan=function(e){var t=this.getSelection(),n=this.getModel();this.editGroupExtend();var r=t.getParentContent(),i=t.getCurrentContent(),s=t.getHeadIndex(),o=t.getOtherIndex();if(s>o){var u=s;s=o,o=u}var a=0,l;while(s<=o&&a===0)l=t.getSiblingReference(s).getContent(),a=r.getApplyIndex(l),a===0&&(s+=1);var c=0,h;while(s<=o&&c===0)h=t.getSiblingReference(o).getContent(),c=r.getApplyIndex(h),c===0&&(o-=1);if(a===0||c===0)return;var p=null;if(a!==c)if(r.isApplyOp(f._body)){r.suspend();var d;for(s=a;s<=c;s+=1)d=r.getApplyArg(s),d.isApplyOp(f._p)&&(d.invalidate(),this.assocInsert(d,1,d.getApplyArgc(),e));n.mergeParagraph(c+1),n.mergeParagraph(a),p=r.getApplyArg(c-1).getApplyArg(1),r.resume(),r.layout()}else this.assocInsert(r,a,c,e),p=r.getApplyArg(a),r.suspend(),i.invalidate(),r.resume(),r.layout();p&&(t.onSelect(p),t.setSelectionSide(!0))},et.prototype.textDelete=function(){var e=this.getTarget().getNthPattern(2);e===f._left&&this.textDeleteLeft(),e===f._right&&this.textDeleteRight(),e&&e.getURI()===f.NS_HTML&&this.textDeleteSpan(e)},et.prototype.textDeleteLeft=function(){var e=this.getSelection(),t=e.getParentContent(),n=e.getCurrentContent();this.editGroupExtend();var r=e.getSelectionWidth();if(r!==0)return this.editDeleteThis();var i=null,s=null,o=t.getApplyIndex(n),u=t.getApplyArgc(),a=e.getSelectionSide(),l;t.suspend(),n.isApplyOp(f._math)&&a?(e.onSelect(n),e.setRight(),e.onLeaf(),e.setSelectionSide(a),s=e.getCurrentContent()):u===1?(e.out(),t.isNullary()?(i=t,t.removeChildAt(o)):(i=n.createPlace(),e.setCurrentContent(i),s=i)):(l=o,o>1?(o-=1,l=e.getNextIndex(o)):u>1&&a&&e.setSelectionSide(!1),i=t.getChild(l),t.removeChildAt(l),s=t.getApplyArg(o)),t.resume(),t.layout(),e.onSelect(s)},et.prototype.textDeleteRight=function(){var e=this.getSelection(),t=e.getParentContent(),n=e.getCurrentContent();this.editGroupExtend();var r=e.getSelectionWidth();if(r!==0)return this.editDeleteThis();var i=null,s=null,o=t.getApplyIndex(n),u=t.getApplyArgc(),a=e.getSelectionSide(),l;t.suspend(),n.isApplyOp(f._math)&&!a?(e.onSelect(n),e.setLeft(),e.onLeaf(),e.setSelectionSide(a),s=e.getCurrentContent()):u===1?(e.out(),t.isNullary()?(i=t,t.removeChildAt(o)):(i=n.createPlace(),e.setCurrentContent(i),s=i)):(l=o,o===u?o-=1:l=e.getNextIndex(o),i=t.getChild(l),t.removeChildAt(l),s=t.getApplyArg(o)),t.resume(),t.layout(),e.onSelect(s)},et.prototype.textDeleteSpan=function(e){var t=this.getSelection(),n=t.getParentContent(),r=t.getCurrentContent(),i=n.getApplyIndex(r),s,o;if(r.getOp()!==e)return;t.isRight()?(s=r.getTail(),o=r.getApplyArg(1)):(s=r.getApplyArg(1),o=r.getTail()),this.assocRemove(n,i,e),n.suspend(),n.invalidate(),n.resume(),n.layout(),s&&o&&t.moveToContent(s)},et.prototype.editDelete=function(){var e=this.getTarget().getNthPattern(2);e===null&&this.editDeleteThis(),e===f._op&&this.editDeleteOp(),e===f._merge&&this.editDeleteMerge(),e===f._split&&this.editDeleteSplit(),e===f._up&&this.editDeleteUp(),e===f._left&&this.editDeleteLeft(),e===f._right&&this.editDeleteRight()},et.prototype.editDeleteThis=function(){this.editGroup();var e=this.getSelection();e.isComplex()&&e.moveToContent(e.getComplexContent());var t=e.getCurrentContent(),n=e.getParentContent();t.isOp()&&e.moveToContent(n);if(t.isApplyOp(f._p)){if(e.isExtended()){this.editDeleteExtend();return}var r=t.getApplyArg(1),i=t.getApplyArg(t.getApplyArgc());e.extendToContent(i,r)}var s=e.getHeadIndex(),o=e.getOtherIndex(),u=s<o?s:o,a=s<o?o:s,l=e.getSiblingCount();if(t.isMathMode()&&t.isTokenMode()){if(u!==0||a!==l-1){this.editDeleteExtend();return}e.out()}t.isMathMode()&&(e.isImplicit()||e.isExplicit())||t.isTextMode()&&!e.isExtendRow()?this.editDeleteSimple():this.editDeleteExtend()},et.prototype.editDeleteSimple=function(){var e=this.getSelection(),t=e.getCurrentContent();if(t.isOp())return;var n=t.createPlace();e.setCurrentContent(n),e.onSelect(n)},et.prototype.editDeleteExtend=function(){var e=this.getSelection(),t=e.getParentContent(),n=e.getHeadIndex(),r=e.getOtherIndex();t.suspend();var i=n<r?n:r,s=n<r?r:n,o=t.getHead();n=0;var u,a;for(u=i;u<=s;u+=1)a=e.getSiblingReference(u).getContent(),a.getParent()===t&&a!==o&&(n===0&&(n=t.getApplyIndex(a)),t.removeChild(a));var l,c=!0;if(t.isApplyOp(f._body)){var h=this.getModel(),p=h.mergeParagraph(n);e.onSelect(p)}else t.isTextMode()||t.isToken()?(n>1?n-=1:c=!1,l=t.getApplyArg(n),l===null&&(l=t.createPlace(),t.insertChildAt(n,l),c=!0),l.isApplyOp(f._p)&&(n=c?l.getApplyArgc():1,l=l.getApplyArg(n))):(l=t.createPlace(),t.insertChildAt(n,l)),t.resume(),t.layout(),e.setSelectionSide(c),e.onSelect(l)},et.prototype.editDeleteOp=function(){var e=this.getSelection(),t=e.getParentContent();if(t&&t.isApplyArgc(1)){var n=t.isApplyOp(f._minus)&&t.getParent().isApplyOp(f._plus)&&t.getParent().getApplyIndex(t)>1;t=t.getApplyArg(1),e.out(),e.setCurrentContent(t),e.onSelect(t),n?(e.onSiblingLeft(),et.process(f.user("delete"),this.getModel()),this.getHistory().pop()):t.isToken()&&e.onSelect(t.getApplyArg(1))}},et.prototype.editDeleteMerge=function(){var e=this.getSelection(),t=e.getParentContent(),n=null;if(t&&t.isApplyOpArgc(f._times,2)){var r=t.getApplyArg(1),i=t.getApplyArg(2);t.suspend(),Z=null;var s,o,u=t.getAttrib(f._class);u===null&&r.isNumber()&&i.isApplyOpArgc(f._divide,2)&&(s=i.getApplyArg(1),o=i.getApplyArg(2),s.isNumber()&&o.isNumber()&&(n=t.createApplyOp(f._mxf,r,s,o),Z=r)),u===null&&r.isApplyOp(f._cn)&&i.isApplyOpArgc(f._times,2)&&(s=i.getApplyArg(1),o=i.getApplyArg(2),s.isApplyOp(f._cn)&&(r=t.createApplyOp(f._times,r,s),n=t.createApply(i.getHead(),r,o),Z=r));if(Z===null){n=this.merge(r,i);if(Z.isApply()){var a=X?1:2;Z=Z.getApplyArg(a),e.setSelectionSide(X)}}e.out(),e.setCurrentContent(n),e.onSelect(Z)}},et.prototype.editDeleteSplit=function(){var e=this.getSelection(),t=e.getParentContent();if(t&&t.isNumberToken()){var n=t.getParent(),r=n?n.getOp():null,i=n?n.getClass():null;if(r===f._mxf){e.onSelect(n);return}var s=e.getHeadIndex(),o=t.getApplyArgc(),u;e.getSelectionSide()&&(s+=1);if(s===0){e.out();return}if(s===o){e.out(),r===f._times&&!i&&e.siblingRight();return}u=t.createApplyOp(f._times),t.suspend();var a,l=t.createApplyOp(t.getOp());for(a=1;a<=s;a+=1)l.addChild(t.removeChildAt(1));var c=t.createApplyOp(t.getOp());for(a=s+1;a<=o;a+=1)c.addChild(t.removeChildAt(1));u.addChild(l),u.addChild(c),e.out(),e.setCurrentContent(u),e.onSelect(u.getOper())}},et.prototype.editDeleteUp=function(){var e=this.getSelection(),t=e.getCurrentContent();if(e.isDone()||e.isRoot())return;e.out(),e.setCurrentContent(t),e.onSelect(t)},et.prototype.editDeleteLeft=function(){var e=this.getSelection(),t=e.getParentContent(),n=e.getCurrentContent(),r=null,i=null,s=t.getApplyArgc(),o=t.getApplyIndex(n);s===1&&o===1?(i=r=t.getApplyArg(1),e.isRoot()||e.out(),e.setCurrentContent(r),this.echoMessageDeleted(t,!1,r)):s===2&&o===1?(i=r=t.getApplyArg(2),i=e.getLeafFirst(i),e.out(),e.setCurrentContent(r),this.echoMessageDeleted(t,!1,r)):s===2&&o===2&&(i=r=t.getApplyArg(1),i=e.getLeafLast(i),e.out(),e.setCurrentContent(r),this.echoMessageDeleted(t,!1,r)),e.onSelect(i)},et.prototype.editDeleteRight=function(){var e=this.getSelection(),t=e.getParentContent(),n=e.getCurrentContent(),r=null,i=null,s=t.getApplyArgc(),o=t.getApplyIndex(n);s===1&&o===1?(i=r=t.getApplyArg(1),!e.isDone()&&!e.isRoot()&&e.out(),e.setCurrentContent(r),this.echoMessageDeleted(t,!0,r)):s===2&&o===1?(i=r=t.getApplyArg(2),i=e.getLeafFirst(i),e.out(),e.setCurrentContent(r),this.echoMessageDeleted(t,!0,r)):s===2&&o===2&&(i=r=t.getApplyArg(1),i=e.getLeafLast(i),e.out(),e.setCurrentContent(r),this.echoMessageDeleted(t,!0,r)),e.onSelect(i)},et.prototype.merge=function(e,t){var n=e.getApplyArgc(),r=e.getApplyOp(),i=e.getApplyArg(n),s=t.getApplyArgc(),o=t.getApplyOp(),u=t.getApplyArg(1),a,l;if(e.isNumberToken()&&t.isNumberToken())a=et.mergeTokens(e,t);else if(!et.isInfix(e)&&!et.isInfix(t))a=e.createApplyOp(f._times,e,t),Z=a;else if(!et.isInfix(e)){a=e.createApply(o),a.addChild(this.merge(e,u));for(l=2;l<=s;l+=1)a.addChild(t.getApplyArg(l))}else if(!et.isInfix(t)){a=e.createApply(r);for(l=1;l<n;l+=1)a.addChild(e.getApplyArg(l));a.addChild(this.merge(i,t))}else if(et.mergeIsNary(e,t)){a=e.createApply(r);for(l=1;l<n;l+=1)a.addChild(e.getApplyArg(l));a.addChild(this.merge(i,u));for(l=2;l<=s;l+=1)a.addChild(t.getApplyArg(l))}else if(et.compareMerge(e,t)){a=e.createApply(o),a.addChild(this.merge(e,u));for(l=2;l<=s;l+=1)a.addChild(t.getApplyArg(l))}else{a=e.createApply(r);for(l=1;l<n;l+=1)a.addChild(e.getApplyArg(l));a.addChild(this.merge(i,t))}return a.isApplyOp(f._times)&&this.assocFlat(a),a},et.mergeTokens=function(e,t){var n=e.createApplyOp(f._cn);Z=e.getTail();var r,i=e.getApplyArgc();for(r=1;r<=i;r+=1)n.addChild(e.removeChildAt(1));var s=t.getApplyArgc();for(r=1;r<=s;r+=1)n.addChild(t.removeChildAt(1));return n},et.mergeAllTokens=function(e){if(!e.isApplyOp(f._times)||e.getOpAttrib(f._class))return e;var t=e.getApplyArgc(),n=e.getApplyOp(),r=null,i=null,s=e.getApplyArg(1),o,u;for(o=2;o<=t;o+=1){i=s,s=e.getApplyArg(o);if(i.isNumberToken()&&s.isNumberToken()){if(r===null){r=e.createApply(n);for(u=1;u<o;u+=1)r.addChild(e.getApplyArg(u))}r.removeChild(i),s=et.mergeTokens(i,s)}r&&r.addChild(s)}return r&&r.isApplyArgc(1)&&(r=r.getApplyArg(1)),r||e},et.isInfix=function(e){return e.isNary()&&e.getNaryMax()===0&&e.getApplyArgc()>1?!0:e.isApplyOp(f._divide)&&e.getOpAttrib(f._class)?!0:e.isApplyOp(f._p)?!0:!1},et.mergeIsNary=function(e,t){if(e.getOp()!==t.getOp())return!1;var n=f._class,r=f.get("paste"),i=e.getOpAttrib(n),s=t.getOpAttrib(n);return i=i===r?null:i,s=s===r?null:s,i!==s?!1:e.isApplyOp(f._divide)&&i?!1:!0},et.compareMerge=function(e,t){var n=e.getConfig(),r=e.getRightBinding(),i=t.getLeftBinding();return n.compareBindings(r,i)},et.prototype.editFunction=function(){var e=this.getSelection(),t=e.getCurrentContent();e.out(),e.setCurrentContent(t),e.onSelect(t)},et.prototype.editUndo=function(){this.getHistory().undo(this.getRepeat()),tt=!1},et.prototype.editRedo=function(){this.getHistory().redo(this.getRepeat()),tt=!1},et.prototype.editReset=function(){this.getHistory().reset(),tt=!1},et.prototype.editClear=function(){this.getHistory().clear(),tt=!1},et.prototype.editRoot=function(){var e=this.getSelection();if(!this.getModel().getEditableSelector()){e.onRoot(),e.update();return}var t=-1,n=-1;while(this.isEditable())n=t,t=e.getHeadIndex(),e.out();t!==-1&&e.inn(t),n!==-1&&e.inn(n),e.getCurrentContent().isTextMode()&&(e.setRight(),e.inn(-1)),e.update()},et.prototype.editSelect=function(){var e=this.getSelection();if(!this.getModel().getEditableSelector()){e.onRoot(),e.setSelectionWidth(-e.getSiblingCount()),e.update();return}var t=-1,n=-1;while(this.isEditable())n=t,t=e.getHeadIndex(),e.out();t!==-1&&e.inn(t),n!==-1&&e.inn(n),e.setSelectionWidth(-1);if(e.getCurrentContent().isTextMode()){e.setRight(),e.root(),e.inn(-1),e.inn(-1);var r=e.getCurrentContent();e.out(),e.out(),e.inn(0),e.inn(0);var i=e.getCurrentContent();e.extendToContent(r,i)}e.update()},et.prototype.editUnselect=function(){var e=this.getSelection();e.makeImplicit(),e.update()},et.prototype.isEditable=function(){var e=this.getSelection();if(e.isDone())return!1;var t=this.getCurrent(),n=e.getSelectionWidth(),r=e.isRight()?f._right:f._left;e.isComplex()&&(n=null),t.isOp()&&(r=f._unknown);var i=this.getModel().getEditableSelector();return i==="inputs >"&&(v.match("input mtable >",t,r)!==-1?i="input mtd >":i="input >"),v.match(i,t,r,n)!==-1},et.prototype.editMerge=function(){var e=this.getSelection(),t=this.getModel();e.out();var n=e.getParentContent(),r=e.getCurrentContent(),i=n.getApplyArgc(),s=n.getApplyIndex(r),o=[],a,c,h,p,d,v,m,g,y,b;for(a=s;a>=1;a-=1){p=n.getApplyArg(a);if(!p.isApplyOp(f._ci))break;for(h=p.getApplyArgc();h>=1;h-=1)d=p.getApplyArg(h).getString(),v=d.charCodeAt(),u.isLetter(v)?o.unshift(d):h=a=0}var w=null,E=null;v=o.length;for(c=v;c>1;c-=1){m=o.slice(v-c).join(""),g=f._functions[m]||null,g&&(E=n.createPlace(),w=n.createApplyOp(g,E)),y=f._units[m]||null;if(l.isString(y))g=f.math(y),w=n.createApplyOp(g);else if(y){w=n.createApplyOp(f._ci),w.setAttrib(f._class,f._unit);for(h=0;h<c;h+=1)b=o[v-c+h],w.addChild(n.createString(b));E=w.getApplyArg(w.getApplyArgc())}v-c>2&&(w=null);if(w)break}if(w===null){e.inn(-1);return}v=c;var S;for(S=s;v>0&&S>=1;S-=1)v-=n.getApplyArg(S).getApplyArgc();S+=1;if(v!==0){e.inn(-1);return}t.getHistory().save(),n.suspend();for(a=s;a>=S;a-=1)n.removeChildAt(a);var x=n.createPlace();S===1&&s===i?(e.moveToContent(n),e.setCurrentContent(x)):n.insertChildAt(S,x),n.resume(),n.layout(),e.moveToContent(x),g?(et.processMain(f.user(g.getName()),t),w=e.getCurrentContent(),w.suspend(),w.setAttrib(f._class,f._unit),w.resume()):(e.setCurrentContent(w),e.moveToContent(E))},et.prototype.editSplit=function(){var e=this.getSelection(),t=e.getParentContent(),n=e.getCurrentContent(),r,i;if(n&&n.isApplyArgc(0)&&n.getAttrib(f._class)===f._unit){var s=f._constants[n.getOp().getName()];if(l.isString(s)){t=t.createApplyOp(f._ci),t.setAttrib(f._class,f._unit);for(r=0;r<s.length;r+=1)i=t.createString(s.charAt(r)),t.addChild(i);e.setCurrentContent(t),e.inn(-1),e.update(),n=e.getCurrentContent()}}if(t&&t.getAttrib(f._class)===f._unit){var o=e.getHeadIndex()+1,u=t.getApplyArgc(),a=t.getParent(),c=a.getApplyIndex(t);if(a.isApplyOp(f._times)){e.out(),e.out(),a.suspend();for(r=1;r<=u;r+=1)i=t.createApplyOp(t.getOp()),i.addChild(t.removeChildAt(1)),a.insertChildBefore(t,i);a.removeChild(t),a.resume(),a.layout();var h=a.getChild(c+o-1);e.moveToContent(h),e.update()}else{var p=t.createApplyOp(f._times);t.suspend();for(r=1;r<=u;r+=1)i=t.createApplyOp(t.getOp()),i.addChild(t.removeChildAt(1)),p.addChild(i);e.out(),e.setCurrentContent(p),e.inn(2*o-2),e.update()}}},et.prototype.editUngroup=function(){var e=this.getSelection(),t=e.isExplicit(),n=e.getSelectionSide(),r=this.getCurrent(),i;if(r.getApplyArgc()<1){this.editDeleteThis();return}var s=r.getApplyArg(1);while(s.isGroup())s=s.getApplyArg(1);var o=r.getParent();o.isApplyOp(f._minus)&&et.isInfix(r)&&(o.suspend(),r=et.ungroup(o,r),e.out(),e.setCurrentContent(r),o=r.getParent()),et.isInfix(o)&&et.isInfix(r)&&(s=r);if(et.isInfix(o)&&et.isInfix(s)){o.suspend(),i=et.ungroup(o,s),e.out(),e.setCurrentContent(i),o=i.getParent();if(o.isAssoc()&&o.getOp()===i.getOp()){var u=i.getApplyArgc(),a=o.getApplyIndex(i);o.suspend(),this.assocFlat(o),o.resume(),o.layout(),s=o.getApplyArg(n?a+u-1:a),e.moveToContent(s),e.setSelectionSide(n)}else{var l=s.getApplyArg(1),c=s.getApplyArg(s.getApplyArgc());t?e.extendToContent(c,l):e.moveToContent(n?c:l)}}else e.setCurrentContent(s),e.moveToContent(s),o.suspend(),i=et.mergeAllTokens(o),i!==o&&(e.out(),e.setCurrentContent(i)),o.resume(),t&&e.makeExplicit()},et.prototype.editGroupExtend=function(){var e=this.getSelection();if(!e.isComplex())return!1;var t=e.getComplexContent(),n=e.getComplexLeft().getContent(),r=e.getComplexRight().getContent();while(n&&n.getParent()!==t)n=n.getParent();while(r&&r.getParent()!==t)r=r.getParent();if(n&&r&&t.isApplyOp(f._p))return e.extendToContent(n,r),!0;if(n&&r&&t.isApplyOp(f._body)){var i=e.getComplexLeft().getContent(),s=e.getComplexRight().getContent();while(i&&i.getParent()!==n)i=i.getParent();while(s&&s.getParent()!==r)s=s.getParent();return i&&s&&(n=this.editGroupSplit(n,i,!1),r=this.editGroupSplit(r,s,!0),e.extendToContent(n,r)),!0}return!1},et.prototype.editGroupSplit=function(e,t,n){var r=e.createApplyOp(e.getOp()),i=e.getApplyIndex(t),s=e.getApplyArgc(),o,u;for(u=s;u>=1;u-=1)o=n?u<=i:u>=i,o&&r.insertChildAt(1,e.removeChildAt(u));var a=e.getParent();return n?a.insertChildBefore(e,r):a.insertChildAfter(e,r),r},et.prototype.editGroup=function(){var e=this.getSelection();if(!e.isComplex())return!1;var t=e.getComplexContent(),n=e.getHeadContent(),r=e.getComplexLeft().getContent(),i=e.getComplexRight().getContent(),s;if(r.isTokenMode()||i.isTokenMode()){if(this.editGroupExtend())return;e.moveToContent(t),e.makeExplicit();return}if(r.isToken()||i.isToken())if(this.editGroupExtend())return;r.isOp()&&(s=r.getOpParent(),s.isApplyArgc(1)&&(r=s),et.isInfix(s)&&(r===n?r=e.getHeadReference(-2).getReference(e.getHeadIndex()-1).getContent():r=e.getTailReference(-2).getReference(e.getTailIndex()-1).getContent())),i.isOp()&&(s=i.getOpParent(),s.isApplyArgc(1)&&(i=s),et.isInfix(s)&&(i===n?i=e.getHeadReference(-2).getReference(e.getHeadIndex()+1).getContent():i=e.getTailReference(-2).getReference(e.getTailIndex()+1).getContent()));if(r.isOp()||i.isOp())return;if(et.isInfix(t)){s=t.getParent(),s.suspend();var o=r;o.isNumberToken()&&(o=r.getApplyArg(1));var u=i;u.isNumberToken()&&(u=i.getApplyArg(1));var a=et.group(t,r,i);e.moveToContent(t),e.setCurrentContent(a),s.resume(),s.layout(),a=L(o,u),a.getParent()===s&&s.getParent()&&s.isApplyOp(f._math)&&(a=s),e.moveToContent(a),e.makeExplicit()}},et.ungroup=function(e,t){var n;return et.mergeIsNary(e,t)?n=b(e,t):e.isApplyOp(f._p)&&t.isTextMode()?n=b(e,t):et.compareMerge(e,t)?n=E(e,t):n=w(e,t),n},b=function(e,t){var n=e.getApplyOp(),r=e.getApplyArgc(),i=t.getApplyArgc(),s=O(e,t),o=e.createApply(n),u,a;for(u=1;u<=r;u+=1)if(u===s)for(a=1;a<=i;a+=1)o.addChild(t.getApplyArg(a));else o.addChild(e.getApplyArg(u));return o},w=function(e,t){var n=e.getApplyOp(),r=e.getApplyArgc(),i=O(e,t),s=e.createApply(n),o;for(o=1;o<=r;o+=1)o===i?s.addChild(t):s.addChild(e.getApplyArg(o));return s},E=function(e,t){var n=e.getApplyOp(),r=e.getApplyArgc(),i=t.getApplyOp(),s=t.getApplyArgc(),o=O(e,t),u=o>1||r===1?2:1,a=o<r?s-1:s,f=e.createApply(i),l,c;if(o>1||r===1){c=e.createApply(n);for(l=1;l<o;l+=1)c.addChild(e.getApplyArg(l));c.addChild(t.getApplyArg(1)),c=et.mergeAllTokens(c),f.addChild(c)}for(l=u;l<=a;l+=1)f.addChild(t.getApplyArg(l));if(o<r){c=e.createApply(n),c.addChild(t.getApplyArg(s));for(l=o+1;l<=r;l+=1)c.addChild(e.getApplyArg(l));c=et.mergeAllTokens(c),c=et.ungroup(c,c.getApplyArg(1)),f.addChild(c)}return f},et.group=function(e,t,n){var r=e.getApplyArgc(),i=e.getApplyArg(1),s=e.getApplyArg(r);i.isGroup()&&(i=i.getApplyArg(1)),s.isGroup()&&(s=s.getApplyArg(1));var o=O(e,t||i);o===-1&&(o=1);var u=O(e,n||s);u===-1&&(u=r);if(o>u)return et.group(e,n,t);if(o===u)return S(e,o,t,n);if(o!==1||u!==r)return x(e,o,u,t,n);var a=i===t||!et.isInfix(i)||A(i.getApplyArg(1),t),f=s===n||!et.isInfix(s)||A(s.getApplyArg(s.getApplyArgc()),n),l;return a&&f?l=e:a?l=N(e,s,n):f?l=T(e,i,t):et.mergeIsNary(i,s)?l=C(e,i,s,t,n):l=k(e,i,s,t,n),l},S=function(e,t,n,r){var i=e.getApplyArg(t);if(i===n||i===r||!et.isInfix(i))return e;var s=e.getApplyOp(),o=e.getApplyArgc(),u=e.createApply(s),a,f;for(a=1;a<=o;a+=1)f=e.getApplyArg(a),a===t&&(f=et.group(f,n,r)),u.addChild(f);return u},x=function(e,t,n,r,i){var s=e.getApplyOp(),o=e.getApplyArgc(),u=e.createApply(s),a=null,f,l;for(f=1;f<=o;f+=1)l=e.getApplyArg(f),f===t?a=e.createApply(s,l):a?a.addChild(l):u.addChild(l),f===n&&a&&(u.addChild(et.group(a,r,i)),a=null);return u},T=function(e,t,n){var r=e.getApplyOp(),i=e.getApplyArgc();t=et.group(t,n,null);var s=t.getApplyOp(),o=t.getApplyArgc(),u=t.getApplyArg(o),a,f=e.createApply(s);for(a=1;a<o;a+=1)f.addChild(t.getApplyArg(a));var l=e.createApply(r);l.addChild(u);for(a=2;a<=i;a+=1)l.addChild(e.getApplyArg(a));var c=u===n||!et.isInfix(u)||A(u.getApplyArg(1),n);return c||(l=T(l,u,n)),l=et.mergeAllTokens(l),f.addChild(l),f},N=function(e,t,n){var r=e.getApplyOp(),i=e.getApplyArgc();t=et.group(t,null,n);var s=t.getApplyOp(),o=t.getApplyArgc(),u=t.getApplyArg(1),a=e.createApply(s),f,l=e.createApply(r);for(f=1;f<i;f+=1)l.addChild(e.getApplyArg(f));l.addChild(u);var c=u===n||!et.isInfix(u)||A(u.getApplyArg(u.getApplyArgc()),n);c||(l=N(l,u,n)),l=et.mergeAllTokens(l),a.addChild(l);for(f=2;f<=o;f+=1)a.addChild(t.getApplyArg(f));return a},C=function(e,t,n,r,i){var s=e.getApplyOp(),o=e.getApplyArgc();t=et.group(t,r,null),n=et.group(n,null,i);var u=t.getApplyOp(),a=t.getApplyArgc(),f=n.getApplyArgc(),l,c=e.createApply(u);for(l=1;l<a;l+=1)c.addChild(t.getApplyArg(l));var h=e.createApply(s);h.addChild(t.getApplyArg(a));for(l=2;l<o;l+=1)h.addChild(e.getApplyArg(l));h.addChild(n.getApplyArg(1)),h=et.group(h,r,i),h=et.mergeAllTokens(h),c.addChild(h);for(l=2;l<=f;l+=1)c.addChild(n.getApplyArg(l));return c},k=function(e,t,n,r,i){var s=e.getApplyArgc();t=et.group(t,r,null),n=et.group(n,null,i);var o=t.getApplyArgc(),u=t.getApplyArg(o),a=n.getApplyArg(1);e=e.copy(e),e.setChild(1,u),e.setChild(s,a),e=et.group(e,r,i),e=et.mergeAllTokens(e);var f=null;return et.compareMerge(t,n)?(n.setChild(1,t),t.setChild(o,e),f=n):(t.setChild(o,n),n.setChild(1,e),f=t),f},L=function(e,t){var n;for(n=t;n;n=n.getParent())if(A(n,e))return n;return null},A=function(e,t){var n;for(n=t;n;n=n.getParent())if(n===e)return!0;return!1},O=function(e,t){var n;for(n=t;n;n=n.getParent())if(n.getParent()===e)break;return e.getApplyIndex(n)},et.prototype.editCut=function(){this.editCopy()&&this.editDelete()},et.prototype.editCopy=function(){var e=this.getHistory();return e.save(),this.editGroup(),this.getModel().getClipboardContent(),e.restore(),e.pop(),!0},et.prototype.editPaste=function(){var e=this.editGroupExtend();this.getModel().setClipboardContent(e)},et.prototype.editQuote=function(){it=!0},et.prototype.showKeyMode=function(){var e=this.getModel(),t=e.getKeyMode(),n=this.getTarget(),r=n.getChild(2),i=r.findOp(f._mode),s=n.copy(n.getChild(3+t));r.insertChildBefore(i,s),r.removeChild(i),this.editPopup(),r.insertChildBefore(s,i),r.removeChild(s)},et.prototype.editKeyboard=function(){var e=this.getModel(),t=(e.getKeyMode()+1)%3;e.setKeyMode(t),e.processTemplate("showMode")},et.prototype.editContent=function(){var e=this.getModel(),t=this.getSelection(),n=p.print(t.getDocumentContent().markup());F(e,n,"ee-markup",!0),tt=!1},et.prototype.editPresent=function(){var e=this.getModel(),t=this.getSelection(),n=p.print(t.getDocumentPresent().markup());F(e,n,"ee-markup",!0),tt=!1},et.prototype.editPopup=function(){var e=this.getModel(),t=this.getTarget().getChild(2),n=t.getStrings();F(e,n,"ee-error",!1),tt=!1},F=function(t,r,i,o){var u=t._editor.getPanel(n.PARENT),a=t._editor.getPanel(n.QUICK),f=t._editor.getPanel(n.INPUT),l=t._editor.getProxy(),h=3e3;a.css("display")==="none"&&(a=t._editor.getPanel(n.CHILD));var p=a.data("tooltip")||a.data("bs.tooltip");if(!p){var d={html:!0,trigger:"manual",placement:o?"bottom":"top"};a.tooltip(d),p=a.data("tooltip")||a.data("bs.tooltip");if(!p)return}var v=function(e){var t=null;e&&e.originalEvent&&(t=e.originalEvent.relatedTarget);if(s.contains(p.tip()[0],t))return;p.enabled=!1,p.closed||(p.closed=!0,a.tooltip("destroy"),p.tip().off())};if(p.tip().is(":visible")){u.one("hidden.bs.tooltip",function(){e.runOnce(0,function(){F(t,r,i,o)})}),a.tooltip("hide");return}a.attr("data-original-title",r),p.tip().addClass(i),p.enabled=!0,i==="ee-error"&&_(t,r);var m=0,g=0,y=p.tip(),b=null;o&&(b=t.getSelection().getHeadReference(-1).getDisplay().getBox()),u.one("shown.bs.tooltip",function(){I(f,y,b),u.one(c.MOUSE_DOWN,v),f.one(c.MOUSE_DOWN,v),f.one(c.MOUSE_OVER,v),f.one(c.MOUSE_OUT,v),l.one(c.FOCUS_OUT,v),m=e.runOnce(500,function(){l.one(c.KEY_DOWN,v)}),g=e.runOnce(h,v),u.one("hidden.bs.tooltip",function(t){if(s(t.target).hasClass("btn"))return;u.off(c.MOUSE_DOWN,v),f.off(c.MOUSE_DOWN,v),f.off(c.MOUSE_OVER,v),f.off(c.MOUSE_OUT,v),l.off(c.FOCUS_OUT,v),l.off(c.KEY_DOWN,v),e.stopThread(m),e.stopThread(g),v()})}),a.tooltip("show")},I=function(e,t,n){var r=e.offset().left,i=t.offset().left;n&&(i=r+n.left+n.width/2-t.width()/2),i<r&&(i=r);var s=e.offset().top,o=t.offset().top;n&&(o=s+n.top+n.height),t.offset({left:i,top:o})},et}),n("editor/model/State",["editor/util/Utils"],function(e){var t=e.Object,n=e.Symbol,r=function(n){return t.isArray(n)||(n=[]),this._symbols=n,this._data=[],this._position=0,this};r.create=function(e){return new r(e)};var i=0;return r.prototype._symbols=null,r.prototype._data=null,r.prototype._position=0,r.prototype.getLength=function(){return this._data.length},r.prototype.getPosition=function(){return this._position},r.prototype.setPosition=function(e){0<=e&&e<=this._data.length?this._position=e:this._position=0},r.prototype.getData=function(e){return 0<=e&&e<this._data.length?this._data[e]:0},r.prototype.setData=function(e,n){t.isInteger(n)||(n=0),0<=e&&e<=this._data.length&&(this._data[e]=n)},r.prototype.getSymbol=function(e){return 0<e&&e<this._symbols.length?this._symbols[e]:null},r.prototype.addSymbol=function(e){this._symbols.length===0&&(this._symbols.push(n.get("state"+i)),i+=1);var t=this._symbols[0];if(t===null)return 0;if(e instanceof n){var r=e.getAttr(t.getName())||0;return r!==0?r:(r=this._symbols.length,e.setAttr(t.getName(),r),this._symbols.push(e),r)}return 0},r.prototype.saveInt=function(e){this.setData(this._position,e),this._position+=1},r.prototype.loadInt=function(){var e=this.getData(this._position);return this._position+=1,e},r.prototype.saveSymbol=function(e){this.saveInt(this.addSymbol(e))},r.prototype.loadSymbol=function(){return this.getSymbol(this.loadInt())},r}),n("editor/control/FocusController",["editor/util/Utils","editor/panel/Panel","editor/model/State"],function(e,t,n){var r=e.$,i=e.Object;r.fn.extend({visible:function(){var e=".ee-quick-bar *[data-row], .ee-side-bar .accordion-toggle, .collapse.in *, .ee-more-menu.in .accordion-toggle, .ee-button-bar.on button:not([disabled]), .ee-carousel *[data-column]";return this.filter(e)}});var s=function(t){return this._model=t||null,this._state=null,this._input=r(),this._panels=[],this._active=r(),this};s.create=function(e){return new s(e)},s.prototype.destroy=function(){this._model=null,this._state=null,this._input=null,this._panels=null,this._active=null},s.prototype.getModel=function(){return this._model},s.prototype.setModel=function(e){this._model=e},s.prototype.getState=function(){return this._state},s.prototype.setState=function(e){this._state=e},s.prototype.getHistory=function(){return this.getModel().getHistory()},s.prototype.getSelection=function(){return this.getModel().getSelection()},s.prototype.isSelectionGap=function(){if(this.getState()===null)return!1;var e=this.getSelection();return e.getCurrentContent().isPlace()&&e.getParentContent().isPlace()},s.prototype.saveSelection=function(){var e=this.getHistory(),t=this.getSelection(),r=n.create();e.saveSelection(r,t),this.setState(r)},s.prototype.clearSelection=function(){this.setState(null)},s.prototype.hideSelection=function(){var e=this.getHistory(),t=this.getSelection(),r=this.getState();r===null&&(r=n.create(),e.saveSelection(r,t),this.setState(r))},s.prototype.showSelection=function(){var e=this.getHistory(),t=this.getSelection(),n=this.getState();n&&(n.setPosition(0),e.loadSelection(n,t))},s.prototype.setFocus=function(e){return e[0]&&e[0].focus(),e},s.prototype.inputHasFocus=function(){return this.getSelection().getSelectionFocus()},s.prototype.containsFocus=function(e){try{return r.contains(e[0],document.activeElement)}catch(t){return r(":focus",e).length>0}};var o=null;s.prototype.getExpectsFocus=function(){return o===this.getInput()},s.prototype.setExpectsFocus=function(){o=this.getInput()},s.prototype.hideFocus=function(e){var n=this.getSelection(),i=this.getParent(),s=this.getChild(),o=e.relatedTarget,u=this.containsFocus(i),a=o&&r.contains(i[0],o);return n.setSelectionParent(u||a),n.getSelectionFocus()===!1?!1:a&&r(o).closest("."+t.SPEECH).length>0?!1:this.containsFocus(i)&&this.getExpectsFocus()?!1:(n.setSelectionFocus(!1),s.removeClass("focus"),this.hideSelection(),!0)},s.prototype.showFocus=function(){var e=this.getSelection(),t=this.getChild();return e.setSelectionParent(!0),e.getSelectionFocus()===!0?!1:(e.setSelectionFocus(!0),t.addClass("focus"),this.showSelection(),this.clearSelection(),this.getModel().startQueue(),o=null,!0)},s.prototype.clickToFocus=function(){return this.containsFocus(this.getChild())?!1:(this.moveToInput(),!0)},s.prototype.getInput=function(){return this._input},s.prototype.setInput=function(e){this._input=e},s.prototype.getParent=function(){return this.getInput().closest("."+t.PARENT)},s.prototype.getChild=function(){return this.getInput().closest("."+t.CHILD)},s.prototype.getPanels=function(){return this._panels},s.prototype.getPanel=function(e){return r(this._panels[e])},s.prototype.getIndex=function(e){return this._panels.indexOf(e[0])},s.prototype.addPanel=function(e){this._panels.push(e[0])},s.prototype.getPanelWidth=function(e){var t=e.parent(),n=i.toInteger(t.innerWidth()),r=i.toInteger(e.outerWidth(!0));return r===0?4:Math.floor(n/r)},s.prototype.getActive=function(){return this._active},s.prototype.setActive=function(e){this._active=e},s.prototype.moveToInput=function(e){return this.setActive(e||this.getActive()),this.setFocus(this.getInput())},s.prototype.moveToPanel=function(e){return this.saveSelection(),this.setActive(e||this.getActive()),this.setFocus(this.getActive())},s.prototype.tabPrev=function(t,n){var r=this.moveLeft(t,n);return e.isIOS&&r===this.getInput()?(this.tabNext(t,r),null):r},s.prototype.tabNext=function(e,t){var n=this.moveRight(e,t);return n[0]===t[0]?null:n},s.prototype.moveHome=function(e,t){var n=i.toInteger(t.attr("data-row")),s='button[data-row="'+n+'"]',o=r(s,e).visible().first();if(o.length===0)return t;var u=i.toInteger(t.attr("data-index"));if(u===0)return this.setFocus(o);var a=this.getPanelWidth(t);u-=(u-1)%a,s=s+'[data-index="'+u+'"]';var f=r(s,e).visible().first();return f.length===0&&(f=o),this.setFocus(f)},s.prototype.moveEnd=function(e,t){var n=i.toInteger(t.attr("data-row")),s='button[data-row="'+n+'"]',o=r(s,e).visible().last();if(o.length===0)return t;var u=i.toInteger(t.attr("data-index"));if(u===0)return this.setFocus(o);var a=this.getPanelWidth(t);u=u-1-(u-1)%a+a,s=s+'[data-index="'+u+'"]';var f=r(s,e).visible().last();return f.length===0&&(f=o),this.setFocus(f)},s.prototype.moveUp=function(e,t){var n=i.toInteger(t.attr("data-row")),s=i.toInteger(t.attr("data-column")),o='*[data-row="'+(n-1)+'"]'+'[data-column="'+s+'"]',u=r(o,e).visible().first(),a=i.toInteger(t.attr("data-index"));if(a){var f=this.getPanelWidth(t);o='*[data-row="'+n+'"]'+'[data-index="'+(a-f)+'"]',u=r(o,e).visible().first()}return u.length===0&&(o='*[data-row="'+(n-1)+'"]',u=r(o,e).visible().last()),u.length===0?this.prevGroup(e,t):this.setFocus(u)},s.prototype.moveDown=function(e,t){var n=i.toInteger(t.attr("data-row")),s=i.toInteger(t.attr("data-column")),o='*[data-row="'+(n+1)+'"]'+'[data-column="'+s+'"],'+'*[data-row="'+(n+1)+'"]'+'[data-column="'+(s+1)+'"]',u=r(o,e).visible().first(),a=i.toInteger(t.attr("data-index"));if(a){var f=this.getPanelWidth(t);o='*[data-row="'+n+'"]'+'[data-index="'+(a+f)+'"]',u=r(o,e).visible().first()}return u.length===0&&(o='*[data-row="'+(n+1)+'"]',u=r(o,e).visible().first()),u.length===0?this.nextGroup(e,t):this.setFocus(u)},s.prototype.moveLeft=function(e,t){var n=i.toInteger(t.attr("data-row")),s=i.toInteger(t.attr("data-column")),o=i.toInteger(t.attr("data-index")),u='*[data-row="'+n+'"]'+'[data-index="'+(o-1)+'"],'+'*[data-row="'+n+'"]'+'[data-column="'+(s-1)+'"],'+'*[data-row="'+n+'"]'+'[data-column="'+(s-2)+'"]',a=r(u,e).visible().last();return a.length===0&&(u='*[data-row="'+(n-1)+'"]',a=r(u,e).visible().last()),a.length===0?this.prevGroup(e,t):this.setFocus(a)},s.prototype.moveRight=function(e,t){var n=i.toInteger(t.attr("data-row")),s=i.toInteger(t.attr("data-column")),o=i.toInteger(t.attr("data-index")),u='*[data-row="'+n+'"]'+'[data-index="'+(o+1)+'"],'+'*[data-row="'+n+'"]'+'[data-column="'+(s+1)+'"],'+'*[data-row="'+n+'"]'+'[data-column="'+(s+2)+'"]',a=r(u,e).visible().first();return a.length===0&&(u='*[data-row="'+(n+1)+'"]',a=r(u,e).visible().first()),a.length===0?this.nextGroup(e,t):this.setFocus(a)},s.prototype.moveFirst=function(e,t){var n=r("a, button",e).visible().first();return n.length===0?this.nextPanel(e,t):this.setFocus(n)},s.prototype.moveLast=function(e,t){var n=r("a, button",e).visible().last();return n.length===0?this.prevPanel(e,t):this.setFocus(n)},s.prototype.prevPanel=function(e,t){var n=this.getIndex(e);n===-1&&(n=this.getPanels().length),n-=1;if(n===-1)return this.moveToInput(t);var r=this.getPanel(n);return this.moveLast(r,t)||this.moveFirst(e,t)},s.prototype.nextPanel=function(e,t){var n=this.getIndex(e);n+=1;if(n===this.getPanels().length)return this.moveLast(e,t);var r=this.getPanel(n);return this.moveFirst(r,t)||this.moveLast(e,t)},s.prototype.prevGroup=function(e,t){var n=t.closest(".accordion-group");t.is(".accordion-toggle")&&(n=n.prev(".accordion-group"));if(n.length===0)return this.prevPanel(e,t);var r=n.find(".accordion-toggle");return this.setFocus(r)},s.prototype.nextGroup=function(e,t){var n=t.closest(".accordion-group");n=n.next(".accordion-group");if(n.length===0)return this.nextPanel(e,t);var r=n.find(".accordion-toggle");return this.setFocus(r)};var u=null;return s.prototype.toggleMoreMenu=function(e,t){var n="none";u&&u!==e&&u.modal("hide");if(!e)return;e.is(":visible")?(u=null,n="down"):(u=e,n="up"),e.modal("toggle"),r("body").removeClass("modal-open");var i=e.data("bs.modal");i&&i.resetAdjustments&&(i.adjustDialog=i.resetAdjustments,i.setScrollbar=i.resetAdjustments,i.resetAdjustments());var s=r("i:first-child",t);s.removeClass("ee-icon-caret-down ee-icon-caret-up"),s.addClass("ee-icon-caret-"+n)},s}),n("editor/control/ScrollController",["editor/util/Utils","editor/expr/Template"],function(e,t){var n=e.Object,r=e.Name,i=e.XML,s=0,o,u,a,f=function(t){return this._model=t,this.scrollMode=!1,this.scrollEnable=!1,this.thisNode=null,this.dragNode=null,this.oldNode=null,this.dragMove=null,this.dragSlide=null,this.isLeft=!1,this.isRight=!1,this.isTop=!1,this.isBottom=!1,this};f.create=function(e){var t=new f(e);return t},f.prototype.destroy=function(){return},f.prototype.getModel=function(){return this._model},f.prototype.setModel=function(e){this._model=e},f.prototype.getSelection=function(){return this.getModel().getSelection()},f.prototype.getCurrentNode=function(){return this.thisNode},f.prototype.getDragNode=function(){return this.dragNode},f.prototype.clearDragNode=function(){u(),this.thisNode&&(this.thisNode=null),this.dragNode&&(this.dragNode=null)},f.prototype.saveDragNode=function(){u(),this.dragNode&&(this.getModel().getHistory().save(),this.dragNode=null)},f.prototype.clickToScroll=function(e){var t=e.currentTarget;if(e.target!==t)return!1;var n=t.scrollWidth>t.clientWidth,r=t.scrollHeight>t.clientHeight,i=t.clientWidth-e.offsetX,s=t.clientHeight-e.offsetY,o=16;return n&&s<o||r&&i<o?!0:!1},f.prototype.dragToScroll=function(e){var t=this.getContent(e);return!t||t.isApplyOp(r._p)},f.prototype.selectAtEnd=function(e){var t=this.getContent(e);return t&&t.isApplyOp(r._p)},f.prototype.moveToEnd=function(e){var t=this.getSelection();t.moveToReference(e.refer),t.onDocLast(),e.refer=t.getHeadReference(),e.content=t.getCurrentContent()},f.prototype.selectAtEdit=function(e){var t=this.getContent(e);return!t||!this.isSelectable(t)};var l=null,c=0,h=0;f.prototype.mouseDownCount=function(t){var n=this.getContent(t);if(!n||n!==l)c=0;return c+=1,c===1&&(l=n),e.stopThread(h),h=e.runOnce(500,function(){l=null,c=0,h=0}),c},f.prototype.mouseUpCount=function(t){var n=this.getContent(t);if(!n||n!==l)e.stopThread(h),l=null,h=0,c=0;return c>1&&(this.dragNode=null),c},f.prototype.isSelectable=function(e,t){return this.getModel().isSelectable(e,t)};var p=["","left","middle","right"];f.prototype.getMouseName=function(t){var n=t.altKey,r=t.ctrlKey,i=t.shiftKey;if(e.isMacOS){if(r)return"none";r=t.metaKey}var s=p[t.which]+"-mouse";return s=(r?"ctrl-":"")+(n?"alt-":"")+(i?"shift-":"")+s,s},f.prototype.getMouseTemplate=function(e){return t.mouse(r.user(e),this.getModel())};var d=function(e){return e.isText()&&e.getString()!==" "};return f.prototype.isEdge=function(e){var t=e.currentTarget,n=t.clientWidth,r=t.clientHeight,s=t.scrollWidth,o=t.scrollHeight,u=t.scrollLeft,a=t.scrollTop,f=e.offsetX,l=e.offsetY;if(e.target!==t){var c=i.getOffsets(e.target,t);c&&(f+=c.left,l+=c.top,f-=u,l-=a)}var h=n-f,p=r-l,d=48,v=0;u>0&&f<d&&(v=d-f);var m=0;u+n<s&&h<d&&(m=d-h);var g=0;a>0&&l<d&&(g=d-l);var y=0;return a+r<o&&p<d&&(y=d-p),this.isLeft=v,this.isRight=m,this.isTop=g,this.isBottom=y,this.isLeft||this.isRight||this.isTop||this.isBottom},f.prototype.selectExtend=function(e,t){var n=this.getMouseTemplate(t);if(!n||!n.isMouseSymbol(r._extend))return!1;var i=e.refer;if(i===null)return!1;var s=i.getContent();if(s===null||!this.isSelectable(s))return!1;var o=this.getSelection();return o.onExtendReference(i),this.isSelectable(o.getCurrentContent())||o.onExtendReference(i,i),o.isComplex()&&!this.isSelectable(o.getComplexContent(),!0)&&o.onExtendReference(i,i),!0},f.prototype.selectExpand=function(e,t){var n=this.getMouseTemplate(t);if(!n||!n.isMouseSymbol(r._select))return!1;var i=e.refer;if(i===null)return!1;var s=this.getSelection();if(s.isDone()||s.isRoot())return!1;var o=s.getCurrentContent(),u=s.getParentContent();if(u===null||!this.isSelectable(u,!0))return!1;if(u.isApplyOp(r._p)){var a=u.getApplyArgc(),f=1,l=a;if(s.isExplicit()&&d(o)){var c=u.getApplyIndex(o),h;for(f=c;f>=1;f-=1){h=u.getApplyArg(f);if(!d(h))break}f+=1;for(l=c;l<=a;l+=1){h=u.getApplyArg(l);if(!d(h))break}l-=1}var p=u.getApplyArg(f),v=u.getApplyArg(l);if(p===o&&v===o)return!1;s.extendToContent(v,p),s.update()}else s.moveToContent(u),s.makeExplicit(),s.update();return!0},f.prototype.selectStart=function(e,t){var n=this.getMouseTemplate(t);if(!n||!n.isMouseSymbol(r._select))return!1;var i=e.refer;if(i===null)return!1;var s=i.getContent();if(s===null||!this.isSelectable(s))return!1;var o=this.getSelection();o.onExtendReference(i,i),this.scrollMode=!1,this.scrollEnable=!1,this.thisNode=i,this.dragNode=i,this.oldNode=i,this.dragMove=!1,this.dragSlide=!1,c===2?(o.makeExplicit(),o.update(),this.dragSlide=!0):(o.makeImplicit(),o.update());var u=this.getModel();return u.getEchoAction()&&(n.setAssoc({}),n.setModel(u),n.echoAction(u,!0)),!0},f.prototype.selectMove=function(e){var t=this.dragNode;if(!t||!t.getContent())return;if(this.isEdge(e)){if(this.scrollMode)return this.scrollMove();if(this.scrollEnable)return this.scrollMode=!0,this.scrollStart(e)}else{if(this.scrollMode)return this.scrollMode=!1,this.scrollEnd(e);this.scrollEnable=!0}return this.selectDrag(e)},f.prototype.selectDrag=function(e){var t=this.dragNode;if(!t||!t.getContent())return;this.selectAtEnd(e)&&this.moveToEnd(e),this.oldNode=this.thisNode||t,this.thisNode=e.refer;var n=e.refer;if(n===null)return;var r=e.content;if(r===null)return;this.thisNode!==this.dragNode&&(this.dragMove=!0);if(this.dragMove===!1)return;if(r===null||!this.isSelectable(r))n=this.thisNode=this.oldNode,r=n.getContent();var i=this.getSelection(),s=this.dragNode,o=this.thisNode,u=-1,a=-1,f=r.getParent();f&&(u=f.getApplyIndex(s.getContent()),a=f.getApplyIndex(o.getContent())),u===-1&&(u=a),this.dragSlide&&(u===-1&&(o=this.oldNode),s=o),s.isTextMode()&&!o.isTextMode()&&(o=i.getMathReference(o)),!s.isTextMode()&&o.isTextMode()&&(s=i.getMathReference(s)),u<a&&i.isRight()&&(s=f.getPresent().getReference(u)),a<u&&i.isLeft()&&(s=f.getPresent().getReference(u-2)),i.onExtendReference(o,s),r=i.getCurrentContent(),this.isSelectable(r)||i.onExtendReference(this.dragNode,this.dragNode),i.isComplex()&&(r=i.getComplexContent(),this.isSelectable(r,!0)||i.onExtendReference(this.dragNode,this.dragNode));var l=this.getSelectionSide(e);o===s&&l===i.getSelectionSide()&&i.makeImplicit(),this.dragSlide&&(this.dragNode=o)},f.prototype.selectEnd=function(e,t){if(s)return this.saveDragNode(),u(),!1;var n=this.getMouseTemplate(t);if(!n||!n.isMouseSymbol(r._select))return!1;this.selectAtEnd(e)&&this.moveToEnd(e),this.thisNode=e.refer;var i=e.refer;if(i===null)return!1;var o=e.content;if(!o||!this.isSelectable(o,!0))return!1;var a=this.dragNode;if(a===null)return!1;o=a.getContent();if(!o||!this.isSelectable(o,!0))this.dragNode=a=i,o=a.getContent();var f=this.getSelection(),l=a,c=i;l.isTextMode()&&!c.isTextMode()&&(c=f.getMathReference(c)),!l.isTextMode()&&c.isTextMode()&&(l=f.getMathReference(l));var h=o.getParent(),p=h.getApplyIndex(l.getContent()),d=h.getApplyIndex(c.getContent());0<p&&p<d&&f.isRight()&&(l=h.getPresent().getReference(p)),0<d&&d<p&&f.isLeft()&&(l=h.getPresent().getReference(p-2)),f.onExtendReference(c,l),o=f.getCurrentContent(),this.isSelectable(o,!0)||f.onExtendReference(i,i),f.isComplex()&&(o=f.getComplexContent(),this.isSelectable(o,!0)||f.onExtendReference(i,i));var v=this.getSelectionSide(e);if(this.dragMove===!1||this.dragSlide===!0||c===l&&v===f.getSelectionSide())f.makeImplicit(),f.update();return!0},o=function(t){s===0&&(s=e.runEvery(300,a.bind(this,t)))},u=function(){e.stopThread(s),s=0},a=function(e){e.scrollLeft-=this.isLeft,e.scrollLeft+=this.isRight,e.scrollTop-=this.isTop,e.scrollTop+=this.isBottom},f.prototype.scrollStart=function(e){return o.call(this,e.currentTarget),!1},f.prototype.scrollMove=function(){return!1},f.prototype.scrollEnd=function(){return u(),!1},f.prototype.getSelectionSide=function(e){var t=this.getContent(e),n=e.refer,r=!0;if(t.isTokenMode()&&n.getDisplay()){var i=n.getDisplay().getBox();r=e.offsetX-i.left>i.width/2}return r},f.prototype.getContent=function(e){var t=e.refer;n.isUndefined(t)&&(t=this.getReference(e),e.refer=t);if(!t)return e.content=null,null;var r=e.content;return n.isUndefined(r)&&(r=t.getContent(),e.content=r),r},f.prototype.getReference=function(e){var t=e.target;if(!t)return null;var n=t.display;while(n&&!n.getRefer())n=n.getParent();if(!n)return null;var r=n.getRefer(),s=r.getReferenceCount();t=e.currentTarget;var o=e.offsetX,u=e.offsetY,a=-1,f=s,l,c,h,p,d,v,m,g,y;while(f-a>1){l=Math.round((a+f)/2),c=r.getReference(l),n=c.getDisplay();if(n===null)break;h=n.getXML(),p=n.getBox(),v=p.left,m=p.top,g=v+p.width,y=m+p.height;if(v<=o&&o<=g&&m<=u&&u<=y)return d=i.getOffsets(h.parentNode,t),d.left=p.left+d.left,d.top=p.top+d.top,d.width=p.width,d.height=p.height,c._box=d,c;if(u<m||u<=y&&o<v)f=l;else{if(!(u>y||u>=m&&o>g))break;a=l}}for(l=a+1;l<f;l+=1){c=r.getReference(l),n=c.getDisplay();if(n===null)continue;h=n.getXML(),p=n.getBox(),v=p.left,m=p.top,g=v+p.width,y=m+p.height;if(v<=o&&o<=g&&m<=u&&u<=y)return d=i.getOffsets(h.parentNode,t),d.left=p.left+d.left,d.top=p.top+d.top,d.width=p.width,d.height=p.height,c._box=d,c}return r},f}),n("editor/control/ZoomController",["editor/util/Utils"],function(e){var t=e.$,n=function(){return window.devicePixelRatio},r=function(){var e=window.visualViewport,t=e?e.width:window.innerWidth,n=document.documentElement.clientWidth;return Math.round(n*100/t)},i=function(i){return this._model=i,this._resize=t.proxy(this.resize,this),this._initialZoom=n(),this._initialScale=r(),this};return i.create=function(e){var n=new i(e);return t(window).on("resize",n._resize),n},i.prototype.destroy=function(){t(window).off("resize",this._resize),this._resize=null},i.prototype.getModel=function(){return this._model},i.prototype.setModel=function(e){this._model=e},i.prototype.getBrowserZoom=function(){return Math.round(n()*100/this._initialZoom)},i.prototype.getScreenZoom=function(){return Math.round(r()*100/this._initialScale)},i.prototype.resize=function(){this.getModel().getFocusController().toggleMoreMenu()},i}),n("editor/model/Selector",["editor/util/Utils","editor/expr/Content"],function(e,t){var n=e.Array,r=e.Char,i=e.Name,s=e.Object,o=e.Symbol,u=function(){return this},a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt=null,nt="",rt=function(e,t){var r=e.split(t),i=r.length,s;for(s=i-1;s>=0;s-=1)r[s]||n.removeAt(r,s);return r};return a=function(e,t){var r=e.match(t),i=r.length,s;for(s=i-1;s>=0;s-=1)r[s]||n.removeAt(r,s);return r},S=function(e){var t=e.charCodeAt(0);return r.isLetter(t)},x=function(e,t){return e.charCodeAt(0)===t},u.compare=function(e,t){if(e===nt)return!1;if(t===nt)return!0;if(t===tt)return!0;if(e===tt)return!1;var n;return n=K(e)-K(t),n!==0?n>0:(n=Q(e)-Q(t),n!==0?n>0:(n=G(e)-G(t),n!==0?n>0:(n=Y(e)-Y(t),n!==0?n<0:(n=Z(e)-Z(t),n!==0?n>0:!0))))},K=function(e){return et(e,"#")},Q=function(e){var t=0,r=rt(e,/[,>+ ]/);return n.each(r,function(e){t+=et(e,".")+et(e,"@")+et(e,"$"),e.charAt(e.length-1)==="."&&(t-=1)}),t},G=function(e){var t=Y(e),r=rt(e,/[,>+ ]/);return n.each(r,function(e){if(S(e)||e==="*")t+=1}),t},Y=function(e){return et(e,"%assoc")+et(e,"%nary")+et(e,"%array")+et(e,"%table")},Z=function(e){return et(e,"%")-Y(e)},et=function(e,t){var n=0,r=0;for(;;){r=e.indexOf(t,r);if(r===-1)break;n+=1,r+=1}return n},u.match=function(e,n,r,u){return s.isString(e)?n instanceof t?(r instanceof o||(r=i._unknown),f(e,n,r,u)):0:0},f=function(e,t,r,i){var s=rt(e,/,/),o=-1;return n.each(s,function(e){return o=l(e,t,r,i),o===-1}),o},l=function(e,t,n,r){var s=!1,o=!0,u=!1,f=null,l,p,d,v=a(e,/(\S+)|(>)|(\+)|(-)/g),m=v.length,g;for(g=m-1;g>=0;g-=1){u=!1,l=t.getParent(),p=v[g];while(l&&l.isOpParent())l=l.getParent();T(e,p,n)&&(n=i._unknown);if(p===">"){if(g===0){if(l===null)break;return-1}g-=1,p=v[g],o=!o}if(p==="+"){if(l===null)return-1;d=l.getApplyIndex(t)-1;if(d===0)return-1;g-=1,t=l.getApplyArg(d),p=v[g],s=!1,o=!0,u=!0}if(p==="-"){if(l===null)return-1;d=l.getApplyIndex(t)+1;if(d===l.getCount())return-1;g-=1,t=l.getApplyArg(d),p=v[g],s=!1,o=!0,u=!0}s&&(t=l,n=null);if(o){if(t===null)return-1;if(!h(p,t,n,r))return-1}else{t=c(p,t,n,r);if(t===null)return-1}s=N(p),o=o&&!s,f===null&&(s&&p!=="*"&&p!==">"||u)&&(f=t)}var y;for(y=0;f;y+=1)f.isOp()?f=f.getOpParent():f=f.getParent();return y},T=function(e,t,n){return n!==i._left&&n!==i._right?!1:t.indexOf("%place")===-1&&t.indexOf("%exist")===-1?!1:e.indexOf("%outfix")===-1?!1:!0},N=function(e){var t=a(e,/([%#.$@=]?[^%#.$@=]*)/g);return t.length>1&&(e=t[0]),x(e,r.percent)?e==="%infix"?!0:e==="%assoc"?!0:e==="%nary"?!0:e==="%array"?!0:e==="%table"?!0:!1:!0},c=function(e,t,n,r){while(t){if(h(e,t,n,r))return t;t=t.getParent(),n=null;while(t&&t.isOpParent())t=t.getParent()}return null},h=function(e,t,n,r){return p(e,t,n,r)},p=function(e,t,s,o){var u=!0,f=null,l=a(e,/([%#.$@=]?[^%#.$@=]*)/g),c=!0,h=n.contains(l,"%outer");n.remove(l,"%outer");var p,T,N,C,k;return n.each(l,function(e){if(u&&(S(e)||e==="*")){if(h){while(t){if(d(e,t))return!1;p=t.getOpParent();if(p===null)return c=!1,!1;T=p.getPresent();if(T===null)return c=!1,!1;N=T.getReferenceCount();if(N>1){C=N-1,s===i._left&&(C=0),k=T.getReference(C).getContent();if(t!==k&&!t.contains(k))return c=!1,!1}if(t.isApplyOp(i._gap))return c=!1,!1;t=p}return c=!1,!1}if(!d(e,t))return c=!1,!1;f=null}else if(u&&x(e,r.percent)){if(!v(e,t,s,o))return c=!1,!1;f=null}else if(x(e,r.hash)){if(!m(e,t))return c=!1,!1;f=null}else if(x(e,r.dot)){if(!g(e,t))return c=!1,!1;f=null}else if(x(e,r.dollar)){if(!y(e,t))return c=!1,!1;f=e}else if(x(e,r.at)){if(!w(e,t))return c=!1,!1;f=e}else{if(!f||!x(e,r.equal))return c=!1,!1;var n=e.substring(1);if(x(f,r.dollar)&&b(f,t)!==n)return c=!1,!1;if(x(f,r.at)&&E(f,t)!==n)return c=!1,!1;f=null}u=!1}),c},d=function(e,t){return e==="*"?t.isApply():e==="apply"?t.isApplySymbol():t.isTheElement(e)},v=function(e,t,n,r){return e==="%assoc"?q(t):e==="%nary"?R(t):e==="%array"?U(t):e==="%table"?z(t):e==="%select"?W(t,r):e==="%insert"?X(t,r):e==="%complex"?V(t,r):e==="%explicit"?$(t,r):e==="%implicit"?J(t,r):n===null?!1:e==="%text"?C(t):e==="%math"?k(t):e==="%left"?L(t,n):e==="%right"?A(t,n):e==="%infix"?O(t):e==="%prefix"?M(t,n):e==="%suffix"?_(t,n):e==="%outfix"?D(t,n):e==="%token"?P(t):e==="%number"?H(t):e==="%decimal"?B(t):e==="%symbol"?j(t):e==="%place"?F(t):e==="%exist"?I(t,n):!1},m=function(e,t){t.isOp()&&(t=t.getOpParent());var n=e.substring(1);return t.getAttribute("id")===n},g=function(e,t){t.isOp()&&(t=t.getOpParent());var n=e.substring(1);return n===""&&(n=null),t.getAttribute("class")===n},y=function(e,t){t.isOp()&&(t=t.getOpParent());var n=e.substring(1);return t.getStyleAttribute(n)!==""},b=function(e,t){t.isOp()&&(t=t.getOpParent());var n=e.substring(1);return t.getStyleAttribute(n)},w=function(e,t){t.isOp()&&(t=t.getOpParent());var n=e.substring(1);return t.getAttribute(n)!==null},E=function(e,t){t.isOp()&&(t=t.getOpParent());var n=e.substring(1);return t.getAttribute(n)},C=function(e){return e.isTextMode()},k=function(e){return e.isMathMode()},L=function(e,t){return e!==null&&t===i._left},A=function(e,t){return e!==null&&t===i._right},O=function(e){return e.isOp()},M=function(e,t){return e.isOp()?t===i._unknown:t===i._left?!e.isPlace():t===i._right?e.isPlace():!1},_=function(e,t){return e.isOp()?t===i._unknown:t===i._left?e.isPlace():t===i._right?!e.isPlace():!1},D=function(e,t){return e.isOp()?t===i._unknown:!0},P=function(e){if(e.isOp())return!1;if(e.isText())return!0;var t=e.getParent();return t===null?!1:t.isToken()},H=function(e){if(e.isOp())return!1;if(!e.isText()&&!e.isPlace())return!1;var t=e.getParent();return t===null?!1:t.isNumberToken()},B=function(e){return e.isNumberToken()?e.toString().indexOf(".")!==-1:!1},j=function(e){if(e.isOp())return!1;if(!e.isText()&&!e.isPlace())return!1;var t=e.getParent();return t===null?!1:t.isSymbolToken()},F=function(e){return e.isPlace()},I=function(e,t){return t===i._unknown?!e.isText():!e.isText()&&!e.isPlace()},q=function(e){if(e.isAssoc())return!0;var t=e.getParent();return t===null?!1:t.isAssoc()},R=function(e){if(e.isOp())return!1;if(U(e))return!1;var t=e.getParent();return t===null?!1:t.isNary()},U=function(e){if(z(e))return!0;var t=e.getParent();if(t===null)return!1;var n=t.getParent();return n===null?!1:n.isArray()||n.isTable()},z=function(e){var t=e.getParent();if(t===null)return!1;var n=t.getParent();if(n===null)return!1;var r=n.getParent();return r===null?!1:r.isTable()},W=function(e,t){return e!==null&&t!==0&&t!==null},X=function(e,t){return e!==null&&t===0},V=function(e,t){return e!==null&&t===null},$=function(e,t){return e!==null&&t!==0},J=function(e,t){return e!==null&&t===0},u.isArray=U,u}),n("editor/expr/Exprs",["editor/expr/Display","editor/expr/Refer","editor/expr/Expr","editor/expr/Content","editor/expr/Present","editor/expr/Layout","editor/expr/Template"],function(e,t,n,r,i,s,o){var u=function(){return this};return u.Display=e,u.Refer=t,u.Expr=n,u.Content=r,u.Present=i,u.Layout=s,u.Template=o,u}),n("editor/model/Selection",["editor/util/Utils","editor/expr/Exprs"],function(e,t){var n=e.$,r=e.Array,i=e.Entity,s=e.Name,o=e.Object,u=e.XML,a=t.Content,f=t.Layout,l=t.Refer,c,h,p,d,v=function(){return this._headIndexList=[],this._tailIndexList=[],this._headReferenceList=[],this._tailReferenceList=[],this._selectionWidth=0,this._selectionScroll=!0,this._selectionParent=!1,this._selectionFocus=!1,this._selectionSide=!0,this._iselect=null,this._selectionHead=null,this._selectionBody=null,this._selectionTail=null,this._proxy=null,this};v.create=function(e,t){var n=new v;return n.setDocumentContent(e),n.setLocation(t),n._selectionHead=document.createElement("div"),n._selectionBody=document.createElement("div"),n._selectionTail=document.createElement("div"),n},v.prototype._headIndexList=null,v.prototype.addHeadIndex=function(e){o.isInteger(e)&&this._headIndexList.push(e)},v.prototype.removeHeadIndex=function(){return r.isEmpty(this._headIndexList)?null:this._headIndexList.pop()},v.prototype.getHeadIndexList=function(){return this._headIndexList.join(" ")},v.prototype.setHeadIndexList=function(e){if(!o.isString(e))return;var t=this;t._headIndexList=[],r.each(e.split(" "),function(e){t.addHeadIndex(o.toInteger(e))})},v.prototype.getHeadIndexCount=function(){return this._headIndexList.length},v.prototype.getHeadIndex=function(e){o.isInteger(e)||(e=-1);var t=this.getHeadIndexCount();e<0&&(e+=t);var n=null;return 0<=e&&e<t&&(n=this._headIndexList[e]),n},v.prototype._tailIndexList=null,v.prototype.addTailIndex=function(e){o.isInteger(e)&&this._tailIndexList.push(e)},v.prototype.removeTailIndex=function(){return r.isEmpty(this._tailIndexList)?null:this._tailIndexList.pop()},v.prototype.getTailIndexList=function(){return this._tailIndexList.join(" ")},v.prototype.setTailIndexList=function(e){if(!o.isString(e))return;var t=this;t._tailIndexList=[],r.each(e.split(" "),function(e){t.addTailIndex(o.toInteger(e))})},v.prototype.getTailIndexCount=function(){return this._tailIndexList.length},v.prototype.getTailIndex=function(e){o.isInteger(e)||(e=-1);var t=this.getTailIndexCount();e<0&&(e+=t);var n=null;return 0<=e&&e<t&&(n=this._tailIndexList[e]),n},v.prototype._headReferenceList=null,v.prototype.addHeadReference=function(e){e instanceof l&&this._headReferenceList.push(e)},v.prototype.removeHeadReference=function(){return this.getHeadReferenceCount()<2?null:this._headReferenceList.pop()},v.prototype.getHeadReferenceCount=function(){return this._headReferenceList.length},v.prototype.getHeadReference=function(e){o.isInteger(e)||(e=-1);var t=this.getHeadReferenceCount();e<0&&(e+=t);var n=null;return 0<=e&&e<t&&(n=this._headReferenceList[e]),n},v.prototype._tailReferenceList=null,v.prototype.addTailReference=function(e){e instanceof l&&this._tailReferenceList.push(e)},v.prototype.removeTailReference=function(){return this.getTailReferenceCount()<2?null:this._tailReferenceList.pop()},v.prototype.getTailReferenceCount=function(){return this._tailReferenceList.length},v.prototype.getTailReference=function(e){o.isInteger(e)||(e=-1);var t=this.getTailReferenceCount();e<0&&(e+=t);var n=null;return 0<=e&&e<t&&(n=this._tailReferenceList[e]),n},v.prototype._selectionWidth=0,v.prototype.getSelectionWidth=function(){return this._selectionWidth},v.prototype.setSelectionWidth=function(e){o.isInteger(e)||(e=0);if(this.getHeadIndexCount()<2)e!==-1&&e!==1&&(e=0);else{var t=this.getHeadIndex(),n=t+e;e<0&&(n+=1),e>0&&(n-=1),this.isSiblingIndex(n)||(e=0)}this._selectionWidth=e},v.prototype.isEmptyTail=function(){return this.getTailIndexCount()===0},v.prototype.isImplicit=function(){return this.isEmptyTail()&&this.getSelectionWidth()===0},v.prototype.isExplicit=function(){return this.isEmptyTail()&&Math.abs(this.getSelectionWidth())===1},v.prototype.isExtended=function(){return this.isEmptyTail()&&Math.abs(this.getSelectionWidth())>1},v.prototype.isComplex=function(){return!this.isEmptyTail()},v.prototype.getComplexContent=function(){var e=this.getHeadReferenceCount(),t=this.getTailReferenceCount(),n,r,i;for(n=0;n<e&&n<t;n+=1){r=this.getHeadIndex(n),i=this.getTailIndex(n);if(r!==i)break}return this.getHeadReference(n).getContent()},v.prototype.getComplexLeft=function(){var e=this.getHeadReferenceCount(),t=this.getTailReferenceCount(),n,r=0,i=0;for(n=0;n<e&&n<t;n+=1){r=this.getHeadIndex(n),i=this.getTailIndex(n);if(r!==i)break}return i<r?this.getTailReference():r<i?this.getHeadReference():t<e?this.getTailReference():this.getHeadReference()},v.prototype.getComplexRight=function(){var e=this.getHeadReferenceCount(),t=this.getTailReferenceCount(),n,r=0,i=0;for(n=0;n<e&&n<t;n+=1){r=this.getHeadIndex(n),i=this.getTailIndex(n);if(r!==i)break}return r<i?this.getTailReference():i<r?this.getHeadReference():t<e?this.getTailReference():this.getHeadReference()},v.prototype.makeExplicit=function(){this.isImplicit()&&this.setSelectionWidth(this.isLeft()?1:-1)},v.prototype.makeImplicit=function(){(this.isExplicit()||this.isExtended())&&this.setSelectionWidth(0)},v.prototype._selectionParent=!1,v.prototype.getSelectionParent=function(){return this._selectionParent},v.prototype.setSelectionParent=function(e){this._selectionParent=e,this.update(),this._update()},v.prototype._selectionFocus=!1,v.prototype.getSelectionFocus=function(){return this._selectionFocus},v.prototype.setSelectionFocus=function(e){this._selectionFocus=e,this.update(),this._update()},v.prototype._selectionSide=!0,v.prototype.getSelectionSide=function(){return this._selectionSide},v.prototype.setSelectionSide=function(e){o.isBoolean(e)||(e=!0),this._selectionSide=e},v.prototype._iselect=null,v.prototype.getInternalSelection=function(){return this._iselect===null&&(this._iselect=new v),this._iselect.setDocumentContent(this.getDocumentContent()),this._iselect},v.prototype.getOtherIndex=function(){var e=this.getHeadIndex(),t=this.getSelectionWidth(),n=e+t;return t<0&&(n+=1),t>0&&(n-=1),n},v.prototype.getOtherReference=function(){return this.isComplex()?this.getTailReference():this.isExtended()?this.getSiblingReference(this.getOtherIndex()):this.getHeadReference()},v.prototype.getParentReference=function(){return this.getHeadReference(-2)},v.prototype.getChildCount=function(){return this.getHeadReference().getReferenceCount()},v.prototype.getChildReference=function(e){return this.getHeadReference().getReference(e)},v.prototype.isChildIndex=function(e){return 0<=e&&e<this.getChildCount()},v.prototype.getSiblingCount=function(){return this.getHeadReferenceCount()<2?0:this.getParentReference().getReferenceCount()},v.prototype.getSiblingReference=function(e){return this.getHeadReferenceCount()<2?null:this.getParentReference().getReference(e)},v.prototype.isSiblingIndex=function(e){return 0<=e&&e<this.getSiblingCount()},v.prototype.getLeftReference=function(){var e=this.getHeadReference(),t=this.getHeadIndex(),n=this.getOtherIndex();return n<t&&this.isSiblingIndex(n)&&(e=this.getSiblingReference(n)||e),e},v.prototype.getRightReference=function(){var e=this.getHeadReference(),t=this.getHeadIndex(),n=this.getOtherIndex();return t<n&&this.isSiblingIndex(n)&&(e=this.getSiblingReference(n)||e),e},v.prototype.setReferenceRoot=function(e){e instanceof a||(e=(new a).createPlace());var t=e.getOp();t!==s._math&&t!==s._html&&(e=(new a).createApplyOp(s._math,e),e.setAttrib(s._xmlns,s.get(s.NS_MATH)));if(this.getHeadReferenceCount()===0){var n=l.create(e);this.addHeadReference(n),this.addTailReference(n)}else this.getHeadReference(0).setContent(e);e.getPresent()===null&&e.layout()},v.prototype.setHeadReferenceList=function(){if(this.isDone())return!0;var e=this.getHeadIndex();return this.out()&&this.setHeadReferenceList()&&this.inn(e)},v.prototype.setTailReferenceList=function(){if(this.isEmptyTail())return!0;var e=this.removeTailIndex();this.removeTailReference();if(!this.setTailReferenceList())return!1;var t=this.getTailReference().getReference(e);return t===null?!1:(this.addTailIndex(e),this.addTailReference(t),!0)},v.prototype.setTailReferenceDone=function(){while(this.getTailReferenceCount()>1)this.removeTailIndex(),this.removeTailReference()},v.prototype.setReferenceHead=function(e){e instanceof a||(e=(new a).createPlace());var t=this.getCurrentContent(),n=this.getParentContent(),r=e.getOp(),i=t.isMathMode();if(r===s._math&&i||r===s._html&&!i)e=e.getApplyArg(1),r=e.getOp();e.getNamespace()&&r!==s._math&&r!==s._html&&e.setAttrib(s._xmlns,null),n.suspend(),h(t.getParent(),t,e),n.resume(),n.layout()},h=function(e,t,n){var r=e.getApplyIndex(t);e.setChild(r,n);var s=0;n.isTokenMode()&&n.isToken()&&(s=n.getCount());var o,u,a,f,l;for(o=1;o<s;o+=1){a=n.removeChildAt(1);if(a.isText()){f=a.getString(),l=f.length;if(l===1||i.isEntity(f))e.insertChildBefore(n,a);else for(u=0;u<l;u+=1)a=e.createString(f.charAt(u)),e.insertChildBefore(n,a)}else e.insertChildBefore(n,a)}s>0&&e.removeChild(n)},v.prototype.getDocumentContent=function(){return this.getHeadReference(0).getContent()},v.prototype.setDocumentContent=function(e){var t=this.getSelectionWidth();this.setReferenceRoot(e),this.setHeadReferenceList(),this.setSelectionWidth(t),this.update()},v.prototype.getDocumentPresent=function(){return this.getHeadReference(0).getPresent()},v.prototype.getCurrentContent=function(){return this.getHeadReference().getContent()},v.prototype.setCurrentContent=function(e){if(this.isDone())return this.setDocumentContent(e);var t=this.getSelectionWidth();this.setReferenceHead(e),this.setHeadReferenceList(),this.setSelectionWidth(t),this.update()},v.prototype.getCurrentPresent=function(){return this.getHeadReference().getPresent()},v.prototype.getParentContent=function(){return this.getHeadReferenceCount()<2?null:this.getParentReference().getContent()},v.prototype.getLeftContent=function(){return this.getLeftReference().getContent()},v.prototype.getRightContent=function(){return this.getRightReference().getContent()},v.prototype.getHeadContent=function(){return this.getHeadReference().getContent()},v.prototype.getTailContent=function(){return this.getTailReference().getContent()},v.prototype.getLocation=function(){return this.getHeadIndexList()},v.prototype.setLocation=function(e){if(!o.isString(e))return;this.done(),this.setRight(),this.setHeadIndexList(e),this.setHeadReferenceList(),this.setSelectionWidth(),this.getLocation()===e?this.update():(this.done(),this.onLast())},v.prototype.getTailLocation=function(){return this.getTailIndexList()},v.prototype.setTailLocation=function(e){if(!o.isString(e))return;this.setTailReferenceDone(),this.setTailIndexList(e),this.setTailReferenceList(),this.update()},v.prototype.setDisplay=function(e){this.getHeadReference(0).getPresent().collectDisplay(e),this.getHeadReference(0).setDisplay(e);var t=this.getSelectionWidth(),n=this.getTailIndexList();this.setHeadReferenceList(),this.setSelectionWidth(t),this.setTailLocation(n),this.update()},v.prototype.isCurrentSpan=function(e){if(!e||!e.getPresent())return!1;var t=e.getPresent().getOp();return t===s._b||t===s._i||t===s._u||t===s._s||t===s._tt},v.prototype.isParentSpan=function(){if(this.getHeadIndexCount()<2)return!1;var e=this.getParentReference().getPresent().getOp();return e===s._b||e===s._i||e===s._u||e===s._s||e===s._tt},v.prototype.isExtendRow=function(){if(this.getHeadIndexCount()<2)return!1;var e=this.getHeadReference(),t=this.getParentReference();return this.isExtendRowRefer(t)&&c(t,e)},v.prototype.isExtendRowRefer=function(e){var t=e.getPresent().getOp();return t===s._mi||t===s._mn||t===s._mrow||t===s._math||t===s._p||t===s._div||t===s._b||t===s._i||t===s._u||t===s._s||t===s._tt},v.prototype.isSiblingParent=function(){if(!this.getCurrentContent().isMathMode())return!1;if(this.getSiblingCount()!==1)return!1;var e=this.getHeadReference(-2);if(e===null)return!1;var t=e.getContent().getOp();return t===null||t.getURI()!==s.NS_MATH?!1:!0},c=function(e,t){var n=e.getPresent(),r=t.getPresent();return r.hasParenOuter()&&(r=r.getParenOuter()),n.getApplyIndex(r)!==-1},v.prototype.markState=function(e){if(this.isDone())return;if(this.isComplex())return;var t=null,n=e.getPresent().getReference(0),r;if(this.isRoot()){n._isSelected=n.getContent();return}var i=this.getHeadReferenceCount()-1;for(r=1;n&&r<i;r+=1)t=n,n=n.getReference(this.getHeadIndex(r));var s=this.getHeadIndex(),o=this.getOtherIndex(),u=s<o?s:o,a=s<o?o:s;i=t.getReferenceCount();for(r=u;r<=a&&r<i;r+=1)n=t.getReference(r),n._isSelected=n.getContent()},v.prototype.isLeft=function(){return this.getSelectionSide()===!1},v.prototype.isRight=function(){return this.getSelectionSide()===!0},v.prototype.setLeft=function(){this.setSelectionSide(!1)},v.prototype.setRight=function(){this.setSelectionSide(!0)},v.prototype.isDone=function(){return this.getHeadIndexCount()===0},v.prototype.isRoot=function(){return this.getHeadIndexCount()===1&&this.isFirst()},v.prototype.isLeaf=function(){return this.getChildCount()===0},v.prototype.isPlace=function(){return this.getCurrentContent().isPlace()},v.prototype.isToken=function(){return this.isLeaf()&&!this.isPlace()},v.prototype.isFirst=function(){return this.getHeadIndex()===0},v.prototype.isLast=function(){return this.getHeadIndex()===this.getSiblingCount()-1},v.prototype.isApplyFirst=function(){return this.isLeft()&&this.isFirst()},v.prototype.isApplyLast=function(){return this.isRight()&&this.isLast()},v.prototype.isNaryFirst=function(){this.out();var e=this.getParentContent(),t=e===null||!e.isNary()||this.isFirst()&&this.isNaryFirst();return this.inn(0),t},v.prototype.isNaryLast=function(){this.out();var e=this.getParentContent(),t=e===null||!e.isNary()||this.isLast()&&this.isNaryLast();return this.inn(-1),t},v.prototype.getLeafFirst=function(e){while(e){if(e.isText()||e.isPlace()||e.isStruct()||e.getApplyArgc()===0)return e;if(e.isApplyOpArgc(s._minus,1))return e.getApplyOp();e=e.getApplyArg(1)}return e},v.prototype.getLeafLast=function(e){while(e){if(e.isText()||e.isPlace()||e.isStruct()||e.getApplyArgc()===0)return e;e=e.getTail()}return e},v.prototype.getReferenceFirst=function(e){var t,n,r,i,o;while(e&&this.isExtendRowRefer(e)){t=e.getContent(),n=e.getReferenceCount();if(t.isText()||t.isPlace()||n===0)return e;o=t.getOper();for(i=0;i<n;i+=1){r=e.getReference(i);if(r.getContent()!==o){e=r,t=e.getContent();if(t.isGroup()||t.isApplyOp(s._mxf))return e;break}}}return e},v.prototype.getReferenceLast=function(e){var t,n,r,i,o;while(e&&this.isExtendRowRefer(e)){t=e.getContent(),n=e.getReferenceCount();if(t.isText()||t.isPlace()||n===0)return e;o=t.getOper();for(i=n-1;i>=0;i-=1){r=e.getReference(i);if(r.getContent()!==o){e=r,t=e.getContent();if(t.isGroup()||t.isApplyOp(s._mxf))return e;break}}}return e},v.prototype.getNextIndex=function(e){return e+(this.isLeft()?0:1)},v.prototype.done=function(){this.setRight();while(!this.isDone())this.out()},v.prototype.root=function(){if(!this.isDone())while(!this.isRoot())this.out()},v.prototype.out=function(){return this.isDone()?!1:(this.removeHeadIndex(),this.removeHeadReference(),this.setSelectionWidth(),this.setTailReferenceDone(),!0)},v.prototype.inn=function(e){return e<0&&(e+=this.getChildCount()),this.isChildIndex(e)?(this.addHeadIndex(e),this.addHeadReference(this.getChildReference(e)),this.setSelectionWidth(),this.setTailReferenceDone(),!0):!1},v.prototype.left=function(){if(this.isDone()||this.isRoot()||this.isFirst())return!1;var e=this.getHeadIndex()-1;return this.out(),this.inn(e)},v.prototype.right=function(){if(this.isDone()||this.isRoot()||this.isLast())return!1;var e=this.getHeadIndex()+1;return this.out(),this.inn(e)},v.prototype.next=function(){this.isDone()?(this.inn(0),this.setLeft()):this.isLeft()?this.isLeaf()?(this.setRight(),this.setSelectionWidth(),this.setTailReferenceDone()):this.inn(0):this.isLast()?this.isRoot()?this.done():this.out():(this.right(),this.setLeft())},v.prototype.prev=function(){this.isDone()?(this.inn(-1),this.setRight()):this.isRight()?this.isLeaf()?(this.setLeft(),this.setSelectionWidth(),this.setTailReferenceDone()):this.inn(-1):this.isFirst()?this.isRoot()?this.done():this.out():(this.left(),this.setRight())},v.prototype.siblingLeft=function(){this.isDone()?this.inn(-1):this.isFirst()||this.left()},v.prototype.siblingRight=function(){this.isDone()?this.inn(0):this.isLast()||this.right()},v.prototype.placeLeft=function(){var e=this.placeParent(),t=this.getHeadReference(),n=this.isRight(),r;do{this.prev();if(this.getHeadReference()===e)continue;r=this.getCurrentContent().isPlace();if(r&&!this.isLeaf()){if(this.isRight())continue;this.setSelectionSide(n),this.inn(0);break}if(r&&this.isRight()===n)break}while(!(this.isDone()||this.getHeadReference()===t&&this.isRight()===n))},v.prototype.placeRight=function(){var e=this.placeParent(),t=this.getHeadReference(),n=this.isRight(),r;do{this.next();if(this.getHeadReference()===e)continue;r=this.getCurrentContent().isPlace();if(r&&!this.isLeaf()){if(this.isLeft())continue;this.setSelectionSide(n),this.inn(-1);break}if(r&&this.isRight()===n)break}while(!(this.isDone()||this.getHeadReference()===t&&this.isRight()===n))},v.prototype.placeParent=function(){var e=null;return r.each(this._headReferenceList,function(t){if(t.getContent().isPlace())return e=t,!1}),e},v.prototype.stopLeft=function(e){var t=this.stopParent(e),n=this.getHeadReference(),r=this.isRight();do{this.prev();if(this.getHeadReference()===t)continue;if(this.getCurrentContent().isStop(e)&&this.isRight()===r){this.inn(-1);break}}while(this.getHeadReference()!==n||this.isRight()!==r)},v.prototype.stopRight=function(e){var t=this.stopParent(e),n=this.getHeadReference(),r=this.isRight();do{this.next();if(this.getHeadReference()===t)continue;if(this.getCurrentContent().isStop(e)&&this.isRight()===r){this.inn(0);break}}while(this.getHeadReference()!==n||this.isRight()!==r)},v.prototype.stopParent=function(e){var t=null;return r.each(this._headReferenceList,function(n){if(n.getContent().isStop(e))return t=n,!1}),t},v.prototype.extendLeft=function(){var e=this.getSelectionWidth();if(e===0)return this.isRight()?(this.setSelectionWidth(-1),this.getSiblingCount()===1&&this.isRight()&&this.extendFullWidth()?this.extendParentLeft():!0):this.inn(0)?this.extendParentRight():!1;if(e===1)return this.inn(0)?this.isExtendRow()?this.setSelectionWidth(this.getSiblingCount()-1):this.isLeaf()?this.setSelectionWidth(0):this.setSelectionWidth(1):this.setSelectionWidth(0),!0;if(this.isRight()&&!this.isExtendRow())return this.extendParentLeft();var t=this.getOtherIndex()-1;if(this.isSiblingIndex(t)){e-=1;var n=this.getParentReference(),r=this.getSiblingReference(t);return(c(n,r)||n.isChildReference(r))&&this.setSelectionWidth(e),-e===this.getSiblingCount()&&this.isRight()&&this.extendFullWidth()?this.extendParentLeft():!0}var i=this.getParentContent().getOp();return i===s._p||i===s._body?!1:this.extendParentLeft()},v.prototype.extendRight=function(){var e=this.getSelectionWidth();if(e===0)return this.isLeft()?(this.setSelectionWidth(1),this.getSiblingCount()===1&&this.isLeft()&&this.extendFullWidth()?this.extendParentRight():!0):this.inn(-1)?this.extendParentLeft():!1;if(e===-1)return this.inn(-1)?this.isExtendRow()?this.setSelectionWidth(1-this.getSiblingCount()):this.isLeaf()?this.setSelectionWidth(0):this.setSelectionWidth(-1):this.setSelectionWidth(0),!0;if(this.isLeft()&&!this.isExtendRow())return this.extendParentRight();var t=this.getOtherIndex()+1;if(this.isSiblingIndex(t)){e+=1;var n=this.getParentReference(),r=this.getSiblingReference(t);return(c(n,r)||n.isChildReference(r))&&this.setSelectionWidth(e),e===this.getSiblingCount()&&this.isLeft()&&this.extendFullWidth()?this.extendParentRight():!0}var i=this.getParentContent().getOp();return i===s._p||i===s._body?!1:this.extendParentRight()},v.prototype.extendNone=function(){return this.isComplex()&&this.moveToContent(this.getComplexContent()),this.setSelectionWidth(0),!0},v.prototype.extendFullWidth=function(){return this.getCurrentContent().isMathMode()||this.isParentSpan()},v.prototype.extendParentLeft=function(){return this.isDone()||this.isRoot()||this.out()?(this.setSelectionWidth(-1),!0):!1},v.prototype.extendParentRight=function(){return this.isDone()||this.isRoot()||this.out()?(this.setSelectionWidth(1),!0):!1},v.prototype.presentLeft=function(){this.setSelectionWidth(),this.setTailReferenceDone();var e=this.getParentContent(),t=this.getInternalSelection();t.moveToSelect(this),t.prev();while(this.isPresentEqual(t))t.prev();this.moveToSelect(t);var n=this.getCurrentContent();return n!==e&&this.getCurrentContent().isToken()&&this.onIn(),!0},v.prototype.presentRight=function(){this.setSelectionWidth(),this.setTailReferenceDone();var e=this.getParentContent(),t=this.getInternalSelection();t.moveToSelect(this),t.next();while(this.isPresentEqual(t))t.next();this.moveToSelect(t);var n=this.getCurrentContent();return n!==e&&this.getCurrentContent().isToken()&&this.onIn(),!0},v.prototype.implicitLeft=function(){this.setSelectionWidth(),this.setTailReferenceDone();var e=this.getInternalSelection();e.moveToSelect(this),e.prev();var t=!1;while(this.isPresentEqual(e))e.prev(),t=!0;f.isInvisibleTimes(e.getCurrentPresent())?(e.isRight()&&e.prev(),e.prev()):t&&e.next();if(e.isInSelect(this))return;this.moveToSelect(e),this.getCurrentContent().isToken()&&this.onIn()},v.prototype.implicitRight=function(){this.setSelectionWidth(),this.setTailReferenceDone();var e=this.getInternalSelection();e.moveToSelect(this),e.next();var t=!1;while(this.isPresentEqual(e))e.next(),t=!0;f.isInvisibleTimes(e.getCurrentPresent())?(e.isLeft()&&e.next(),e.next()):t&&e.prev();if(e.isInSelect(this))return;this.moveToSelect(e),this.getCurrentContent().isToken()&&this.onIn()},v.prototype.isPresentIsolated=function(e){if(this.isDone()||this.isRoot())return!0;var t=this.getCurrentContent();return t===null?!0:t===null||t.isApplyOp(s._gap)?!0:(t=this.getParentContent(),t===null?!0:t.isApplyOp(s._gap)?!0:this.isInSelect(e)?!1:t.isRelation()?!0:!1)},v.prototype.isPresentEqual=function(e){if(this.isPresentIsolated(e))return!1;if(e.isPresentIsolated(this))return!1;var t=this.getSelectionSide();return t!==e.getSelectionSide()?t?this.isPresentNext(e):e.isPresentNext(this):this.isInSelect(e)?t?this.isPresentLast(e):this.isPresentFirst(e):e.isInSelect(this)?t?e.isPresentLast(this):e.isPresentFirst(this):!1},v.prototype.isPresentNext=function(e){var t=this.getHeadIndexCount(),n=e.getHeadIndexCount(),r;for(r=0;r<t&&r<n;r+=1)if(this.getHeadIndex(r)!==e.getHeadIndex(r))break;if(r===t)return!1;var i=this.getHeadIndex(r),o=e.getHeadIndex(r);if(i+1!==o)return!1;var u=this.getHeadReference(r+1).getContent(),a=e.getHeadReference(r+1).getContent();if(u.isApplyOp(s._p)||a.isApplyOp(s._p))return!1;var f=this.getHeadReference(r).getPresent();return d(this,r+1,f)&&p(e,r+1,f)},v.prototype.isPresentFirst=function(e){var t=this.getHeadIndexCount(),n=this.getCurrentPresent();return p(e,t,n)},v.prototype.isPresentLast=function(e){var t=this.getHeadIndexCount(),n=this.getCurrentPresent();return d(e,t,n)},p=function(e,t,n){var r=t,i=e.getHeadIndexCount(),o,u,a;for(o=r;o<i;o+=1){u=e.getHeadIndex(o);if(u!==0)return!1}var f=n,l,c,h;f.hasParenOuter()&&(f=f.getParenOuter());for(o=r;o<=i;o+=1){a=e.getHeadReference(o),l=a.getPresent(),l.hasParenOuter()&&(l=l.getParenOuter()),o===i&&(l=l.getParent());while(l!==null){h=l.getOp();if(h===s._mfrac||h===s._msub||h===s._msup||h===s._msqrt||h===s._mroot)return!1;c=l.getContent();if(c&&c.isGroup())return!1;if(l===f)break;if(h===s._mfenced)return!1;l=l.getParent()}f=a.getPresent(),f.hasParenOuter()&&(f=f.getParenOuter())}return!0},d=function(e,t,n){var r=t,i=e.getHeadIndexCount(),o,u,a;for(o=r;o<i;o+=1){u=e.getHeadIndex(o),t=e.getHeadReference(o).getReferenceCount();if(u!==t-1)return!1}var f=n,l,c,h;f.hasParenOuter()&&(f=f.getParenOuter());for(o=r;o<=i;o+=1){a=e.getHeadReference(o),l=a.getPresent(),l.hasParenOuter()&&(l=l.getParenOuter()),o===i&&(l=l.getParent());while(l!==null){h=l.getOp();if(h===s._mfrac||h===s._msub||h===s._msup||h===s._msqrt||h===s._mroot)return!1;c=l.getContent();if(c&&c.isGroup())return!1;if(l===f)break;if(h===s._mfenced)return!1;l=l.getParent()}f=a.getPresent(),f.hasParenOuter()&&(f=f.getParenOuter())}return!0},v.prototype.containsReference=function(e){var t=this.getInternalSelection();return t.moveToReference(e),this.isInSelect(t)},v.prototype.isInReference=function(e){var t=this.getHeadIndexCount(),n;for(n=0;n<t;n+=1)if(this.getHeadReference(n)===e)return!0;return!1},v.prototype.isInSelect=function(e){var t=this.getHeadIndexCount(),n=e.getHeadIndexCount(),r,i,s;for(r=0;r<t&&r<n;r+=1){i=this.getHeadIndex(r),s=e.getHeadIndex(r);if(i!==s)break}return r===t},v.prototype.moveToSelect=function(e){this.root(),this.out();var t=e.getHeadIndexCount(),n;for(n=0;n<t;n+=1)this.inn(e.getHeadIndex(n));this.setSelectionWidth(e.getSelectionWidth()),this.setSelectionSide(e.getSelectionSide())};var m=function(e){var t=e.getCurrentContent();t.isMathMode()&&t.isTokenMode()&&e.getSiblingCount()===1&&e.out()},g=function(e,t){var n=e.getHeadIndexCount(),r=t.getHeadIndexCount(),i,s,o;for(i=0;i<n&&i<r;i+=1){s=e.getHeadIndex(i),o=t.getHeadIndex(i);if(s!==o)break}return i},y=function(e,t,n){var r,i,o,u,a,f,l,c=n.getHeadReferenceCount()-1,h;for(h=e;h<c;h+=1){r=n.getHeadReference(h),i=n.getHeadReference(h+1);if(r.getContent().isApplyOp(s._mxf))return h;o=r.getPresent().getOp(),u=o===s._math||o===s._mfenced||o===s._mrow||o===s._mi||o===s._mn||o===s._p||o===s._div||o===s._b||o===s._i||o===s._u||o===s._s||o===s._tt;if(!u)return h;a=o===s._b||o===s._i||o===s._u||o===s._s||o===s._tt;if(!a&&!r.getContent().isMathMode())continue;if(h+1!==c||!i.getContent().isTokenMode())continue;f=n.getHeadIndex(h);if(t&&f===0)return h;l=r.getReferenceCount();if(!t&&f===l-1)return h}return h};v.prototype.extendToSelect=function(e){var t=this.getHeadIndexCount(),n=e.getHeadIndexCount(),r=g(this,e);if(r===t){m(this),this.makeExplicit();return}if(r===n){this.moveToSelect(e),this.makeExplicit();return}var i=this.getHeadIndex(r),s=e.getHeadIndex(r),o=y(r,i<s,this),u=y(r,s<i,e),a;if(o===r&&u===r){for(a=r;a<t;a+=1)this.out();this.makeExplicit();return}if(o<=r+1&&u<=r+1){for(a=r+1;a<n;a+=1)e.out();this.makeExplicit();var f=this.getSelectionWidth(),l=s-i,c=f<0,h=l<0;c===h?(e.out(),e.inn(i),l<0&&(l-=1),l>0&&(l+=1)):l=f-l,e.setSelectionWidth(l),e.setSelectionSide(l<0),Math.abs(l)===e.getSiblingCount()&&e.extendFullWidth()&&(e.isRight()?e.extendParentLeft():e.extendParentRight()),this.moveToSelect(e)}else{for(a=o;a<t;a+=1)this.out();for(a=u;a<n;a+=1)e.out();var p=this.getHeadIndexList();this.moveToSelect(e),this.setSelectionSide(s>=i),this.setTailIndexList(p),this.setTailReferenceList(),this.makeExplicit()}},v.prototype.isInContent=function(e){var t=this.getInternalSelection();return t.moveToContent(e),this.isInSelect(t)},v.prototype.moveToContent=function(e){if(e===this.getDocumentContent())this.root(),this.out();else if(e){this.moveToContent(e.getParent());var t;for(t=0;t<this.getChildCount();t+=1){this.inn(t);if(this.getCurrentContent()===e)break;this.out()}}},v.prototype.extendToContent=function(e,t){var n=this.getInternalSelection();n.moveToContent(e),t&&this.moveToContent(t),this.extendToSelect(n)},v.prototype.moveToReference=function(e){if(e===this.getHeadReference(0))this.root(),this.out();else if(e&&e.getContent()){this.moveToContent(e.getContent().getParent());var t;for(t=0;t<this.getChildCount();t+=1){this.inn(t);if(e===this.getHeadReference())break;this.out()}}},v.prototype.extendToReference=function(e,t){var n=this.getInternalSelection();n.moveToReference(e),t&&this.moveToReference(t),this.extendToSelect(n)},v.prototype.getMathReference=function(e){var t=this.getInternalSelection();t.moveToReference(e);while(!t.getCurrentContent().isTextMode())t.out();return t.getHeadReference()},v.prototype.onDone=function(){this.done(),this.update()},v.prototype.onOut=function(){this.out(),this.update()},v.prototype.onIn=function(){this.isDone()?this.inn(0):this.isLeaf()||this.inn(this.isLeft()?0:-1),this.update()},v.prototype.onRoot=function(){this.isDone()?this.inn(0):this.root(),this.update()},v.prototype.onLeaf=function(){this.isDone()&&this.inn(0);while(!this.isLeaf())this.inn(this.isLeft()?0:-1);this.update()},v.prototype.onLast=function(e){this.isDone()&&this.inn(0),e=e===!1;while(!this.isLeaf()&&!this.getCurrentContent().isStruct(e))this.inn(this.isLeft()?0:-1);this.getCurrentContent().isOp()&&this.out(),this.update()},v.prototype.onDocLeft=function(){this.isDone()?this.prev():(this.prev(),this.isRoot()&&this.done(),this.update())},v.prototype.onDocRight=function(){this.isDone()?this.next():(this.next(),this.isRoot()&&this.done(),this.update())},v.prototype.onDocHome=function(){this.onRoot(),this.onDocFirst()},v.prototype.onDocEnd=function(){this.onRoot(),this.onDocLast()},v.prototype.onDocFirst=function(){while(!this.isLeaf())this.inn(0);this.update()},v.prototype.onDocLast=function(){while(!this.isLeaf())this.inn(-1);this.update()},v.prototype.onPlace=function(){this.isLeft()?(this.setRight(),this.isPlace()&&this.next(),this.placeLeft(),this.setLeft()):(this.setLeft(),this.isPlace()&&this.prev(),this.placeRight(),this.setRight()),this.update()},v.prototype.onPlaceLeft=function(){this.placeLeft(),this.update()},v.prototype.onPlaceRight=function(){this.placeRight(),this.update()},v.prototype.onStopLeft=function(e){this.stopLeft(e),this.update()},v.prototype.onStopRight=function(e){this.stopRight(e),this.update()},v.prototype.onExtendLeft=function(){this.extendLeft()&&this.update()},v.prototype.onExtendRight=function(){this.extendRight()&&this.update()},v.prototype.onExtendNone=function(){this.extendNone()&&this.update()},v.prototype.onSiblingLeft=function(){this.siblingLeft(),this.update()},v.prototype.onSiblingRight=function(){this.siblingRight(),this.update()},v.prototype.onSiblingHome=function(){this.isDone()?this.inn(0):this.isSiblingParent()?(this.out(),this.onSiblingHome()):(this.out(),this.inn(0)),this.setLeft(),this.update()},v.prototype.onSiblingEnd=function(){this.isDone()?this.inn(-1):this.isSiblingParent()?(this.out(),this.onSiblingEnd()):(this.out(),this.inn(-1)),this.setRight(),this.update()},v.prototype.onPresentLeft=function(){this.presentLeft(),this.update()},v.prototype.onPresentRight=function(){this.presentRight(),this.update()},v.prototype.onImplicitLeft=function(){this.implicitLeft(),this.update()},v.prototype.onImplicitRight=function(){this.implicitRight(),this.update()},v.prototype.onSelect=function(e){this.moveToContent(e),this.update()},v.prototype.onSelectReference=function(e){this.moveToReference(e),this.update()},v.prototype.onExtend=function(e,t){this.extendToContent(e,t),this.update()},v.prototype.onExtendReference=function(e,t){this.extendToReference(e,t),this.update()},v.prototype.getSelectionClass=function(){var e="cursor";return this.isDone()?e:(e+=this.isLeft()?" left":" right",e+=this.getSelectionParent()?"":" none",e+=this.getSelectionFocus()?"":" blur",e+=this.isLeaf()?" vert":"",e)};var b=function(e){var t=e.getDisplay(),n=t;return n&&(n=n.getParent()),n&&n.getRefer()===null&&n.getSpanName()==="mfenced"&&(t=n),t?t.getXML():null},w=function(e){return e.getContent().getString()===" "};v.prototype.getBeforeSpace=function(){var e=this.getHeadReference(),t=this.getHeadIndex();if(t>0){e=this.getSiblingReference(t-1);if(!w(e))return t-1}return t},v.prototype.getAfterSpace=function(){var e=this.getHeadReference(),t=this.getHeadIndex(),n=this.getSiblingCount();if(t+1<n){e=this.getSiblingReference(t+1);if(!w(e))return t+1}return t};var E=function(e,t,r){var i=t.height;r=r||16,i<r&&(t.top=t.top-r+i,t.height=r),n(e).css(t)};return v.prototype.update=function(){this._needsUpdate=!0;return},v.prototype._update=function(){if(!this._needsUpdate)return;this.isImplicit()?this.updateSingle():this.isExplicit()?this.updateSingle():this.isExtended()?this.updateExtended():this.isComplex()&&this.updateComplex(),this.updateProxy(),this.updateBrailleBar(),this._needsUpdate=!1},v.prototype.updateClear=function(){this._selectionHead.setAttribute("class","cursor blur"),this._selectionBody.setAttribute("class","cursor blur"),this._selectionTail.setAttribute("class","cursor right blur")},v.prototype.updateSingle=function(){var e=this._selectionHead,t=this._selectionBody,n=this._selectionTail;if(!(e&&t&&n))return;var r=this.getSelectionClass(),i=this.getHeadReference();if(this.isCurrentSpan(i))return this.updateExtended();var s;this.isLeft()&&w(i)&&(s=this.getBeforeSpace(),s!==this.getHeadIndex()&&(r=r.replace("left","right"),i=this.getSiblingReference(s))),this.isRight()&&w(i)&&(s=this.getAfterSpace(),s!==this.getHeadIndex()&&(r=r.replace("right","left"),i=this.getSiblingReference(s))),i=b(i),this.updateClear();if(r===null||i===null)return;i=u.createSpan(i);var o=this.getHeadReference(0).getDisplay().getXML();if(o===null)return;var a=o.parentNode;if(a===null)return;var f=u.getOffsets(i,a);u.removeSpan(i),this.isExplicit()&&(r+=" select"),E(n,f),n.setAttribute("class",r),e.parentNode===a&&a.removeChild(e),t.parentNode===a&&a.removeChild(t),n.parentNode!==a&&a.insertBefore(n,a.firstChild),this.scrollTo(f)},v.prototype.updateExtended=function(){var e=this._selectionHead,t=this._selectionBody,r=this._selectionTail;if(!(e&&t&&r))return;var i=this.getSelectionClass(),s=this.getLeftReference(),o=this.getRightReference();this.isCurrentSpan(s)&&(s=s.getReference(0)||s),this.isCurrentSpan(o)&&(o=o.getReference(o.getReferenceCount()-1)||o),s=b(s),o=b(o),this.updateClear();if(i===null||s===null||o===null)return;s=u.createSpan(s),o=u.createSpan(o);var a=this.getHeadReference(0).getDisplay().getXML();if(a===null)return;var f=a.parentNode;if(f===null)return;var l=u.getOffsets(f),c=u.getOffsets(s,f),h=u.getOffsets(o,f),p=n.extend({},this.getSelectionSide()?h:c);u.removeSpan(s),u.removeSpan(o);var d=Math.min(c.left,h.left),v=Math.max(c.left+c.width,h.left+h.width),m=Math.min(c.top,h.top),g=Math.max(c.top+c.height,h.top+h.height),y=Math.min(c.top+c.height,h.top+h.height),w=Math.max(c.top,h.top),S=d,x=m,T=v-d,N=g-m,C="none",k=this.getSelectionParent()?" select":" select blur",L="cursor blur",A=i,O=i;if(c.top+c.height<h.top+h.height/2||h.top+h.height<c.top+c.height/2){C="inline-block",i+=" vert",L="cursor",A=this.isLeft()?i:L,O=this.isLeft()?L:i,S=4,x=w,l.width-=S,c.top<h.top?(T=h.left+h.width-S,N=h.height,c.width=l.width-c.left,E(e,c)):(T=c.left+c.width-S,N=c.height,h.width=l.width-h.left,E(e,h));var M={};M.left=S,M.top=y,M.width=l.width-S,M.height=w-y,E(t,M,-1)}var _={};_.left=S,_.top=x,_.width=T,_.height=N,n(e).css("display",C),n(t).css("display",C),E(r,_,-1),e.setAttribute("class",A+k),t.setAttribute("class",L+k),r.setAttribute("class",O+k),e.parentNode!==f&&f.insertBefore(e,f.firstChild),t.parentNode!==f&&f.insertBefore(t,f.firstChild),r.parentNode!==f&&f.insertBefore(r,f.firstChild),i&&this.scrollTo(p)},v.prototype.updateComplex=function(){var e=this._selectionHead,t=this._selectionBody,r=this._selectionTail;if(!(e&&t&&r))return;var i=this.getSelectionClass(),s=this.getHeadReference(),o=this.getTailReference();this.isCurrentSpan(s)&&(s=s.getReference(0)||s),this.isCurrentSpan(o)&&(o=o.getReference(o.getReferenceCount()-1)||o),s=b(s),o=b(o),s=b(this.getHeadReference()),o=b(this.getTailReference()),this.updateClear();if(i===null||s===null||o===null)return;s=u.createSpan(s),o=u.createSpan(o);var a=this.getHeadReference(0).getDisplay().getXML();if(a===null)return;var f=a.parentNode;if(f===null)return;var l=u.getOffsets(f),c=u.getOffsets(s,f),h=u.getOffsets(o,f),p=n.extend({},c);u.removeSpan(s),u.removeSpan(o);var d=Math.min(c.left,h.left),v=Math.max(c.left+c.width,h.left+h.width),m=Math.min(c.top,h.top),g=Math.max(c.top+c.height,h.top+h.height),y=Math.min(c.top+c.height,h.top+h.height),w=Math.max(c.top,h.top),S=d,x=m,T=v-d,N=g-m,C="none",k=this.getSelectionParent()?" select":" select blur",L="cursor blur",A=i,O=i;if(c.top+c.height<h.top+h.height/2||h.top+h.height<c.top+c.height/2){C="inline-block",i+=" vert",L="cursor",A=this.isLeft()?i:L,O=this.isLeft()?L:i,S=4,x=w,l.width-=S,c.top<h.top?(T=h.left+h.width-S,N=h.height,c.width=l.width-c.left,E(e,c)):(T=c.left+c.width-S,N=c.height,h.width=l.width-h.left,E(e,h));var M={};M.left=S,M.top=y,M.width=l.width-S,M.height=w-y,E(t,M,-1)}var _={};_.left=S,_.top=x,_.width=T,_.height=N,n(e).css("display",C),n(t).css("display",C),E(r,_,-1),e.setAttribute("class",A+k),t.setAttribute("class",L+k),r.setAttribute("class",O+k),e.parentNode!==f&&f.insertBefore(e,f.firstChild),t.parentNode!==f&&f.insertBefore(t,f.firstChild),r.parentNode!==f&&f.insertBefore(r,f.firstChild),i&&this.scrollTo(p)},v.prototype.scrollTo=function(e){var t=this._sideBar,n=t?t._content:null;if(!t||!n)return;if(this.isDone()||this.isRoot())return;if(!this._selectionScroll)return;var r=e.left,i=e.top,s=e.width,o=e.height,u=16,a=48;s>u&&(this.getSelectionSide()&&(r=r+s-u),s=u),o>a/2&&(this.getSelectionSide()&&(i+=o),o=a),this.getSelectionFocus()&&t.scrollTo(r,i,s,o)},v.prototype.updateProxy=function(){var t=this._selectionTail,r=t?t.parentNode:null;if(e.isAndroid&&e.isZoom()&&this._proxy&&r){var i=this._proxy.css("left");r&&r.scrollWidth<=r.clientWidth?i=n(t).css("left"):window.visualViewport&&(e.isCrOS?i=r.clientWidth:i=window.visualViewport.offsetLeft),this._proxy.css("left",i)}},v.prototype.updateBrailleBar=function(){this._brailleBar&&this._brailleBar.update()},v}),n("editor/model/History",["editor/util/Utils","editor/config/Config","editor/expr/Content","editor/model/Selection","editor/model/State"],function(e,t,n,r,i){var s=e.Name,o=function(t){return this._selection=null,this._config=null,this._symbols=[],this._states=[],this._limit=-1,this._index=0,this.setSelection(t),this.setConfig(null),this};return o.create=function(e){return new o(e)},o.prototype._selection=null,o.prototype._config=null,o.prototype._symbols=null,o.prototype._states=null,o.prototype._limit=-1,o.prototype._index=0,o.prototype.getSelection=function(){return this._selection},o.prototype.setSelection=function(e){e instanceof r||(e=r.create()),this._selection=e},o.prototype.getConfig=function(){return this._config},o.prototype.setConfig=function(e){e instanceof t||(e=t.create()),this._config=e},o.prototype.getCount=function(){return this._states.length},o.prototype.getState=function(e){var t=null;return 0<=e&&e<this.getCount()&&(t=this._states[e]),t},o.prototype.addState=function(e){e instanceof i&&this._states.push(e)},o.prototype.getIndex=function(){return this._index},o.prototype.setIndex=function(e){0<=e&&e<=this.getCount()&&(this._index=e)},o.prototype.removeNewer=function(e){while(this.getCount()>e&&e>=0)this._states.pop();this.getIndex()>this.getCount()&&this.setIndex(this.getCount())},o.prototype.removeOlder=function(e){while(this.getCount()>e&&e>=0)this._states.shift(),this.setIndex(this.getIndex()-1)},o.prototype.saveState=function(e){this.saveContent(e,this._selection.getDocumentContent()),this.saveSelection(e,this._selection)},o.prototype.restoreState=function(e){e.setPosition(0),this._selection.setDocumentContent(this.loadContent(e)),this.loadSelection(e,this._selection)},o.prototype.restoreStatePosition=function(e){e.setPosition(0),this.loadContent(e),this.loadSelection(e,this._selection)},o.prototype.saveContent=function(e,t){var n=t.getCount();e.saveInt(n),n===0&&e.saveSymbol(t.getSymbol());var r;for(r=0;r<n;r+=1)this.saveContent(e,t.getChild(r))},o.prototype.saveSelection=function(e,t){var n=t.getHeadIndexCount();e.saveInt(n);var r;for(r=0;r<n;r+=1)e.saveInt(t.getHeadIndex(r));n=t.getTailIndexCount(),e.saveInt(n);for(r=0;r<n;r+=1)e.saveInt(t.getTailIndex(r));e.saveInt(t.getSelectionSide()?1:0),e.saveInt(t.getSelectionWidth())},o.prototype.loadContent=function(e){var t=this.getConfig(),r=e.loadInt(),i=null;if(r===0)i=n.create(t),i.setSymbol(e.loadSymbol());else if(r>e.getLength())e.setPosition(e.getLength());else{i=n.create(t);var o,u;for(o=0;o<r;o+=1)i.addChild(this.loadContent(e)),o===0&&(u=i.getAttrib(s._xmlns),u&&(i._attributes.xmlns=u))}return i},o.prototype.loadSelection=function(e,t){t.done();var n=e.loadInt(),r,i,s;for(r=0;r<n;r+=1)t.inn(e.loadInt());t.setTailReferenceDone(),n=e.loadInt();for(r=0;r<n;r+=1)i=e.loadInt(),t.addTailIndex(i),s=t.getTailReference().getReference(i),t.addTailReference(s);t.setSelectionSide(e.loadInt()!==0),t.setSelectionWidth(e.loadInt()),t.isDone()&&t.prev(),t.update()},o.prototype.canUndo=function(){return this.getIndex()>1},o.prototype.canRedo=function(){return this.getIndex()<this.getCount()},o.prototype.undo=function(e){var t=this.getIndex()-(e||1);t>0&&(this.setIndex(t),this.restore())},o.prototype.redo=function(e){var t=this.getIndex()+(e||1);t<=this.getCount()&&(this.setIndex(t),this.restore())},o.prototype.save=function(){var e=this.getIndex(),t=this.getCount(),n;for(n=t-1;n>=e;n-=1)this.addState(this.getState(n-1));var r=i.create(this.symbols);this.saveState(r),this.addState(r),this.removeOlder(this._limit),this.setIndex(this.getCount())},o.prototype.restore=function(){this.restoreState(this.getState(this.getIndex()-1))},o.prototype.restorePosition=function(){this.restoreStatePosition(this.getState(this.getIndex()-1))},o.prototype.pop=function(){this.canUndo()&&(this.setIndex(this.getIndex()-1),this._states.pop())},o.prototype.clearNewer=function(){this.canUndo()&&(this.removeNewer(1),this.restore())},o.prototype.clearOlder=function(){this.canUndo()&&this.removeOlder(1)},o.prototype.reset=function(){this.clearNewer()},o.prototype.clear=function(){this.restoreState(this.getState(0)),this.save()},o}),n("editor/model/Model",["editor/util/Utils","editor/expr/Content","editor/expr/Template","editor/control/FocusController","editor/control/ScrollController","editor/control/ZoomController","editor/panel/Panel","editor/model/Selector","editor/model/History"],function(e,t,n,r,i,s,o,u,a){var f=e.$,l=e.Key,c=e.Object,h=e.Name,p=e.XML,d,v=function g(e){return this._handler=null,this._history=null,this._editableSelector=null,this._responseSelector=null,this._mathIt=!1,this._mathSense=!1,this._brailleBar=!1,this._buttonBar=!0,this._carousel=!1,this._quickBar=!1,this._sideBar=!1,this._moreMenu=!1,this._collapsible=!0,this._toolTips=!0,this._scrollBars=!0,this._responseLimit=0,this._echoAction=!1,this._keyMode=g.KEY_MODE_QWERTY,this._showKeyMode=!0,this._keyHistory=0,this._keyPrefix="",this._keyType="",this._contrast="",this._focus=r.create(this),this._scroll=i.create(this),this._zoom=s.create(this),this._recoverCount=1,this._recoverIndex=1,this._pendingCount=0,this._typesetCount=0,this._lastUpdate=0,this._templates=[],this.setHistory(e),this.startQueue(),this};v.KEY_MODE_BRAILLE=0,v.KEY_MODE_QWERTY=1,v.KEY_MODE_MULTI=2,v.create=function(e){return new v(e)},v.prototype.destroy=function(){this.stopQueue(),this._focus&&(this._focus.destroy(),this._focus=null),this._scroll&&(this._scroll.destroy(),this._scroll=null),this._zoom&&(this._zoom.destroy(),this._zoom=null)},v.prototype._handler=null,v.prototype.getHandler=function(){return this._handler},v.prototype.setHandler=function(e){this._handler=e},v.prototype._history=null,v.prototype.getHistory=function(){return this._history},v.prototype.setHistory=function(e){e instanceof a||(e=a.create()),this._history=e},v.prototype.getSelection=function(){return this.getHistory().getSelection()},v.prototype.setSelection=function(e){this.getHistory().setSelection(e)},v.prototype.getConfig=function(){return this.getHistory().getConfig()},v.prototype.setConfig=function(e){this.getHistory().setConfig(e)},v.prototype._editableSelector=null,v.prototype.getEditableSelector=function(){return this._editableSelector},v.prototype.setEditableSelector=function(e){if(e===null||c.isString(e))e&&e.substr(e.length-2)!==" >"&&(e+=" >"),this._editableSelector=e},v.prototype.hasEditableEnd=function(){var e=this.getEditableSelector();return e===null||e==="body >"?!0:!1},v.prototype.isSelectable=function(e,t){var n=this.getEditableSelector();if(n===null)return!0;var r=this.getSelection().isRight()?h._right:h._left;n==="inputs >"&&(u.match("input mtable >",e,r)!==-1?n="input mtd >":n="input >");if(u.match(n,e,r)===-1)return!1;n=n.substring(0,n.length-2);if(u.match(n,e,r)!==-1)if(!t||!e.isApplyOp(h._body))return!1;return!t&&e.isApplyOp(h._p)?!1:!0},v.prototype._responseSelector=null,v.prototype.getResponseSelector=function(){return this._responseSelector},v.prototype.setResponseSelector=function(e){if(e===null||c.isString(e))this._responseSelector=e},v.prototype._mathIt=!1,v.prototype.getMathIt=function(){return this._mathIt},v.prototype.setMathIt=function(e){c.isString(e)&&(e=c.toBoolean(e)),c.isBoolean(e)&&(this._mathIt=e)},v.prototype._mathSense=!1,v.prototype.getMathSense=function(){return this._mathSense},v.prototype.setMathSense=function(e){c.isString(e)&&(e=c.toBoolean(e)),c.isBoolean(e)&&(this._mathSense=e)},v.prototype._brailleBar=!1,v.prototype.getBrailleBar=function(){return this._brailleBar},v.prototype.setBrailleBar=function(e){c.isString(e)&&(e=c.toBoolean(e)),c.isBoolean(e)&&(this._brailleBar=e)},v.prototype._buttonBar=!0,v.prototype.getButtonBar=function(){return this._buttonBar},v.prototype.setButtonBar=function(e){c.isString(e)&&(e=c.toBoolean(e)),c.isBoolean(e)&&(this._buttonBar=e)},v.prototype._carousel=!1,v.prototype.getCarousel=function(){return this._carousel},v.prototype.setCarousel=function(e){c.isString(e)&&(e=c.toBoolean(e)),c.isBoolean(e)&&(this._carousel=e)},v.prototype._quickBar=!1,v.prototype.getQuickBar=function(){return this._quickBar},v.prototype.setQuickBar=function(e){c.isString(e)&&(e=c.toBoolean(e)),c.isBoolean(e)&&(this._quickBar=e)},v.prototype._sideBar=!1,v.prototype.getSideBar=function(){return this._sideBar},v.prototype.setSideBar=function(t){t==="auto"&&(t=!e.useMoreMenu),c.isString(t)&&(t=c.toBoolean(t)),c.isBoolean(t)&&(this._sideBar=t)},v.prototype._moreMenu=!1,v.prototype.getMoreMenu=function(){return this._moreMenu},v.prototype.setMoreMenu=function(t){t==="auto"&&(t=e.useMoreMenu),c.isString(t)&&(t=c.toBoolean(t)),c.isBoolean(t)&&(this._moreMenu=t)},v.prototype._collapsible=!0,v.prototype.getCollapsible=function(){return this._collapsible},v.prototype.setCollapsible=function(e){c.isString(e)&&(e=c.toBoolean(e)),c.isBoolean(e)&&(this._collapsible=e)},v.prototype._toolTips=!0,v.prototype.getToolTips=function(){return this._toolTips},v.prototype.setToolTips=function(e){c.isString(e)&&(e=c.toBoolean(e)),c.isBoolean(e)&&(this._toolTips=e)},v.prototype._scrollBars=!0,v.prototype.getScrollBars=function(){return this._scrollBars},v.prototype.setScrollBars=function(e){c.isString(e)&&(e=c.toBoolean(e)),c.isBoolean(e)&&(this._scrollBars=e)},v.prototype._responseLimit=0,v.prototype.getResponseLimit=function(){return this._responseLimit},v.prototype.setResponseLimit=function(e){c.isString(e)&&(e=c.toInteger(e)),c.isInteger(e)&&e>=0&&(this._responseLimit=e)},v.prototype.getResponseCount=function(){var e=this.getSelection(),t=e.getDocumentContent();return t.getExpressionCount()},v.prototype._echoAction=!1,v.prototype.getEchoAction=function(){return this._echoAction},v.prototype.setEchoAction=function(e){c.isString(e)&&(e=c.toBoolean(e)),c.isBoolean(e)&&(this._echoAction=e)},v.prototype._keyMode=v.KEY_MODE_QWERTY,v._lastKeyMode=null,v.prototype.isKeyMode=function(){return this.getKeyMode()!==v.KEY_MODE_QWERTY},v.prototype.getKeyMode=function(){return this._keyMode},v.prototype.setKeyMode=function(e){c.isString(e)&&(e=c.toInteger(e)),c.isInteger(e)&&(this._keyMode=e,v._lastKeyMode=e)},v.prototype._keyHistory=0,v.prototype._keyPrefix="",v.prototype._keyType="",v.prototype.getKeyType=function(){var e=this.getHistory().getIndex()-this._keyHistory;return e>0&&this._keyType?this._keyType:this.setKeyType()},v.prototype.setKeyType=function(){var e=this.getSelection().getCurrentContent().isMathMode();return this._keyType=e?"math":"text",this._keyType},v.prototype.clearKeyHistory=function(){this._keyHistory=this.getHistory().getIndex(),this._keyPrefix="",this.setKeyType()},v.prototype.restoreKeyHistory=function(){var e=this;this._templates.push(["restoreKeyHistory",function(){var t=e.getHistory(),n=t.getIndex()-e._keyHistory;n>0&&(t.undo(n),e.setKeyType())}])},v.prototype._contrast="",v.prototype.getContrast=function(){return this._contrast},v.prototype.setContrast=function(e){c.isString(e)&&(this._contrast=e)},v.prototype._focus=null,v.prototype.getFocusController=function(){return this._focus},v.prototype._scroll=null,v.prototype.getScrollController=function(){return this._scroll},v.clipboardData=null;var m=function(e){var t=e.getParent();if(!t)return!1;if(e.isOp())return!0;var n=t.getOp();return n===h._b||n===h._i||n===h._u||n===h._s||n===h._tt?!0:!1};return v.prototype.getClipboardContent=function(){var e=this.getSelection(),t=e.getCurrentContent(),n=e.getParentContent(),r=t,i=e.getHeadIndex(),s=e.getOtherIndex(),o,u;if(e.isComplex())t=r=e.getComplexContent();else if(t.isOp()||n.isApplyOp(h._mxf))t=r=n;else if(i!==s||t.isText()){r=n.create(),o=n.getHead(),r.addChild(n.copy(o));var a=i<s?i:s,f=i<s?s:i,l;for(l=a;l<=f;l+=1)u=e.getSiblingReference(l).getContent(),u.getParent()===n&&u!==o&&r.addChild(n.copy(u));t=n,n=t.getParent()}while(m(t))u=r,r=n.create(),o=n.getHead(),r.addChild(n.copy(o)),r.addChild(u),t=n,n=t.getParent();var c=r.getOp(),d=c.getURI(),g=d===h.NS_MATH?h._math:h._html;return c!==g&&(r===t&&(r=r.copy(r)),r=r.createApplyOp(g,r),r._attributes.xmlns=h.get(d)),v.clipboardData=p.print(r.markup()),v.clipboardData},v.prototype.setClipboardContent=function(e){var n=v.clipboardData;if(!n)return;var r=this.getSelection(),i=this.getConfig();r.isComplex()&&(r.moveToContent(r.getComplexContent()),r.makeExplicit());var s=t.expand(p.valueOf(n),i);if(s===null)return;var o=r.getParentContent();if(o===null)return;var u,a=o.getOp(),f=a.getURI(),l=s.getOp(),c=l.getURI(),d=c===h.NS_HTML?h._html:h._math;if(c!==h.NS_MATH&&c!==h.NS_HTML)return;f!==h.NS_MATH&&f!==h.NS_HTML&&(f=h.NS_MATH);if(c===h.NS_HTML){var m;while(f!==h.NS_HTML)a===h._times&&o.getClass().getName()==="paste"&&(r.getSelectionSide()?u=o.getApplyArg(1):u=o.getApplyArg(2),m=o.getParent(),m.suspend(),m.insertChildBefore(o,u),m.removeChild(o),m.resume(),m.layout(),o=u),r.moveToContent(o),o=o.getParent(),a=o.getOp(),f=a.getURI();r.setSelectionSide(!0)}f===c&&l===d&&(s=s.getApplyArg(1)),f!==c&&l!==d&&(s=s.createApplyOp(d,s),s._attributes.xmlns=h.get(c)),l=s.getOp();while(o.isToken()&&!s.isToken()&&l!==h._math||o.isToken()&&s.isToken()&&a!==l||a===h._mxf&&l!==h._cn||r.getCurrentContent().isOp()){if(a===h._p)break;r.out(),o=r.getParentContent(),a=o.getOp(),f=a.getURI()}var g=r.getHeadIndex(),y=r.getOtherIndex(),b=r.getSelectionWidth(),w=r.isRight()?1:0,E,S=!1;o.suspend();if(f===h.NS_HTML&&r.isExtendRow()&&b===0)u=r.getSiblingReference(g).getContent(),g=o.getApplyIndex(u)+w,u.isPlace()&&(o.removeChild(u),g-=w);else if(f!==h.NS_HTML&&o.isToken()&&b===0)u=r.getSiblingReference(g).getContent(),g=o.getApplyIndex(u)+w;else if(f!==h.NS_HTML&&b===0&&!r.isPlace()&&!r.getHeadContent().isOp())this.processTemplate("paste"),S=!0;else{var x=g<y?g:y,T=g<y?y:g,N=o.getHead();g=0;for(E=x;E<=T;E+=1)u=r.getSiblingReference(E).getContent(),u.getParent()===o&&u!==N&&(g===0&&(g=o.getApplyIndex(u)),o.removeChild(u));g===0&&(r.isSiblingIndex(x+1)&&(u=r.getSiblingReference(x+1).getContent()),u&&u!==N&&u.getParent()===o?g=o.getApplyIndex(u):(o.resume(),S=!0))}if(S)return;var C=s,k=s;if(a===h._p&&l===h._body){var L=s.getApplyArg(1),A=s.getApplyArg(s.getApplyArgc()),O=A.getApplyArgc();C=k=A.getApplyArg(O);for(E=o.getApplyArgc();E>=1;E-=1)u=o.removeChildAt(E),E<g?L.insertChildAt(1,u):A.insertChildAt(O+1,u);o.resume(),o.layout(),r.out(),o=r.getParentContent(),a=o.getOp(),f=a.getURI(),g=o.getApplyIndex(r.getCurrentContent()),o.suspend(),o.removeChildAt(g)}a===h._body&&l!==h._p&&l!==h._body&&(s=o.createApplyOp(h._p,s));var M=s.getApplyArgc(),_=o.getClass(),D=s.getClass();l=s.getOp();if(a===l&&_===D&&M>0&&r.isExtendRow()){C===s&&k===s&&(C=s.getApplyArg(1),k=s.getApplyArg(M));for(E=M;E>=1;E-=1)o.insertChildAt(g,s.getApplyArg(E))}else o.insertChildAt(g,s),l===h._p&&M>0&&(C=s.getApplyArg(1),k=s.getApplyArg(M)),M=1;a===h._body&&e&&(C=this.mergeParagraph(g),k=this.mergeParagraph(g+M-1)),o.layout(),o.resume(),r.onSelect(k)},v.prototype.getCurrentContentXML=function(){return this.getSelection().getCurrentContent().markup()},v.prototype.setCurrentContentXML=function(e){this.getSelection().setCurrentContent(this.expandContent(e))},v.prototype.expandContent=function(e){var n=this.getConfig(),r=t.expand(e,n);return r instanceof t||(r=t.create(n).createPlace()),!r.isApplyOp(h._math)&&!r.isApplyOp(h._html)&&(r=r.createApplyOp(h._math,r),r.setAttrib(h._xmlns,h.get(h.NS_MATH))),r},v.prototype.processTypeset=function(){if(this._typesetCount>0)return;this._typesetCount+=1,this._pendingCount=0;var t=this._editor,n=t.getPanel(o.PARENT),r=t.getPanel(o.INPUT),i=t.getPanel(o.SCRATCH),s=this,u=function(){var o=t.model();if(o===null)return;try{var u=(new Date).getTime(),a=u-s._lastUpdate,l,c,h=r.height();if(MathJax.Hub.lastError){l=i.children(".MathJax_Error").clone(),r.empty(),r.append(l),s._lastUpdate=u,i.empty(),i.prepend("<math/>");var p=i[0];MathJax.Hub.Queue(["Typeset",MathJax.Hub,p]),MathJax.Hub.lastError=null}else if(s._pendingCount===0||a>300)l=i.children().first(),l.hasClass("MathJax_Preview")&&(l.remove(),l=i.children().first()),l.attr("tabindex",-1),f("[tabindex]",l).attr("tabindex",-1),l=l.clone(),c=l,c.hasClass("mjx-chtml")||(c=f(".mjx-chtml",l)),c.length>0&&(c.removeAttr("id"),f("[id]",c).removeAttr("id"),f(".MJX_Assistive_MathML",c).removeAttr("aria-hidden"),c.css("position",""),c.attr("role","math")),f("script",l).remove(),r.empty(),r.append(l),s._lastUpdate=u;s._pendingCount===0&&(t.processDisplay(),s.getSelection()._update()),s._typesetCount-=1,n.trigger("eeResponseReady"),s._stopQueue===2&&(s.stopQueue(),s._stopQueue=1),h!==r.height()&&t.resizeOthers()}catch(d){var v="EquationEditor.processTypeset callback:  ";e.log(v+d.message)}};try{var a=t.processStyle(),l=i[0];if(p.isTheElement(a,"math")){var c=MathJax.Hub.getAllJax(l)[0];MathJax.Hub.Queue(["Text",c,p.toString(a),u])}else if(!d(a))i.empty(),i.prepend(a),MathJax.Hub.Queue(["Typeset",MathJax.Hub,l,u]);else{var h=l.firstChild;l.removeChild(h);var v=f("math",a),m=f(".mjx-chtml",h),g=v.length,y=m.length,b=f("<span>")[0],w=[],E,S,x,T,N,C,k;for(C=0,k=0;C<g;C+=1,k+=1)E=v[C],S=k<y?m[k]:null,T=p.toString(E),N=S?p.toString(f("math",S)[0]):"",T===N?E.parentNode.replaceChild(S,E):g<y&&k<y-1?C-=1:(x=f("<span>")[0],E.parentNode.replaceChild(x,E),b.appendChild(E),w.push(x),y<g&&(k-=1));l.appendChild(a);if(w.length===0)u();else{var L=function(){f(".MathJax_Preview",b).remove(),f("script",b).remove();for(C=w.length-1;C>=0;C-=1)S=b.children[C],x=w[C],x.parentNode.replaceChild(S,x);l.removeChild(b),u()};l.appendChild(b),MathJax.Hub.Queue(["Typeset",MathJax.Hub,b,L])}}}catch(A){var O="EquationEditor.processTypeset call:  ";e.log(O+A.message)}},d=function(e){if(p.isTheElement(e,"div")&&e.children.length===1){e=e.children[0];if(p.isTheElement(e,"div")){var t=e.children.length,n;for(n=0;n<t;n+=1)if(!p.isTheElement(e.children[n],"p"))return!1;return!0}}return!1},v.prototype.processQueue=function(){var e=this._templates.shift();while(e)this.processStage(e),e=this._templates.shift();this._pendingCount>0?this.processTypeset():this._typesetCount===0&&(this.getSelection()._update(),this._stopQueue===1&&(this.stopQueue(),this._stopQueue=0))},v.prototype.processStage=function(t){try{var r=h.user(t[0]),i=r.getName(),s,o=this.getResponseCount();if(isNaN(o)){s="EquationEditor:  null expression before "+i,e.log(s);if(!this.restoreState()){e.error(s);return}}var u=t[1]===n.processMath;if(u&&!this.checkGapBoundary()){s="EquationEditor:  outside gap before "+i,e.log(s);if(!this.restoreState()){e.error(s);return}}var a=this.getResponseLimit();a>0&&o>a&&(l.limitEnabled[t[0]]||(r=h.user("responseLimit")));var f=t[1],c=t[2];f(r,this,c),o=this.getResponseCount();if(isNaN(o)){s="EquationEditor:  null expression after "+i,e.log(s),this.restoreState()||e.error(s);return}var p=t[1]===n.processPost;if(p&&!this.checkGapBoundary()){s="EquationEditor:  outside gap after "+i,e.log(s),this.restoreState()||e.error(s);return}if(p){this._recoverCount=this.getHistory().getCount(),this._recoverIndex=this.getHistory().getIndex();if(i!=="tab"&&i!=="shift-tab"){var d=this.getFocusController();d.clearSelection(),d.saveSelection()}}}catch(v){e.log(v.message),this.restoreState()||e.error(v.message)}},v.prototype.checkGapBoundary=function(){var e=this.getSelection(),t=e.getCurrentContent(),n=this.getEditableSelector(),r=e.getSelectionWidth(),i=e.isRight()?h._right:h._left;return n==="inputs >"&&(u.match("input mtable >",t,i)!==-1?n="input mtd >":n="input >"),u.match(n,t,i,r)!==-1},v.prototype.restoreState=function(){var t=this.getHistory();return t.removeNewer(this._recoverCount),t.setIndex(this._recoverIndex),t.restore(),isNaN(this.getResponseCount())?!1:this.checkGapBoundary()?(e.log("EquationEditor:  restored previous state"),!0):!1},v.prototype.startQueue=function(){if(this._processId)return;e.stopThread(this._processId),this._processId=e.runEvery(30,this.processQueue.bind(this)),this._stopQueue=0},v.prototype.stopQueue=function(){if(!this._processId)return;if(this.getFocusController().inputHasFocus())return;e.stopThread(this._processId),this._processId=0},v.prototype.flushQueue=function(){this._templates=[]},v.prototype.processTemplate=function(e,t){this._templates.push([e,n.processMath]),this._templates.push([e,n.processPre]),this._templates.push([e,n.processMain,t]),this._templates.push([e,n.processPost])},v.prototype.processPost=function(e){this._templates.unshift([e,n.processPost])},v.prototype.mergeParagraph=function(e){var t=this.getSelection(),n=t.getParentContent(),r=n.getApplyArg(e-1),i=r.getApplyArgc(),s=n.getApplyArg(e),o=s.getApplyArgc();n.suspend();var u,a;i!==0?(u=r.getApplyArg(i),t.setSelectionSide(!0)):o!==0?(u=s.getApplyArg(1),t.setSelectionSide(!1)):(u=r.addChild(r.createPlace()),t.setSelectionSide(!0));for(a=1;a<=o;a+=1)r.addChild(s.removeChildAt(1));return n.removeChild(s),n.resume(),n.layout(),u},v}),n("editor/panel/BrailleBar",["editor/util/Utils","editor/expr/Content","editor/expr/Template","editor/panel/Panel","editor/model/Model","lib/bootstrap"],function(e,t,n,r,i){var s=e.Array,o=e.Name,u,a,f,l,c,h,p,d,v,m=function(e,t){return t instanceof i||(t=null),this._parent=e,this._model=t,this._panel=null,this._proxy=null,this._config=null,this._factory=null,this._brailleString=null,this._updateTo=null,this._routeTo=null,this.build(),this};m.create=function(e,t){return new m(e,t)},m.prototype.destroy=function(){this._parent=null,this._model=null,this._panel=null,this._proxy=null,this._config=null,this._factory=null,this._brailleString=null},m.prototype.model=function(){return this._model},m.prototype.config=function(){return this._config},m.prototype.factory=function(){return this._factory},m.prototype.build=function(){this._panel=this._parent.find("."+r.BRAILLE),this._proxy=this._parent.find("."+r.PROXY);var e=this._panel;e.hide();var n=this.model();if(!n||!n.getBrailleBar())return;this._config=n.getConfig().copy("braille"),this._factory=t.create(this._config),e.append('<textarea disabled="true" aria-hidden="true"/>'),e.show()},m.prototype.update=function(t){var n=this.model();if(!n||!n.getBrailleBar())return;var r=n.getSelection(),i=r.getDocumentContent();this.processContent(i);var s=this._brailleString,o=this.processSelected(s),u=s.index,a=this._proxy[0];if(a){var f=o,l=f.indexOf("\n",u+1);l!==-1&&(f=f.substr(0,l)),f+="⠀";var c=this;t?c._routeTo=u:c._updateTo=u,e.runOnce(150,function(){var e=c._routeTo,t=c._updateTo;if(u!==e&&u!==t)return;c._routeTo=null,c._updateTo=null,n.getHandler().isProxyValue(f,u)||n.getHandler().setProxyValue(f,u)})}var h=o.charCodeAt(u),p=h===10?"⣀\n":String.fromCharCode(h|10432),d=this._panel.find("textarea")[0];d.value=o.substr(0,u)+p+o.substr(u+1)},m.prototype.route=function(e){var t=this.model();if(!t||!t.getBrailleBar())return;var n=t.getSelection(),r=this._brailleString,i=u(r,e-1),s=u(r,e),o=!1;i&&!a(i,s)?(f(n,i),n.setRight(),o=!0):s&&!a(s,i)&&(f(n,s),n.setLeft(),o=!0);if(o){this.update(!0);if(t.getEchoAction()){var l=this.getRouteTemplate("route");l.setAssoc({}),l.setModel(t),l.echoAction(t,!0)}}},m.prototype.getRouteTemplate=function(e){return n.mouse(o.user(e),this.model())},m.prototype.processContent=function(e){e=this.factory().copy(e),e.layout();var t=e.getPresent(),n=t.getReference(0);t=n.getPresent();var r=this.model(),i=r.getSelection();i.markState(e);var s={};s.t=[],s.v=[],this._brailleString=s,this.processBraille(t,n,s),s.s=s.t.join(""),delete s.t;var o=r.getConfig();return s.global=o.getBrailleOutput()==="",d(s),v(s),s.s},m.prototype.processBraille=function(e,t,n){var r,i,s,o,u;r=t.getReferenceCount();var a;for(i=0;i<r;i+=1){a=t.getReference(i);if(a.getPresent()===e&&!a._isProcessed){a._isSelected=a._isSelected||t._isSelected||null,a._isProcessed=!0,t=a;break}}if(e.isSymbol()){s=e.getString();if(s==="&it;")n.v.push({string:"",refer:t});else{r=s.length;for(i=0;i<r;i+=1)o=s.charAt(i),u=s.charCodeAt(i),u===10368&&(o="\n"),10240<=u&&u<10496&&(n.t.push(o),n.v.push({string:o,refer:t}))}}else{r=e.getApplyArgc();for(i=1;i<=r;i+=1)this.processBraille(e.getApplyArg(i),t,n)}},m.prototype.processSelected=function(e){var t=this.model(),n=t.getSelection(),r=e.s.length,i=r,s=r,o,u,a,f,l=0,c=0;for(f=0;f<e.v.length;f+=1)o=e.v[f].string,u=e.v[f].refer,a=u?u._isSelected:null,a&&(i===r&&(i=l),s=l,c=n.isLeft()||a.isPlace()||!o?0:1),l+=o?1:0;var h=n.isLeft()?i:s+c;if(i<r){var p=n.isImplicit()?10368:10432,d,v=[];for(f=i;f<=s;f+=1){d=e.s.charCodeAt(f);if(f===i||f===s)d|=f===h?0:p;v.push(d)}var m=String.fromCharCode.apply(null,v);e.s=e.s.substr(0,i)+m+e.s.substr(s+1)}return e.index=h,e.s},u=function(e,t){var n=e.v.length,r,i=0,s=null,o,u,a,f,l,c,h;for(r=0;r<n;r+=1){s=e.v[r].string;if(i===t&&s){a=e.v[r].refer;if(a===null)return null;f=a.getContent();if(f.getOpParent()===null)return null;l=f.getOpParent().getPresent(),c=f._source;if(c.getOpParent()===null)return null;h=c.getOpParent().getPresent(),o=l.getReferenceCount();if(h.getReferenceCount()!==o)return c;for(u=0;u<o;u+=1)if(l.getReference(u)===a)return h.getReference(u);return c}i+=s?1:0}return null},a=function(e,t){return e===null||t===null?!1:(e=e._content||e,t=t._content||t,e.contains(t))},f=function(e,n){n instanceof t?e.onSelect(n):e.onSelectReference(n)},l=function(e,t,n){var r=e.length,i=0,s=r,o=0,u=0,a=null;for(o=0;o<r;o+=1){a=e[o].string,u===t&&a&&(i=o);if(u===n){s=o;break}u+=a?1:0}return e.splice(i,s-i)},c=function(e,t,n,r){var i=e.length,o=i,u=0,a=0,f=null;for(u=0;u<i;u+=1){f=e[u].string;if(a===t&&f){o=u;break}a+=f?1:0}if(r){var l=(e[o-1]||{}).refer||null,c=(e[o]||{}).refer||null;r=l&&c?null:l||c,r&&s.each(n,function(e){e.refer=r})}var h=[o,0].concat(n);return e.splice.apply(e,h)},h=function(e,t,n,r){var i=r[0],s=r.index,o=e.s.length,u=r.index+i.length;e.s=e.s.replace(t,n);var a=e.s.length,f=u+a-o,h=l(e.v,s,u),p=null,d;for(d=0;d<h.length;d+=1)if(p===null)p=h[d].refer;else if(h[d].refer!==p){p=null;break}var v=[];for(d=s;d<f;d+=1)v.push({string:e.s.charAt(d),refer:p});c(e.v,s,v,p===null);var m,g,y,b,w;for(d=1;d<r.length&&r[d];d+=1)w=r[d],m=e.s.indexOf(w,s),g=m+w.length,l(e.v,m,g),y=i.indexOf(w),b=y+w.length,c(e.v,m,l(h.slice(),y,b))},p=function(e,t,n,r){var i,s,o,u,a=new RegExp(t.source,"g");a.lastIndex=0;var f;for(f=a.exec(e.s);f;f=a.exec(e.s))o=f.index,u=e.global,u||(i=e.s.lastIndexOf("⠸⠩",o),s=e.s.lastIndexOf("⠸⠱",o),u=r?i<=s:i>s),u?h(e,t,n,f):o+=1,a.lastIndex=o};var g={};return g.string="⠀",d=function(e){if(e.global)return;var t=function(e,t,n){p(e,t,n,!0)};return e.s="⠀"+e.s,e.v.splice(0,0,g),t(e,/(\u2800\u2824?)\u28E0/,"$1⠼"),t(e,/\u28E0/,""),t(e,/^\u2800/,""),e.s},v=function(e){var t;return e.global&&(e.s="⠀"+e.s+"⠀",e.v.splice(0,0,g),e.v.push(g)),p(e,/\u28F1\u28E1/,"⠐"),p(e,/[\u28E1\u28F1]+/,""),p(e,/\u28F2\u28E2/,"⠐"),p(e,/[\u28E2\u28F2]+/,""),p(e,/([\u2821\u2824\u282C])\u28E3/,"$1⠀"),p(e,/\u28E3+/,""),p(e,/\u28F5\u28E4/,""),p(e,/\u28F5\u283C/,"⠼"),p(e,/([\u2818\u2830\u28FF])\u28E5/,"$1"),p(e,/[\u28E5\u28F5]/,"⠀"),p(e,/\u28FE\u28FE\u28E0/,"⠐"),p(e,/\u28FE\u28FE\u28E6/,""),t="⣾⣾(⠐[⠘⠰])",p(e,new RegExp(t),"⣿⣿$1"),p(e,/\u28FE\u28FE/,""),t="⣾[⠘⠰]*⣿⣦(⠄|⠐[⠘⠰])",p(e,new RegExp(t),"$1"),t="⣾([⠘⠰]*⣿(⣶⣦)?⠐[⠘⠰])",p(e,new RegExp(t),"⣿$1"),p(e,/[\u28E6\u28F6]+/,""),t="([⠀⣳]⠤?)((⠨⣰(⣽⣾⣿|⠐)?)?⣠)",p(e,new RegExp(t),"$1⠼$2"),p(e,/\u28F3+/,""),p(e,/\u28F4/,"⠀"),p(e,/\u28F0(\u28FD\u28FE\u28FF)\u28E0/,"$1"),p(e,/\u28F0([^\u28E0])/,"⠐$1"),p(e,/[\u28E0\u28F0]+/,""),t="⣽⣾[⠘⠰]*⣿(⠠?.)⠣⠱⠻",p(e,new RegExp(t),"$1⠱"),t="⠐([⠘⠰]+)⣽⣾\\1⣿",p(e,new RegExp(t),"⠐$1⣿⣿"),p(e,/\u28FD\u28FE([\u2818\u2830]+)\u28FF/,"$1⣿⣿"),p(e,/\u28FD\u28FE\u28FF/,"⠐"),p(e,/\u28FE([\u2818\u2830]*)\u28FF/,"⠐$1"),p(e,/[\u2818\u2830]+\u2810/,"⠐"),p(e,/\u2810+\u2810/,"⠐"),p(e,/\u2810([\u2818\u2830])/,"$1"),p(e,/\u28FF([\u2818\u2830]+)\u28FF/,"$1"),p(e,/\u28FF\u28FF/,"⠐"),p(e,/\u2810?\u28E4/,""),p(e,/\u2810\u2800/,"⠀"),p(e,/\u2837\u2800/,"⠀⠷"),p(e,/\u2800\u283E/,"⠾⠀"),p(e,/\u28F7\u28E7/,"⠀"),p(e,/[\u28E7\u28F7]+/,""),t="⠈⠜⠀+⠈⠜",p(e,new RegExp(t),"⠈⠜⠈⠜"),p(e,/^\u2800+/,""),p(e,/\u2800+$/,""),p(e,/\u2800\u2800+/,"⠀"),e.s},m}),n("editor/panel/ButtonBar",["editor/util/Utils","editor/panel/Panel","editor/model/Model","lib/bootstrap"],function(e,t,n){var r=e.$,i=e.Key,s=e.XML,o=e.Array,u=e.Event,a,f,l,c,h,p,d,v,m,g,y=0,b=0,w=function(e,t){return t instanceof n||(t=null),this._parent=e,this._model=t,this._more=null,this.build(),this};w.create=function(e,t){return new w(e,t)},w.prototype.destroy=function(){this._parent=null,this._model=null,this._more=null},w.prototype.parent=function(){return this._parent},w.prototype.model=function(){return this._model},w.prototype.config=function(){return this.model().getConfig()},w.prototype.build=function(){var e=this.parent(),n=e.find("."+t.BAR),r=this.model();if(!r.getButtonBar()){n.hide();return}var i=[];this.collect("home",i);if(i.length===0){r.setButtonBar(!1),n.hide();return}var s=e.find("."+t.INPUT),o=e.find("."+t.MORE),u=r.getFocusController();u.setInput(s),u.addPanel(n),this._more=o,y=0,b=0,this.processTop(n,"top"),this.processExtra(n,"left"),this.process(n,i),this.processExtra(n,"right"),this.attach(n)},w.prototype.collect=function(e,t){var n=this.config().getButtonBarInfo(e);n&&t.push(e);var i=s.getAttr(n,"back");i&&!o.contains(t,i)&&this.collect(i,t);var u=s.getAttr(n,"more");u&&!o.contains(t,u)&&this.collect(u,t);var a=this;r(n).children().each(function(){if(s.localName(this)==="buttonBar"){var e=s.getAttr(this,"ref");e&&!o.contains(t,e)&&a.collect(e,t)}})},w.prototype.processTop=function(t,n){var i=this.config().getButtonBarInfo(n);if(!(i&&s.children(i).length>0))return;var u=this.config(),a=this.model().getToolTips(),f=[];f.push('<div class="ee-'+n+'-button-bar">');var l=[];l.push('<div class="ee-button-bar on" id="ee-button-bar-'),l.push(n),l.push('">');var c=[],h=0;y+=1,r(i).children().each(function(){var e=this,t=s.localName(e);if(t!=="button")return;var n=s.getAttr(e,"ref"),i=u.getButtonInfo(n);if(!i)return;var l=r("label",e),p=r("label",i),d=l.text()||p.text()||"&nbsp;",v=s.processStyles(p,l)||"",m=l.attr("class")||p.attr("class")||"",g=l.attr("icon")||p.attr("icon");m+=" ee-button btn btn-large",g&&(d="",o.each(g.split(" "),function(e){d+='<i class="'+e+' icon"></i>'}));var b=r("tooltip",e).text()||r("tooltip",i).text()||"",w=r("template",i),E=w.attr("name")||w.attr("char");h===0&&c.push('<div class="btn-group">'),c.push("<button"),E&&c.push(' name="'+E+'"'),h+=1,c.push(' class="'),c.push(m),c.push('" data-row="'),c.push(y),c.push('" data-index="'),c.push(h),a&&b&&(c.push('" data-toggle="tooltip" title="'),c.push(b)),b&&(c.push('" aria-label="'),c.push(b),f.push("\n")),c.push('">'),c.push("<span"),v&&(c.push(' style="'),c.push(v),c.push('"')),c.push(">"),c.push(d),c.push("</span>"),c.push("</button>")}),h>0&&c.push("</div>"),l.push(c.join("")),l.push("</div>"),f.push(l.join("")),f.push("</div>"),f.push("<br/>"),t.append(r(f.join("")));var p=r(".ee-top-button-bar",t);if(h>0&&p.length>0){var d=(e.isTouch?49:41)*h+13;p.css("width",d+"px")}},w.prototype.processExtra=function(t,n){var i=this.config().getButtonBarInfo(n);if(!(i&&s.children(i).length>0))return;var u=this.config(),a=this.model().getToolTips(),f=[];f.push('<div class="ee-'+n+'-button-bar">');var l=[];l.push('<div class="ee-button-bar on" id="ee-button-bar-'),l.push(n),l.push('">');var c=r(i).children("br").length,h=[],p=0,d=0,v=1,m=c?0:1;c===0&&(y+=1),r(i).children().each(function(){var e=this,t=s.localName(e);if(t==="br"){p>0&&h.push("</div>"),h.push("<br/>"),p=0,y+=1,m=0;return}if(t!=="button")return;var n=s.getAttr(e,"ref"),i=u.getButtonInfo(n);if(!i)return;var l=r("label",e),g=r("label",i),b=l.text()||g.text()||"&nbsp;",w=s.processStyles(g,l)||"",E=l.attr("class")||g.attr("class")||"",S=l.attr("icon")||g.attr("icon");E+=" ee-button btn btn-large",S&&(b="",o.each(S.split(" "),function(e){b+='<i class="'+e+' icon"></i>'}));var x=r("tooltip",e).text()||r("tooltip",i).text()||"",T=r("template",i),N=T.attr("name")||T.attr("char"),C="btn-group",k='<div class="'+C+'">';p===0?h.push(k):N==="more"&&(h.push("</div>"),h.push(k)),h.push("<button"),N&&h.push(' name="'+N+'"'),c?(m+=1,v=m>v?m:v):d+=1,h.push(' class="'),h.push(E),c?(h.push('" data-row="'),h.push(y),h.push('" data-column="'),h.push(m)):(h.push('" data-row="'),h.push(y),h.push('" data-index="'),h.push(d)),a&&x&&(h.push('" data-toggle="tooltip" title="'),h.push(x)),x&&(h.push('" aria-label="'),h.push(x),f.push("\n")),h.push('">'),h.push("<span"),w&&(h.push(' style="'),h.push(w),h.push('"')),h.push(">"),h.push(b),h.push("</span>"),h.push("</button>"),p+=1}),p>0&&h.push("</div>"),l.push(h.join("")),l.push("</div>"),f.push(l.join("")),f.push("</div>"),t.append(r(f.join(""))),v>0&&(b+=(e.isTouch?49:41)*v+12)},w.prototype.process=function(t,n){var i=this.config(),o=this.model().getToolTips(),u=this,a=[];a.push('<div class="ee-main-button-bar">');var f=0,l=0;r(n).each(function(){var e=this,t=i.getButtonBarInfo(e);if(!t)return;var n=[];n.push('<div class="ee-button-bar" id="ee-button-bar-'),n.push(e),n.push('">');var c=r(t).children("br").length,h=[],p=[],d=0,v=0;if(c||f===0)y+=1;r(t).children().each(function(){var t=this,n=s.localName(t),u=null;if(n==="br"){p.length>0&&h.push(p.join("")),d>0&&h.push("</div>"),h.push("<br/>"),p=[],d=0,y+=1,v=0;return}if(n==="buttonBar"){n="button",u=s.getAttr(t,"ref");var m=i.getButtonBarInfo(u);t=r("label",m)[0];if(!t)return}if(n!=="button")return;var g=s.getAttr(t,"ref"),b=i.getButtonInfo(g);if(!b)return;var w=r("label",t),E=r("label",b),S=w.text()||E.text()||"&nbsp;",x=s.processStyles(E,w)||"",T=w.attr("class")||E.attr("class")||"",N=w.attr("icon")||E.attr("icon");T+=" ee-button btn btn-large",N&&(T+=" icon",S='<i class="'+N+'"></i>');var C=r("tooltip",t).text()||r("tooltip",b).text()||"",k=r("template",b),L=k.attr("name")||k.attr("char");d===0&&h.push('<div class="btn-group">'),h.push("<button"),L&&h.push(' name="'+L+'"'),f+=1,d+=1,v+=1,l=v>l?v:l;if(u){h.push(' name="more"'),h.push(' source="'+e+'"'),h.push(' target="'+u+'"'),p.length===0&&(p.push("</div>"),p.push("<br/>"),p.push('<div class="btn-group">'));var A="ee-palette-button ee-button btn btn-large";p.push('<button name="more"'),p.push(' class="'+A+'"'),p.push(' source="'+e+'"'),p.push(' target="'+u+'"'),p.push(">"),p.push('<i class="ee-icon-caret-down"></i>'),p.push("</button>")}h.push(' class="'),h.push(T),h.push('" data-row="'),h.push(y),c?(h.push('" data-column="'),h.push(v)):(h.push('" data-index="'),h.push(f)),o&&C&&(h.push('" data-toggle="tooltip" title="'),h.push(C)),C&&(h.push('" aria-label="'),h.push(C),a.push("\n")),h.push('">'),h.push("<span"),x&&(h.push(' style="'),h.push(x),h.push('"')),h.push(">"),h.push(S),h.push("</span>"),h.push("</button>")}),p.length>0&&h.push(p.join("")),d>0&&h.push("</div>");var m=u.processNav(t,e,"back","up");m&&p.length>0&&n.push(m),n.push(h.join("")),m&&p.length===0&&n.push(m);var g=u.processNav(t,e,"more","down");g&&n.push(g),n.push("</div>"),a.push(n.join(""))}),a.push("</div>"),t.append(r(a.join("")));var c=b;l>0&&(b+=(e.isTouch?49:41)*l+13);var h=r(".ee-main-button-bar",t),p=r(".ee-top-button-bar",t),d=p.width();p.length>0&&(b>d?(p.css("width",b+"px"),t.css("width",b+"px")):h.css("width",d-c))},w.prototype.processNav=function(e,t,n,i){var o=[],u=s.getAttr(e,n);if(u){var a=this.model().getToolTips(),f=this.config().getButtonInfo(":"+n),l=r("tooltip",f).text()||n,c="ee-"+n+"-button ee-button btn btn-large";o.push('<button name=":'+n+'"'),o.push(' class="'+c+'"'),o.push(' source="'+t+'"'),o.push(' target="'+u+'"'),o.push(' data-row="'+(y+1)+'"'),o.push(' data-column="1"'),a&&l&&(o.push(' data-toggle="tooltip"'),o.push(' title="'+l+'"')),l&&o.push(' aria-label="'+l+'\n"'),o.push(">"),o.push('<i class="ee-icon-caret-'+i+'"></i>'),o.push("</button>")}return o.join("")},w.prototype.attach=function(e){var n=this.model();n.getMoreMenu()||r("button[name='more']",e).css("display","none").removeAttr("data-row").removeAttr("data-column").attr("disabled","");var i=r("button",e);i.tooltip(t.tooltipOptions()),i.on(u.FOCUS_OUT,a(this)),r("button.ee-back-button",e).addClass("btn-primary"),r("button.ee-more-button",e).addClass("btn-primary"),r("button.ee-palette-button",e).addClass("btn-primary"),r(".ee-main-button-bar .ee-button-bar",e).hide(),this.showPanel(e,"","home"),e.on("hidden.bs.tooltip",f(this)),e.on("shown.bs.tooltip",l(this)),e.on(u.KEY_DOWN,c(this)),e.on(u.KEY_UP,h(this)),e.on(u.MOUSE_DOWN,p(this)),e.on(u.MOUSE_OUT,d(this)),e.on(u.MOUSE_UP,d(this)),e.on(u.CLICK,v(this)),n.getCollapsible()||(r("button[name=':more']",e).click(),r("button[name=':more']",e).css("display","none"),r("button[name=':back']",e).css("display","none"))},a=function(t){return function(n){var i=r(n.target);i.tooltip("hide"),t._hideTooltip&&(e.stopThread(t._hideThread),t._hideTooltip=null,t._hideThread=0)}},f=function(t){return function(n){var i=r(n.target),s=i.data("tooltip")||i.data("bs.tooltip");s&&(s.options.placement="top"),t._hideTooltip&&t._hideTooltip===s&&(e.stopThread(t._hideThread),t._hideTooltip=null,t._hideThread=0)}},l=function(t){return function(n){var i=r(n.currentTarget),s=r(n.target),o=s.data("tooltip")||s.data("bs.tooltip");if(!o)return;var u=o.tip();if(u.length===0)return;var a=u.offset().top,f=o.$element.offset().top,l=u[0].offsetHeight;a+l+3<f&&u.offset({top:f-l-3}),u.offset().top<i.offset().top&&o.options.placement==="top"&&(u.removeClass("top"),o.options.placement="bottom",o.show()),t._hideTooltip&&t._hideTooltip!==o&&(e.stopThread(t._hideThread),t._hideTooltip.hide()),t._hideTooltip=o,t._hideThread=e.runOnce(3e3,function(){s.tooltip("hide")})}},c=function(e){return function(t){var n=r(t.target);if(n.hasClass("ee-button"))return g(e)(t)}},h=function(){return function(e){var t=i.getKeyCode(e);if(t===i.ESCAPE)return!1;if(t===i.ENTER||t===i.SPACE)return!1}};var E=function(e,t,n){return e.is(t)?e:e.closest(t,n)};return p=function(){return function(t){var n=r(t.currentTarget),i=r(t.target),s=E(i,".ee-button",n);s.length&&(s.addClass("active"),e.runOnce(300,function(){s.removeClass("active")}))}},d=function(){return function(e){var t=r(e.currentTarget),n=r(e.target),i=E(n,".ee-button",t);i.length&&i.removeClass("active")}},v=function(t){return function(n,i){var s=r(n.currentTarget),o=r(n.target),u=t.model(),a=u.getFocusController(),f=!a.containsFocus(t.parent());f&&a.showFocus();var l=E(o,".ee-button",s);if(l.length){var c=u.getSelection();c.isDone()&&c.onLeaf();var h=l.attr("name"),p=l.attr("source"),d=l.attr("target");h===":more"?t.showPanel(s,p,d):h===":back"?t.hidePanel(s,p,d):h==="more"?m(t)(s,l):u.processTemplate(h);if(e.isIOS){(f||!i)&&a.moveToInput(l);return}if(e.isCrOS){(f||!i)&&a.moveToInput(l);return}return i||(a.moveToPanel(l),a.moveToInput(l)),!1}return a.moveToInput(),!1}},m=function(e){return function(t,n){var r=e.parent(),i=e._more,s=t.position(),o=s.top+t.outerHeight()+4,u=s.left+r.position().left-2,a=u+i.outerWidth(),f=r.outerWidth(),l=s.left+f/2;s.left+f<a&&(u=s.left+n.position().left+n.outerWidth()-i.outerWidth(),u<l&&(u=l)),u<l&&(u=l),i.css("position","absolute"),i.css("left",u+"px"),i.css("top",o+"px"),i.css("bottom","auto");var c=e.model(),h=c.getFocusController();return h.toggleMoreMenu(i,n),!1}},g=function(e){return function(t){var n=r(t.currentTarget),s=r(t.target),o=e.model(),a=o.getFocusController(),f=i.getKeyCode(t);if(f===i.ESCAPE){var l=r(".ee-button-bar.on .ee-back-button",n);return l.length>0?r(l[l.length-1]).click():(e._more.modal("hide"),a.moveToInput(s)),!1}if(f===i.ENTER||f===i.SPACE)return s.trigger(u.CLICK,f),a.moveToPanel(s),!1;if(f===i.TAB&&!t.shiftKey&&a.tabNext(n,s))return!1;if(f===i.TAB&&t.shiftKey&&a.tabPrev(n,s))return!1;if(f===i.HOME)return a.moveHome(n,s),!1;if(f===i.END)return a.moveEnd(n,s),!1;if(!t.shiftKey){if(f===i.UP)return a.moveUp(n,s),!1;if(f===i.DOWN)return a.moveDown(n,s),!1;if(f===i.LEFT)return a.moveLeft(n,s),!1;if(f===i.RIGHT)return a.moveRight(n,s),!1}else{if(f===i.LEFT||f===i.UP)return a.prevPanel(n,s),!1;if(f===i.RIGHT||f===i.DOWN)return a.nextPanel(n,s),!1}}},w.prototype.showPanel=function(e,t,n){var i=r("#ee-button-bar-"+t,e),s=r("#ee-button-bar-"+n,e),o=this.model(),u=o.getFocusController(),a=null;u.containsFocus(i)&&(a=r(".ee-back-button",s));var f=r(".ee-more-button",i);f.tooltip("hide").hide();var l=f.data("tooltip")||f.data("bs.tooltip");l&&l.$tip&&l.$tip.detach(),r("[name=':more']",i).prop("disabled",!0),r(".ee-palette-button",i).prop("disabled",!0),r(".ee-back-button",i).prop("disabled",!0);var c=function(){a&&u.moveToPanel(a),r(window).resize()};s.addClass("on"),s.slideDown(200,c)},w.prototype.hidePanel=function(e,t,n){var i=r("#ee-button-bar-"+t,e),s=r("#ee-button-bar-"+n,e),o=this.model(),u=o.getFocusController(),a=null;u.containsFocus(i)&&(a=r(".ee-back-button, .ee-more-button",s));var f=function(){r(".ee-more-button",s).show(),r("[name=':more']",s).prop("disabled",!1),r(".ee-palette-button",s).prop("disabled",!1),r(".ee-back-button",s).prop("disabled",!1),a&&u.moveToPanel(a),r(window).resize()};i.removeClass("on"),i.slideUp(200,f)},w}),n("editor/panel/Carousel",["editor/util/Utils","editor/panel/Panel","editor/model/Model","lib/bootstrap"],function(e,t,n){var r=e.$,i=e.Key,s=e.XML,o=e.Array,u=e.Event,a=e.Object,f,l,c,h,p,d,v,m,g,y=0,b=0,w=0,E=0,S=0,x=function(e,t){return t instanceof n||(t=null),this._parent=e,this._model=t,this.build(),this};x.create=function(e,t){return new x(e,t)},x.prototype.destroy=function(){this._parent=null,this._model=null},x.prototype.parent=function(){return this._parent},x.prototype.model=function(){return this._model},x.prototype.config=function(){return this.model().getConfig()},x.prototype.build=function(){var e=this.parent(),n=e.find("."+t.CAROUSEL),r=this.model();if(!r.getCarousel()){n.hide();return}var i=this.config().getCarousel();if(!(i&&s.children(i).length>0)){r.setCarousel(!1),n.hide();return}var o=e.find("."+t.INPUT),u=r.getFocusController();u.setInput(o),u.addPanel(n),this.process(n,i),this.attach(n)},x.prototype.process=function(e,t){y=0,this.processTB(e,t,"top"),e.append("<br/>"),b=0,this.processLR(e,t,"left");var n=y>2?y:2;this.processMain(e,t,"main"),this.processLR(e,t,"right"),y=n+1,e.append("<br/>"),this.processTB(e,t,"bottom"),w=this._parent.width()*.65-w,E-=3,w>=S?r(".ee-carousel-btn",e).css("display","none"):(r(".ee-carousel-btn",e).css("height",E),r(".ee-carousel-btn",e).css("width",40),w-=80),r(".ee-carousel-inner",e).css("width",S),r(".ee-main-carousel",e).css("width",w),r(".ee-main-carousel",e).css("height",E)},x.prototype.processLR=function(t,n,i){var u=this.config(),a=this.model().getToolTips(),f=r(n).children("palette[loc='"+i+"']"),l=f.attr("ref");n=u.getPaletteInfo(l);if(!n)return;var c=[];c.push('<div class="ee-'+i+'-carousel">');var h=r(n).children("br").length===0,p=[],d=0,v=b,m=b;y=h?0:1,b=h?m+1:m,v=b>v?b:v,r(n).children().each(function(){var e=this,t=s.localName(e);if(t==="br"){d>0&&p.push("</div>"),p.push("<br/>"),d=0,y+=1,b=m;return}if(t!=="button")return;var n=s.getAttr(e,"ref"),i=u.getButtonInfo(n);if(!i)return;var f=r("label",e),l=r("label",i),g=f.text()||l.text()||"&nbsp;",w=s.processStyles(l,f)||"",E=f.attr("class")||l.attr("class")||"",S=f.attr("icon")||l.attr("icon");E+=" ee-button btn btn-large",S&&(g="",o.each(S.split(" "),function(e){g+='<i class="'+e+' icon"></i>'}));var x=r("tooltip",e).text()||r("tooltip",i).text()||"",T=r("template",i),N=T.attr("name")||T.attr("char"),C="btn-group";h&&(C+=" btn-group-vertical");var k='<div class="'+C+'">';d===0&&p.push(k),p.push("<button"),N&&p.push(' name="'+N+'"'),h?y+=1:(b+=1,v=b>v?b:v),p.push(' class="'),p.push(E),p.push('" data-row="'),p.push(y),p.push('" data-column="'),p.push(b),a&&x&&(p.push('" data-toggle="tooltip" title="'),p.push(x)),x&&(p.push('" aria-label="'),p.push(x),c.push("\n")),p.push('">'),p.push("<span"),w&&(p.push(' style="'),p.push(w),p.push('"')),p.push(">"),p.push(g),p.push("</span>"),p.push("</button>"),d+=1}),d>0&&p.push("</div>"),c.push(p.join("")),c.push("</div>"),t.append(r(c.join(""))),b=v,v>m&&(w+=(e.isTouch?49:41)*(v-m)+12),y>0&&(E=(e.isTouch?44:34)*y+4+(h?0:2*y-2))},x.prototype.processTB=function(e,t,n){var i=this.config(),u=this.model().getToolTips(),a=r(t).children("palette[loc='"+n+"']"),f=a.attr("ref");t=i.getPaletteInfo(f);if(!t)return;var l=[];l.push('<div class="ee-'+n+'-carousel">');var c=[];b=0,r(t).children().each(function(){var e=this,t=s.localName(e);if(t!=="button")return;var n=s.getAttr(e,"ref"),a=i.getButtonInfo(n);if(!a)return;var f=r("label",e),h=r("label",a),p=f.text()||h.text()||"&nbsp;",d=s.processStyles(h,f)||"",v=f.attr("class")||h.attr("class")||"",m=f.attr("icon")||h.attr("icon");v+=" ee-button btn btn-large",m&&(p="",o.each(m.split(" "),function(e){p+='<i class="'+e+' icon"></i>'}));var g=r("tooltip",e).text()||r("tooltip",a).text()||"",w=r("template",a),E=w.attr("name")||w.attr("char");b===0&&c.push('<div class="btn-group">'),c.push("<button"),E&&c.push(' name="'+E+'"'),b+=1,c.push(' class="'),c.push(v),c.push('" data-row="'),c.push(y),c.push('" data-column="'),c.push(b),u&&g&&(c.push('" data-toggle="tooltip" title="'),c.push(g)),g&&(c.push('" aria-label="'),c.push(g),l.push("\n")),c.push('">'),c.push("<span"),d&&(c.push(' style="'),c.push(d),c.push('"')),c.push(">"),c.push(p),c.push("</span>"),c.push("</button>")}),b>0&&c.push("</div>"),l.push(c.join("")),l.push("</div>"),e.append(r(l.join("")))},x.prototype.processMain=function(t,n,i){var u=this.config(),a=this.model().getToolTips(),f=r(n).children("palette[loc='"+i+"']"),l=f.attr("ref");n=u.getPaletteInfo(l);if(!n)return;var c=[];c.push('<button class="ee-carousel-btn ee-icon-caret-left"></button>'),c.push('<div class="ee-'+i+'-carousel">');var h=[];h.push('<div class="ee-carousel-inner">');var p=[],d=[],v=0,m=b,g=y>2?y:2,w;y=0,b+=1;for(w=1;w<=g;w+=1)d[w]=[];r(n).children().each(function(){var e=this,t=s.localName(e);if(t==="br"){if(v>0){for(w=1;w<=g;w+=1)d[w].push("<br/>"),p.push(d[w].join("")),d[w]=[];p.push("</div>")}v=0,b+=1,y=0;return}if(t!=="button")return;var n=s.getAttr(e,"ref"),i=u.getButtonInfo(n);if(!i)return;var f=r("label",e),l=r("label",i),h=f.text()||l.text()||"&nbsp;",m=s.processStyles(l,f)||"",E=f.attr("class")||l.attr("class")||"",S=f.attr("icon")||l.attr("icon");E+=" ee-button btn btn-large",S&&(h="",o.each(S.split(" "),function(e){h+='<i class="'+e+' icon"></i>'}));var x=r("tooltip",e).text()||r("tooltip",i).text()||"",T=r("template",i),N=T.attr("name")||T.attr("char");v===0&&p.push('<div class="btn-group">'),y===g&&(b+=1,y=0),y+=1,d[y].push("<button"),N&&d[y].push(' name="'+N+'"'),d[y].push(' class="'),d[y].push(E),d[y].push('" data-row="'),d[y].push(y),d[y].push('" data-column="'),d[y].push(b),a&&x&&(d[y].push('" data-toggle="tooltip" title="'),d[y].push(x)),x&&(d[y].push('" aria-label="'),d[y].push(x),c.push("\n")),d[y].push('">'),d[y].push("<span"),m&&(d[y].push(' style="'),d[y].push(m),d[y].push('"')),d[y].push(">"),d[y].push(h),d[y].push("</span>"),d[y].push("</button>"),v+=1});if(v>0){for(w=1;w<=g;w+=1)d[w].push("<br/>"),p.push(d[w].join("")),d[w]=[];p.push("</div>")}h.push(p.join("")),h.push("</div>"),c.push(h.join("")),c.push("</div>"),c.push('<button class="ee-carousel-btn ee-icon-caret-right"></button>'),t.append(r(c.join(""))),b>m&&(S=41*(b-m)+7),E===0&&g>0&&(E=(e.isTouch?46:36)*g+5)},x.prototype.attach=function(e){var n=r("button",e);n.tooltip(t.tooltipOptions()),n.on(u.FOCUS_OUT,f(this)),e.on("hidden.bs.tooltip",l(this)),e.on("shown.bs.tooltip",c(this)),e.on(u.KEY_DOWN,h(this)),e.on(u.KEY_UP,p(this)),e.on(u.MOUSE_DOWN,d(this)),e.on(u.MOUSE_OUT,v(this)),e.on(u.MOUSE_UP,v(this)),e.on(u.CLICK,m(this))},f=function(t){return function(n){var i=r(n.target);i.tooltip("hide"),t._hideTooltip&&(e.stopThread(t._hideThread),t._hideTooltip=null,t._hideThread=0)}},l=function(t){return function(n){var i=r(n.target),s=i.data("tooltip")||i.data("bs.tooltip");s&&(s.options.placement="top"),t._hideTooltip&&t._hideTooltip===s&&(e.stopThread(t._hideThread),t._hideTooltip=null,t._hideThread=0)}},c=function(t){return function(n){var i=r(n.target),s=i.data("tooltip")||i.data("bs.tooltip");if(!s)return;var o=s.tip(),u=s.arrow(),f=o.closest(".ee-main-carousel");if(o.length===0||f.length===0)return;var l=f.offset().left,c=o.offset().left,h=a.toNumber(u.css("left")),p=f[0].offsetWidth,d=o[0].offsetWidth;c<l&&(o.offset({left:l}),u.css("left",h+c-l)),l+p<c+d&&(o.offset({left:l+p-d}),u.css("left",h+c+d-l-p));var v=o.offset().top,m=s.$element.offset().top,g=o[0].offsetHeight;v+g+3<m&&o.offset({top:m-g-3}),o.offset().top<f.offset().top&&s.options.placement==="top"&&(o.removeClass("top"),s.options.placement="bottom",s.show()),t._hideTooltip&&t._hideTooltip!==s&&(e.stopThread(t._hideThread),t._hideTooltip.hide()),t._hideTooltip=s,t._hideThread=e.runOnce(3e3,function(){i.tooltip("hide")})}},h=function(e){return function(t){var n=r(t.target);if(n.hasClass("ee-button"))return g(e)(t)}},p=function(){return function(e){var t=i.getKeyCode(e);if(t===i.ESCAPE)return!1;if(t===i.ENTER||t===i.SPACE)return!1}};var T=function(e,t,n){return e.is(t)?e:e.closest(t,n)};return d=function(){return function(t){var n=r(t.currentTarget),i=r(t.target),s=T(i,".ee-button",n);s.length&&(s.addClass("active"),e.runOnce(300,function(){s.removeClass("active")}))}},v=function(){return function(e){var t=r(e.currentTarget),n=r(e.target),i=T(n,".ee-button",t);i.length&&i.removeClass("active")}},m=function(t){return function(n,i){var s=r(n.currentTarget),o=r(n.target),u=t.model(),a=u.getFocusController(),f=!a.containsFocus(t.parent());f&&a.showFocus();var l=T(o,".ee-carousel-btn",s);if(l.length){var c=r(".ee-main-carousel",s)[0],h=c.clientWidth-50;return l.hasClass("ee-icon-caret-left")&&(h=-h),c.scrollBy({left:h,behavior:"smooth"}),!1}l=T(o,".ee-button",s);if(l.length){var p=u.getSelection();p.isDone()&&p.onLeaf();var d=l.attr("name");u.processTemplate(d);if(e.isIOS)return;if(e.isCrOS){(f||!i)&&a.moveToInput(l);return}return i||(a.moveToPanel(l),a.moveToInput(l)),!1}return a.moveToInput(),!1}},g=function(e){return function(t){var n=r(t.currentTarget),s=r(t.target),o=e.model(),a=o.getFocusController(),f=i.getKeyCode(t);if(f===i.ESCAPE)return a.moveToInput(s),!1;if(f===i.ENTER||f===i.SPACE)return s.trigger(u.CLICK,f),a.moveToPanel(s),!1;if(f===i.TAB&&!t.shiftKey&&a.tabNext(n,s))return!1;if(f===i.TAB&&t.shiftKey&&a.tabPrev(n,s))return!1;if(f===i.HOME)return a.moveHome(n,s),!1;if(f===i.END)return a.moveEnd(n,s),!1;if(!t.shiftKey){if(f===i.UP)return a.moveUp(n,s),!1;if(f===i.DOWN)return a.moveDown(n,s),!1;if(f===i.LEFT)return a.moveLeft(n,s),!1;if(f===i.RIGHT)return a.moveRight(n,s),!1}else{if(f===i.LEFT||f===i.UP)return a.prevGroup(n,s),!1;if(f===i.RIGHT||f===i.DOWN)return a.nextGroup(n,s),!1}}},x}),n("editor/panel/QuickBar",["editor/util/Utils","editor/panel/Panel","editor/model/Model","lib/bootstrap"],function(e,t,n){var r=e.$,i=e.Key,s=e.XML,o=e.Array,u=e.Event,a,f,l,c,h,p,d,v,m,g,y=function(e,t){return t instanceof n||(t=null),this._parent=e,this._model=t,this._more=null,this.build(),this};y.create=function(e,t){return new y(e,t)},y.prototype.destroy=function(){this._parent=null,this._model=null,this._more=null},y.prototype.parent=function(){return this._parent},y.prototype.model=function(){return this._model},y.prototype.config=function(){return this.model().getConfig()},y.prototype.build=function(){var e=this.parent(),n=e.find("."+t.QUICK),i=this.model();if(!i.getQuickBar()){n.hide();return}var o=this.config().getQuickBar();if(!(o&&s.children(o).length>0)){i.setQuickBar(!1),n.hide();return}var m=e.find("."+t.INPUT),g=e.find("."+t.MORE),y=i.getFocusController();y.setInput(m),y.addPanel(n),this._more=g,this.process(n,o),i.getMoreMenu()?e.on("show",".modal",function(e){e.stopPropagation()}):r("button[name='more']",n).css("display","none").removeAttr("data-row").removeAttr("data-column");var b=r("button",n);b.tooltip(t.tooltipOptions()),b.on(u.FOCUS_OUT,a(this)),n.on("hidden.bs.tooltip",f(this)),n.on("shown.bs.tooltip",l(this)),n.on(u.KEY_DOWN,c(this)),n.on(u.KEY_UP,h(this)),n.on(u.MOUSE_DOWN,p(this)),n.on(u.MOUSE_OUT,d(this)),n.on(u.MOUSE_UP,d(this)),n.on(u.CLICK,v(this))},a=function(t){return function(n){var i=r(n.target);i.tooltip("hide"),t._hideTooltip&&(e.stopThread(t._hideThread),t._hideTooltip=null,t._hideThread=0)}},f=function(t){return function(n){var i=r(n.target),s=i.data("tooltip")||i.data("bs.tooltip");t._hideTooltip&&t._hideTooltip===s&&(e.stopThread(t._hideThread),t._hideTooltip=null,t._hideThread=0)}},l=function(t){return function(n){var i=r(n.target),s=i.data("tooltip")||i.data("bs.tooltip");t._hideTooltip&&t._hideTooltip!==s&&(e.stopThread(t._hideThread),t._hideTooltip.hide()),t._hideTooltip=s,t._hideThread=e.runOnce(3e3,function(){i.tooltip("hide")})}},c=function(e){return function(t){var n=r(t.target);if(n.hasClass("ee-button"))return g(e)(t)}},h=function(){return function(e){var t=i.getKeyCode(e);if(t===i.ESCAPE)return!1;if(t===i.ENTER||t===i.SPACE)return!1}};var b=function(e,t,n){return e.is(t)?e:e.closest(t,n)};return p=function(){return function(t){var n=r(t.currentTarget),i=r(t.target),s=b(i,".ee-button",n);s.length&&(s.addClass("active"),e.runOnce(300,function(){s.removeClass("active")}))}},d=function(){return function(e){var t=r(e.currentTarget),n=r(e.target),i=b(n,".ee-button",t);i.length&&i.removeClass("active")}},v=function(t){return function(n,i){var s=r(n.currentTarget),o=r(n.target),u=t.model(),a=u.getFocusController(),f=!a.containsFocus(t.parent());f&&a.showFocus();var l=b(o,".ee-button",s);if(l.length){var c=u.getSelection();c.isDone()&&c.onLeaf();var h=l.attr("name");h==="more"?m(t)(s,l):u.processTemplate(h);if(e.isIOS){f&&a.moveToInput(l);return}if(e.isCrOS){(f||!i)&&a.moveToInput(l);return}return i||(a.moveToPanel(l),a.moveToInput(l)),!1}return a.moveToInput(),!1}},m=function(e){return function(t,n){var r=e.parent(),i=e._more,s=t.position(),o=s.top+t.outerHeight()-2,u=s.left+n.position().left-2,a=u+i.outerWidth(),f=r.outerWidth(),l=s.left+f/2;s.left+f<a&&(u=s.left+n.position().left+n.outerWidth()-i.outerWidth(),u<l&&(u=l)),u<0&&(u=l),i.css("position","absolute"),i.css("left",u+"px"),i.css("top",o+"px"),i.css("bottom","auto");var c=e.model(),h=c.getFocusController();return h.toggleMoreMenu(i,n),!1}},g=function(e){return function(t){var n=r(t.currentTarget),s=r(t.target),o=e.model(),a=o.getFocusController(),f=i.getKeyCode(t);if(f===i.ESCAPE)return e._more.modal("hide"),a.moveToInput(s),!1;if(f===i.ENTER||f===i.SPACE)return s.trigger(u.CLICK,f),a.moveToPanel(s),!1;if(f===i.TAB&&!t.shiftKey&&a.tabNext(n,s))return!1;if(f===i.TAB&&t.shiftKey&&a.tabPrev(n,s))return!1;if(f===i.HOME)return a.moveHome(n,s),!1;if(f===i.END)return a.moveEnd(n,s),!1;if(!t.shiftKey){if(f===i.UP)return a.moveUp(n,s),!1;if(f===i.DOWN)return a.moveDown(n,s),!1;if(f===i.LEFT)return a.moveLeft(n,s),!1;if(f===i.RIGHT)return a.moveRight(n,s),!1}else{if(f===i.LEFT||f===i.UP)return a.prevPanel(n,s),!1;if(f===i.RIGHT||f===i.DOWN)return a.nextPanel(n,s),!1}}},y.prototype.process=function(e,t){var n=this.config(),i=this.model().getToolTips(),u=[];u.push("<div>");var a=0;r("button",t).each(function(){var e=r(this).attr("ref"),t=n.getButtonInfo(e);if(!t)return;var f=r("label",this),l=r("label",t),c=f.text()||l.text()||"&nbsp;",h=s.processStyles(l,f)||"",p=f.attr("class")||l.attr("class")||"",d=f.attr("icon")||l.attr("icon");p+=" ee-button btn",d&&(c="",o.each(d.split(" "),function(e){c+='<i class="'+e+' icon"></i>'}));var v=r("tooltip",this).text()||r("tooltip",t).text()||"",m=r("template",t),g=m.attr("name")||m.attr("char");a+=1,u.push('<button name="'),u.push(g),u.push('" class="'),u.push(p),u.push('" data-row="'),u.push(0),u.push('" data-index="'),u.push(a),i&&v&&(u.push('" data-toggle="tooltip" title="'),u.push(v)),v&&(u.push('" aria-label="'),u.push(v),u.push("\n")),u.push('" aria-live="off">'),u.push("<span"),h&&(u.push(' style="'),u.push(h),u.push('"')),u.push(">"),u.push(c),u.push("</span>"),u.push("</button>")}),u.push("</div>"),e.append(r(u.join("")))},y}),n("editor/panel/SideBar",["editor/util/Utils","editor/panel/Panel","editor/model/Model","lib/bootstrap"],function(e,t,n){var r=e.$,i=e.Key,s=e.XML,o=e.Object,u=e.Event,a,f,l,c,h,p,d,v,m,g,y,b=function(e,t){return t instanceof n||(t=null),this._parent=e,this._model=t,this._content=null,this.build(),this};b.create=function(e,t){return new b(e,t)},b.prototype.destroy=function(){this._parent=null,this._model=null,this._content=null},b.prototype.parent=function(){return this._parent},b.prototype.model=function(){return this._model},b.prototype.config=function(){return this.model().getConfig()},b.prototype.reflow=function(){var e=this._content,n=e.parent(),i=n.find("."+t.PROXY);e.css("display")!=="block"&&e.css("display","");if(!e[0].style.height)return!1;var s=n.height();return s-=e.outerHeight()-e.height()+12,e.height()===s?!1:(r().jquery<"1.8"&&(s+=e.outerHeight()-e.height()),e.height(s),i.css("top",-s),!0)},b.prototype.scrollTo=function(e,t,n,r){var i=this._content;if(!i)return;var s=i.scrollLeft(),o=i.scrollTop(),u=i[0].clientWidth,a=i[0].clientHeight,f=32,l=32;s+u<e+n+f&&(s=e+n-u+f),s>e-f&&(s=e-f),s<0&&(s=0),s+u>i[0].scrollWidth&&(s=i[0].scrollWidth-u),o+a<t+r+l&&(o=t+r-a+l),o>t-l&&(o=t-l),i.scrollLeft(s),i.scrollTop(o)},b.prototype.build=function(){var e=this.parent(),n=e.find("."+t.SIDE),i=e.find("."+t.INPUT);this._content=i;var o=this.model();if(!o.getSideBar()){n.hide();return}var g=this.config().getSideBar();if(!(g&&s.children(g).length>0)){o.setSideBar(!1),n.hide();return}var y=o.getFocusController();y.setInput(i),y.addPanel(n),this.process(n,g);var b=r(".in button",n);b.tooltip(t.tooltipOptions()),r("button",n).on(u.FOCUS_OUT,a(this)),n.on("hidden.bs.tooltip",f(this)),n.on("shown.bs.tooltip",l(this)),n.on("hidden.bs.collapse",c(this)),n.on("shown.bs.collapse",c(this)),n.on(u.KEY_DOWN,h(this)),n.on(u.KEY_UP,p(this)),n.on(u.MOUSE_DOWN,d(this)),n.on(u.MOUSE_OUT,v(this)),n.on(u.MOUSE_UP,v(this)),n.on(u.CLICK,m(this));if(!o.getCollapsible()){var w=r(".accordion-toggle",n);w.on(u.CLICK,!1)}},a=function(t){return function(n){var i=r(n.target);i.tooltip("hide"),t._hideTooltip&&(e.stopThread(t._hideThread),t._hideTooltip=null,t._hideThread=0)}},f=function(t){return function(n){var i=r(n.target),s=i.data("tooltip")||i.data("bs.tooltip");s&&(s.options.placement="top"),t._hideTooltip&&t._hideTooltip===s&&(e.stopThread(t._hideThread),t._hideTooltip=null,t._hideThread=0)}},l=function(t){return function(n){var i=r(n.currentTarget),s=r(n.target),u=s.data("tooltip")||s.data("bs.tooltip");if(!u)return;var a=u.tip(),f=u.arrow(),l=a.closest(".accordion-body");if(a.length===0||l.length===0)return;var c=l.offset().left,h=a.offset().left,p=o.toNumber(f.css("left")),d=l[0].offsetWidth,v=a[0].offsetWidth;h<c&&(a.offset({left:c}),f.css("left",p+h-c)),c+d<h+v&&(a.offset({left:c+d-v}),f.css("left",p+h+v-c-d));var m=a.offset().top,g=u.$element.offset().top,y=a[0].offsetHeight;m+y+3<g&&a.offset({top:g-y-3}),a.offset().top<i.offset().top&&u.options.placement==="top"&&(a.removeClass("top"),u.options.placement="bottom",u.show()),t._hideTooltip&&t._hideTooltip!==u&&(e.stopThread(t._hideThread),t._hideTooltip.hide()),t._hideTooltip=u,t._hideThread=e.runOnce(3e3,function(){s.tooltip("hide")})}},c=function(){return function(e){var n=r(e.target);if(n.hasClass("ee-button"))return;var i=n.parent(),s=r("button",i);r(".accordion-toggle i",i).toggleClass("ee-icon-caret-right ee-icon-caret-down");var o=r(".accordion-toggle",i);e.type==="shown"?(s.removeAttr("disabled"),s.removeAttr("tabindex"),o.attr("aria-expanded","true"),s.tooltip(t.tooltipOptions())):(s.attr("disabled","disabled"),s.attr("tabindex",-1),o.attr("aria-expanded","false"),s.tooltip("destroy"))}},h=function(e){return function(t){var n=r(t.target);if(n.hasClass("accordion-toggle"))return g(e)(t);if(n.hasClass("ee-button"))return y(e)(t)}},p=function(){return function(e){var t=i.getKeyCode(e);if(t===i.ESCAPE)return!1;if(t===i.ENTER||t===i.SPACE)return!1}};var w=function(e,t,n){return e.is(t)?e:e.closest(t,n)};return d=function(){return function(t){var n=r(t.currentTarget),i=r(t.target),s=w(i,".ee-button",n);if(s.length){s.addClass("active"),e.runOnce(300,function(){s.removeClass("active")});return}var o=w(i,".accordion-toggle",n),u=w(i,".accordion",n);if(u.length&&!o.length)return!1}},v=function(){return function(e){var t=r(e.currentTarget),n=r(e.target),i=w(n,".ee-button",t);if(i.length){i.removeClass("active");return}var s=w(n,".accordion-toggle",t),o=w(n,".accordion",t);if(o.length&&!s.length)return!1}},m=function(t){return function(n,i){var s=r(n.currentTarget),o=r(n.target),u=t.model(),a=u.getFocusController(),f=!a.containsFocus(t.parent());f&&a.showFocus();var l=w(o,".ee-button",s);if(l.length){var c=u.getSelection();c.isDone()&&c.onLeaf();var h=l.attr("name");u.processTemplate(h);if(e.isIOS)return;if(e.isCrOS){(f||!i)&&a.moveToInput(l);return}return i||(a.moveToPanel(l),a.moveToInput(l)),!1}var p=w(o,".accordion-toggle",s);if(p.length){if(e.isIOS||e.isCrOS){f&&a.moveToInput(l);return}a.moveToInput();return}return a.moveToInput(),!1}},g=function(e){return function(t){var n=r(t.currentTarget),s=r(t.target),o=e.model(),a=o.getFocusController(),f=i.getKeyCode(t);if(f===i.ESCAPE)return a.moveToInput(s),!1;if(f===i.ENTER||f===i.SPACE)return s.trigger(u.CLICK,f),a.moveToPanel(s),!1;if(f===i.TAB&&!t.shiftKey&&a.tabNext(n,s))return!1;if(f===i.TAB&&t.shiftKey&&a.tabPrev(n,s))return!1;if(f===i.HOME)return a.moveHome(n,s),!1;if(f===i.END)return a.moveEnd(n,s),!1;if(!t.shiftKey){if(f===i.UP)return a.moveUp(n,s),!1;if(f===i.DOWN)return a.moveDown(n,s),!1;if(f===i.LEFT)return a.moveLeft(n,s),!1;if(f===i.RIGHT)return a.moveRight(n,s),!1}else{if(f===i.UP||f===i.LEFT)return a.prevGroup(n,s),!1;if(f===i.DOWN||f===i.RIGHT)return a.nextGroup(n,s),!1}}},y=function(e){return function(t){var n=r(t.currentTarget),s=r(t.target),o=e.model(),a=o.getFocusController(),f=i.getKeyCode(t);if(f===i.ESCAPE)return a.moveToInput(s),!1;if(f===i.ENTER||f===i.SPACE)return s.trigger(u.CLICK,f),a.moveToPanel(s),!1;if(f===i.TAB&&!t.shiftKey&&a.tabNext(n,s))return!1;if(f===i.TAB&&t.shiftKey&&a.tabPrev(n,s))return!1;if(f===i.HOME)return a.moveHome(n,s),!1;if(f===i.END)return a.moveEnd(n,s),!1;if(!t.shiftKey){if(f===i.UP)return a.moveUp(n,s),!1;if(f===i.DOWN)return a.moveDown(n,s),!1;if(f===i.LEFT)return a.moveLeft(n,s),!1;if(f===i.RIGHT)return a.moveRight(n,s),!1}else{if(f===i.LEFT||f===i.UP)return a.prevGroup(n,s),!1;if(f===i.RIGHT||f===i.DOWN)return a.nextGroup(n,s),!1}}},b.prototype.process=function(e,t){var n=this.config(),i=this.model().getToolTips(),o=this.model().getCollapsible(),u=this.parent().attr("id"),a=[];a.push('<div class="accordion">'),a.push('<div role="tablist" aria-owns="'),a.push('"/>');var f="",l=0,c=0,h=0,p=r("palette",t).length;r("palette",t).each(function(){var e=r(this).attr("ref"),t=n.getPaletteInfo(e);if(!t)return!0;l+=1;var d=s.getAttr(this,"open")||s.getAttr(t,"open")||(o?"false":"true"),v=r("label",this).text()||r("title",t).text(),m=u+"-ee-palette-tab-"+e,g=u+"-ee-palette-panel-"+e;f+=" "+m,h+=1,a.push('<div class="accordion-group">'),a.push('<div class="accordion-heading">'),a.push('<a class="accordion-toggle"'),a.push(' data-toggle="collapse"'),a.push(' data-target="#'),a.push(g),a.push('" id="'),a.push(m),a.push('" data-row="'),a.push(l),a.push('" data-column="'),a.push(1),a.push('" aria-label="'),a.push(v),a.push("\n"),a.push('" aria-controls="'),a.push(g),a.push('" aria-expanded="'),a.push(d==="true"?"true":"false"),a.push('" aria-posinset="'),a.push(h),a.push('" aria-setsize="'),a.push(p),a.push('" role="tab" tabindex="0">'),l+=1,c=0,a.push('<i class="ee-icon-caret-'),a.push(d==="true"?"down":"right"),a.push('"></i>'),a.push(v),a.push("</a>"),a.push("</div>"),a.push('<div class="accordion-body collapse'),d==="true"&&a.push(" in"),a.push('" id="'),a.push(g),a.push('" role="tabpanel" aria-live="off">'),a.push('<p class="accordion-inner">'),r("button",t).each(function(){var e=r(this).attr("ref"),t=n.getButtonInfo(e);if(!t)return;var o=r("label",this),u=r("label",t),f=o.text()||u.text()||"&nbsp;",h=s.processStyles(u,o)||"",p=o.attr("class")||u.attr("class")||"",v=o.attr("icon")||u.attr("icon");p+=" ee-button btn",v&&(p+=" icon",f='<i class="'+v+'"></i>');var m=r("tooltip",this).text()||r("tooltip",t).text()||"",g=r("template",t),y=g.attr("name")||g.attr("char");c+=1,a.push('<button name="'),a.push(y),a.push('" class="'),a.push(p),a.push('" data-row="'),a.push(l),a.push('" data-index="'),a.push(c),i&&m&&(a.push('" data-toggle="tooltip"'),a.push(' data-placement="top"'),a.push(' title="'),a.push(m)),m&&(a.push('" aria-label="'),a.push(m),a.push("\n")),d!=="true"&&(a.push('" disabled="disabled'),a.push('" tabindex="-1')),a.push('" aria-live="off">'),a.push("<span"),h&&(a.push(' style="'),a.push(h),a.push('"')),a.push(">"),a.push(f),a.push("</span>"),a.push("</button>")}),a.push("</p>"),a.push("</div>"),a.push("</div>")}),a.push("</div>"),a.splice(2,0,f),e.append(r(a.join("")))},b}),n("editor/panel/MoreMenu",["editor/util/Utils","editor/panel/Panel","editor/model/Model","lib/bootstrap"],function(e,t,n){var r=e.$,i=e.Key,s=e.XML,o=e.Object,u=e.Event,a,f,l,c,h,p,d,v,m,g,y,b,w,E=function(e,t){return t instanceof n||(t=null),this._parent=e,this._model=t,this._build=!1,this.buildLater(),this};E.create=function(e,t){return new E(e,t)},E.prototype.destroy=function(){this._parent=null,this._model=null,this._build=!1},E.prototype.parent=function(){return this._parent},E.prototype.model=function(){return this._model},E.prototype.config=function(){return this.model().getConfig()},E.prototype.buildLater=function(){var e=this.parent(),n=e.find("."+t.MORE),r=this.model();if(!r.getMoreMenu()){n.hide();return}var i=this.config().getMoreMenu();if(!(i&&s.children(i).length>0)){r.setMoreMenu(!1),n.hide();return}n.addClass("modal"),n.css("display","none"),n.attr("data-backdrop",!1);var o=e.find("."+t.QUICK),a=e.find("."+t.BAR),f=u.FOCUS_IN+" "+u.MOUSE_DOWN,l=this.build.bind(this);o.one(f,l),a.one(f,l)},E.prototype.build=function(){if(this._build)return;this._build=!0;var e=this.model();if(!e.getMoreMenu())return;var n=this.config().getMoreMenu();if(!n)return;var i=this.parent(),s=i.find("."+t.MORE),o=i.find("."+t.INPUT),b=e.getFocusController();b.setInput(o),b.addPanel(s),this.process(s,n);var w=r(".ee-more-panel",s);w.height(s.height()),w.removeAttr("tabindex"),r("a",s).attr("tabindex",0),r(".open .accordion-body",s).addClass("in"),this._toggles=r(".accordion-toggle",s),this._panels=r(".accordion-body",s);var E=r("button",s);E.tooltip(t.tooltipOptions()),E.on(u.FOCUS_OUT,a(this)),s.on("hidden.bs.tooltip",f(this)),s.on("shown.bs.tooltip",l(this)),s.on("hidden.bs.collapse",c(this)),s.on("shown.bs.collapse",c(this)),s.on("hidden.bs.modal",h(this)),s.on("shown.bs.modal",p(this)),s.on(u.KEY_DOWN,d(this)),s.on(u.KEY_UP,v(this)),s.on(u.MOUSE_DOWN,m(this)),s.on(u.MOUSE_OUT,g(this)),s.on(u.MOUSE_UP,g(this)),s.on(u.CLICK,y(this)),e.getCollapsible()||this._toggles.on(u.CLICK,!1)},a=function(t){return function(n){var i=r(n.target);i.tooltip("hide"),t._hideTooltip&&(e.stopThread(t._hideThread),t._hideTooltip=null,t._hideThread=0)}},f=function(t){return function(n){var i=r(n.target),s=i.data("tooltip")||i.data("bs.tooltip");s&&(s.options.placement="top"),t._hideTooltip&&t._hideTooltip===s&&(e.stopThread(t._hideThread),t._hideTooltip=null,t._hideThread=0)}},l=function(t){return function(n){var i=r(n.currentTarget),s=r(n.target),u=s.data("tooltip")||s.data("bs.tooltip");if(!u)return;var a=u.tip(),f=u.arrow(),l=a.closest(".accordion-body");if(a.length===0||l.length===0)return;var c=l.offset().left,h=a.offset().left,p=o.toNumber(f.css("left")),d=l[0].offsetWidth,v=a[0].offsetWidth;h<c&&(a.offset({left:c}),f.css("left",p+h-c)),c+d<h+v&&(a.offset({left:c+d-v}),f.css("left",p+h+v-c-d));var m=a.offset().top,g=u.$element.offset().top,y=a[0].offsetHeight;m+y+3<g&&a.offset({top:g-y-3}),a.offset().top<i.offset().top&&u.options.placement==="top"&&(a.removeClass("top"),u.options.placement="bottom",u.show()),t._hideTooltip&&t._hideTooltip!==u&&(e.stopThread(t._hideThread),t._hideTooltip.hide()),t._hideTooltip=u,t._hideThread=e.runOnce(3e3,function(){s.tooltip("hide")})}},c=function(){return function(e){var n=r(e.target);if(e.target===e.currentTarget)return;if(n.hasClass("ee-button"))return;var i=n.parent(),s=r("button",i);r(".accordion-toggle i",i).toggleClass("ee-icon-caret-right ee-icon-caret-down");var o=r(".accordion-toggle",i);e.type==="shown"?(s.removeAttr("disabled"),s.removeAttr("tabindex"),o.attr("aria-expanded","true"),s.tooltip(t.tooltipOptions())):(s.attr("disabled","disabled"),s.attr("tabindex",-1),o.attr("aria-expanded","false"),s.tooltip("destroy"))}},h=function(e){return function(t){if(t.target!==t.currentTarget)return;e._panels.removeClass("in"),e._panels.css("height",0),r("i",e._toggles).removeClass("ee-icon-caret-down"),r("i",e._toggles).addClass("ee-icon-caret-right"),r("button",e._panels).attr("disabled","disabled"),r("button",e._panels).attr("tabindex",-1),r("button[name='more'] i:first-child",e.parent()).removeClass("ee-icon-caret-down ee-icon-caret-up").addClass("ee-icon-caret-down")}},p=function(){return function(e){if(e.target!==e.currentTarget)return;var t=r(e.currentTarget);r(".open .accordion-body",t).addClass("in"),r(".open .accordion-body",t).height("auto"),r(".open .accordion-toggle i",t).toggleClass("ee-icon-caret-right ee-icon-caret-down"),r(".open button",t).removeAttr("disabled"),r(".open button",t).removeAttr("tabindex")}},d=function(e){return function(t){var n=r(t.target);if(n.hasClass("accordion-toggle"))return b(e)(t);if(n.hasClass("ee-button"))return w(e)(t)}},v=function(){return function(e){if(e.keyCode===i.ESCAPE)return!1;if(e.keyCode===i.ENTER||e.keyCode===i.SPACE)return!1}};var S=function(e,t,n){return e.is(t)?e:e.closest(t,n)};return m=function(){return function(t){var n=r(t.currentTarget),i=r(t.target),s=S(i,".ee-button",n);if(s.length){s.addClass("active"),e.runOnce(300,function(){s.removeClass("active")});return}var o=S(i,".accordion-toggle",n),u=S(i,".accordion",n);if(u.length&&!o.length)return!1}},g=function(){return function(e){var t=r(e.currentTarget),n=r(e.target),i=S(n,".ee-button",t);if(i.length){i.removeClass("active");return}var s=S(n,".accordion-toggle",t),o=S(n,".accordion",t);if(o.length&&!s.length)return!1}},y=function(t){return function(n,i){var s=r(n.currentTarget),o=r(n.target),u=t.model(),a=u.getFocusController(),f=!a.containsFocus(t.parent());f&&a.showFocus();var l=S(o,".ee-button",s);if(l.length){var c=u.getSelection();c.isDone()&&c.onLeaf();var h=l.attr("name");u.processTemplate(h),(n.pageX||n.pageY)&&s.modal("hide");if(e.isIOS)return;if(e.isCrOS){(f||!i)&&a.moveToInput(l);return}return i||(a.moveToPanel(l),a.moveToInput(l)),!1}var p=S(o,".accordion-toggle",s);if(p.length){if(e.isIOS||e.isCrOS)return;a.moveToInput();return}return a.moveToInput(),!1}},b=function(e){return function(t){var n=r(t.currentTarget),s=r(t.target),o=e.model(),a=o.getFocusController(),f=i.getKeyCode(t);if(f===i.ESCAPE)return a.moveToInput(s),n.modal("hide"),!1;if(f===i.ENTER||f===i.SPACE)return s.trigger(u.CLICK,f),a.moveToPanel(s),!1;if(f===i.TAB&&!t.shiftKey&&a.tabNext(n,s))return!1;if(f===i.TAB&&t.shiftKey&&a.tabPrev(n,s))return!1;if(f===i.HOME)return a.moveHome(n,s),!1;if(f===i.END)return a.moveEnd(n,s),!1;if(!t.shiftKey){if(f===i.UP)return a.moveUp(n,s),!1;if(f===i.DOWN)return a.moveDown(n,s),!1;if(f===i.LEFT)return a.moveLeft(n,s),!1;if(f===i.RIGHT)return a.moveRight(n,s),!1}else{if(f===i.UP||f===i.LEFT)return a.prevGroup(n,s),!1;if(f===i.DOWN||f===i.RIGHT)return a.nextGroup(n,s),!1}}},w=function(e){return function(t){var n=r(t.currentTarget),s=r(t.target),o=e.model(),a=o.getFocusController(),f=i.getKeyCode(t);if(f===i.ESCAPE)return a.moveToInput(s),n.modal("hide"),!1;if(f===i.ENTER||f===i.SPACE)return s.trigger(u.CLICK,f),a.moveToPanel(s),!1;if(f===i.TAB&&!t.shiftKey&&a.tabNext(n,s))return!1;if(f===i.TAB&&t.shiftKey&&a.tabPrev(n,s))return!1;if(f===i.HOME)return a.moveHome(n,s),!1;if(f===i.END)return a.moveEnd(n,s),!1;if(!t.shiftKey){if(f===i.UP)return a.moveUp(n,s),!1;if(f===i.DOWN)return a.moveDown(n,s),!1;if(f===i.LEFT)return a.moveLeft(n,s),!1;if(f===i.RIGHT)return a.moveRight(n,s),!1}else{if(f===i.LEFT||f===i.UP)return a.prevGroup(n,s),!1;if(f===i.RIGHT||f===i.DOWN)return a.nextGroup(n,s),!1}}},E.prototype.process=function(e,t){var n=this.config(),i=this.model().getToolTips(),o=this.model().getCollapsible(),u=this.parent().attr("id"),a=[];a.push('<div class="ee-more-panel">'),a.push('<div class="accordion">');var f=0,l=0;r("palette",t).each(function(){var e=r(this).attr("ref"),t=n.getPaletteInfo(e);if(!t)return!0;f+=1;var c=s.getAttr(this,"open")||s.getAttr(t,"open")||(o?"false":"true"),h=r("label",this).text()||r("title",t).text(),p=u+"-ee-palette-panel-"+e;a.push('<div class="accordion-group'),c==="true"&&a.push(" open"),a.push('">'),a.push('<div class="accordion-heading">'),a.push('<a class="accordion-toggle"'),a.push(' data-toggle="collapse"'),a.push(' data-target="#'),a.push(p),a.push('" data-row="'),a.push(f),a.push('" data-column="'),a.push(1),a.push('" aria-label="'),a.push(h),a.push("\n"),a.push('">'),f+=1,l=0,a.push('<i class="ee-icon-caret-'),a.push(c==="true"?"down":"right"),a.push('"></i>'),a.push(h),a.push("</a>"),a.push("</div>"),a.push('<div class="accordion-body collapse" id="'),a.push(p),a.push('">'),a.push('<p class="accordion-inner">'),r("button",t).each(function(){var e=r(this).attr("ref"),t=n.getButtonInfo(e);if(!t)return!0;var o=r("label",this),u=r("label",t),c=o.text()||u.text()||"&nbsp;",h=s.processStyles(u,o)||"",p=o.attr("class")||u.attr("class")||"",d=o.attr("icon")||u.attr("icon");p+=" ee-button btn",d&&(p+=" icon",c='<i class="'+d+'"></i>');var v=r("tooltip",this).text()||r("tooltip",t).text()||"",m=r("template",t),g=m.attr("name")||m.attr("char");l+=1,a.push('<button name="'),a.push(g),a.push('" class="'),a.push(p),a.push('" data-row="'),a.push(f),a.push('" data-index="'),a.push(l),i&&v&&(a.push('" data-toggle="tooltip"'),a.push(' data-placement="top"'),a.push(' title="'),a.push(v)),v&&(a.push('" aria-label="'),a.push(v),a.push("\n")),a.push('" disabled="disabled'),a.push('" tabindex="-1'),a.push('">'),a.push("<span"),h&&(a.push(' style="'),a.push(h),a.push('"')),a.push(">"),a.push(c),a.push("</span>"),a.push("</button>")}),a.push("</p>"),a.push("</div>"),a.push("</div>")}),a.push("</div>"),a.push("</div>"),e.append(r(a.join("")))},E}),n("editor/event/HandlerBase",["editor/util/Utils","editor/panel/Panel","editor/model/Model"],function(e,t,n){var r=e.$,i=e.XML,s=function f(e,r){return e instanceof f?(this.setHandler(e),this.addListeners(),this):(e instanceof jQuery||(e=null),r instanceof n||(r=null),this._handler=null,this._parent=e,this._target=e?e.find("."+t.INPUT):null,this._proxy=this._target,this._model=r,this)};s.prototype.destroy=function(){this.removeListeners(),this._handler=null,this._parent=null,this._target=null,this._proxy=null,this._model=null},s.prototype.addListeners=function(){return},s.prototype.removeListeners=function(){return},s.prototype.setHandler=function(e){this._handler=e,this._parent=e._parent,this._target=e._target,this._proxy=e._proxy,this._model=e._model},s.prototype.setProxy=function(e){this._proxy=e},s.prototype.handler=function(){return this._handler},s.prototype.parent=function(){return this._parent},s.prototype.target=function(){return this._target},s.prototype.proxy=function(){return this._proxy},s.prototype.model=function(){return this._model},s.prototype.history=function(){return this.model().getHistory()},s.prototype.selection=function(){return this.model().getSelection()};var o=function(e,t){return t===!1?!1:function(n){return t.call(e,n)}},u=function(e,t,n,r){t&&n&&t.on(n+".editor",o(e,r))},a=function(e,t){e&&t&&e.off(t+".editor")};return s.prototype.addListener=function(e,t){u(this,this.target(),e,t)},s.prototype.removeListener=function(e){a(this.target(),e)},s.prototype.addProxyListener=function(e,t){u(this,this.proxy(),e,t)},s.prototype.removeProxyListener=function(e){a(this.proxy(),e)},s.prototype.addParentListener=function(e,t){u(this,this.parent(),e,t)},s.prototype.removeParentListener=function(e){a(this.parent(),e)},s.prototype.useProxy=function(){return e.isTouch||e.isCrOS||this.model().getBrailleBar()},s.prototype.inferKeys=function(){return e.isTouch&&e.isAndroid},s.prototype.createProxy=function(){if(this.useProxy()){var n=this.target(),i=this.inferKeys()?"<input/>":"<textarea/>",s=r(i).addClass(t.PROXY);s.attr("tabindex",n.attr("tabindex")),s.attr("aria-label","equation"),s.attr("autocapitalize","off"),s.attr("autocomplete","off"),s.attr("autocorrect","off"),s.attr("spellcheck","false"),s.attr("cols","100"),e.isAndroid&&s.css("width","1px"),s.on("cut copy paste",function(){return!1}),n.attr("tabindex",-1),this.inferKeys()&&(s.attr("type","password"),s[0].value="01",s[0].setSelectionRange(1,1)),s.insertAfter(n),this.setProxy(s)}},s.prototype.getProxyIndex=function(){return this.handler().getProxyIndex()},s.prototype.setProxyIndex=function(e){this.handler().setProxyIndex(e)},s.prototype.setProxyValue=function(e,t){this.handler().setProxyValue(e,t)},s.prototype.isProxyValue=function(e,t){return this.handler().isProxyValue(e,t)},s.prototype.getReference=function(e){var t=e.target;if(!t)return null;var n=t.display;while(n&&!n.getRefer())n=n.getParent();if(!n)return null;var r=n.getRefer(),s=r.getReferenceCount();t=this.target()[0];var o=e.offsetX,u=e.offsetY,a=-1,f=s,l,c,h,p,d,v,m,g,y;while(f-a>1){l=Math.round((a+f)/2),c=r.getReference(l),n=c.getDisplay();if(n===null)break;h=n.getXML(),p=n.getBox(),v=p.left,m=p.top,g=v+p.width,y=m+p.height;if(v<=o&&o<=g&&m<=u&&u<=y)return d=i.getOffsets(h.parentNode,t),d.left=p.left+d.left,d.top=p.top+d.top,d.width=p.width,d.height=p.height,c._box=d,c;if(u<m||u<=y&&o<v)f=l;else{if(!(u>y||u>=m&&o>g))break;a=l}}for(l=a+1;l<f;l+=1){c=r.getReference(l),n=c.getDisplay();if(n===null)continue;h=n.getXML(),p=n.getBox(),v=p.left,m=p.top,g=v+p.width,y=m+p.height;if(v<=o&&o<=g&&m<=u&&u<=y)return d=i.getOffsets(h.parentNode,t),d.left=p.left+d.left,d.top=p.top+d.top,d.width=p.width,d.height=p.height,c._box=d,c}return r},s}),n("editor/event/MouseHandler",["editor/util/Utils","editor/event/HandlerBase"],function(e,t){var n=e.$,r=e.Event,i,s,o,u,a,f,l,c,h,p=function(n){return t.call(this,n),this};p.prototype=new t,p.prototype.constructor=p,p.prototype.addListeners=function(){this.addListener(r.MOUSE_ENTER,s),this.addListener(r.MOUSE_LEAVE,o),this.addListener(r.MOUSE_MOVE,a),this.addListener(r.MOUSE_OVER,a),this.addListener(r.MOUSE_DOWN,u),this.addListener(r.MOUSE_UP,f),this.addListener(r.TOUCH_START,l),this.addListener(r.TOUCH_MOVE,c),this.addListener(r.TOUCH_END,h),this.addListener(r.CLICK,!1),this.addListener(r.DOUBLE,!1),this.addListener(r.CONTEXT_MENU,!1),this.addParentListener(r.MOUSE_DOWN,!1),this.addParentListener(r.MOUSE_OUT,i)},p.prototype.removeListeners=function(){this.removeListener(r.MOUSE_ENTER,s),this.removeListener(r.MOUSE_LEAVE,o),this.removeListener(r.MOUSE_MOVE,a),this.removeListener(r.MOUSE_OVER,a),this.removeListener(r.MOUSE_DOWN,u),this.removeListener(r.MOUSE_UP,f),this.removeListener(r.TOUCH_START,l),this.removeListener(r.TOUCH_MOVE,c),this.removeListener(r.TOUCH_END,h),this.removeListener(r.CLICK,!1),this.removeListener(r.DOUBLE,!1),this.removeListener(r.CONTEXT_MENU,!1),this.removeParentListener(r.MOUSE_DOWN,!1),this.removeParentListener(r.MOUSE_OUT,i)},i=function(e){if(!n.contains(this.target()[0],e.target)){var t=this.selection();t._selectionScroll=!0;var r=this.model().getScrollController();r.saveDragNode()}},s=function(e){if(e.target===e.currentTarget){var t=this.model().getScrollController();t.clearDragNode()}},o=function(e){if(e.target===e.currentTarget){var t=this.selection();t._selectionScroll=!0;var n=this.model().getScrollController();n.saveDragNode()}},u=function(e){var t=this.model(),n=this.selection();n._selectionScroll=!1;var r=n.getCurrentContent(),i,s=t.getFocusController();if(s.clickToFocus(e))return!1;var o=t.getScrollController();if(o.clickToScroll(e))return!0;if(e.touchEvent&&o.dragToScroll(e))return!1;o.selectAtEnd(e)&&(o.moveToEnd(e),i=r.closeOuter(e.content),r.closeSoft(i)&&n.update());if(o.selectAtEdit(e))return n.onDone(),t.hasEditableEnd()||n.onPlaceLeft(),n.onLast(),e.refer=n.getHeadReference(),e.content=n.getCurrentContent(),i=r.closeOuter(e.content),r.closeSoft(i)&&n.update(),!1;var u=o.mouseDownCount(e),a=o.getMouseName(e,"mouse");if(u===2&&n.isImplicit())return n.makeExplicit(),n.update(),this.history().save(),!1;if(u>1&&o.selectExpand(e,a))return this.history().save(),!1;if(o.selectExtend(e,a))return this.history().save(),!1;var f=o.getSelectionSide(e);o.selectStart(e,a)&&n.setSelectionSide(f),i=r.closeOuter(e.content),r.closeSoft(i)&&n.update()},a=function(e){var t=this.model().getScrollController();t.selectMove(e)},f=function(e){var t=this.model(),n=this.selection();n._selectionScroll=!0;var r=t.getScrollController();r.selectAtEnd(e)&&r.moveToEnd(e);var i=e.refer,s=e.content;if(i===null||s===null){r.saveDragNode();return}var o=r.mouseUpCount(e);if(o>1)return;var u=r.getMouseName(e);r.selectEnd(e,u)&&r.saveDragNode();var a=r.getDragNode();if(a&&a.getContent()&&i&&s){var f=a.getContent(),l=f.closeOuter(s);f.closeSoft(l)&&n.update()}r.clearDragNode()};var d=function(e){var t=e.originalEvent.touches;t.length===0&&(t=e.originalEvent.changedTouches);if(t.length!==1)return null;var r=t[0],i={};i.altKey=e.altKey,i.ctrlKey=e.ctrlKey,i.shiftKey=e.shiftKey,i.metaKey=e.metaKey;var s=r.pageX,o=r.pageY,u=document.scrollingElement||document.body;u&&(s-=u.scrollLeft,o-=u.scrollTop),i.touchEvent=e,i.target=document.elementFromPoint(s,o),s=r.pageX,o=r.pageY;if(i.target){var a=n(i.target).offset();a&&(s-=a.left,o-=a.top)}return i.offsetX=s,i.offsetY=o,i.which=1,i},v=function(e,t){var r=d(e);r&&n(r.target).trigger(n.Event(t,r))};return l=function(e){v(e,r.MOUSE_DOWN);var t=this.model().getScrollController();if(t.getCurrentNode())return!1},c=function(e){var t=this.model().getScrollController();if(t.getCurrentNode())return v(e,r.MOUSE_MOVE),!1},h=function(t){var n=this.selection();n._selectionScroll=!0;var i=this.model().getScrollController();if(i.getCurrentNode()){v(t,r.MOUSE_UP),v(t,r.CLICK);return}i.saveDragNode();if(e.isIOS&&e.hasFocus(this.proxy()))return!1},p}),n("editor/event/FocusHandler",["editor/util/Utils","editor/event/HandlerBase"],function(e,t){var n=e.$,r=e.Event,i,s,o,u,a,f,l=function(n){return t.call(this,n)};l.prototype=new t,l.prototype.constructor=l,l.prototype.addListeners=function(){this.addProxyListener(r.FOCUS_IN,i),this.addProxyListener(r.FOCUS_OUT,s),this.addParentListener(r.FOCUS_IN,a),this.addParentListener(r.FOCUS_OUT,f),this.useProxy()&&this.addListener(r.FOCUS_IN,u)},l.prototype.removeListeners=function(){this.removeProxyListener(r.FOCUS_IN,i),this.removeProxyListener(r.FOCUS_OUT,s),this.removeParentListener(r.FOCUS_IN,a),this.removeParentListener(r.FOCUS_OUT,f),this.useProxy()&&this.removeListener(r.FOCUS_IN,u)};var c=null,h=null;l.getPrevKeyDown=function(){return c},l.setPrevKeyDown=function(e){c=e},l.getKeyDown=function(){return h},l.setKeyDown=function(e){if(h||e)c=h||c;h=e},i=function(){l.setKeyDown(null);var e=this.model(),t=e.getFocusController();if(t.showFocus()&&this.useProxy()){o.call(this);var n=this.getProxyIndex();n===-1&&(n=0),this.setProxyIndex(n),e.isKeyMode()&&e._showKeyMode&&(e._showKeyMode=!1,e.processTemplate("showMode"))}},s=function(e){l.setKeyDown(null);var t=this.model(),n=t.getFocusController();n.hideFocus(e)};var p=!1,d=-1,v=-1,m=function(){if(p!==this)return;var t=this.parent();if(t===null)return;var r=t.offset(),i=r.left,s=t.width(),o=window.scrollX,u=window.innerWidth,a=o,f=16;a+u<i+s+f&&(a=i+s+f-u),a>i-f&&(a=i-f),a<0&&(a=0);var l=r.top,c=t.height(),h=window.scrollY,m=window.innerHeight,g=h,y=n(".navbar-fixed-top"),b=y.css("position")==="fixed"?y.height():0;l-=b,c+=b;var w=m<u?.5:.75;g+m*w<l&&(g=l),g+m*w<l+c&&(g=l),g>l&&(g=l),g<0&&(g=0),a===o&&g===h||a===d&&g===v?p=!1:(d=a,v=g,e.runOnce(500,function(){var t=a-window.scrollX,n=g-window.scrollY;e.isWin10&&(n=0);if(e.isCrOS&&e.isAndroid){n=0;if(e.isZoom())return}if(e.isAndroid&&window.visualViewport){t-=window.visualViewport.offsetLeft,n-=window.visualViewport.offsetTop;if(e.isCrOS&&e.isZoom())return}if(e.isIOS&&!e.isIOS10){var r=document.scrollingElement||document.body;if(h+m>r.scrollHeight)return}(t!==0||n!==0)&&window.scrollBy(t,n),d=v=-1,p=!1}))};return o=function(){p=this.useProxy()?this:!1,e.runOnce(500,m.bind(this))},u=function(){e.hasFocus(this.target())&&this.proxy()[0].focus()},a=function(){l.setKeyDown(null);var e=this.model(),t=e.getFocusController();e.getSelection().setSelectionParent(!0),e.startQueue(),t.getExpectsFocus()||t.showFocus()},f=function(e){var t=this.model(),r=t.getFocusController(),i=e.relatedTarget;n.contains(this.parent()[0],i)||(r.hideFocus(e),t.stopQueue());if(e.target!==this.proxy()[0])return;r.inputHasFocus()&&!r.getExpectsFocus()&&r.hideFocus(e);var s=l.getKeyDown();(s===null||s==="tab"||s==="shift-tab")&&r.hideFocus(e)},l}),n("editor/event/KeyHandler",["editor/util/Utils","editor/expr/Template","editor/event/HandlerBase","editor/event/FocusHandler"],function(e,t,n,r){var i=e.Key,s=e.Event,o=e.Object,u=e.Symbol,a={"ctrl-0":!0,"ctrl-+":!0,"ctrl--":!0,"ctrl-=":!0,"ctrl-_":!0},f=function(t){return n.call(this,t)};f.prototype=new n,f.prototype.constructor=f;var l,c,h,p,d,v,m,g,y=!1,b="“",w="”",E=25,S=null,x="\\",T="/",N=null,C=0,k=0,L=0,A=null;f.prototype.addListeners=function(){this.addProxyListener(s.KEY_PRESS,p),this.addProxyListener(s.KEY_DOWN,d),this.addProxyListener(s.KEY_UP,v),this.addParentListener(s.KEY_DOWN,l),this.addProxyListener("compositionstart",c),this.addProxyListener("compositionend",h)},f.prototype.removeListeners=function(){this.removeProxyListener(s.KEY_PRESS,p),this.removeProxyListener(s.KEY_DOWN,d),this.removeProxyListener(s.KEY_UP,v),this.removeParentListener(s.KEY_DOWN,l),this.removeProxyListener("compositionstart",c),this.removeProxyListener("compositionend",h)},l=function(e){var t=m(e);t!==r.getKeyDown()&&t!=="shift-tab"&&r.setKeyDown(t)},c=function(){var e=this.selection();if(e.getSelectionFocus()===!1)return!0;y=!0},h=function(e){var t=this.selection();if(t.getSelectionFocus()===!1)return!0;var n=this.model(),i=m(e);i&&i!==r.getKeyDown()&&(r.setKeyDown(i),i=this.prefixName(i),n.processTemplate(i),n._keyPrefix=A||i),y=!1};var O=0,M={},_=4,D=function(e){var t=e.type,n=e.timeStamp;if(n<O-_)return!1;if(n<=O+_){var r=M[t];if(r)return!1;M[t]=e}return n>O+_&&(O=n,M={},M[t]=e),!0};p=function(t){if(e.isIOS&&!D(t))return!1;var n=this.selection();if(n.getSelectionFocus()===!1)return!0;var i=this.model(),s=m(t),u=r.getKeyDown(),f;if(s&&s!==u){if(e.isIOS&&u==="bs")return;r.setKeyDown(s);if(s===b)return S="",!0;if(S!==null)if(s===w||S.length>E)s=S,S=null;else if(!s.match(/alt-[0-9]/))return S+=s,!0;if(s===x&&N===null&&i.isKeyMode())return N=0,!0;if(N!==null){if(s.match(/[1-8]/))return N|=1<<s-1,!0;if(s===T)s=g(N),N=null;else{if(s!==x)return N=null,!1;N=null}}if(s==="tab"||s==="shift-tab")return!1;var l=/(.*)\[([0-9]+)\]/.exec(s);l&&(s=l[1],f=o.toInteger(l[2])),s=this.prefixName(s),i.processTemplate(s,f),i._keyPrefix=A||s;if(!a[s])return e.isIOS&&!e.isZoom()?!0:!1}return!0};var P=0;d=function(n){if(e.isIOS10&&C===0){var s=document.scrollingElement||document.body;k=s.scrollTop,L=s.scrollLeft,k=k<0?0:k,L=L<0?0:L}if(e.isIOS&&!D(n))return!1;if(e.isCrOS&&y)return!0;var u=this.selection();if(u.getSelectionFocus()===!1)return!0;var f=r.getKeyDown();f==="shift"&&(f=r.getPrevKeyDown(),r.setKeyDown(f)),r.setKeyDown(null);var l=m(n);r.setKeyDown(l);var c=this.model();t.clearQueue(c);if(l==="shift")return!1;var h;if(l){if(l!==f)P=1;else if(P<10)P+=1;else if(!i.limitEnabled[l])return c.processTemplate("repeatLimit"),!1;e.isIOS10&&l===" "&&(C+=1);if(l===b)return S="",!0;if(S!==null)if(l===w||S.length>E)l=S,S=null;else if(!l.match(/alt-[0-9]/))return S+=l,!0;var p=c.getFocusController();if(l==="esc")return p.saveSelection(),p.moveToPanel(),!1;if(l==="tab")return p.isSelectionGap()||p.saveSelection(),t.processPlaceRight(c),u.isDone()?(this.history().pop(),c.flushQueue(),p.nextPanel(this.target(),this.target()),p.isSelectionGap()||p.showSelection(),!1):(p.isSelectionGap()||p.clearSelection(),c.processPost(l),!1);if(l==="shift-tab")return p.isSelectionGap()||p.saveSelection(),t.processPlaceLeft(c),u.isDone()?(this.history().pop(),c.flushQueue(),p.isSelectionGap()||p.showSelection(),!0):(p.isSelectionGap()||p.clearSelection(),c.processPost(l),!1);var d=/(.*)\[([0-9]+)\]/.exec(l);d&&(l=d[1],h=o.toInteger(d[2]));if(c.getBrailleBar()){var v=this.proxy()[0],g=v.value,x=-1;if(l==="left"||l==="right"||l==="home"||l==="end"||l==="delete")x=g.length;x!==-1&&(v.value=g+String.fromCharCode(8192),this.setProxyIndex(x))}l=this.prefixName(l),c.processTemplate(l,h),c._keyPrefix=A||l,l==="keyboard"&&(P-=2);if(!a[l]){if(e.isIOS){n.metaKey&&(this.proxy()[0].value="");if(l===" "||l==="up"||l==="down")return!1;if(!e.isZoom())return!0}return!1}}return!0},v=function(n){if(e.isIOS&&!D(n))return!1;var i=this.selection();if(i.getSelectionFocus()===!1)return!0;var s=r.getKeyDown();s==="shift"&&(s=r.getPrevKeyDown(),r.setKeyDown(s),n.shiftKey=!0);var o=document.scrollingElement||document.body,u=m(n);if(u&&u===s){e.isIOS10&&u===" "&&e.runOnce(500,function(){C-=1,C===0&&(o.scrollTop=k,o.scrollLeft=L)}),r.setKeyDown(null);if(!a[u])return!1}if(u==="shift")return r.setKeyDown(u),!1;var f=this.model();if(this.inferKeys()){var l=this.proxy()[0],c=l.value,h=null;return c==="0"&&(h="delete"),c==="1"&&(h="bs"),c.length===3&&c.match(/0.[12]/)&&(h=c.charAt(1)),h&&f.processTemplate(h),l.value=h===" "?"02":"01",this.setProxyIndex(1),!0}if(u==="esc"||u==="tab"||u==="shift-tab"){var p=f.getFocusController();p.showSelection(),p.clearSelection(),i.isDone()&&(u==="esc"||u==="tab"?t.processPlaceRight(f):t.processPlaceLeft(f)),i.isDone()&&(f.hasEditableEnd()||i.onPlaceRight(),i.onLast())}return!0},f.prototype.prefixName=function(e){var t=this.model(),n=t.getConfig(),r=u.get(t._keyPrefix),i=u.get(e);A=null;if(t.isKeyMode()&&e){var s=t.getKeyType(),o=n.getPrefixInfo(s,r,i);if(o){e=o.getKey(i).getName();var a=o.getNext(i);a&&(t.clearKeyHistory(),A=a.getName());if(e==="undo"||e==="redo"||e.indexOf(" ")>0)return e;o.isRoot()?t.clearKeyHistory():t.restoreKeyHistory()}}return!t.isKeyMode()&&e==="="&&(r===i?(t.restoreKeyHistory(),e="keyboard"):(t.clearKeyHistory(),t._keyPrefix="=")),e};var H=" a1b'k2l`cif/msp\"e3h9o6r~djg>ntq,*5<-u8v.%{$+x!&;:4|0z7(_?w}#y)=",B={"alt-`":{65:192,69:200,73:204,79:210,85:217},"alt-e":{65:193,69:201,73:205,79:211,85:218,89:221},"alt-i":{65:194,69:202,73:206,79:212,85:219},"alt-n":{65:195,78:209,79:213},"alt-u":{65:196,69:203,73:207,79:214,85:220}};g=function(e){var t=H.charCodeAt(e%64);return e&64&&(t-=32),e%128===120&&(t=127),e&128&&(t+=128),t===0?"bs":t===128?"":t===160?"enter":String.fromCharCode(t)};var j=function(e,t){var n=!1,r=null,i=t.shift;return 32<=e&&e<127?n=!0:160<=e&&e<256?n=!0:8192<=e&&e<8448?n=!0:10240<=e&&e<10496?(r=g(e),i=!1):12288<=e&&e<12544?n=!0:19968<=e&&e<40960&&(n=!0),n&&(r=String.fromCharCode(e),i=!1),t.shift=i,r},F=function(e,t){var n=null,r=t.shift;return 1<=e&&e<=26&&t.ctrl?(e+=r?64:96,n=String.fromCharCode(e),r=!1):48<=e&&e<=57?r?(n=i.shift[e],r=!1):n=String.fromCharCode(e):65<=e&&e<=90?(r||(e+=32),n=String.fromCharCode(e),r=!1):i.names[e]&&(r&&i.shift.hasOwnProperty(e)?n=i.shift[e]:n=i.names[e],r=!1),t.shift=r,n},I=function(e,t){var n=null;if(i.values.hasOwnProperty(e))return e==="CapsLock"&&(t.ctrl=!1),n=i.values[e],n;var r=e.charCodeAt();if(e.length===1&&1<=r&&r<=255){r<=26&&(r+=96,t.ctrl=!0);if(r<32)return n;65<=r&&r<=90&&t.ctrl&&!t.shift&&(r+=32),97<=r&&r<=122&&t.ctrl&&t.shift&&(r-=32),n=String.fromCharCode(r),t.shift=!1}return n},q=function(e,t){var n=0,r=t.shift;return e===49&&!r&&(n=161),e===191&&r&&(n=191),e===220&&!r&&(n=171),e===220&&r&&(n=187),e===51&&r&&(n=8249),e===52&&r&&(n=8250),n&&(t.key="",t.alt=!1,t.shift=!1),n},R=function(e,t,n){97<=e&&e<=122&&(e-=32);var r=n[e]||0;return r&&(r+=t.shift?0:32,t.key="",t.alt=!1,t.shift=!1),r},U=["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"],z=function(e){e.ctrl&&(e.shift&&(97<=e.kc&&e.kc<=122&&(e.kc-=32),e.cc=0),e.key=""),e.alt&&(e.kc===e.cc&&(e.kc=0),e.cc=0,e.key="")},W=function(e){e.key.length===2&&e.key.charCodeAt()===180&&(e.cc=0,e.kc=0,e.shift=!1);if(e.shift&&e.key.length===1){var t=e.key.charCodeAt();28<=t&&t<=31&&(e.key=U[t-28])}},X=function(t){var n={};n.key=t.key||"",n.alt=t.altKey,n.ctrl=t.ctrlKey||t.metaKey,n.shift=t.shiftKey,n.cc=t.charCode||0,n.kc=t.keyCode||0;if(n.key==="Alt"||n.key==="Control"||n.key==="Shift"||n.key==="Meta")n.alt=!1,n.ctrl=!1,n.shift=!1;return(e.isMacOS||e.isIOS)&&z(n),e.isIOS&&W(n),n},V=function(e,t){return e&&(e=(t.ctrl?"ctrl-":"")+(t.alt?"alt-":"")+(t.shift?"shift-":"")+e),e};return m=function(e){var t=null,n=X(e),i=n.cc,s=n.kc,o=e.originalEvent?e.originalEvent.data:null,u=B[r.getPrevKeyDown()];return!(i||n.key||n.alt||n.ctrl)&&65<=s&&s<=90?null:(i=o&&o.length===1?o.charCodeAt():i,i=n.alt?q(s,n)||i:i,i=u?R(i||s,n,u)||i:i,t=t||I(n.key,n),t=t||j(i,n),t=t||F(s,n),t=V(t,n),t)},f}),n("editor/event/MultiKey",["editor/util/Utils","editor/event/HandlerBase"],function(e,t){var n=e.$,r=e.Key,i,s,o,u=0,a={},f,l,c,h,p,d=function(r,i){return this._options=n.extend({},p,i),t.call(this,r)};d.prototype=new t,d.prototype.constructor=d,d.prototype.destroy=function(){this.removeListeners(),this._options=null},d.prototype.enabled=function(){return this.model().getKeyMode()===2};var v=function(e,t){return function(n){return t.call(e,n)}},m=function(e,t){e.each(function(){var e=n._data(this,"events")[t];e.splice(0,0,e.pop())})};d.prototype.addListeners=function(){this.keypress=v(this,i),this.keydown=v(this,s),this.keyup=v(this,o),this.proxy().on("keypress",this.keypress),this.proxy().on("keydown",this.keydown),this.proxy().on("keyup",this.keyup),this._options.bindFirst&&(m(this.proxy(),"keypress"),m(this.proxy(),"keydown"),m(this.proxy(),"keyup"))},d.prototype.removeListeners=function(){this.proxy().off("keypress",this.keypress),this.proxy().off("keydown",this.keydown),this.proxy().off("keyup",this.keyup),this.keypress=null,this.keydown=null,this.keyup=null};var g=function(e){return e===186?";":String.fromCharCode(e).toLowerCase()},y=function(e){return 10240<=e&&e<=10495},b=function(e){var t=0,n;for(n in e)e.hasOwnProperty(n)&&(t=t|h[n]|10240);return e.hasOwnProperty(" ")&&c[t]&&(t=c[t]),t};return i=function(e){if(!this.enabled()){u=0,a={};return}var t=e.charCode;t===231&&e.key&&(t=e.key.charCodeAt());if(y(t))return;if(l[t]||a.ctrlKey&&f[t])return;if(this._options.consumeKeyEvents)return e.stopImmediatePropagation(),!1},s=function(e){if(!this.enabled()){u=0,a={};return}var t=e.keyCode;t===231&&e.key&&(t=e.key.charCodeAt());if(y(t))return;var n=g(t);h[n]&&!a[n]&&(u+=1,a[n]=!0),e.ctrlKey&&(a.ctrlKey=!0);if(l[t]||a.ctrlKey&&f[t])return;if(this._options.consumeKeyEvents)return e.stopImmediatePropagation(),!1},o=function(e){if(!this.enabled()||u===0){u=0,a={};return}var t=e.keyCode;if(y(t))return;var n=g(t);h[n]&&(u-=1),e.ctrlKey&&(a.ctrlKey=!0),u===0&&(this._options.outputKeyEvents&&(t=b(a),t&&(this.proxy().trigger({type:"keydown",keyCode:t,ctrlKey:a.ctrlKey}),this.proxy().trigger({type:"keyup",keyCode:t,ctrlKey:a.ctrlKey}),y(t)&&this.proxy().trigger({type:"keypress",charCode:t,ctrlKey:a.ctrlKey}))),a={});if(l[t]||a.ctrlKey&&f[t])return;if(this._options.consumeKeyEvents)return e.stopImmediatePropagation(),!1},f={},f[81]=!0,l={},l[r.BACKSPACE]=!0,l[r.ENTER]=!0,l[r.PAGE_UP]=!0,l[r.PAGE_DOWN]=!0,l[r.END]=!0,l[r.HOME]=!0,l[r.LEFT]=!0,l[r.UP]=!0,l[r.RIGHT]=!0,l[r.DOWN]=!0,l[r.EQUAL]=!0,l[r.EQUAL2]=!0,c={},c[10241]=r.UP,c[10243]=r.PAGE_UP,c[10244]=r.LEFT,c[10246]=r.HOME,c[10248]=r.DOWN,c[10264]=r.PAGE_DOWN,c[10272]=r.RIGHT,c[10288]=r.END,h={" ":10240,a:64,s:4,d:2,f:1,j:8,k:16,l:32,";":128},p={bindFirst:!0,consumeKeyEvents:!0,outputKeyEvents:!0},d}),n("editor/event/RouterKey",["editor/util/Utils","editor/event/HandlerBase"],function(e,t){var n=e.Event,r,i,s,o=function(n){return this._pid=-1,this._index=-1,t.call(this,n)};return o.prototype=new t,o.prototype.constructor=o,o.prototype.destroy=function(){this._pid=-1,this._index=-1,this.removeListeners()},o.prototype.addListeners=function(){this.model().getBrailleBar()&&(this.addProxyListener(n.FOCUS_IN,r),this.addProxyListener(n.FOCUS_OUT,i))},o.prototype.removeListeners=function(){this.model().getBrailleBar()&&(this.removeProxyListener(n.FOCUS_IN,r),this.removeProxyListener(n.FOCUS_OUT,i))},o.prototype.getProxyIndex=function(){return this._index},o.prototype.setProxyIndex=function(t){this._index=t;var n=this.proxy()[0];e.hasFocus(n)&&n.selectionStart!==t&&e.runOnce(0,function(){n.setSelectionRange(t,t)})},o.prototype.setProxyValue=function(t,n){this._index=n;var r=this.proxy()[0];r.value!==t&&(r.value=t);if(r.selectionStart!==n){var i=this;i._index=-1,e.runOnce(0,function(){r.setSelectionRange(n,n),i._index=n})}},o.prototype.isProxyValue=function(e,t){var n=this.proxy()[0];return this._index===t&&n.value===e&&n.selectionStart===t},r=function(){this._pid=e.runEvery(100,s.bind(this)),this._index=this._proxy[0].selectionStart},i=function(){e.stopThread(this._pid),this._pid=-1,this._index=-1},s=function(){var e=this._proxy[0].selectionStart;if(this._index!==-1&&e!==this._index){this._index=e;var t=this.model().getSelection()._brailleBar;t&&t.route(e)}},o}),n("editor/event/EventHandler",["editor/event/HandlerBase","editor/event/MouseHandler","editor/event/FocusHandler","editor/event/KeyHandler","editor/event/MultiKey","editor/event/RouterKey"],function(e,t,n,r,i,s){var o=function(u,a){return e.call(this,u,a),this.createProxy(),this._mouse=new t(this),this._focus=new n(this),this._key=new r(this),this._multi=new i(this),this._router=new s(this),a.setHandler(this),this};return o.prototype=new e,o.prototype.constructor=o,o.create=function(e,t){return new o(e,t)},o.prototype.destroy=function(){this._mouse.destroy(),this._mouse=null,this._focus.destroy(),this._focus=null,this._key.destroy(),this._key=null,this._multi.destroy(),this._multi=null,this._router.destroy(),this._router=null,e.prototype.destroy.call(this)},o.prototype.getProxyIndex=function(){return this._router.getProxyIndex()},o.prototype.setProxyIndex=function(e){this._router.setProxyIndex(e)},o.prototype.setProxyValue=function(e,t){this._router.setProxyValue(e,t)},o.prototype.isProxyValue=function(e,t){return this._router.isProxyValue(e,t)},o}),n("editor/model/Editor",["editor/util/Utils","editor/config/Config","editor/config/AttInfo","editor/expr/Exprs","editor/panel/Panel","editor/panel/BrailleBar","editor/panel/ButtonBar","editor/panel/Carousel","editor/panel/QuickBar","editor/panel/SideBar","editor/panel/MoreMenu","editor/model/Model","editor/event/EventHandler","editor/event/MouseHandler","editor/event/FocusHandler","editor/event/KeyHandler"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p=e.$,d=e.Array,v=e.Object,m=e.Color,g=e.Name,y=e.XML,b=e.Markup,w=r.Display,E=r.Content,S=r.Template,x='<math xmlns="'+g.NS_MATH+'">',T="</math>",N,C,k=["width","height","grabFocus","fontSize","fontFamily","fontWeight","fontStyle","fontVariant","mathFontFamily","textFontFamily","editableSelector","responseSelector","mathIt","mathSense","echoAction","keyMode","brailleBar","buttonBar","carousel","quickBar","sideBar","moreMenu","collapsible","toolTips","scrollBars","responseLimit","location","math","text"],L={styles:"basic",ready:"eeEditorReady",width:0,height:0,minWidth:0,maxWidth:0,color:"transparent",background:"transparent",contrast:"",halign:"left",valign:"top",fontSize:24,fontFamily:"",fontWeight:"",fontStyle:"",fontVariant:"",mathFontFamily:"",textFontFamily:"",resize:!1,autoSize:!1,grabFocus:!1,editableSelector:null,responseSelector:null,mathIt:!1,mathSense:!1,echoAction:!1,keyMode:c.KEY_MODE_QWERTY,brailleBar:!1,buttonBar:!0,carousel:!1,quickBar:!1,sideBar:!1,moreMenu:!1,collapsible:!0,toolTips:!0,scrollBars:!0,responseLimit:1e3,config:"",lang:"en",location:"",math:"",text:""},A={},O=0,M=function(e){A[e.id()]=e,O+=1},_=function(e){delete A[e.id()]},D=function(e){var t="ee_"+O,n=y.getAttr(e,"id");return n&&!A[n]&&(t=n),n||y.setAttr(e,"id",t),t},P=function(e){if(e&&v.isString(e)){var t=e.indexOf("<math")===0,n=e.indexOf("<html")===0;!t&&!n&&(e=x+e+T);if(e.indexOf(" xmlns=")!==5){var r=t?g.NS_MATH:g.NS_HTML;e=e.substring(0,5)+' xmlns="'+r+'"'+e.substring(5)}}y.isNode(e)||(e=y.valueOf(e));var i=b.getName(e);return i!==g._math&&i!==g._html&&i!==g._hmath&&i!==g._div&&(e=null),e},H=function(e){y.isNode(e)&&y.children(e).length>0&&(e=y.toString(e));if(!e||!v.isString(e))return"";var t=e.indexOf("<math")===0,n=e.indexOf("<html")===0;!t&&!n&&(e=x+e+T);if(e.indexOf(" xmlns=")===-1){var r=t?g.NS_MATH:g.NS_HTML;e=e.substring(0,5)+' xmlns="'+r+'"'+e.substring(5)}return e},B=function(t,n){return t=P(t),this._options=n||{},this._id=D(t),this._xml=t,this._content=H(t),this._location=null,this._model=c.create(),this._model._editor=this,this.createPanels(),this};B.create=function(e,t){var n=new B(e,t);return M(n),n},B.prototype.initialize=function(e){var n=this,r=function(){n.processOptions(),n.build(),n._initialize(e)};t.base(this._options).ready(r)},B.prototype.build=function(){this.buildPanels();var e=this.getPanel(i.PARENT),t=this.model();return this._handler=h.create(e,t),this._brailleBar=s.create(e,t),this._buttonBar=o.create(e,t),this._carousel=u.create(e,t),this._moreMenu=l.create(e,t),this._quickBar=a.create(e,t),this._sideBar=f.create(e,t),this._ready=!1,this._callback=null,this.selection()._sideBar=this._sideBar,this.selection()._proxy=this._handler.proxy(),this.selection()._brailleBar=this._brailleBar,this.processContent(),this},B.getInstance=function(e){return A[e]||null},B.prototype._initialize=function(e){var t=this._xoptions.callback,n=this;this._doresize=function(){n.resize()},p(window).on("resize",this._doresize);var r=this.getPanel(i.PARENT),s=this._readyEvent,o=this.id(),u=function(){n.checkInteractionType(n.getResponseValues()),t&&t.apply(n),e&&e.apply(n),s&&r.trigger(s,o)};this._callback=u,this._ready&&this._callback&&this._callback()},B.prototype.finalize=function(){this.getPanel(i.PARENT).remove(),this._doblink&&(clearTimeout(this._doblink_),this._doblink_=null,this._doblink=null),this._doresize&&(p(window).off("resize",this._doresize),this._doresize=null),this._handler&&(this._handler.destroy(),this._handler=null),this._brailleBar&&(this._brailleBar.destroy(),this._brailleBar=null),this._buttonBar&&(this._buttonBar.destroy(),this._buttonBar=null),this._carousel&&(this._carousel.destroy(),this._carousel=null),this._quickBar&&(this._quickBar.destroy(),this._quickBar=null),this._sideBar&&(this._sideBar.destroy(),this._sideBar=null),this._moreMenu&&(this._moreMenu.destroy(),this._moreMenu=null),this._model&&(this._model.destroy(),this._model=null),_(this)},B.prototype.resize=function(){if(!this._model)return;var e=this.getPanel(i.PARENT),t=e.height();this.selection().update(),this.reflowPanels(),e.height()!==t&&this.resizeOthers()},B.prototype.resizeOthers=function(){var e=this.id();p.each(A,function(t,n){t!==e&&n&&n.resize()})},B.prototype.getAnswered=function(){return this.isAnsweredNotInitialMarkup()},B.prototype.isAnsweredNotInitialMarkup=function(){var e=this._initial,t=this.selection().getDocumentContent().toString(),n=!1;return e&&t&&(e=e.replace(/\(p\s*\(input\)\s*\)/,"(input)"),e=e.replace(/\(\(body\)/,"(body"),t=t.replace(/\(p\s*\(input\)\s*\)/,"(input)"),t=t.replace(/\(\(body\)/,"(body"),n=t!==e),n},B.prototype.getResponseData=function(){var e=this.getResponseValues();return this.checkResponseValues(e),e},B.prototype.setResponseData=function(e){if(!e){var t=this.getPanel(i.PARENT);t.trigger("eeResponseReady");return}this.model().startQueue(),this.model()._stopQueue=2,e.content&&this.setDocumentContent(e.content),e.values&&this.setGapValues(e.values),e.location&&this.setCurrentLocation(e.location),this.history().save(),this.getResponseData()},B.prototype.getResponseValues=function(){var e={};return e.location=this.getCurrentLocation(),e.values=this.getGapValues(),e.values||(e.content=this.getResponseContent(),e.presentation=this.getResponsePresent()),e},B.prototype.getResponseContent=function(){return y.toString(this.getDocumentContentXML())},B.prototype.getResponsePresent=function(){return y.toString(this.getDocumentPresentXML())},B.prototype.getGapValues=function(){var e=this.selection().getDocumentContent(),t=this.getDocumentContentXML(),n=this.getResponseSelector(),r;return t&&n&&p(t).find("csymbol").each(function(){var t=p(this);if(t.text()!==n)return;var i=t.attr("id");if(!i)return;var s=e.findId(i);if(!s)return;s=s.getOpParent().getApplyArg(1);var o=s.getPresent();if(!o)return;r||(r=[]);var u=y.toString(s.markup()),a=y.toString(o.markup()),f={identifier:i,content:u,presentation:a};r.push(f)}),r},B.prototype.setGapValues=function(e){var t=this.selection().getDocumentContent(),n=this;d.each(e,function(e){if(!e.identifier||!e.content)return;var r=t.findId(e.identifier);if(!r)return;r=r.getOpParent().getApplyArg(1),n.selection().moveToContent(r),n.setCurrentContent(e.content)})};var j=function(t){e.log("EquationEditor.getResponseData:  "+t.error)},F=function(e){if(window.TN8&&window.TN8.Application){var t=TN8.Application.error;if(t&&t.type&&t.showError){var n=t.type.EE_INTERACTION_TYPE_ERROR;t.showError(e.error,n)}}};return B.prototype.checkInteractionType=function(e){var t=!0;t=t&&this.checkResponseType(e),t=t&&this.checkGapUse(e),t=t&&this.checkGapIds(e),t||(j(e),F(e))},B.prototype.checkResponseValues=function(e){var t=!0;this.checkResponseType(e),t=t&&this.checkGapValues(e),t=t&&this.checkResponseValue(e),t?(delete e.styles,delete e.loaded,delete e.style,delete e.error):j(e)},B.prototype.checkResponseType=function(e){var t=this.config().getStyleNames(this._xoptions.styles),n=this.config().getLoaded(),r=null,i=null;t.unshift("basic"),d.contains(t,"basic")&&(r="ee-basic"),d.contains(t,"fill-in")&&(r="ee-fill-in"),d.contains(t,"text")&&(r="ee-text");var s=[];return d.each(t,function(e){e&&!d.contains(n,e)&&!d.contains(s,e)&&s.push(e)}),d.isEmpty(s)||(i="The item interaction type(s) were not loaded:  "+s.join(" ")+"."),e.styles=t,e.loaded=n,e.style=r,e.error=i,i===null},B.prototype.checkGapUse=function(e){var t=e.values?!0:!1,n=e.style==="ee-fill-in",r=null;return t&&!n&&(r="The response uses gap values, but the item does not."),n&&!t&&(r="The item uses gap values, but the response does not."),e.error=r,r===null},B.prototype.checkGapIds=function(e){if(!e.values)return!0;var t={},n=[],r=null;return d.each(e.values,function(e){var r=e.identifier;r&&t[r]===r&&!d.contains(n,r)&&d.add(n,r),t[r]=r}),d.isEmpty(n)||(r="The response repeats gap identifier(s):  "+n.join(" ")+"."),e.error=r,r===null},B.prototype.checkGapValues=function(e){if(!e.values)return!0;var t=null,n=!1,r=[];return d.each(e.values,function(e){var i=E.valueOf(e.content);i===null?t="Could not parse response markup:  "+e.content:N(i,n,r)}),d.isEmpty(r)||(t="The response uses invalid operator(s):  "+r.join(" ")+"."),e.error=t,t===null},B.prototype.checkResponseValue=function(e){if(!e.content)return!0;var t=null,n=e.style==="ee-text",r=[],i=E.valueOf(e.content);return i===null?t="Could not parse response markup:  "+e.content:N(i,n,r),d.isEmpty(r)||(t="The response uses invalid operator(s):  "+r.join(" ")+"."),e.error=t,t===null},N=function(e,t,n){if(!e.isApply())return;var r=e.getOp(),i=r.getName();!C(r,t)&&!d.contains(n,i)&&n.push(i);var s=e.getApplyArgc(),o;for(o=1;o<=s;o+=1)N(e.getApplyArg(o),t,n)},C=function(e,t){return e===g._math||e===g._box?!0:n.isContentElt(e)?!0:n.isContentOp(e)?!0:n.isCustomOp(e)?!0:n.isCustomConstant(e)?!0:t&&e===g._html?!0:t&&n.isTextElt(e)?!0:!1},B.prototype._panels=null,B.prototype.createPanel=function(e){var t=p("<div/>").addClass(e);return this._panels[e]=t,t},B.prototype.getPanel=function(e){return this._panels[e]||null},B.prototype.getProxy=function(){var e;return this._handler?e=this._handler.proxy():e=this.getPanel(i.INPUT),e},B.prototype.createPanels=function(){this._panels={};var t=this.createPanel(i.PARENT),n=this.createPanel(i.BAR),r=this.createPanel(i.CAROUSEL),s=this.createPanel(i.QUICK),o=this.createPanel(i.CHILD),u=this.createPanel(i.INPUT),a=this.createPanel(i.SCRATCH),f=this.createPanel(i.SIDE),l=this.createPanel(i.MORE),c=this.createPanel(i.BRAILLE),h=this.createPanel(i.SPEECH);t.append(o,s,f,l,c,n,r),o.append(u,a,h),t.attr("id","ee-"+this.id()),t.addClass(e.isTouch?"touch":"no-touch"),p(document.body).attr("role")==="application"?t.attr("aria-label"," "):t.attr("role","application"),u.attr("role","paragraph"),u.attr("tabindex",0),a.attr("aria-hidden",!0);var d=p('<span aria-live="polite" aria-atomic="true">');h.append(d),t.attr("tabindex",-1)},B.prototype.buildPanels=function(){var e=this.getPanel(i.PARENT),t=this.getPanel(i.QUICK),n=this.getPanel(i.SIDE),r=this.getPanel(i.MORE),s=this.getWidth()||this.getMaxWidth()||"",o=this.getHeight()||"";s&&e.css("width",s),o&&e.css("height",o),this.getHeight()===0&&(n.height(200),r.height(200));if(this.getResize()&&e.resizable){var u=this,a={minWidth:this.getMinWidth(),maxWidth:this.getMaxWidth(),grid:[44,1],zIndex:3,resize:function(){var n=t.height()+34;e.resizable("option","minHeight",n),u.resize()}};e.resizable(a)}},B.prototype.reflowPanels=function(){var t=this.getPanel(i.PARENT),n=this.getPanel(i.QUICK),r=this.getPanel(i.CHILD),s=this.getPanel(i.INPUT),o=this.getPanel(i.SIDE),u=this.getPanel(i.MORE),a=this.getPanel(i.BRAILLE),f=this.getPanel(i.BAR),l=this.getPanel(i.CAROUSEL),c=p(t).find("."+i.PROXY),h=this.getHeight(),d=0,v=0,m=0;n.is(":visible")&&(d+=n.outerHeight(!0)),o.is(":visible")&&o.css("position")==="absolute"&&(m+=o.outerWidth(!0)),a.is(":visible")&&(v+=a.outerHeight(!0)),f.is(":visible")&&(v+=f.outerHeight(!0)),l.is(":visible")&&(v+=l.outerHeight(!0));var g=h,y,b;if(g===0){s.css("height",""),s.css("min-height",""),y=s[0].clientHeight,b=s[0].scrollHeight+16,m>0&&b<200&&(b=200),b>y&&s.css("min-height",b),o.height(200),u.height(200),r.css("marginRight",m),r.css("top",d),g=r.outerHeight(),o.css("top",d),c.css("top",-g),t.height(d+g+v);return}g-=d,g-=v;var w=g;g-=r.outerHeight()-r.height();var E=g,S=s.outerHeight()-s.height();g-=S;var x=g;y=s[0].clientHeight-S,b=s[0].scrollHeight-S;var T=s[0].clientWidth,N=s[0].scrollWidth;N>T&&(b+=s.innerHeight()-s[0].clientHeight);var C=b-x;b>30&&y===x&&(C=0),C>v&&(C=v),C>0&&(h+=C,w+=C,E+=C,x+=C);var k=w-(o.outerHeight()-o.height()),L=w-(u.outerHeight()-u.height());p().jquery<"1.8"&&(k=w,L=w,E+=r.outerHeight()-r.height(),x+=s.outerHeight()-s.height()),e.isIE&&(x+=s.outerHeight()-s[0].clientHeight),t.height(h),o.height(k),u.height(L),p(".ee-more-panel",u).height(L),r.css("marginRight",m),r.css("top",d),r.height(E),o.css("top",d),a.css("top",d),c.css("top",-x),s.height(x),c.height(x),c.css("marginBottom",-x),s.css("width",""),o.css("width",""),u.css("width",""),this.getSideBar()&&this.getBrailleBar()&&a.css("marginRight","12px")},B.prototype.processStyleOptions=function(e){if(!e||!v.isString(e))return null;var n=this.config(),r={},i=n.getStyleNames(e),s=!0;return d.each(t.basic().getLoaded(),function(e){s=s&&d.contains(i,e)}),s&&(n=t.basic(),this.model().setConfig(n)),d.each(i,function(e){var t=n.getStyleData(e);d.each(k,function(e){var n=y.getAttr(t,e);n&&(r[e]=n)})}),r},B.prototype.processOptions=function(){var e=this.id(),t=this._options.models||[],n=null;d.each(t,function(t){t.identifier===e&&(n=t)});var r=v.extend({},L,n);r.keyMode==="last"&&(r.keyMode=c._lastKeyMode);var i={};p.i18n&&p.i18n.lng&&(i.lang=p.i18n.lng());var s=this.processStyleOptions(r.styles);r=v.extend({},L,s,i,n),this._xoptions=r,this.setWidth(r.width),this.setHeight(r.height),this.setMinWidth(r.minWidth),this.setMaxWidth(r.maxWidth),this.setColor(r.color),this.setBackground(r.background),this.setContrast(r.contrast),this.setHAlign(r.halign),this.setVAlign(r.valign),this.setFontSize(r.fontSize),this.setFontFamily(r.fontFamily),this.setFontWeight(r.fontWeight),this.setFontStyle(r.fontStyle),this.setFontVariant(r.fontVariant),this.setMathFontFamily(r.mathFontFamily),this.setTextFontFamily(r.textFontFamily),this.setResize(r.resize),this.setAutoSize(r.autoSize),this.setGrabFocus(r.grabFocus),this.setEditableSelector(r.editableSelector),this.setResponseSelector(r.responseSelector),this.setMathIt(r.mathIt),this.setMathSense(r.mathSense),this.setEchoAction(r.echoAction),this.setKeyMode(r.keyMode),this.setBrailleBar(r.brailleBar),this.setButtonBar(r.buttonBar),this.setCarousel(r.carousel),this.setQuickBar(r.quickBar),this.setSideBar(r.sideBar),this.setMoreMenu(r.moreMenu),this.setCollapsible(r.collapsible),this.setToolTips(r.toolTips),this.setScrollBars(r.scrollBars),this.setResponseLimit(r.responseLimit),r.styles&&this.pushStyles(r.styles),r.config&&this.pushConfig(r.config),r.lang&&r.lang!=="en"&&this.pushStyles("lang-"+r.lang),r.ready&&(this._readyEvent=r.ready),r.location&&(this._location=r.location),r.math&&(this._content=H(r.math)),r.text&&(this._content=H(r.text))},B.prototype.processContent=function(){var t=this.getResponseLimit(),n=this.expandContent(y.valueOf(this._content)),r=n.getExpressionCount(),i=!1;if(t===0||r<t)try{this.selection().setDocumentContent(n)}catch(s){i=!0}else i=!0;if(i){e.log("EE:  invalid response"),this.setDocumentContent("");var o="eeInvalidResponse",u=this.id(),a={id:u,xml:this._content};p(document).trigger(o,a)}this.processPresent()},B.prototype.processStyle=function(){var e=this.getDocumentPresentXML(),t=y.namespaceURI(e)===g.NS_MATH,n;if(t)e.setAttribute("fontsize",this.getFontSize()+"px"),n=this.getFontFamily(),n&&e.setAttribute("fontfamily",n),n=this.getFontWeight(),n&&e.setAttribute("fontweight",n),n=this.getFontStyle(),n&&e.setAttribute("fontstyle",n),n=this.getFontVariant(),n&&e.setAttribute("mathvariant",n),n=this.getMathFontFamily(),n&&e.setAttribute("fontfamily",n);else{var r={};r["font-size"]=this.getFontSize()+"px",n=this.getFontFamily(),n&&(r["font-family"]=n),n=this.getFontWeight(),n&&(r["font-weight"]=n),n=this.getFontStyle(),n&&(r["font-style"]=n),n=this.getTextFontFamily(),n&&(r["font-family"]=n),p(e).css(r),n=this.getMathFontFamily(),n&&p("math",e).attr("fontfamily",n)}return e},B.prototype.processPresent=function(){var t=this.getPanel(i.PARENT),n=this.getPanel(i.INPUT),r=this.getPanel(i.SCRATCH),s=this.xml(),o=this.processStyle();r.prepend(o),s&&s.parentNode&&p(s).replaceWith(t),this.reflowPanels();var u=this,a=function(){var e=u.model();if(e===null)return;var t=r.children().first();t.hasClass("MathJax_Preview")&&(t.remove(),t=r.children().first()),t.attr("tabindex",-1),p("[tabindex]",t).attr("tabindex",-1),t=t.clone(),t.removeAttr("id"),p("[id]",t).removeAttr("id"),p(".MJX_Assistive_MathML",t).removeAttr("aria-hidden"),t.css("position",""),t.attr("role","math"),p(".MathJax_Preview",t).remove(),p("script",t).remove(),n.empty(),n.append(t),e._typesetCount-=1,u.processDisplay(),u.processModel()};this.model()._typesetCount+=1;if(window.MathJax&&window.MathJax.Hub){this._update=function(){var e=u.model();e!==null&&(e._pendingCount+=1)};var f=r[0];MathJax.Hub.Queue(["Typeset",MathJax.Hub,f,a])}else e.runOnce(100,a)},B.prototype.processDisplay=function(){var e=this.getPanel(i.INPUT)[0],t=w.create(e.firstChild);this.selection().setDisplay(t),this.resize(),window.MathJax&&t.addChangeListener(this._update)},B.prototype.processModel=function(){this.getGrabFocus()&&(this.selection().onDone(),this.requestFocus()),this._location?this.setCurrentLocation(this._location):this.requestPlaceRight(),this.history().save(),this.history().clearOlder(),this._initial=this.selection().getDocumentContent().toString(),this.selection()._update(),this.model()._stopQueue=1,this._ready=!0,this._callback&&this._callback()},B.prototype.id=function(){return this._id},B.prototype.xml=function(){return this._xml},B.prototype.model=function(){return this._model},B.prototype.history=function(){return this.model().getHistory()},B.prototype.selection=function(){return this.model().getSelection()},B.prototype.config=function(){return this.model().getConfig()},B.prototype.setXML=function(e){e=P(e),this._xml=e,this._content=H(e),this.processContent()},B.prototype.pushStyles=function(e){this.model().setConfig(this.config().pushStyles(e))},B.prototype.pushConfig=function(e){this.model().setConfig(this.config().push(e))},B.prototype.popConfig=function(){this.model().setConfig(this.config().pop())},B.prototype.resetConfig=function(){this.model().setConfig(this.config().reset())},B.prototype._width=0,B.prototype.getWidth=function(){return this._width},B.prototype.setWidth=function(e){e==="100%"&&(e=0),v.isString(e)&&(e=v.toInteger(e)),v.isInteger(e)&&e>=0&&(this._width=e)},B.prototype._height=0,B.prototype.getHeight=function(){return this._height},B.prototype.setHeight=function(e){e==="100%"&&(e=0),v.isString(e)&&(e=v.toInteger(e)),v.isInteger(e)&&e>=0&&(this._height=e)},B.prototype._minWidth=0,B.prototype.getMinWidth=function(){return this._minWidth},B.prototype.setMinWidth=function(e){v.isString(e)&&(e=v.toInteger(e)),v.isInteger(e)&&e>=0&&(this._minWidth=e)},B.prototype._maxWidth=0,B.prototype.getMaxWidth=function(){return this._maxWidth},B.prototype.setMaxWidth=function(e){v.isString(e)&&(e=v.toInteger(e)),v.isInteger(e)&&e>=0&&(this._maxWidth=e)},B.prototype._color=m.transparent,B.prototype.getColor=function(){return m.toString(this._color)},B.prototype.setColor=function(e){v.isString(e)&&(e=m.valueOf(e)),v.isUInt(e)&&(this._color=e);var t=e===m.transparent?"":this.getColor();this.getPanel(i.INPUT).css("color",t)},B.prototype._background=m.transparent,B.prototype.getBackground=function(){return m.toString(this._background)},B.prototype.setBackground=function(e){v.isString(e)&&(e=m.valueOf(e)),v.isUInt(e)&&(this._background=e);var t=e===m.transparent?"":this.getBackground();this.getPanel(i.CHILD).css("background-color",t)},B.prototype.getContrast=function(){return this.model().getContrast()},B.prototype.setContrast=function(e){this.model().setContrast(e);var t=this.getContrast();t&&this.getPanel(i.PARENT).addClass("ee-"+t)},B.prototype._halign="left",B.prototype.getHAlign=function(){return this._halign},B.prototype.setHAlign=function(e){v.isString(e)&&(this._halign=e);var t=this.getPanel(i.INPUT);t.css("text-align",this.getHAlign())},B.prototype._valign="top",B.prototype.getVAlign=function(){return this._valign},B.prototype.setVAlign=function(e){v.isString(e)&&(this._valign=e)},B.prototype._fontSize=24,B.prototype.getFontSize=function(){return this._fontSize},B.prototype.setFontSize=function(e){v.isString(e)&&(e=v.toInteger(e)),v.isInteger(e)&&e>0&&(this._fontSize=e)},B.prototype._fontFamily="",B.prototype.getFontFamily=function(){return this._fontFamily},B.prototype.setFontFamily=function(e){v.isString(e)&&(this._fontFamily=e)},B.prototype._fontWeight="",B.prototype.getFontWeight=function(){return this._fontWeight},B.prototype.setFontWeight=function(e){v.isString(e)&&(this._fontWeight=e)},B.prototype._fontStyle="",B.prototype.getFontStyle=function(){return this._fontStyle},B.prototype.setFontStyle=function(e){v.isString(e)&&(this._fontStyle=e)},B.prototype._fontVariant="",B.prototype.getFontVariant=function(){return this._fontVariant},B.prototype.setFontVariant=function(e){v.isString(e)&&(this._fontVariant=e)},B.prototype._mathFontFamily="",B.prototype.getMathFontFamily=function(){return this._mathFontFamily},B.prototype.setMathFontFamily=function(e){v.isString(e)&&(this._mathFontFamily=e)},B.prototype._textFontFamily="",B.prototype.getTextFontFamily=function(){return this._textFontFamily},B.prototype.setTextFontFamily=function(e){v.isString(e)&&(this._textFontFamily=e)},B.prototype._resize=!1,B.prototype.getResize=function(){return this._resize},B.prototype.setResize=function(e){v.isString(e)&&(e=v.toBoolean(e)),v.isBoolean(e)&&(this._resize=e)},B.prototype._autoSize=!1,B.prototype.getAutoSize=function(){return this._autoSize},B.prototype.setAutoSize=function(e){v.isString(e)&&(e=v.toBoolean(e)),v.isBoolean(e)&&(this._autoSize=e)},B.prototype._grabFocus=!1,B.prototype.getGrabFocus=function(){return this._grabFocus},B.prototype.setGrabFocus=function(e){v.isString(e)&&(e=v.toBoolean(e)),v.isBoolean(e)&&(this._grabFocus=e)},B.prototype.getEditableSelector=function(){return this.model().getEditableSelector()},B.prototype.setEditableSelector=function(e){this.model().setEditableSelector(e)},B.prototype.getResponseSelector=function(){return this.model().getResponseSelector()},B.prototype.setResponseSelector=function(e){this.model().setResponseSelector(e)},B.prototype.getMathIt=function(){return this.model().getMathIt()},B.prototype.setMathIt=function(e){this.model().setMathIt(e)},B.prototype.getMathSense=function(){return this.model().getMathSense()},B.prototype.setMathSense=function(e){this.model().setMathSense(e)},B.prototype.getEchoAction=function(){return this.model().getEchoAction()},B.prototype.setEchoAction=function(e){this.model().setEchoAction(e)},B.prototype.getKeyMode=function(){return this.model().getKeyMode()},B.prototype.setKeyMode=function(e){this.model().setKeyMode(e)},B.prototype.getBrailleBar=function(){return this.model().getBrailleBar()},B.prototype.setBrailleBar=function(e){this.model().setBrailleBar(e)},B.prototype.getButtonBar=function(){return this.model().getButtonBar()},B.prototype.setButtonBar=function(e){this.model().setButtonBar(e)},B.prototype.getCarousel=function(){return this.model().getCarousel()},B.prototype.setCarousel=function(e){this.model().setCarousel(e)},B.prototype.getQuickBar=function(){return this.model().getQuickBar()},B.prototype.setQuickBar=function(e){this.model().setQuickBar(e)},B.prototype.getSideBar=function(){return this.model().getSideBar()},B.prototype.setSideBar=function(e){this.model().setSideBar(e)},B.prototype.getMoreMenu=function(){return this.model().getMoreMenu()},B.prototype.setMoreMenu=function(e){this.model().setMoreMenu(e)},B.prototype.getCollapsible=function(){return this.model().getCollapsible()},B.prototype.setCollapsible=function(e){this.model().setCollapsible(e)},B.prototype.getToolTips=function(){return this.model().getToolTips()},B.prototype.setToolTips=function(e){this.model().setToolTips(e)},B.prototype.getScrollBars=function(){return this.model().getScrollBars()},B.prototype.setScrollBars=function(e){this.model().setScrollBars(e)},B.prototype.getResponseLimit=function(){return this.model().getResponseLimit()},B.prototype.setResponseLimit=function(e){this.model().setResponseLimit(e)},B.prototype.getContent=function(){return this.getDocumentContent()},B.prototype.setContent=function(e){this.setDocumentContent(e)},B.prototype.getPresent=function(){return this.getDocumentPresent()},B.prototype.getDocumentContent=function(){return y.print(this.getDocumentContentXML())},B.prototype.setDocumentContent=function(e){this.setDocumentContentXML(y.valueOf(e))},B.prototype.getDocumentPresent=function(){return y.print(this.getDocumentPresentXML())},B.prototype.getCurrentContent=function(){return y.print(b.math(this.getCurrentContentXML()))},B.prototype.setCurrentContent=function(e){this.setCurrentContentXML(b.root(y.valueOf(e)))},B.prototype.getCurrentPresent=function(){return y.print(b.math(this.getCurrentPresentXML()))},B.prototype.getCurrentLocation=function(){return this.selection().getLocation()},B.prototype.setCurrentLocation=function(e){this.selection().setLocation(e)},B.prototype.getDocumentContentXML=function(){return this.selection().getDocumentContent().markup()},B.prototype.setDocumentContentXML=function(e){this.selection().setDocumentContent(this.expandContent(e))},B.prototype.getDocumentPresentXML=function(){return this.selection().getDocumentPresent().markup()},B.prototype.getCurrentContentXML=function(){return this.selection().getCurrentContent().markup()},B.prototype.setCurrentContentXML=function(e){this.selection().setCurrentContent(this.expandContent(e))},B.prototype.getCurrentPresentXML=function(){return this.selection().getCurrentPresent().markup()},B.prototype.expandContent=function(e){var t=this.config(),n=E.expand(e,t);n instanceof E||(n=E.create(t).createPlace());var r=this.selection().getDocumentContent().getOp(),i=n.getOp();return r===g._html&&i===g._math&&(n=n.createApplyOp(g._p,n),n=n.createApplyOp(g._body,n),n=n.createApplyOp(g._html,n),n.setAttrib(g._xmlns,g.get(g.NS_HTML))),r===g._math&&i===g._html&&this._ready&&(n=n.findOp(g._math)||E.create(t).createPlace()),i!==g._math&&i!==g._html&&(n=n.createApplyOp(g._math,n),n.setAttrib(g._xmlns,g.get(g.NS_MATH))),n},B.prototype.hasFocus=function(){return e.hasFocus(this.getProxy())},B.prototype.setFocus=function(){this.requestFocus()},B.prototype.requestFocus=function(){var t=this.getProxy()[0];t&&t.parentNode&&e.runOnce(100,function(){p(t).trigger("focus")})},B.prototype.requestDone=function(){this.selection().onDone()},B.prototype.requestSelect=function(){this.selection().isDone()&&this.selection().onRoot()},B.prototype.requestPlaceLeft=function(){if(this.selection().isDone()){var e=this.getEchoAction();this.setEchoAction(!1),S.processPlaceLeft(this.model()),this.setEchoAction(e)}},B.prototype.requestPlaceRight=function(){if(this.selection().isDone()){var e=this.getEchoAction();this.setEchoAction(!1),S.processPlaceRight(this.model()),this.setEchoAction(e)}},B.prototype.processTemplate=function(e){var t=this.getEchoAction();this.setEchoAction(!1),S.process(g.user(e),this.model()),this.setEchoAction(t)},B.prototype.undo=function(){this.history().undo()},B.prototype.redo=function(){this.history().redo()},B.prototype.saveHistory=function(){this.history().save()},B.prototype.restoreHistory=function(){this.history().restore()},B.prototype.resetHistory=function(){this.history().reset()},B.prototype.clearHistory=function(){this.history().clear()},B.prototype.getUnicodeBraille=function(){var e=this.selection().getDocumentContent();return this._brailleBar.processContent(e)},B}),n("editor/model/Factory",["editor/util/Utils","editor/config/Config","editor/expr/Content","editor/model/Model","editor/model/Editor"],function(e,t,n,r,i){var s=e.$,o=e.Object,u=e.Array,a={div:"ee-factory",ready:"eeFactoryReady",mobile:"auto",styleBase:"../../deploy/equationeditor/styles",models:[{identifier:"RESPONSE",styles:"ee-full",width:612}]};window.TN8&&(a.styleBase="public/javascripts/equationeditor/styles");var f=function(e){return o.extend({},a,e)},l=function(t){t instanceof Function||(t=function(){return!0}),e.require(["lib/mathjax"],t)},c=function(e,n){n instanceof Function||(n=function(){return!0}),l(function(){t.base(e).ready(n)})},h=!1,p=function(){return h},d=function(t,n){t=f(t),n=n||t.callback;var i=t.mobile;o.isString(i)&&(i=o.toBoolean(i)),o.isBoolean(i)&&(e.isMobile=i);var u=function(){h=!0,n&&n(),t.ready&&s(document).trigger(t.ready)};r.clipboardData=null,c(t,u)},v=function(e){e=f(e);var t=null,n=s("#"+e.div);return u.each(e.models,function(r){var o=s();e.div!==r.identifier&&(o=s("#"+r.identifier)),o.length===0&&(n.length===0&&(n=s('<div id="'+e.div+'"/>'),s(document.body).append(n)),o=s("#"+r.identifier,n),o.length===0&&(o=s('<div id="'+r.identifier+'"/>'),n.append(o)));var u=i.create(o[0],e);t===null&&(t=u)}),t},m=function(e,t){e=f(e);var n=1,r=function(){n-=1,n===0&&t&&t()},o=s("#"+e.div);u.each(e.models,function(t){var u=s();e.div!==t.identifier&&(u=s("#"+t.identifier)),u.length===0&&(o.length===0&&(o=s('<div id="'+e.div+'"/>'),s(document.body).append(o)),u=s("#"+t.identifier,o),u.length===0&&(u=s('<div id="'+t.identifier+'"/>'),o.append(u))),n+=1;var a=i.create(u[0],e);a.initialize(r)}),r()},g=function(e,t){t=t||e.callback,d(e,function(){m(e,t)})},y=function(){var e=function(e){e=f(e);var n=this;c(e,function(){t.base(e).ready(function(){n.config=t.basic(),e.callback&&e.callback(),s(document).trigger("transformerReady")})})},r=function(e){return n.transform(e,this.config)},i={initialize:e,transform:r};return i},b={ready:p,initialize:d,getInstance:i.getInstance,createInstance:v,createTransformer:y,process:g};return b}),n("main",["editor/model/Factory"],function(e){var t={ready:e.ready,initialize:e.initialize,getInstance:e.getInstance,createInstance:e.createInstance,createTransformer:e.createTransformer,process:e.process,version:"0.1.2",timeStamp:"21-Sep-2022 20:09:41Z"};return t}),n("lib/require",function(e){return function(){return t}}(this)),n("lib/jquery",function(e){return function(){return e.jQuery}}(this)),n("lib/bootstrap",function(e){return function(){return e.jQuery}}(this)),n("lib/mathjax",function(e){return function(){return e.MathJax}}(this)),t("main")});